import{A as Yh,B as Kh,C as U,D as B,E as Zh,F as Xh,G as ti,H as as,I as Qh,J as An,K as z,L as Jh,M as ii,N as xt,O as ef,P as pt,Q as So,R as ls,S as bi,T as rt,a as Ll,b as wi,c as Le,d as Nh,e as In,f as Ki,g as kn,h as ar,i as Kn,j as tt,k as Zn,l as Si,m as ue,n as Uh,o as Oe,p as Vh,q as Hh,r as Xn,s as jh,t as qs,u as Nl,v as $h,w as Ul,x as zh,y as Wh,z as qh}from"./chunk-6SNFERDM.js";import{$ as js,$a as Ci,$b as N,A as De,Aa as sr,Ab as me,B as Se,Ba as vi,Bb as kh,C as Ze,Ca as pi,Cb as Yi,D as u,Da as $e,Db as p,E as lh,Ea as G,Eb as H,F as is,Fa as Ht,Fb as D,G as w,Ga as zs,Gb as Ee,H as S,Ha as bh,Hb as Ah,I as ch,Ia as v,Ib as te,J as Ne,Ja as Pe,Jb as ie,K as ke,Ka as pe,Kb as ne,L as _o,La as qn,Lb as Re,M as ir,Ma as V,Mb as Ve,N as dh,Na as K,Nb as q,O as rp,Oa as xh,Ob as Rl,P as k,Pa as ze,Pb as Bl,Q as sp,Qa as Ae,Qb as et,R as Il,Ra as Pn,Rb as ot,S as vo,Sa as Mh,Sb as ht,T as Co,Ta as Al,Tb as Oi,U as ph,Ua as Ol,Ub as xe,V as ap,Va as up,Vb as Me,W as Wn,Wa as Fl,Wb as ve,X as nr,Xa as Dh,Xb as En,Y as Ge,Ya as Ws,Yb as ae,Z as ns,Za as Ph,Zb as ss,_ as kl,_a as Eh,_b as mn,a as T,aa as lp,ab as x,ac as It,b as J,ba as bt,bb as M,bc as Oh,ca as W,cb as j,cc as Yn,d as Jr,da as Ue,db as le,dc as Fh,ea as cp,eb as P,ec as Rh,f as yi,fa as uh,fb as E,fc as hn,g as tr,ga as $s,gb as f,gc as hp,h as X,ha as mh,hb as a,hc as fp,i as un,ia as or,ib as l,ic as Bh,j as es,ja as hh,jb as g,jc as Gh,k as op,ka as dp,kb as We,kc as Tn,l as Xt,la as pp,lb as I,lc as Lh,m as ts,ma as os,mb as mp,mc as Gl,n as ih,na as rs,nb as y,o as nh,oa as fh,ob as m,p as oh,pa as gh,pb as lt,q as rh,qa as yh,qb as Xe,r as sh,ra as _h,rb as Th,s as _i,sa as vh,sb as Et,t as ah,ta as Ch,tb as _t,u as yo,ua as wh,ub as vt,v as Ai,va as rr,vb as Ih,w as di,wa as qi,wb as Tt,x as zn,xa as wo,xb as ei,y as Wi,ya as Sh,yb as ce,z as A,za as c,zb as se}from"./chunk-KSOMLFX6.js";var of=null;function Fi(){return of}function gp(n){of??=n}var Ys=class{},yp=(()=>{class n{historyGo(i){throw new Error("")}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:()=>u(rf),providedIn:"platform"})}return n})();var rf=(()=>{class n extends yp{_location;_history;_doc=u(ke);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Fi().getBaseHref(this._doc)}onPopState(i){let t=Fi().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",i,!1),()=>t.removeEventListener("popstate",i)}onHashChange(i){let t=Fi().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",i,!1),()=>t.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,t,o){this._history.pushState(i,t,o)}replaceState(i,t,o){this._history.replaceState(i,t,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function sf(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function tf(n){let e=n.search(/#|\?|$/);return n[e-1]==="/"?n.slice(0,e-1)+n.slice(e):n}function bo(n){return n&&n[0]!=="?"?`?${n}`:n}var Vl=(()=>{class n{historyGo(i){throw new Error("")}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:()=>u(lf),providedIn:"root"})}return n})(),af=new Se(""),lf=(()=>{class n extends Vl{_platformLocation;_baseHref;_removeListenerFns=[];constructor(i,t){super(),this._platformLocation=i,this._baseHref=t??this._platformLocation.getBaseHrefFromDOM()??u(ke).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return sf(this._baseHref,i)}path(i=!1){let t=this._platformLocation.pathname+bo(this._platformLocation.search),o=this._platformLocation.hash;return o&&i?`${t}${o}`:t}pushState(i,t,o,r){let s=this.prepareExternalUrl(o+bo(r));this._platformLocation.pushState(i,t,s)}replaceState(i,t,o,r){let s=this.prepareExternalUrl(o+bo(r));this._platformLocation.replaceState(i,t,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(t){return new(t||n)(Ze(yp),Ze(af,8))};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Hl=(()=>{class n{_subject=new X;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(i){this._locationStrategy=i;let t=this._locationStrategy.getBaseHref();this._basePath=L_(tf(nf(t))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,t=""){return this.path()==this.normalize(i+bo(t))}normalize(i){return n.stripTrailingSlash(G_(this._basePath,nf(i)))}prepareExternalUrl(i){return i&&i[0]!=="/"&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,t="",o=null){this._locationStrategy.pushState(o,"",i,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+bo(t)),o)}replaceState(i,t="",o=null){this._locationStrategy.replaceState(o,"",i,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+bo(t)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription??=this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)}),()=>{let t=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(t,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",t){this._urlChangeListeners.forEach(o=>o(i,t))}subscribe(i,t,o){return this._subject.subscribe({next:i,error:t??void 0,complete:o??void 0})}static normalizeQueryParams=bo;static joinWithSlash=sf;static stripTrailingSlash=tf;static \u0275fac=function(t){return new(t||n)(Ze(Vl))};static \u0275prov=A({token:n,factory:()=>B_(),providedIn:"root"})}return n})();function B_(){return new Hl(Ze(Vl))}function G_(n,e){if(!n||!e.startsWith(n))return e;let i=e.substring(n.length);return i===""||["/",";","?","#"].includes(i[0])?i:e}function nf(n){return n.replace(/\/index.html$/,"")}function L_(n){if(new RegExp("^(https?:)?//").test(n)){let[,i]=n.split(/\/\/[^\/]+/);return i}return n}var _p=/\s+/,cf=[],Zi=(()=>{class n{_ngEl;_renderer;initialClasses=cf;rawClass;stateMap=new Map;constructor(i,t){this._ngEl=i,this._renderer=t}set klass(i){this.initialClasses=i!=null?i.trim().split(_p):cf}set ngClass(i){this.rawClass=typeof i=="string"?i.trim().split(_p):i}ngDoCheck(){for(let t of this.initialClasses)this._updateState(t,!0);let i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(let t of i)this._updateState(t,!0);else if(i!=null)for(let t of Object.keys(i))this._updateState(t,!!i[t]);this._applyStateDiff()}_updateState(i,t){let o=this.stateMap.get(i);o!==void 0?(o.enabled!==t&&(o.changed=!0,o.enabled=t),o.touched=!0):this.stateMap.set(i,{enabled:t,changed:!0,touched:!0})}_applyStateDiff(){for(let i of this.stateMap){let t=i[0],o=i[1];o.changed?(this._toggleClass(t,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(t,!1),this.stateMap.delete(t)),o.touched=!1}}_toggleClass(i,t){i=i.trim(),i.length>0&&i.split(_p).forEach(o=>{t?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(t){return new(t||n)(G(Ue),G($e))};static \u0275dir=pe({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})(),wp=(()=>{class n{_viewContainerRef;ngComponentOutlet=null;ngComponentOutletInputs;ngComponentOutletInjector;ngComponentOutletContent;ngComponentOutletNgModule;ngComponentOutletNgModuleFactory;_componentRef;_moduleRef;_inputsUsed=new Map;get componentInstance(){return this._componentRef?.instance??null}constructor(i){this._viewContainerRef=i}_needToReCreateNgModuleInstance(i){return i.ngComponentOutletNgModule!==void 0||i.ngComponentOutletNgModuleFactory!==void 0}_needToReCreateComponentInstance(i){return i.ngComponentOutlet!==void 0||i.ngComponentOutletContent!==void 0||i.ngComponentOutletInjector!==void 0||this._needToReCreateNgModuleInstance(i)}ngOnChanges(i){if(this._needToReCreateComponentInstance(i)&&(this._viewContainerRef.clear(),this._inputsUsed.clear(),this._componentRef=void 0,this.ngComponentOutlet)){let t=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;this._needToReCreateNgModuleInstance(i)&&(this._moduleRef?.destroy(),this.ngComponentOutletNgModule?this._moduleRef=bh(this.ngComponentOutletNgModule,df(t)):this.ngComponentOutletNgModuleFactory?this._moduleRef=this.ngComponentOutletNgModuleFactory.create(df(t)):this._moduleRef=void 0),this._componentRef=this._viewContainerRef.createComponent(this.ngComponentOutlet,{injector:t,ngModuleRef:this._moduleRef,projectableNodes:this.ngComponentOutletContent})}}ngDoCheck(){if(this._componentRef){if(this.ngComponentOutletInputs)for(let i of Object.keys(this.ngComponentOutletInputs))this._inputsUsed.set(i,!0);this._applyInputStateDiff(this._componentRef)}}ngOnDestroy(){this._moduleRef?.destroy()}_applyInputStateDiff(i){for(let[t,o]of this._inputsUsed)o?(i.setInput(t,this.ngComponentOutletInputs[t]),this._inputsUsed.set(t,!1)):(i.setInput(t,void 0),this._inputsUsed.delete(t))}static \u0275fac=function(t){return new(t||n)(G(Ht))};static \u0275dir=pe({type:n,selectors:[["","ngComponentOutlet",""]],inputs:{ngComponentOutlet:"ngComponentOutlet",ngComponentOutletInputs:"ngComponentOutletInputs",ngComponentOutletInjector:"ngComponentOutletInjector",ngComponentOutletContent:"ngComponentOutletContent",ngComponentOutletNgModule:"ngComponentOutletNgModule",ngComponentOutletNgModuleFactory:"ngComponentOutletNgModuleFactory"},exportAs:["ngComponentOutlet"],features:[bt]})}return n})();function df(n){return n.get(zs).injector}var jl=class{$implicit;ngForOf;index;count;constructor(e,i,t,o){this.$implicit=e,this.ngForOf=i,this.index=t,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},zl=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(i,t,o){this._viewContainer=i,this._template=t,this._differs=o}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){let i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){let t=this._viewContainer;i.forEachOperation((o,r,s)=>{if(o.previousIndex==null)t.createEmbeddedView(this._template,new jl(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)t.remove(r===null?void 0:r);else if(r!==null){let d=t.get(r);t.move(d,s),pf(d,o)}});for(let o=0,r=t.length;o<r;o++){let d=t.get(o).context;d.index=o,d.count=r,d.ngForOf=this._ngForOf}i.forEachIdentityChange(o=>{let r=t.get(o.currentIndex);pf(r,o)})}static ngTemplateContextGuard(i,t){return!0}static \u0275fac=function(t){return new(t||n)(G(Ht),G(vi),G(hp))};static \u0275dir=pe({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function pf(n,e){n.context.$implicit=e.item}var Sp=(()=>{class n{_viewContainer;_context=new $l;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(i,t){this._viewContainer=i,this._thenTemplateRef=t}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){uf(i,!1),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){uf(i,!1),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(i,t){return!0}static \u0275fac=function(t){return new(t||n)(G(Ht),G(vi))};static \u0275dir=pe({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),$l=class{$implicit=null;ngIf=null};function uf(n,e){if(n&&!n.createEmbeddedView)throw new di(2020,!1)}var Qn=(()=>{class n{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(i,t,o){this._ngEl=i,this._differs=t,this._renderer=o}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){let i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,t){let[o,r]=i.split("."),s=o.indexOf("-")===-1?void 0:sr.DashCase;t!=null?this._renderer.setStyle(this._ngEl.nativeElement,o,r?`${t}${r}`:t,s):this._renderer.removeStyle(this._ngEl.nativeElement,o,s)}_applyChanges(i){i.forEachRemovedItem(t=>this._setStyle(t.key,null)),i.forEachAddedItem(t=>this._setStyle(t.key,t.currentValue)),i.forEachChangedItem(t=>this._setStyle(t.key,t.currentValue))}static \u0275fac=function(t){return new(t||n)(G(Ue),G(fp),G($e))};static \u0275dir=pe({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return n})(),Gt=(()=>{class n{_viewContainerRef;_viewRef=null;ngTemplateOutletContext=null;ngTemplateOutlet=null;ngTemplateOutletInjector=null;constructor(i){this._viewContainerRef=i}ngOnChanges(i){if(this._shouldRecreateView(i)){let t=this._viewContainerRef;if(this._viewRef&&t.remove(t.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let o=this._createContextForwardProxy();this._viewRef=t.createEmbeddedView(this.ngTemplateOutlet,o,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(i){return!!i.ngTemplateOutlet||!!i.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(i,t,o)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,t,o):!1,get:(i,t,o)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,t,o)}})}static \u0275fac=function(t){return new(t||n)(G(Ht))};static \u0275dir=pe({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},features:[bt]})}return n})();function U_(n,e){return new di(2100,!1)}var vp=class{createSubscription(e,i,t){return En(()=>e.subscribe({next:i,error:t}))}dispose(e){En(()=>e.unsubscribe())}},Cp=class{createSubscription(e,i,t){return e.then(o=>i?.(o),o=>t?.(o)),{unsubscribe:()=>{i=null,t=null}}}dispose(e){e.unsubscribe()}},V_=new Cp,H_=new vp,Xi=(()=>{class n{_ref;_latestValue=null;markForCheckOnValueUpdate=!0;_subscription=null;_obj=null;_strategy=null;applicationErrorHandler=u(dh);constructor(i){this._ref=i}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(i){if(!this._obj){if(i)try{this.markForCheckOnValueUpdate=!1,this._subscribe(i)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return i!==this._obj?(this._dispose(),this.transform(i)):this._latestValue}_subscribe(i){this._obj=i,this._strategy=this._selectStrategy(i),this._subscription=this._strategy.createSubscription(i,t=>this._updateLatestValue(i,t),t=>this.applicationErrorHandler(t))}_selectStrategy(i){if(Fl(i))return V_;if(Dh(i))return H_;throw U_(n,i)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(i,t){i===this._obj&&(this._latestValue=t,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static \u0275fac=function(t){return new(t||n)(G(hn,16))};static \u0275pipe=qn({name:"async",type:n,pure:!1})}return n})();function j_(n,e){return{key:n,value:e}}var Ri=(()=>{class n{differs;constructor(i){this.differs=i}differ;keyValues=[];compareFn=mf;transform(i,t=mf){if(!i||!(i instanceof Map)&&typeof i!="object")return null;this.differ??=this.differs.find(i).create();let o=this.differ.diff(i),r=t!==this.compareFn;return o&&(this.keyValues=[],o.forEachItem(s=>{this.keyValues.push(j_(s.key,s.currentValue))})),(o||r)&&(t&&this.keyValues.sort(t),this.compareFn=t),this.keyValues}static \u0275fac=function(t){return new(t||n)(G(fp,16))};static \u0275pipe=qn({name:"keyvalue",type:n,pure:!1})}return n})();function mf(n,e){let i=n.key,t=e.key;if(i===t)return 0;if(i==null)return 1;if(t==null)return-1;if(typeof i=="string"&&typeof t=="string")return i<t?-1:1;if(typeof i=="number"&&typeof t=="number")return i-t;if(typeof i=="boolean"&&typeof t=="boolean")return i<t?-1:1;let o=String(i),r=String(t);return o==r?0:o<r?-1:1}var ct=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({})}return n})();function bp(n,e){e=encodeURIComponent(e);for(let i of n.split(";")){let t=i.indexOf("="),[o,r]=t==-1?[i,""]:[i.slice(0,t),i.slice(t+1)];if(o.trim()===e)return decodeURIComponent(r)}return null}var Wl="browser",hf="server";function xp(n){return n===Wl}function Mp(n){return n===hf}var Ks=class{};var Kl=new Se(""),Tp=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,t){this._zone=t,i.forEach(o=>{o.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,t,o,r){return this._findPluginFor(t).addEventListener(i,t,o,r)}getZone(){return this._zone}_findPluginFor(i){let t=this._eventNameToPlugin.get(i);if(t)return t;if(t=this._plugins.find(r=>r.supports(i)),!t)throw new di(5101,!1);return this._eventNameToPlugin.set(i,t),t}static \u0275fac=function(t){return new(t||n)(Ze(Kl),Ze(Ae))};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),Zs=class{_doc;constructor(e){this._doc=e}manager},ql="ng-app-id";function ff(n){for(let e of n)e.remove()}function gf(n,e){let i=e.createElement("style");return i.textContent=n,i}function $_(n,e,i,t){let o=n.head?.querySelectorAll(`style[${ql}="${e}"],link[${ql}="${e}"]`);if(o)for(let r of o)r.removeAttribute(ql),r instanceof HTMLLinkElement?t.set(r.href.slice(r.href.lastIndexOf("/")+1),{usage:0,elements:[r]}):r.textContent&&i.set(r.textContent,{usage:0,elements:[r]})}function Pp(n,e){let i=e.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",n),i}var Ip=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(i,t,o,r={}){this.doc=i,this.appId=t,this.nonce=o,this.isServer=Mp(r),$_(i,t,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,t){for(let o of i)this.addUsage(o,this.inline,gf);t?.forEach(o=>this.addUsage(o,this.external,Pp))}removeStyles(i,t){for(let o of i)this.removeUsage(o,this.inline);t?.forEach(o=>this.removeUsage(o,this.external))}addUsage(i,t,o){let r=t.get(i);r?r.usage++:t.set(i,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(i,this.doc)))})}removeUsage(i,t){let o=t.get(i);o&&(o.usage--,o.usage<=0&&(ff(o.elements),t.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])ff(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[t,{elements:o}]of this.inline)o.push(this.addElement(i,gf(t,this.doc)));for(let[t,{elements:o}]of this.external)o.push(this.addElement(i,Pp(t,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,t){return this.nonce&&t.setAttribute("nonce",this.nonce),this.isServer&&t.setAttribute(ql,this.appId),i.appendChild(t)}static \u0275fac=function(t){return new(t||n)(Ze(ke),Ze($s),Ze(dp,8),Ze(or))};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),Dp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},kp=/%COMP%/g;var _f="%COMP%",z_=`_nghost-${_f}`,W_=`_ngcontent-${_f}`,q_=!0,Y_=new Se("",{providedIn:"root",factory:()=>q_});function K_(n){return W_.replace(kp,n)}function Z_(n){return z_.replace(kp,n)}function vf(n,e){return e.map(i=>i.replace(kp,n))}var Ap=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,t,o,r,s,d,h,_=null,C=null){this.eventManager=i,this.sharedStylesHost=t,this.appId=o,this.removeStylesOnCompDestroy=r,this.doc=s,this.platformId=d,this.ngZone=h,this.nonce=_,this.tracingService=C,this.platformIsServer=!1,this.defaultRenderer=new Xs(i,s,h,this.platformIsServer,this.tracingService)}createRenderer(i,t){if(!i||!t)return this.defaultRenderer;let o=this.getOrCreateRenderer(i,t);return o instanceof Yl?o.applyToHost(i):o instanceof Qs&&o.applyStyles(),o}getOrCreateRenderer(i,t){let o=this.rendererByCompId,r=o.get(t.id);if(!r){let s=this.doc,d=this.ngZone,h=this.eventManager,_=this.sharedStylesHost,C=this.removeStylesOnCompDestroy,O=this.platformIsServer,R=this.tracingService;switch(t.encapsulation){case pp.Emulated:r=new Yl(h,_,t,this.appId,C,s,d,O,R);break;case pp.ShadowDom:return new Ep(h,_,i,t,s,d,this.nonce,O,R);default:r=new Qs(h,_,t,C,s,d,O,R);break}o.set(t.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.delete(i)}static \u0275fac=function(t){return new(t||n)(Ze(Tp),Ze(Ip),Ze($s),Ze(Y_),Ze(ke),Ze(or),Ze(Ae),Ze(dp),Ze(xh,8))};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),Xs=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,i,t,o,r){this.eventManager=e,this.doc=i,this.ngZone=t,this.platformIsServer=o,this.tracingService=r}destroy(){}destroyNode=null;createElement(e,i){return i?this.doc.createElementNS(Dp[i]||i,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,i){(yf(e)?e.content:e).appendChild(i)}insertBefore(e,i,t){e&&(yf(e)?e.content:e).insertBefore(i,t)}removeChild(e,i){i.remove()}selectRootElement(e,i){let t=typeof e=="string"?this.doc.querySelector(e):e;if(!t)throw new di(-5104,!1);return i||(t.textContent=""),t}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,i,t,o){if(o){i=o+":"+i;let r=Dp[o];r?e.setAttributeNS(r,i,t):e.setAttribute(i,t)}else e.setAttribute(i,t)}removeAttribute(e,i,t){if(t){let o=Dp[t];o?e.removeAttributeNS(o,i):e.removeAttribute(`${t}:${i}`)}else e.removeAttribute(i)}addClass(e,i){e.classList.add(i)}removeClass(e,i){e.classList.remove(i)}setStyle(e,i,t,o){o&(sr.DashCase|sr.Important)?e.style.setProperty(i,t,o&sr.Important?"important":""):e.style[i]=t}removeStyle(e,i,t){t&sr.DashCase?e.style.removeProperty(i):e.style[i]=""}setProperty(e,i,t){e!=null&&(e[i]=t)}setValue(e,i){e.nodeValue=i}listen(e,i,t,o){if(typeof e=="string"&&(e=Fi().getGlobalEventTarget(this.doc,e),!e))throw new di(5102,!1);let r=this.decoratePreventDefault(t);return this.tracingService?.wrapEventListener&&(r=this.tracingService.wrapEventListener(e,i,r)),this.eventManager.addEventListener(e,i,r,o)}decoratePreventDefault(e){return i=>{if(i==="__ngUnwrap__")return e;e(i)===!1&&i.preventDefault()}}};function yf(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Ep=class extends Xs{sharedStylesHost;hostEl;shadowRoot;constructor(e,i,t,o,r,s,d,h,_){super(e,r,s,h,_),this.sharedStylesHost=i,this.hostEl=t,this.shadowRoot=t.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let C=o.styles;C=vf(o.id,C);for(let R of C){let Q=document.createElement("style");d&&Q.setAttribute("nonce",d),Q.textContent=R,this.shadowRoot.appendChild(Q)}let O=o.getExternalStyles?.();if(O)for(let R of O){let Q=Pp(R,r);d&&Q.setAttribute("nonce",d),this.shadowRoot.appendChild(Q)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,i){return super.appendChild(this.nodeOrShadowRoot(e),i)}insertBefore(e,i,t){return super.insertBefore(this.nodeOrShadowRoot(e),i,t)}removeChild(e,i){return super.removeChild(null,i)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Qs=class extends Xs{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,i,t,o,r,s,d,h,_){super(e,r,s,d,h),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=o;let C=t.styles;this.styles=_?vf(_,C):C,this.styleUrls=t.getExternalStyles?.(_)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Yl=class extends Qs{contentAttr;hostAttr;constructor(e,i,t,o,r,s,d,h,_){let C=o+"-"+t.id;super(e,i,t,r,s,d,h,_,C),this.contentAttr=K_(C),this.hostAttr=Z_(C)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,i){let t=super.createElement(e,i);return super.setAttribute(t,this.contentAttr,""),t}};var Zl=class n extends Ys{supportsDOMEvents=!0;static makeCurrent(){gp(new n)}onAndCancel(e,i,t,o){return e.addEventListener(i,t,o),()=>{e.removeEventListener(i,t,o)}}dispatchEvent(e,i){e.dispatchEvent(i)}remove(e){e.remove()}createElement(e,i){return i=i||this.getDefaultDocument(),i.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,i){return i==="window"?window:i==="document"?e:i==="body"?e.body:null}getBaseHref(e){let i=X_();return i==null?null:Q_(i)}resetBaseElement(){Js=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return bp(document.cookie,e)}},Js=null;function X_(){return Js=Js||document.head.querySelector("base"),Js?Js.getAttribute("href"):null}function Q_(n){return new URL(n,document.baseURI).pathname}var Xl=class{addToWindow(e){zn.getAngularTestability=(t,o=!0)=>{let r=e.findTestabilityInTree(t,o);if(r==null)throw new di(5103,!1);return r},zn.getAllAngularTestabilities=()=>e.getAllTestabilities(),zn.getAllAngularRootElements=()=>e.getAllRootElements();let i=t=>{let o=zn.getAllAngularTestabilities(),r=o.length,s=function(){r--,r==0&&t()};o.forEach(d=>{d.whenStable(s)})};zn.frameworkStabilizers||(zn.frameworkStabilizers=[]),zn.frameworkStabilizers.push(i)}findTestabilityInTree(e,i,t){if(i==null)return null;let o=e.getTestability(i);return o??(t?Fi().isShadowRoot(i)?this.findTestabilityInTree(e,i.host,!0):this.findTestabilityInTree(e,i.parentElement,!0):null)}},J_=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),wf=(()=>{class n extends Zs{constructor(i){super(i)}supports(i){return!0}addEventListener(i,t,o,r){return i.addEventListener(t,o,r),()=>this.removeEventListener(i,t,o,r)}removeEventListener(i,t,o,r){return i.removeEventListener(t,o,r)}static \u0275fac=function(t){return new(t||n)(Ze(ke))};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),Cf=["alt","control","meta","shift"],ev={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},tv={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Sf=(()=>{class n extends Zs{constructor(i){super(i)}supports(i){return n.parseEventName(i)!=null}addEventListener(i,t,o,r){let s=n.parseEventName(t),d=n.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Fi().onAndCancel(i,s.domEventName,d,r))}static parseEventName(i){let t=i.toLowerCase().split("."),o=t.shift();if(t.length===0||!(o==="keydown"||o==="keyup"))return null;let r=n._normalizeKey(t.pop()),s="",d=t.indexOf("code");if(d>-1&&(t.splice(d,1),s="code."),Cf.forEach(_=>{let C=t.indexOf(_);C>-1&&(t.splice(C,1),s+=_+".")}),s+=r,t.length!=0||r.length===0)return null;let h={};return h.domEventName=o,h.fullKey=s,h}static matchEventFullKeyCode(i,t){let o=ev[i.key]||i.key,r="";return t.indexOf("code.")>-1&&(o=i.code,r="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),Cf.forEach(s=>{if(s!==o){let d=tv[s];d(i)&&(r+=s+".")}}),r+=o,r===t)}static eventCallback(i,t,o){return r=>{n.matchEventFullKeyCode(r,i)&&o.runGuarded(()=>t(r))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(t){return new(t||n)(Ze(ke))};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})();function iv(){Zl.makeCurrent()}function nv(){return new ir}function ov(){return uh(document),document}var rv=[{provide:or,useValue:Wl},{provide:mh,useValue:iv,multi:!0},{provide:ke,useFactory:ov}],Op=Fh(Bh,"browser",rv);var sv=[{provide:Al,useClass:Xl},{provide:Mh,useClass:Ol,deps:[Ae,up,Al]},{provide:Ol,useClass:Ol,deps:[Ae,up,Al]}],av=[{provide:lh,useValue:"root"},{provide:ir,useFactory:nv},{provide:Kl,useClass:wf,multi:!0,deps:[ke]},{provide:Kl,useClass:Sf,multi:!0,deps:[ke]},Ap,Ip,Tp,{provide:pi,useExisting:Ap},{provide:Ks,useClass:J_},[]],Fp=(()=>{class n{constructor(){}static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({providers:[...av,...sv],imports:[ct,Gh]})}return n})();var Rp=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:function(t){let o=null;return t?o=new(t||n):o=Ze(cv),o},providedIn:"root"})}return n})(),cv=(()=>{class n extends Rp{_doc;constructor(i){super(),this._doc=i}sanitize(i,t){if(t==null)return null;switch(i){case rr.NONE:return t;case rr.HTML:return rs(t,"HTML")?os(t):wh(this._doc,String(t)).toString();case rr.STYLE:return rs(t,"Style")?os(t):t;case rr.SCRIPT:if(rs(t,"Script"))return os(t);throw new di(5200,!1);case rr.URL:return rs(t,"URL")?os(t):Ch(String(t));case rr.RESOURCE_URL:if(rs(t,"ResourceURL"))return os(t);throw new di(5201,!1);default:throw new di(5202,!1)}}bypassSecurityTrustHtml(i){return fh(i)}bypassSecurityTrustStyle(i){return gh(i)}bypassSecurityTrustScript(i){return yh(i)}bypassSecurityTrustUrl(i){return _h(i)}bypassSecurityTrustResourceUrl(i){return vh(i)}static \u0275fac=function(t){return new(t||n)(Ze(ke))};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ft=function(n){return n[n.Event=0]="Event",n[n.LocationAction=1]="LocationAction",n[n.PlayerAction=2]="PlayerAction",n}(ft||{});var xf=n=>`<i class="ra ra-${n}"></i>`,Mf=n=>n+xf("feather-wing"),ea=n=>n+xf("crystal-ball");function kt(n){return wi(n),n}var Df=kt({id:"#acard-thunder",title:"Thunder",icon:"lightning-storm",type:ft.Event,description:"Your hero loses 1 action point."}),Pf=kt({id:"#acard-rainbow",title:"Rainbow",icon:"sunbeams",type:ft.Event,description:"Your hero gains +1 action point."}),Ef=kt({id:"#acard-snowfall",title:"Snowfall",icon:"frost-emblem",type:ft.Event,description:"Your army is slowed down by 25% during the combat."}),Tf=kt({id:"#acard-raiders",title:"Raiders",icon:"demolish",type:ft.Event,description:"Raiders are approaching. At the end of the day, you will lose a random building on the map."});var If=kt({id:"#acard-loc-attack",title:"Attack",icon:"crossed-swords",type:ft.LocationAction,bgColor:"#f33b4e",description:"Attack the camp."}),kf=kt({id:"#acard-init-attack",title:"Initiative Attack",icon:"groundbreaker",type:ft.LocationAction,bgColor:"red",description:"Attack the camp, allowing your hero to cast a spell at the beginning of the fight."}),Af=kt({id:"#acard-visit",title:"Visit",icon:"trail",type:ft.LocationAction,bgColor:"#ffa446",description:"Visit the location. Takes 1 action point until location says otherwise."});var Up={};Jr(Up,{CombatAttackInteraction:()=>xo,FightEnds:()=>fn,FightNextRoundStarts:()=>Bi,GroupAttacked:()=>Jn,GroupCounterAttacked:()=>Np,GroupDamagedByGroup:()=>cr,GroupDies:()=>Mo,GroupModifiersChanged:()=>Ql,GroupSpeedChanged:()=>na,GroupSpellsChanged:()=>ds,GroupTakesDamage:()=>Lp,PlayerCastsInstantSpell:()=>ia,PlayerTargetsSpell:()=>lr,RoundGroupSpendsTurn:()=>ra,RoundGroupTurnEnds:()=>Jl,RoundPlayerCountinuesAttacking:()=>sa,RoundPlayerTurnStarts:()=>eo,UnitHealed:()=>dr,UnitSummoned:()=>oa});var Of=0;function dt(n=""){let e={__id:Of,__name:n,__type:null},i=function(t={}){return T({__eventType:e},t)};return i.__typeInfo=e,e.__type=i,Of++,i}var oe=(()=>{let e=class e{dispatch(t){this.eventStream$.next(t)}constructor(){this.eventStream$=new X,Ki.logEvents&&this.eventStream$.subscribe(t=>console.log(`[${t.__eventType.__name}]`,t))}onEvent(t){return this.eventStream$.pipe(Ai(o=>o.__eventType.__id===t.__typeInfo.__id))}events(...t){let o=new Map;return t.forEach(r=>o.set(r.eventType.__typeInfo.__id,r.fn)),this.eventStream$.pipe(Ai(r=>{let s=o.get(r.__eventType.__id);return s?(s(r),!0):!1}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function jt({events:n,prefix:e}){return Object.entries(n).forEach(([i,t])=>{let o=t.__typeInfo.__name;t.__typeInfo.__name=`${e}:${i}`+(o?`, ${o}`:"")}),{events:n,getEventByName(i){return n[i]}}}var ta=Symbol("Class members configs"),Bp=Symbol("Class type marker");function Gp(n,e){let i=Object.getPrototypeOf(n);return i?i[Bp]===e?i:Gp(i,e):null}function Ff(n,e,i,t,o,r){let s=i.value,d=n.constructor,h=Gp(d,"store");if(!h)throw new Error(`[Store Feature] ${o} Error. Class ${d.name} must extend StoreClient(). Method ${d.name}.${e}.`);if(typeof s!="function")throw new Error(`[Store Feature] ${o} Error. ${o} in ${d.name}.${e} must be applied to method.`);h[ta].push({type:r,method:s,event:t})}function ge(n){return function(e,i,t){Ff(e,i,t,n,`@Notify(${n.name})`,"notify")}}function Y(n){return function(e,i,t){Ff(e,i,t,n,`@WireEvent(${n.name})`,"wire")}}function Te(){var i;var n,e;return i=class{constructor(){this.events=u(oe),this.destroyed$=new X,this.plainSubscriptions=new yi,this.untilDestroyed=s=>s.pipe(Ge(this.destroyed$));let o=this;Object.getPrototypeOf(this).constructor[ta].forEach(s=>{let d=s.event;if(s.type==="wire-prop")return;let h=s.method;switch(s.type){case"wire":this.events.onEvent(d).pipe(this.untilDestroyed).subscribe(C=>{h.apply(this,[C])});break;case"notify":this.events.onEvent(d).pipe(this.untilDestroyed).subscribe(()=>{h.apply(this)});break;case"subscribeEvent":let _=h.apply(o,[this.events.onEvent(d)]);this.plainSubscriptions.add(_);break}})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this.plainSubscriptions.unsubscribe()}},n=ta,e=Bp,i[n]=[],i[e]="store",i}var Lt=dt,lr=Lt(""),ia=Lt(),Jn=Lt(),xo=Lt(),na=Lt(),ds=Lt(),Ql=Lt(),cr=Lt(),Lp=Lt(),oa=Lt(),Np=Lt(),Mo=Lt(),ra=Lt(),Jl=Lt(),eo=Lt(),sa=Lt(),Bi=Lt(),fn=Lt("Fight Ends"),dr=Lt();var Vp={};Jr(Vp,{AddCombatModifiersToUnit:()=>aa,DefendAction:()=>da,RegisterUnitLoss:()=>ca,RemoveCombatModifiersFromUnit:()=>la});var ec=dt,aa=ec(),la=ec(),ca=ec(),da=ec();var dv=jt({prefix:"Battle",events:Up}),pv=jt({prefix:"BattleCommands",events:Vp}),Mk=T(T({},dv.events),pv.events);var Qi=function(n){return n.GroupAttacks="attacks",n.GroupCounterattacks="counterattacks",n.AttackInteractionCompleted="completed",n}(Qi||{});var $p={};Jr($p,{BeforeBattleInit:()=>wa,DisplayCdkPopup:()=>xa,DisplayPopup:()=>ps,DisplayReward:()=>ba,FightStarts:()=>Gi,GameCreated:()=>ua,GameStarted:()=>pa,HeroLevelsUp:()=>Ma,NewDayStarted:()=>mr,NewWeekStarted:()=>io,OpenActiviesAndSpecialtiesDialog:()=>ga,OpenGarrisonPopup:()=>fr,OpenSplitUnitGroupPopup:()=>ya,OpenUnitSlotsActionPopup:()=>_a,PlayerEntersTown:()=>ha,PlayerEquipsItem:()=>yr,PlayerLeavesTown:()=>fa,PlayerLosesItem:()=>gr,PlayerOpensActionCards:()=>va,PlayerOpensHeroInfo:()=>pr,PlayerReceivesItem:()=>gn,PlayerStartsFight:()=>Ca,PlayerUnequipsItem:()=>Do,PlayersInitialized:()=>On,ScheduleAction:()=>_r,ShowGameOverPopup:()=>Sa,StructCompleted:()=>to,StructFightConfirmed:()=>hr,StructSelected:()=>ur,TestSandboxScenario:()=>ma,UnitGroupAddedToHero:()=>Hp,UnitGroupRemovedFromHero:()=>jp});var He=dt,pa=He(),ua=He(),ma=He(),On=He(),ha=He(),fa=He(),pr=He(),ga=He(),ya=He(),_a=He(),va=He(),ur=He(),Ca=He(),wa=He(),Gi=He(),to=He(),Sa=He(),mr=He(),io=He(),ba=He(),hr=He(),ps=He(),xa=He(),fr=He(),gn=He(),gr=He(),yr=He(),Do=He(),Ma=He(),Hp=He(),jp=He(),_r=He();var At=function(n){return n.MainScreen="main-screen",n.NewGame="new-game",n.SandboxMode="sandbox",n.ScenarioMode="scenario-editor",n.Multiplayer="multiplayer",n.Structures="structures",n.Battleground="battleground",n.Town="town",n}(At||{});var zp={};Jr(zp,{ActivateActionCard:()=>xr,AddActionCardsToPlayer:()=>xi,BuildBuilding:()=>Oa,CleanUpHandlersOnFightEnd:()=>tc,DisplayPlayerRewardPopup:()=>Ta,GameOpenMainScreen:()=>Li,GameOpenMapStructuresScreen:()=>br,InitBuilding:()=>us,InitGameObjectApi:()=>Ia,InitItem:()=>Aa,InitSpell:()=>ka,InitStructure:()=>Fa,MapPanCameraCenterTo:()=>Po,NavigateToView:()=>Ni,OpenGlossary:()=>wr,OpenMainMenu:()=>Sr,OpenMultiplayer:()=>Ea,OpenNewGameScreen:()=>vr,OpenSandboxMode:()=>Da,OpenScenarioMode:()=>Pa,OpenSettings:()=>Cr,PushEventFeedMessage:()=>yn,PushPlainEventFeedMessage:()=>_n,RemoveActionPoints:()=>Qt});var ut=dt,tc=ut("Clear spells and items registries on fight end"),Po=ut("Pan camera on the map"),Li=ut("Open Main Screen"),vr=ut("Open New Game Screen"),Da=ut("Open Sandbox Mode"),Pa=ut("Open Scenario Mode"),Cr=ut("Open Game settings"),Ea=ut("Open Game settings"),wr=ut("Open Glossary"),Sr=ut("Open Main menu"),Ni=ut("Navigate To View"),br=ut("Open map structures screen"),Ta=ut(),Ia=ut(),ka=ut(),Aa=ut(),us=ut(),Oa=ut(),Fa=ut(),yn=ut(),_n=ut(),Qt=ut(),xr=ut(),xi=ut();var uv=jt({events:$p,prefix:"GameEvents"}),mv=jt({events:zp,prefix:"GameCommands"}),Lk=T(T({},uv.events),mv.events);var Wp={};Jr(Wp,{DisplayUnitGroupInfo:()=>Rn,PlayerClicksAllyGroup:()=>Ga,PlayerClicksEnemyGroup:()=>Ba,PlayerHoversGroupCard:()=>Fn,PlayerRightClicksUnitGroup:()=>La});var Ra=dt,Ba=Ra(),Ga=Ra(),Fn=Ra(),La=Ra(),Rn=Ra();var ni=function(n){return n[n.EnemyCard=0]="EnemyCard",n[n.AllyCard=1]="AllyCard",n[n.Unhover=2]="Unhover",n}(ni||{});var hv=jt({events:Wp,prefix:"UI"}),Zk=hv.events;var qp={};Jr(qp,{GamePreparationFinished:()=>gv,PrepareGameEvent:()=>fv});var Rf=dt,fv=Rf("Player started new game, waiting for GamePreparationFinished event to prepare the map."),gv=Rf("Map is prepared, player can start the game");var yv=jt({events:qp,prefix:"Triggers"}),no=yv.events;var Mr=function(n){return n.Normal="normal",n.SandboxScenario="sandbox",n}(Mr||{});var oo=function(n){return n[n.Icon=0]="Icon",n[n.Html=1]="Html",n[n.Customizable=2]="Customizable",n}(oo||{}),Bn=function(n){return n[n.VfxElement=0]="VfxElement",n}(Bn||{});var _e=(n,e)=>({icon:n,id:e,type:oo.Icon}),Bf=n=>({id:n,type:oo.Html}),Na=n=>({id:n,type:oo.Customizable}),it=(n,e)=>{let i={id:n,config:{layout:"default"},elements:[],elemsKeyframes:{},elemsDefaultStyles:{}};return e.forEach(([t,o,r])=>{i.elements.push(t),i.elemsKeyframes[t.id]=o,i.elemsDefaultStyles[t.id]=r}),wi(i),i},Mi=()=>[{opacity:"0"},{opacity:"1",offset:.25},{opacity:"1",offset:.35},{offset:.76,opacity:"0"},{opacity:"0"}],$t=()=>[{filter:"blur(10px)"},{filter:"blur(0px)",offset:.4},{filter:"blur(0px)",opacity:0}],Dr=()=>[{opacity:"0"},{opacity:"0.2",transform:"translate(-50%, -50%) scale(1.2)",offset:.25},{opacity:"0.3",transform:"translate(-50%, -50%) scale(1.5)",offset:.35},{offset:.76,transform:"translate(-50%, -50%) scale(1.6)",opacity:"0"},{opacity:"0"}];var Ot=(n=0,e=0)=>{let i="translate(-50%, -50%) scale(1)";return[{opacity:0+e,offset:.001+n},{opacity:.3+e,transform:i,offset:.3+n},{opacity:.3+e,transform:i,offset:.5+n},{opacity:.3+e,transform:i},{opacity:0+e,transform:i}]};var Eo=(n,e,i="rgb(244 162 124)")=>it(n,[[_e(e,"fire-main"),Mi(),{fontSize:"64px",color:i,opacity:"1"}],[_e(e,"fire-blur"),$t(),{fontSize:"64px",color:i,filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[_e(e,"fire-pulse"),Dr(),{fontSize:"64px",color:i,opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);function ro(n,e,i){let t=()=>({transform:"translate(-50%, -50%) scale(3)",fontSize:"64px",color:"rgb(213 197 223)",opacity:"0"});return it(n,[[_e(e,"bw-1"),Ot(),t()],[_e(e,"bw-2"),Ot(.2),t()],[_e(e,"bw-3"),Ot(.4),t()],[_e(e,"bw-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4,opacity:1},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:i,filter:"blur(6px)",opacity:"0",mixBlendMode:"hard-light"}]])}var Gf=it("#vfx-lightning",[[_e("focused-lightning","l-main"),[{opacity:"0"},{opacity:"1",offset:.05},{opacity:"1",offset:.15},{opacity:"0",offset:.16},{opacity:"0",offset:.2},{opacity:"1",offset:.23},{opacity:"0"}],{fontSize:"64px",color:"#eaefff",opacity:"1"}],[_e("focused-lightning","l-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:"#98abff",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}]]),ic=Eo("#vfx-fire","fire"),Lf=ro("#vfx-fright","batwings","rgba(218, 137, 204, 0.78)"),Nf=ro("#vfx-lifesteal","bat-sword","rgba(245, 10, 20, 0.8)"),Uf=it("#vfx-enchant",[[_e("fire-ring","fr-main"),Mi(),{fontSize:"64px",color:"white",opacity:"1"}],[_e("fire-ring","fr-blur"),$t(),{fontSize:"64px",color:"violet",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[_e("fire-ring","fr-pulse"),Dr(),{fontSize:"64px",color:"pink",opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);var Yp={textShadow:"0px 0px 5px rgba(0, 0, 0, 1)"},Vf=it("#vfx-static-cursor",[[Na("elem"),[],T({fontSize:"24px",position:"relative",top:"17px",left:"10px",color:"white"},Yp)]]),Hf=it("#vfx-centered-static-cursor",[[Na("elem"),[],T({fontSize:"24px",color:"white"},Yp)]]),jf=it("#vfx-spell-cast-cursor",[[_e("burning-book","bm"),[],T({fontSize:"34px",color:"#bfcbff",opacity:.7},Yp)],[_e("burning-book","bm2"),Ot(0,.2),{fontSize:"34px",color:"#bfcbff",mixBlendMode:"screen"}],[_e("burning-book","book-blur"),Dr(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff",mixBlendMode:"screen"}],[_e("burning-book","book-blur2"),Dr(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff"}]]);var $f=it("#vfx-floating-message",[[Na("msg"),[{fontSize:"13px"},{offset:.3,opacity:1,transform:"translate(10px, -50px) scale(1.5)"},{opacity:0,transform:"translate(20px, -100px) scale(0.8)"}],{opacity:.3,fontSize:"15px"}]]),zf=it("#vfx-dropping-message",[[Bf("msg"),[{offset:0,opacity:0,transform:"translate(0, -50px)"},{offset:.2,opacity:1,transform:"translate(0, -10px)"},{offset:.8,opacity:1,transform:"translate(0, -10px)"},{opacity:0,transform:"translate(0, 0px)"}],{fontSize:"15px"}]]);var Ua=({icon:n,iconColor:e="white",bgColor:i="transparent"})=>`<i class='ra ra-${n}' style="background: ${i}; color: ${e}"></i>`,_v=({icon:n,iconColor:e,bgColor:i})=>`<i class='ra ra-${n}' style="background: ${i}; color: ${e}"></i>`,vn=n=>`${_v(n)} <span style="font-weight: 600;">${n.title}</span>`;var Kp=n=>`${Math.round(n*100)}`,nc=n=>`${Math.round(n*100)}%`,Wf=(n,e)=>n===e?`${n} `:`${n}-${e} `,qf=n=>n===0?n:n>0?`+${n}`:`-${n}`;var Di=(n,e,i=!1,t=0,o=!1)=>({parts:[{type:"plainPart",icon:i?"broadhead-arrow":"sword",text:`<span style="${o?"font-weight: 800;":""}">${n}</span>`,color:o?"#ff8100":"red"},...t?[{type:"plainPart",icon:"shield",color:"yellow",text:t}]:[],{type:"plainPart",icon:"skull",text:e,color:"white"}]}),oc=(n,e)=>({parts:[{type:"plainPart",icon:"double-team",text:n,color:"white"},{type:"plainPart",icon:"health",text:e,color:"#5fc960"}]}),Ui=(n,{fontSize:e=15,width:i=100}={})=>`<div style="margin-top: 4px; text-align: center; width: ${i}px; font-size:${e}px; background:rgba(0,0,0,0.6); padding: 2px; border-radius: 5px;">${n}</div>`,Kf=(n,e)=>({html:Ui(`
      <div style="">${Ua({icon:"bat-sword",iconColor:"red"})} ${e}</div>
      <div style="">${Ua({icon:"double-team",iconColor:"#91edb8"})}${qf(n)}</div>
    `,{width:50})}),Yf=(n,e=n.count)=>`<span style="color: ${n.ownerPlayer.color}; font-weight: 500">${e} ${n.type.name}</span>`,Zf=({attacker:n,attacked:e,originalNumber:i,damage:t,unitLoss:o})=>`${Yf(n)} retaliated! Dealing ${t} damage to ${Yf(e,i)}, ${o} units perish.`;var rc=kt({id:"#acard-setup-camp",title:"Set up Camp",icon:"campfire",type:ft.PlayerAction,bgColor:"gray",iconColor:"#ffae66",description:"You set up camp, skipping this day.",config:{onUsedInstantly({events:n,actions:e}){n.dispatch(Qt({points:e.getActionPointsLeft()}))}}}),Zp=kt({id:"#acard-tribute",title:"Tribute",icon:"hand-saw",type:ft.PlayerAction,bgColor:"green",iconColor:"white",description:"You gain 300 gold and 2 wood for 2 action points.",config:{onUsedInstantly({events:n,players:e,actions:i}){let t=e.getCurrentPlayer();n.dispatch(Qt({points:2}));let o=300,r=2;e.giveResourcesToPlayer(t,{gold:o,wood:r}),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(Zp)}:<hr/>+${o} Gold<br/>+${r} Wood`}]}))}}}),vv=kt({id:"#acard-blacksmithing",title:"blacksmithing",icon:"sword",type:ft.PlayerAction,bgColor:"#f8a121",iconColor:"white",description:"You gain +1 to Attack permanently for 1 action point.",config:{onUsedInstantly({events:n,players:e,actions:i}){let t=e.getCurrentPlayer();n.dispatch(Qt({points:1}));let o=1;t.hero.addStatsMods({heroBonusAttack:o}),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(vv)}:<hr/>+${o} Attack`}]}))}}}),Cv=kt({id:"#acard-armor-forging",title:"Armor Forging",icon:"anvil",type:ft.PlayerAction,bgColor:"#f8a121",iconColor:"white",description:"You gain +1 to Defence permanently for 1 action point.",config:{onUsedInstantly({events:n,players:e,actions:i}){let t=e.getCurrentPlayer();n.dispatch(Qt({points:1}));let o=1;t.hero.addStatsMods({heroBonusDefence:o}),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(Cv)}:<hr/>+${o} Defence`}]}))}}}),JA=kt({id:"#acard-quiescence",title:"Quiescence",icon:"crystal-ball",type:ft.PlayerAction,bgColor:"blue",iconColor:"white",description:"You gain +3 to Max Mana permanently for 1 action point.",config:{onUsedInstantly({events:n,players:e,actions:i}){let t=e.getCurrentPlayer();n.dispatch(Qt({points:1}));let o=3;t.hero.addStatsMods({heroMaxMana:o}),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(so)}:<hr/>+${o} Max Mana`}]}))}}}),Va=kt({id:"#acard-skip-the-day",title:"Skip the day",icon:"moon-sun",type:ft.PlayerAction,bgColor:"#283761",iconColor:"rgb(255 198 90)",borderColor:"rgb(255 198 90)",description:"You will immediately skip this day and receive 200 gold for each remaining action point left.",config:{onUsedInstantly({events:n,players:e,actions:i}){let t=e.getCurrentPlayer(),o=i.getActionPointsLeft(),r=o*200;n.dispatch(Qt({points:o})),e.giveResourcesToPlayer(t,{gold:r}),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(Va)}:<hr/>+${r} Gold`}]}))}}}),so=kt({id:"#acard-meditate",title:"Meditate",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:ft.PlayerAction,description:`You restore ${ea(3)} mana (+${ea(2)} per point of Restoration specialty), consumes ${Mf(2)} action points. Action restored every week.`,actionPoints:2,config:{onUsedInstantly({events:n,players:e}){let i=e.getCurrentPlayer(),r=3+(i.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(i,r),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(so)}: Restored ${ea(r)} Mana.`}]}))}}}),Xp=kt({id:"#acard-restore-mana",title:"Restore Mana",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:ft.PlayerAction,description:"You restore 3 points of mana (+2 per point of Restoration specialty), consumes 1 action point.",actionPoints:1,config:{onUsedInstantly({events:n,players:e}){let i=e.getCurrentPlayer(),r=3+(i.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(i,r),n.dispatch(yn({message:[{type:tt.FreeHtml,htmlContent:`${vn(Xp)}: Restored ${ea(r)} Mana.`}]}))}}}),eO=kt({id:"#acard-recruit",title:"Recruit",icon:"knight-helmet",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:ft.PlayerAction,description:"Gives you additional units below tier 3, consumes 2 action points."}),Xf=kt({id:"#acard-rangers-horn",title:"Ranger's Horn",description:"8 Rangers will join your army for 3 days. Rangers are effective against forest dwellers.",bgColor:"#3c843c",icon:"hood",type:ft.PlayerAction,config:{onUsedInstantly({actions:n,players:e,events:i}){let t="#unit-neut-ranger-0",o=e.getCurrentPlayer(),r=8;e.addUnitGroupToPlayer(o,t,r),i.dispatch(_n({message:`${r} Rangers joined your army.`})),n.scheduleActionInGameDays(()=>{e.removeUnitTypeFromPlayer(o,t,r),i.dispatch(_n({message:"Summoned Rangers have left your army."}))},2)}}});var Pi=ls.createFaction({id:"#faction-constellation",title:"Constellation",icon:"arrow-cluster"});Pi.createHero({id:"#hero-blackbird",name:"Blackbird",image:ue.HeroBlackbird,abilities:["#spell-rain-of-fire","#spell-summon-sagittar","#spell-kneeling-light"],army:[{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,11,2],["#unit-c10",3,5,1]]},{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-c00",12,18,1],["#unit-c10",7,12,1]]},{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,10,1],["#unit-c10",4,6,2]]}],generalDescription:U("Blackbird is a hero who specializes at Astral and Fire magic, as well as Summoning."),items:["#item-wishmaster"],stats:{baseAttack:2,baseDefence:4,mana:15},resources:{gems:1,gold:1e3,redCrystals:1,wood:1}});var Cn={gems:0,gold:1250,redCrystals:0,wood:2},Qf={gems:0,gold:0,redCrystals:0,wood:0},Jf=n=>{let{id:e,abilities:i,army:t,items:o,name:r,resources:s,stats:d,generalDescription:h,image:_}=n,C={id:e,name:r,generalDescription:h,initialState:{abilities:i,army:t,items:o,resources:s,stats:d},image:_??ue.HeroMage};return wi(C),C};var hO=bi.createHero({id:"#hero-blight",name:"Blight",generalDescription:U("A rotting ent called Blight. His army is weakened by -10% All Resist and -5 Defence, but compensating it with abilities and providing many ways to heal."),image:ue.HeroKnight,abilities:["#spell-obelisk","#spell-life-transfer"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",13,16,2],["#unit-f10",10,14,1]]}],items:[],resources:Cn,stats:{mana:16,baseAttack:2,baseDefence:0},defaultModifiers:{heroBonusDefence:-5,resistAll:-10}});var CO=bi.createHero({id:"#hero-firebrand",name:"Firebrand",generalDescription:U("A half-troll who harnessed the chaotic nature of fire magic, which ends up unfortunately both for his enemies and allies. All Fort units will start with -15% Fire Resist."),image:ue.HeroKnight,abilities:["#spell-firestorm"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Cn,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{__unitConditionalMods(n){return n.type.faction===bi?{resistFire:-15}:null}}});var Be=function(n){return n.PhysicalAttack="physAttack",n.Physical="physical",n.Magic="magic",n.Fire="fire",n.Cold="cold",n.Poison="poison",n.Lightning="lightning",n.Astral="astral",n}(Be||{});var oi=(()=>{let e=class e{constructor(t){this.id=t}getState(){return console.info("Game object doens't have state getter:",this),null}listenState(){return console.info("Game object doens't have state listener:",this),es(null)}getStateSignal(){throw new Error(`Game object doesn't have signal state ${this.id}`)}create(t){}getApi(){return this.api}onDestroy(){}addCustomData(t){this.api.gameObjects.addCustomData(this.id,t)}getCustomData(){return this.api.gameObjects.getCustomData(this.id)}};e.categoryId="game-object";let n=e;return n})();var sc=class{addEventHandler(e,i){this.eventHandlersMap||(this.eventHandlersMap=new Map);let t=this.eventHandlersMap.get(e);t?t.push(i):this.eventHandlersMap.set(e,[i])}triggerEvent(e){this.eventHandlersMap&&this.eventHandlersMap.get(e.__eventType.__type)?.forEach(i=>i(e))}removeAllHandlers(){this.eventHandlersMap?.clear()}removeEventHandler(e,i){let t=this.eventHandlersMap?.get(e);t&&z.removeItem(t,i)}removeEventHandlers(e){this.eventHandlersMap?.delete(e)}};var L=function(n){return n.Target="target",n.Instant="instant",n.Passive="passive",n.Debuff="debuff",n.Buff="buff",n}(L||{}),wv=[L.Buff,L.Debuff],Sv=[L.Buff,L.Debuff,L.Passive],OO=[L.Instant,L.Passive,L.Target];function bv(n){return wv.includes(n.baseType.activationType)}var Ha=function(n){return n[n.RegularAttackSpell=0]="RegularAttackSpell",n}(Ha||{}),ac=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.currentLevel=1,this.combatEventHandlers=new sc}create({spellBaseType:t,initialLevel:o,state:r}){this.baseType=t,this.currentLevel=o,this.name=this.baseType.name,this.state=r,this.sourceInfo={},this.updateCurrentManaCost()}onDestroy(){this.removeCombatHandlers()}initCombatHandlers(t){this.baseType.config.init(t)}removeCombatHandlers(){this.combatEventHandlers.removeAllHandlers()}updateCurrentManaCost(){this.currentManaCost=this.baseType.config.getManaCost?.(this)||0}setCooldown(t){this.cooldown=t}clearCooldown(){this.cooldown=void 0}setOwnerObjectId(t){this.sourceInfo.ownerUnitObjectId=t}setSourceGameObjectId(t){this.sourceInfo.gameObjectId=t}levelUp(){this.currentLevel+=1,this.updateCurrentManaCost();let t=this.sourceInfo.ownerUnitObjectId;t&&this.baseType.config.onAcquired?.({spellInstance:this,ownerUnit:this.getApi().gameObjects.getObjectByFullId(t)})}isEffect(){return bv(this)}isPassive(){return Sv.includes(this.baseType.activationType)}};e.categoryId="spell";let n=e;return n})();var Z=n=>(wi(n),[L.Instant,L.Target].includes(n.activationType)&&(n.config.isOncePerBattle??=!0),n),Ft=({isEnemy:n,unitGroup:e})=>n&&e.isAlive,eg=({unitGroup:n})=>n.isAlive,To=({isEnemy:n,unitGroup:e})=>!n,Ji={bgClr:Si.DefautlDebuffBg,iconClr:Si.DefautlDebuffClr},lc={bgClr:Si.DefautlBuffBg,iconClr:Si.DefautlBuffClr};var tg=(n,e)=>i=>n+(i-1)*e;var Pr=(n,e)=>n!==e?` (${e}% against ranged units)`:"",Er=n=>{let{icon:e,name:i,blockConfig:t,description:o}=n;return Z({id:n.id,name:i,activationType:L.Passive,icon:{icon:e},getDescription({ownerUnit:r,spellInstance:s}){let d=s.currentLevel-1,h=t.minDamage[d],_=t.maxDamage[d],C=Kp(t.chance[d]),O=Kp(t.chanceAgainstRange[d]);return{descriptions:[B(o({meleeChance:C,rangedChance:O,blockValue:Wf(h,_)}))]}},config:{onAcquired({ownerUnit:r,spellInstance:s}){console.log("Aquired",s),s.state?.damageBlockMod&&r.removeSpellMods(s.state.damageBlockMod),s.state={damageBlockMod:{__attackConditionalModifiers({attacker:d}){let h=s.currentLevel-1,_=t.minDamage[h],C=t.maxDamage[h];return d?.modGroup.getModValue("isRanged")?{damageBlockMin:_,damageBlockMax:C,chanceToBlock:t.chanceAgainstRange[h]}:{damageBlockMin:_,damageBlockMax:C,chanceToBlock:t.chance[h]}}}},r.addSpellMods(s.state.damageBlockMod)},init(){}}})};var WO=Er({id:"#spell-devastator-block",name:"Scale Armor",icon:"dragon-wing",blockConfig:{minDamage:[16],maxDamage:[24],chance:[.35],chanceAgainstRange:[.65]},description:({blockValue:n,meleeChance:e,rangedChance:i})=>`Sturdy scales of Devastator give a ${e}% chance to block ${n} damage${Pr(e,i)}.`});var KO=Er({id:"#spell-knight-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:n,meleeChance:e,rangedChance:i})=>`Knights can block ${n} damage with ${e}% chance${Pr(e,i)}.`}),ZO=Er({id:"#spell-tower-shields-block",name:"Tower Shields",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:n,meleeChance:e,rangedChance:i})=>`Tower shields can block ${n} damage with ${e}% chance${Pr(e,i)}.`});var JO=Er({id:"#spell-skeleton-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[8,24,45,86,120],maxDamage:[16,36,55,96,160],chance:[.2,.3,.35,.4,.45],chanceAgainstRange:[.55,.65,.7,.75,.8]},description:({blockValue:n,meleeChance:e,rangedChance:i})=>`Skeletons can block ${n} damage with ${e}% chance${Pr(e,i)}.`});var Qp="cracked-shield",cc={fontSize:"64px",color:"rgb(220 145 129)"},dc=(n=cc.color)=>it("#vfx-cracked-shield",[[_e(Qp,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],J(T({},cc),{opacity:"1"})],[_e(Qp,"fire-blur"),$t(),J(T({},cc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(Qp,"fire-pulse"),Ot(),J(T({},cc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]);var xv=dc("red"),uF=Z({id:"#spell-neut-gnoll-crush",name:"Crush",icon:{icon:"cracked-shield"},getDescription(){return{descriptions:["Gnolls perform an attack with crushing force, reducing armor and attack of the victim by 2."]}},activationType:L.Target,config:{aiTags:[Ha.RegularAttackSpell],init({events:n,actions:e,ownerUnit:i,spellInstance:t,vfx:o}){n.on({PlayerTargetsSpell({target:r}){t.setCooldown(1),e.historyLog(`Group of Gnolls uses 'Crush' on group of ${r.type.name}`),e.dealDamageTo(r,40,Be.PhysicalAttack),o.createEffectForUnitGroup(r,xv)}})}}});var vF=Z({id:"#spell-universal-pin",name:"Pin",icon:{icon:"crossed-swords",iconClr:"rgb(255 255 255)",bgClr:"#ff7163"},getDescription(){return{descriptions:[B("Attack-ability. Attacks and pins an enemy group, forcing it to deal less damage to everyone aside this group."),B("<br/>Pinning unit also takes more damage from other unpinned enemy groups. Attacking or pinning different target will release previously pinned target."),B("<hr/>Learn more in Glossary.")]}},activationType:L.Target,config:{isOncePerBattle:!1,hideLevel:!0,targetCastConfig:{canActivate:Ft},getTargetActionHint({ownerUnit:n,target:e}){let i=100,t=e.modGroup;return(t.getModValue("isCavalry")||t.getModValue("isBigCreature"))&&(i=70),t.getModValue("isBoss")&&(i=15),(t.getModValue("isGiant")||e.type.level>=6)&&(i=0),`Chance to pin: ${i}%`},init({actions:n,events:e,ownerUnit:i,vfx:t}){e.on({PlayerTargetsSpell({target:o}){if(n.unitGroupAttack(i,o),n.pinAttempt(i,o).pinFailed){n.historyLog("Pin attempt has failed");return}n.historyLog("Pin succeeded"),t.createFloatingMessageForUnitGroup(o,{html:"pinned"})}})},getManaCost(){return 0}}});var Jp=jt({prefix:"Spells",events:{PlayerTargetsSpell:dt(),SpellPlacedOnUnitGroup:dt(),NewRoundBegins:dt(),PlayerCastsInstantSpell:dt(),UnitGroupAttacks:dt(""),AuraCheck:dt()}}),Io=Jp.events;var EF=Z({id:"#spell-astral-banishment",name:"Astral Banishment",activationType:L.Target,icon:{icon:""},getDescription(){return{descriptions:[B("Banishes unit into astral plane, where it cannot attack or be attacked, but receives increased magical damage.")]}},config:{getManaCost(){return 0},init(){},targetCastConfig:{canActivate:eg}}});var OF=Z({id:"#spell-blindness",name:"Blindness",activationType:L.Instant,icon:{icon:"sunbeams"},getDescription(){return{descriptions:[B("Decreases damage of target enemy group by 15%.")]}},config:{getManaCost(n){return 0},init:()=>{}}});var ig=Z({id:"#spell-charged-strike",name:"Charged Strike",activationType:L.Target,icon:{icon:"lightning"},getDescription:()=>({descriptions:[B("Makes current unit group attack enemy with additional lightning damage."),B("If current unit group is cavalry type, damage is doubled, as well as critical damage is added"),B("Consumes Turn.")]}),config:{isOncePerBattle:!1,init({actions:n,events:e,vfx:i}){e.on({PlayerTargetsSpell({target:t}){let o=n.getCurrentUnitGroup(),r=o.modGroup.getModValue("isCavalry"),s=n.createModifiers({criticalDamageMul:r?.2:.35,criticalDamageChance:1});n.addModifiersToUnitGroup(o,s),n.dealDamageTo(t,40,Be.Lightning),i.createEffectForUnitGroup(t,Gf),n.unitGroupAttack(o,t),n.removeModifiresFromUnitGroup(o,s)}})},getManaCost(){return 2}}});var ng=.14,og=Kh(ng),eu=5,rg=2,Mv=dc(),Dv=Z({id:"#spell-corrosive-fog-debuff",name:"Corrosion",activationType:L.Debuff,icon:T({icon:"cracked-shield"},Ji),getDescription(n){return{descriptions:[B(`Defence is lowered by ${eu}, damage by ${og}. Rounds left: ${n.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{isOncePerBattle:!1,init({events:n,actions:e,thisSpell:i,spellInstance:t,vfx:o}){n.on({SpellPlacedOnUnitGroup({target:r}){let s={debuffRoundsLeft:rg};t.state=s;let d=e.createModifiers({baseDamagePercentModifier:-ng,heroBonusDefence:-eu});o.createEffectForUnitGroup(r,Mv),e.addModifiersToUnitGroup(r,d),e.historyLog(`${r.type.name} gets negative effect "${i.name}"`),n.on({NewRoundBegins(h){s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(r,t),e.removeModifiresFromUnitGroup(r,d))}})}})}}}),zF=Z({id:"#spell-corrosive-fog",name:"Corrosive Fog",activationType:L.Target,icon:{icon:"cracked-shield"},getDescription(n){return{descriptions:[B(`Surrounds an enemy with corrosive fog, reducing defence by ${eu} and outgoing damage by ${og}. Lasts ${rg} rounds.`)]}},config:{targetCastConfig:{canActivate:Ft},getManaCost(n){return{1:2,2:2,3:3,4:4}[n.currentLevel]},init({events:n,actions:e,ownerPlayer:i,ownerHero:t,thisSpell:o}){n.on({PlayerTargetsSpell(r){e.historyLog(`${t.name} casts "${o.name}" against ${r.target.type.name}`);let s=e.createSpellInstance(Dv);e.addSpellToUnitGroup(r.target,s,i)}})}}});var ZF=Z({id:"#spell-dream-aura",name:"Dream Aura",icon:{icon:"overmind"},getDescription(){return{descriptions:["Damage dealt to nearby allies becomes part of Star Dragon's dream. Increases All Resist (+17%) and Defence(6) for closest allies."]}},activationType:L.Passive,config:{init(){}}});var tu=17,iu=Z({id:"#spell-enchant-buff",name:"Enchanted",activationType:L.Debuff,icon:T({icon:"fire-ring"},Ji),getDescription(){return{descriptions:[B(`Incoming damage from spells is increased by ${tu}%.`)]}},config:{init:({events:n,actions:e,vfx:i})=>{let t=e.createModifiers({amplifiedTakenMagicDamagePercent:tu/100});n.on({SpellPlacedOnUnitGroup(o){i.createEffectForUnitGroup(o.target,Uf,{duration:1e3}),e.addModifiersToUnitGroup(o.target,t)}})}}}),sg=Z({id:"#spell-enchant",name:"Enchant",activationType:L.Target,icon:{icon:"fire-ring"},getDescription(){return{descriptions:[B(`Enchants an enemy to receive increased damage from spells by ${tu}%`)]}},config:{isOncePerBattle:!1,targetCastConfig:{canActivate:Ft},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},init:({events:n,actions:e,ownerPlayer:i})=>{n.on({PlayerTargetsSpell(t){let o=e.createSpellInstance(iu);e.addSpellToUnitGroup(t.target,o,i),e.historyLog("Enemy is enchanted")}})}}});var ag=20,lg=30,cg=2,Pv=Eo("#vfx-dragon-breath","dragon-breath"),dR=Z({id:"#spell-fire-breath",name:"Fire Breath",activationType:L.Passive,icon:{icon:"dragon-breath"},getDescription({ownerUnit:n}){return{descriptions:[B(`${n?.type.name} covers ground with fire breath at the beginning of each round, dealing ${ag}-${lg} fire damage to ${cg} random enemy groups.`)]}},config:{init({actions:n,vfx:e,ownerPlayer:i,ownerUnit:t,events:o,thisSpell:r}){o.on({NewRoundBegins(){let s=n.getAliveUnitGroupsOfPlayer(n.getEnemyOfPlayer(i)),d=z.getRandomItems(s,cg);n.historyLog(`${t?.type.name} casts ${r.name}.`),d.forEach(h=>{let _=z.randIntInRange(ag,lg);e.createEffectForUnitGroup(h,Pv,{duration:1300}),n.dealDamageTo(h,_,Be.Fire,C=>{n.historyLog(`${t?.type.name} deals ${C.finalDamage} damage to ${C.initialUnitCount} ${h.type.name} with ${r.name}, ${C.unitLoss} units perish`),e.createFloatingMessageForUnitGroup(h,Di(C.finalDamage,C.unitLoss),{duration:1800})})})}})}}});var ja="fire-shield",nu={fontSize:"64px",color:"#ffbc6c"},Ev=it("#vfx-haste",[[_e(ja,"fire-main"),Mi(),J(T({},nu),{opacity:"1"})],[_e(ja,"fire-blur"),$t(),J(T({},nu),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(ja,"fire-pulse"),Ot(),J(T({},nu),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Tv=Z({id:"#spell-fire-shield-buff",name:"Fire Shield",activationType:L.Buff,icon:T({icon:ja},lc),getDescription(){return{descriptions:[B("Unit is protected by Fire Shield, blocking 14-18 damage with 100% and receiving 15% Fire Resist.")]}},config:{isOncePerBattle:!1,init:({events:n,actions:e,vfx:i})=>{let t=e.createModifiers({__attackConditionalModifiers(){return{chanceToBlock:1,damageBlockMax:18,damageBlockMin:14,resistFire:15}}});n.on({SpellPlacedOnUnitGroup(o){i.createEffectForUnitGroup(o.target,Ev,{duration:800}),e.addModifiersToUnitGroup(o.target,t)}})}}}),dg=Z({id:"#spell-fire-shield",name:"Fire Shield",activationType:L.Target,icon:{icon:ja},getDescription(){return{descriptions:[B("Protects allied unit with a fire shield that blocks damage.")]}},config:{targetCastConfig:{canActivate:To},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},init:({events:n,actions:e,ownerPlayer:i,ownerUnit:t})=>{n.on({PlayerTargetsSpell(o){let r=e.createSpellInstance(Tv);e.addSpellToUnitGroup(o.target,r,i)}})}}});var pc="hospital-cross",ou={fontSize:"64px",color:"rgb(200 244 124)"},Iv=it("#vfx-firebird-heal",[[_e(pc,"fire-main"),Mi(),J(T({},ou),{opacity:"1"})],[_e(pc,"fire-blur"),$t(),J(T({},ou),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(pc,"fire-pulse"),Ot(),J(T({},ou),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),ru=20,SR=Z({id:"#spell-revitalize",name:"Revitalize",activationType:L.Target,icon:{icon:pc},getDescription(n){let e=n.ownerUnit,i=e.count,t=e.type.name,o=i*ru;return{descriptions:[B(`Heals friendly unit group by ${o}. Heal increases by ${ru} per each Firebird in current group.`)]}},config:{isOncePerBattle:!1,targetCastConfig:{canActivate:To},getManaCost(n){return 2},init:({events:n,actions:e,ownerUnit:i,vfx:t})=>{n.on({PlayerTargetsSpell(o){let r=i,s=r.count*ru,d=o.target,h=d.type.name,_=e.healUnit(d,s);t.createEffectForUnitGroup(d,Iv,{duration:800});let C=_.revivedUnitsCount;e.historyLog(`${r.count} ${r.type.name} heal ${h} by ${s}.`),e.historyLog(`${C} of ${h} are brought back to life.`),t.createFloatingMessageForUnitGroup(o.target,oc(C,s),{duration:1600})}})}}});var ug=.25,mg=ug*100,pg=Z({id:"#spell-fright-debuff",name:"Fright",activationType:L.Debuff,icon:T({icon:"batwings"},Ji),getDescription(){return{descriptions:[B(`This unit group is frightened, dealing ${mg}% less damage to the one who scared it.`)]}},config:{init({actions:n,events:e,spellInstance:i,vfx:t,ownerHero:o}){e.on({SpellPlacedOnUnitGroup({target:r}){let s=o.modGroup.getModValue("specialtyNecromancy")||0,d=n.createModifiers({__attackConditionalModifiers(h){return!s&&h.attacked===i.state?.frighter?{baseDamagePercentModifier:-ug}:s>=1?h.attacked===i.state?.frighter?{baseDamagePercentModifier:-.25}:h.attacked.modGroup.getModValue("isGhost")?{baseDamagePercentModifier:-.17}:{baseDamagePercentModifier:-.12}:{}}});t.createEffectForUnitGroup(r,Lf,{duration:1e3}),n.addModifiersToUnitGroup(r,d)}})}}}),TR=Z({id:"#spell-fright",name:"Fright",activationType:L.Passive,icon:{icon:"batwings"},getDescription(n){return{descriptions:[B(`Scares enemy group on attack, reducing damage against this group by ${mg}%.  Ability Improves with Necromancy, reducing damage against all your units.`)]}},config:{init({actions:n,events:e,ownerPlayer:i,ownerUnit:t}){e.on({UnitGroupAttacks({attacked:o,attacker:r}){if(t!==r||o.spells.find(d=>d.baseType===pg))return;let s=n.createSpellInstance(pg,{state:{frighter:r}});n.addSpellToUnitGroup(o,s,i)}})}}});var uc="frost-emblem",su={fontSize:"64px",color:"#a9bee2"},kv=it("#vfx-frozen-arrow",[[_e(uc,"fire-main"),Mi(),J(T({},su),{opacity:"1"})],[_e(uc,"fire-blur"),$t(),J(T({},su),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(uc,"fire-pulse"),Ot(),J(T({},su),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),hg=40,mc=4,hc=3,Av=Z({id:"#spell-frost-arrow-debuff",name:"Freeze",activationType:L.Debuff,icon:J(T({icon:uc},Ji),{bgClr:"#a9bee2"}),getDescription(n){return{descriptions:[B(`Unit group is slowed down by ${mc}, attack rating reduced by ${hc}.`)]}},config:{init:({events:n,actions:e,vfx:i,thisSpell:t})=>{let o=e.createModifiers({unitGroupSpeedBonus:-mc,heroBonusAttack:-hc});n.on({SpellPlacedOnUnitGroup({target:r}){i.createEffectForUnitGroup(r,kv,{duration:800}),e.addModifiersToUnitGroup(r,o),e.historyLog(`${r.type.name} receives ${t.name} debuff, slowed by ${mc} and gains -${hc} attack rating penalty.`)}})}}}),fg=Z({id:"#spell-frost-arrow",name:"Frost Arrow",activationType:L.Target,icon:{icon:"frozen-arrow"},getDescription(n){return{descriptions:[B(`Deals ${hg} magic damage, slows enemy by ${mc} and reduces attack rating by ${hc}.`)]}},config:{targetCastConfig:{canActivate:Ft},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},init:({events:n,actions:e,ownerPlayer:i,ownerHero:t,thisSpell:o,vfx:r})=>{n.on({PlayerTargetsSpell:s=>{let d=e.createSpellInstance(Av);e.addSpellToUnitGroup(s.target,d,i),e.dealDamageTo(s.target,hg,Be.Cold,({finalDamage:h,unitLoss:_})=>{let C=s.target.type.name;e.historyLog(`${t.name} deals ${h} damage to ${C} with ${o.name}, ${_} ${C} perishes`),r.createFloatingMessageForUnitGroup(s.target,Di(h,_),{duration:1e3})})}})}}});var $a="boot-stomp",au={fontSize:"64px",color:"rgb(200 244 124)"},Ov=it("#vfx-haste-anim",[[_e($a,"fire-main"),Mi(),J(T({},au),{opacity:"1"})],[_e($a,"fire-blur"),$t(),J(T({},au),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e($a,"fire-pulse"),Ot(),J(T({},au),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),lu=5,Fv=Z({id:"#spell-haste-buff",name:"Haste",activationType:L.Buff,icon:T({icon:$a},lc),getDescription(){return{descriptions:[B(`Unit group is speeded up by ${lu}.`)]}},config:{init:({events:n,actions:e,vfx:i,spellInstance:t})=>{let o=e.createModifiers({unitGroupSpeedBonus:lu+t.currentLevel-1});n.on({SpellPlacedOnUnitGroup(r){i.createEffectForUnitGroup(r.target,Ov,{duration:800}),e.addModifiersToUnitGroup(r.target,o)}})}}}),jR=Z({id:"#spell-haste",name:"Haste",activationType:L.Target,icon:{icon:$a},getDescription({spellInstance:n}){return{descriptions:[B(`Target unit group is speeding up by ${lu+n.currentLevel-1}.`),B("When upgraded, increases the speed bonus and starts to grant a chance to gain additional turn to units.")]}},config:{targetCastConfig:{canActivate:To},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},isOncePerBattle:!1,init:({events:n,actions:e,ownerPlayer:i,spellInstance:t,vfx:o})=>{n.on({PlayerTargetsSpell(r){let s=e.createSpellInstance(Fv,{initialLevel:t.currentLevel});r.target.type.id==="#unit-neut-wind-spirit-0"&&(e.addTurnsToUnitGroup(r.target,1),o.createDroppingMessageForUnitGroup(r.target.id,{html:Ui("+1 Turn")},{duration:1200})),e.addSpellToUnitGroup(r.target,s,i)}})}}});var fc="hospital-cross",cu={fontSize:"64px",color:"rgb(200 244 124)"},Rv=it("#vfx-heal",[[_e(fc,"fire-main"),Mi(),J(T({},cu),{opacity:"1"})],[_e(fc,"fire-blur"),$t(),J(T({},cu),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(fc,"fire-pulse"),Ot(),J(T({},cu),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),KR=Z({id:"#spell-heal",name:"Heal",activationType:L.Target,icon:{icon:fc},getDescription(n){return{descriptions:[]}},config:{targetCastConfig:{canActivate:To},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},isOncePerBattle:!1,init:({events:n,actions:e,ownerPlayer:i,ownerUnit:t,vfx:o})=>{n.on({PlayerTargetsSpell(r){let d=r.target.count,h=r.target;e.healUnit(h,64),o.createEffectForUnitGroup(h,Rv,{duration:800});let _=r.target.count,C=h.type.name,O=_-d;e.historyLog(`${i.hero.name} heals ${C} by 64.`),e.historyLog(`${O} of ${C} are brought back to life.`),o.createFloatingMessageForUnitGroup(r.target,oc(O,64),{duration:1e3})}})}}});var du=50,gg="player-despair",Bv=ro("#vfx-kneeling-light","player-despair","rgb(227, 240, 113)"),Gv=Z({id:"#spell-kneeling-light-debuff",name:"Slowed",activationType:L.Debuff,icon:T({icon:gg},Ji),getDescription(n){return{descriptions:[B(`Unit group is slowed down by ${du}%.`)]}},config:{init:({events:n,actions:e,vfx:i})=>{n.on({SpellPlacedOnUnitGroup(t){let o=t.target.type.baseStats.speed,r=e.createModifiers({unitGroupSpeedBonus:-(o*(du/100))});i.createEffectForUnitGroup(t.target,Bv,{duration:1e3}),e.addModifiersToUnitGroup(t.target,r)}})}}}),iB=Z({id:"#spell-kneeling-light",name:"Kneeling Light",icon:{icon:gg},getDescription(n){return{descriptions:[B(`Makes light so heavy for the enemy target that it loses ${du}% of the speed.`)]}},activationType:L.Target,config:{targetCastConfig:{canActivate:Ft},getManaCost(n){return{1:2,2:2,3:3,4:3}[n.currentLevel]},init:({events:n,actions:e,ownerPlayer:i})=>{n.on({PlayerTargetsSpell(t){let o=e.createSpellInstance(Gv);e.addSpellToUnitGroup(t.target,o,i)}})}}});var yg=20,_g=50,vg=30,Lv=Eo("#vfx-meteor","burning-meteor"),Cg=Z({id:"#spell-meteor",name:"Meteor",activationType:L.Instant,icon:{icon:"burning-meteor"},getDescription({spellInstance:n}){let e=vg*n.currentLevel;return{descriptions:[B(`Meteor deals ${yg+e}-${_g+e} fire damage to random enemy group, next 2 unit groups after current group in fight queue (enemies or allies) will be stunned and will lose their turns. If stunned enemy's creature is tier 4 or higher, instead of stun, it will take 65% of ability's damage.`)]}},config:{getManaCost:n=>({1:5,2:5,3:6,4:6})[n.currentLevel],init({events:n,actions:e,thisSpell:i,ownerHero:t,vfx:o,spellInstance:r}){n.on({PlayerCastsInstantSpell(s){let d=e.getRandomEnemyPlayerGroup(),h=vg*r.currentLevel;r.setCooldown(1/0),o.createEffectForUnitGroup(d,Lv,{duration:1e3});let _=z.randIntInRange(yg+h,_g+h);e.dealDamageTo(d,_,Be.Fire,({unitLoss:R,initialUnitCount:Q,finalDamage:de})=>{e.historyLog(`${t.name} deals ${de} damage to ${Q} ${d.type.name} with ${i.name}, ${R} units perish`),o.createFloatingMessageForUnitGroup(d,Di(de,R),{duration:1e3})});let C=e.getUnitsFromFightQueue(),O=z.selectItems(C,2,1);console.log(C,O),O.forEach(R=>{R.type.level<4?(e.removeTurnsFromUnitGroup(R),o.createDroppingMessageForUnitGroup(R.id,{html:Ui("Stunned!")}),e.historyLog(`${R.count} ${R.type.name} stunned by the Meteor.`)):e.isEnemyUnitGroup(R)&&e.dealDamageTo(R,_*.65,Be.Fire,({unitLoss:Q,initialUnitCount:de,finalDamage:Ie})=>{e.historyLog(`${t.name} deals ${Ie} damage to ${de} ${R.type.name} with ${i.name}, ${Q} units perish`),o.createFloatingMessageForUnitGroup(d,Di(Ie,Q),{duration:1e3})})})}})}}});var mu=5,Sg=34,bg=46,xg=`${Sg}-${bg}`,Nv=2,pu="bomb-explosion",uu={fontSize:"64px",color:"rgb(172 202 120)"},wg=it("#vfx-poison-cloud",[[_e(pu,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],J(T({},uu),{opacity:"1"})],[_e(pu,"fire-blur"),$t(),J(T({},uu),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[_e(pu,"fire-pulse"),Ot(),J(T({},uu),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Uv=Z({id:"#spell-poison-cloud-debuff",name:"Poisoned",activationType:L.Debuff,icon:T({icon:"poison-cloud"},Ji),getDescription(n){return{descriptions:[B(`Takes ${xg} damage at the beginning of round, attack rating is lowered by ${mu}. Rounds left: ${n.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{init({events:n,actions:e,thisSpell:i,spellInstance:t,vfx:o}){n.on({SpellPlacedOnUnitGroup({target:r}){let s={debuffRoundsLeft:Nv};t.state=s;let d=e.createModifiers({heroBonusAttack:-mu});o.createEffectForUnitGroup(r,wg),e.addModifiersToUnitGroup(r,d),e.historyLog(`${r.type.name} gets negative effect "${i.name}"`),n.on({NewRoundBegins(h){e.dealDamageTo(r,z.randIntInRange(Sg,bg),Be.Poison,_=>{e.historyLog(`Poison deals ${_.finalDamage} damage to ${r.type.name}, ${_.unitLoss} units perish`),o.createEffectForUnitGroup(r,wg),o.createFloatingMessageForUnitGroup(r,Di(_.finalDamage,_.unitLoss),{duration:1e3})}),s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(r,t),e.removeModifiresFromUnitGroup(r,d))}})}})}}}),_B=Z({id:"#spell-poison-cloud",name:"Poison Cloud",activationType:L.Target,icon:{icon:"poison-cloud"},getDescription(n){return{descriptions:[B(`Poisons target, lowering attack rating by ${mu} and dealing ${xg} damage at the beginning of each round. Lasts 2 rounds.`)]}},config:{targetCastConfig:{canActivate:Ft},getManaCost(n){return{1:2,2:3,3:4,4:5}[n.currentLevel]},init({events:n,actions:e,ownerPlayer:i,ownerHero:t,thisSpell:o}){n.on({PlayerTargetsSpell(r){e.historyLog(`${t.name} casts "${o.name}" against ${r.target.type.name}`);let s=e.createSpellInstance(Uv);e.addSpellToUnitGroup(r.target,s,i)}})}}});var bB=Z({id:"#spell-protection-aura",name:"Protected",activationType:L.Buff,icon:{icon:"spear-head"},getDescription:()=>({descriptions:["Unit is being protected"]}),config:{onAcquired({ownerUnit:n,spellInstance:e}){},init({}){}}}),xB=Z({id:"#spell-protection",name:"Protection",icon:{icon:"spear-head"},activationType:L.Passive,getDescription:()=>({descriptions:["An aura that affects allies in range of 1 and gives damage block plus bonus armor."]}),config:{flags:{isAura:!0},onAcquired({spellInstance:n,ownerUnit:e}){},init({ownerUnit:n,events:e,actions:i}){e.on({AuraCheck({target:t}){}})}}});var Pg=65,Eg=25,Mg=tg(Pg,Eg),Tr=3,Dg=[{targets:1,damage:[.3]},{targets:1,damage:[.6]},{targets:2,damage:[.65,.25]}],AB=Z({id:"#spell-rain-of-fire",name:"Rain of Fire",activationType:L.Target,icon:{icon:"fire"},getDescription({ownerHero:n,spellInstance:e}){let i=n.specialtiesModGroup.getModValue("specialtyFireMastery")||0,t=[B(`Deals ${Pg} base damage, +${Eg} per level to the target.`),B(`<br>Damage: ${Mg(e.currentLevel)}`),B("<br>Improves with Fire Mastery: gains random additional targets.")];if(i){let o=Dg[i-1];t.push(B(`<hr/>Fire Mastery ${i}:<br>Additional targets: ${o.targets}<br>Damage: ${o.damage.map(nc).join(", ")}`))}return{descriptions:t}},config:{targetCastConfig:{canActivate:Ft},init:({events:n,actions:e,thisSpell:i,ownerHero:t,vfx:o,spellInstance:r})=>{n.on({PlayerTargetsSpell(s){let d=Mg(r.currentLevel);function h(C,O,R){e.dealDamageTo(C,O,Be.Fire,Q=>{e.historyLog(`${t.name} deals ${Q.finalDamage} damage to ${Q.initialUnitCount} ${C.type.name} with ${i.name}, ${Q.unitLoss} units perish.`),setTimeout(()=>{o.createEffectForUnitGroup(C,ic,{duration:850}),o.createFloatingMessageForUnitGroup(C,Di(Q.finalDamage,Q.unitLoss),{duration:1200})},R*250)})}h(s.target,d,0);let _=t.specialtiesModGroup.getModValue("specialtyFireMastery")||0;if(_){let C=Dg[_-1],O=e.getAliveUnitGroupsOfPlayer(s.target.ownerPlayer);z.removeItem(O,s.target),O.length&&z.getRandomItems(O,C.targets).forEach((Q,de)=>{h(Q,d*C.damage[de],de+1)})}}})},getManaCost:n=>({1:Tr,2:Tr,3:Tr+1,4:Tr+1,5:Tr+2,6:Tr+2,7:Tr+2})[n.currentLevel]}});var Tg=3,Ig=2,NB=Z({id:"#spell-summon-fire-spirits",name:"Fire Spirits",activationType:L.Instant,icon:{icon:"aura"},getDescription({spellInstance:n}){return{descriptions:[B(`Summon ${Tg+Ig*n.currentLevel} Fire Spirits that fight on your side.`),B("<hr/>Spirits have active ability Fire Shield and disappear when the fight is over.")]}},config:{getManaCost(n){return 2+n.currentLevel},init({actions:n,spellInstance:e,ownerPlayer:i,events:t,vfx:o}){t.on({PlayerCastsInstantSpell(){let r=n.summonUnitsForPlayer(i,"#unit-neut-fire-spirit-0",Tg+Ig*e.currentLevel);e.setCooldown(1/0);let s=n.createSpellInstance(dg,{initialLevel:1});n.addSpellToUnitGroup(r,s,i),o.createEffectForUnitGroup(r,ic,{duration:1e3});let d=n.getAliveUnitGroupsOfPlayer(n.getEnemyOfPlayer(i))}})}}});var kg=6,Ag=4,Vv=Eo("#vfx-summon-saggitar","arrow-cluster","rgb(190, 190, 231)"),zB=Z({id:"#spell-summon-sagittar",name:"Summon Sagittar",activationType:L.Instant,icon:{icon:"arrow-cluster"},getDescription(n){return{descriptions:[B(`Summons ${kg+n.ownerHero.level*Ag} Sagittars that fight on your side.`)]}},config:{getManaCost(){return 2},init({actions:n,ownerHero:e,ownerPlayer:i,events:t,vfx:o,thisSpell:r}){t.on({PlayerCastsInstantSpell(){let s=n.summonUnitsForPlayer(i,"#unit-c20",kg+e.level*Ag);o.createEffectForUnitGroup(s,Vv,{duration:1e3})}})}}});var Og=2,Fg=.17,Rg=Z({id:"#spell-wind-bless-buff",name:"Wind Bless",icon:{icon:"feather-wing",bgClr:Si.DefautlBuffBg,iconClr:Si.DefautlBuffClr},activationType:L.Buff,getDescription(){return Zh(`Attack of ranged units increased by ${Og} and Block-Piercing by ${nc(Fg)}.`)},config:{init:({events:n,actions:e,spellInstance:i})=>{n.on({SpellPlacedOnUnitGroup(t){let o=e.createModifiers({heroBonusAttack:Og,blockPiercingPercent:Fg});i.state={roundsLeft:1,target:t.target,mods:o},e.addModifiersToUnitGroup(t.target,o)},NewRoundBegins(t){let o=i.state;--o.roundsLeft||(e.removeSpellFromUnitGroup(o.target,i),e.removeModifiresFromUnitGroup(o.target,o.mods))}})}}});var O3=Z({id:"#spell-firestorm",name:"Firestorm",icon:{icon:"flaming-claw"},activationType:L.Target,getDescription:()=>({descriptions:[B("Deals 100 damage to the target as fire damage while converting 30% of it to pure damage. Your current unit is going to suffer 25% of that damage as fire damage.")]}),config:{getManaCost:()=>3,init({events:n,actions:e,vfx:i}){n.on({PlayerTargetsSpell({target:t}){e.dealDamageTo(t,70,Be.Fire),e.dealDamageTo(t,30,Be.Magic),e.dealDamageTo(e.getCurrentUnitGroup(),100*.25,Be.Fire)}})},targetCastConfig:{canActivate:Ft}}});var Bg=20,Gg=10,L3=Z({id:"#spell-life-transfer",name:"Life Drain",icon:{icon:"health-decrease"},activationType:L.Instant,getDescription:({spellInstance:n})=>({descriptions:[B(`Reallocates health from enemies, dealing ${Bg+Gg*(n.currentLevel-1)} damage to all enemies and equally distributing the dealt damage as healing among your army.`)]}),config:{getManaCost:()=>3,init({events:n,actions:e,vfx:i,ownerPlayer:t,spellInstance:o}){n.on({PlayerCastsInstantSpell(){let r=e.getEnemyOfPlayer(t),s=e.getAliveUnitGroupsOfPlayer(r),d=Bg+Gg*(o.currentLevel-1),h=s.length;s.forEach(R=>{e.dealDamageTo(R,d,Be.Magic)});let _=h*d,C=e.getUnitGroupsOfPlayer(t),O=Math.round(_/C.length);C.forEach(R=>e.healUnit(R,O))}})}}});var j3=Z({id:"#spell-obelisk",name:"Life Obelisk",icon:{icon:"arena"},activationType:L.Target,getDescription:()=>({descriptions:[B("Stuns selected target and summons an Obelisk with 100 health. Obelisk possesses aura that increases the armor by 4."),B("Obelisk cannot attack, but can be attacked and destroyed."),B("Some of Blight's abilities interact with obelisk."),B("Cannot be cast while there is another obelisk.")]}),config:{getManaCost:()=>3,init({events:n,actions:e,vfx:i}){n.on({PlayerTargetsSpell({target:t}){i.createDroppingMessageForUnitGroup(t.id,{html:Ui("Stunned!")}),e.removeTurnsFromUnitGroup(t,2)}})},targetCastConfig:{canActivate:Ft}}});var Hv=Z({id:"#spell-onslaught-buff",name:"Onslaught",icon:{icon:"spear-head",bgClr:"orange",iconClr:"#f10c0c"},activationType:L.Buff,getDescription:()=>({descriptions:[B("This group of Raiders has increased stats and 40% lifesteal.")]}),config:{getManaCost:()=>3,init({events:n,actions:e,vfx:i}){let t=e.createModifiers({lifesteal:40,heroBonusAttack:3,heroBonusDefence:2});n.on({SpellPlacedOnUnitGroup({target:o}){e.addModifiersToUnitGroup(o,t)}})}}}),jv=ro("#vfx-spear-head","spear-head","orange"),Y3=Z({id:"#spell-onslaught",name:"Onslaught",icon:{icon:"spear-head"},activationType:L.Target,getDescription:()=>({descriptions:[B("Can only be cast on Raiders. Increases their stats and grants lifesteal.")]}),config:{getManaCost:()=>1,init({events:n,actions:e,vfx:i,ownerPlayer:t}){n.on({PlayerTargetsSpell({target:o}){i.createEffectForUnitGroup(o,jv);let r=e.createSpellInstance(Hv,{initialLevel:1});e.addSpellToUnitGroup(o,r,t)}})},targetCastConfig:{canActivate:({isEnemy:n,unitGroup:e})=>!n&&e.type.name==="Raiders"}}});var eG=bi.createHero({id:"#hero-toothpick",name:"Toothpick",generalDescription:U("Toothpick is a famous captain of Raiders, their effectiveness excels under his command."),image:ue.HeroKnight,abilities:["#spell-onslaught"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Cn,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{}});var mG=rt.createHero({id:"#hero-helvetica",name:"Helvetica",generalDescription:U("Helvetica is the mage who supports her own army with offensive fire spells as well as increasing their speed."),image:ue.HeroHelvetica,abilities:["#spell-rain-of-fire","#spell-haste"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h00",20,32,1],["#unit-h10",12,18,1],["#unit-h20",6,11,1],["#unit-neut-wind-spirit-0",4,6,1]]}],items:["#item-wind-crest"],resources:{gems:0,gold:750,redCrystals:0,wood:4},stats:{mana:12,baseAttack:1,baseDefence:0},defaultModifiers:{}});var Lg=12,vG=rt.createHero({id:"#hero-taltir",name:"Taltir",generalDescription:U(`Taltir specializes at utilizing Fire Spells, summoning Fire Spirits and devastating Meteors. Knowledge in magic defenses makes him start with +${Lg}% to all resists.`),image:ue.HeroTaltir,abilities:["#spell-summon-fire-spirits","#spell-meteor"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h20",6,11,2],["#unit-h30",3,6,2],["#unit-h00",25,30,1]]}],items:["#item-irton-plate","#item-light-boots"],resources:Cn,stats:{mana:14,baseAttack:2,baseDefence:2},defaultModifiers:{resistAll:Lg}});var xG=rt.createHero({id:"#hero-veasin",name:"Veasin",generalDescription:U("Veasin makes use of her poison abilities, weakening enemies and dealing damage over time."),image:ue.HeroMage,abilities:["#spell-poison-cloud","#spell-corrosive-fog"],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h01",10,18,2],["#unit-h20",6,11,1],["#unit-h30",3,5,1]]}],items:["#item-wind-crest"],resources:{gold:1100,wood:2,gems:0,redCrystals:0},stats:{mana:14,baseAttack:4,baseDefence:2}});var st=function(n){return n[n.Hiring=0]="Hiring",n[n.Garrison=1]="Garrison",n[n.HallsOfFate=2]="HallsOfFate",n[n.ItemsSelling=3]="ItemsSelling",n[n.ResourceTrading=4]="ResourceTrading",n}(st||{}),Ng=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.currentLevel=0,this.built=!1}create(t){this.base=t.base,this.currentBuilding=t.base.levels[0].building}};e.categoryId="building";let n=e;return n})();function Fe(n){return wi(n),n}function za(n,e,i,t=!1){return{type:st.Hiring,hiring:{unitTypeId:n,growth:e,refillDaysInterval:7},unitGrowthGroup:i,growth:e,growthIntervalDays:7,upgrade:t}}function ko(n,e,i,t=!1){return{type:st.Hiring,hiring:{unitTypeId:n,growth:e,refillDaysInterval:7},unitGrowthGroup:i,growth:e,growthIntervalDays:7,upgrade:t}}var $v=Fe({id:"#build-castle-town-center",name:"Town Center",description:"Earns 500 gold each day.",config:{init({players:n,localEvents:e}){e.on({NewDayBegins(){n.giveResourcesToPlayer(n.getCurrentPlayer(),{gold:500})}})}}}),zv=Fe({id:"#build-castle-market",name:"Market",activity:{type:st.ResourceTrading}}),Wv=Fe({id:"#build-castle-high-tower",name:"High Tower",description:"Gives 1 Meditation action card instantly and at the beginning of each week.",config:{init({localEvents:n,players:e,globalEvents:i}){i.dispatch(xi({actionCardStacks:[{card:so,count:1}],player:e.getCurrentPlayer()})),n.on({NewWeekStarts(){i.dispatch(xi({actionCardStacks:[{card:so,count:1}],player:e.getCurrentPlayer()}))}})}}}),qv=Fe({id:"#build-castle-tavern",activity:{type:st.Garrison},name:"Tavern",description:"Allows to hire more units, including neutral ones, from your garrison",config:{init({globalEvents:n,players:e,localEvents:i}){n.dispatch(xi({actionCardStacks:[{card:Xf,count:1}],player:e.getCurrentPlayer()})),i.on({Built(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:Le("#unit-neut-ranger-0")}],name:"Castle Tavern"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:Le("#unit-neut-ranger-0")}],name:"Castle Tavern"})}})}}}),Yv=Fe({id:"#build-castle-taining-camp-1",name:"Training Camp",description:"Allows to train Pikemans that can be upgraded.",activity:ko("#unit-h00",18,"pikeman")}),Kv=Fe({id:"#build-castle-taining-camp-2",name:"Upg. Training Camp",description:"Allows to hire and upgrade Halberdiers",activity:ko("#unit-h00",18,"pikeman",!0)}),Zv=Fe({id:"#build-castle-archers-1",name:"Archers Outpost",description:"Allows to train Archers",activity:ko("#unit-h10",12,"archers")}),Xv=Fe({id:"#build-castle-archers-2",name:"Upg. Archers Outpost",description:"Allows to train Archers and Crossbowmen",activity:ko("#unit-h10",12,"archers",!0)}),Qv=Fe({id:"#build-castle-knights-1",name:"Halls of Knights",description:"Allows to train Knights",activity:ko("#unit-h20",4,"knights")}),Jv=Fe({id:"#build-castle-cavalry-1",name:"Cavalry Stalls",description:"Allows to train Cavalry",activity:ko("#unit-h30",2,"cavalry")}),eC=Fe({id:"#build-castle-magic-tower-1",name:"Magic Tower",description:"Allows to train Mystical Birds",activity:ko("#unit-h40",2,"firebirds")}),tC=Fe({id:"#build-castle-magic-tower-2",name:"Upg. Magic Tower",description:"Allows to train Mystical Birds and Firebirds",activity:ko("#unit-h40",2,"firebirds",!0)}),iC=Fe({id:"#build-castle-items-market",name:"Item market",activity:{type:st.ItemsSelling},description:"Sells items",config:{init({localEvents:n,thisBuilding:e}){n.on({Built(){e.addCustomData({items:["#item-iron-pike","#item-magic-cape","#item-irton-plate","#item-kite-shield"],selling:!0})}})}}}),nC=Fe({id:"#build-castle-halls-of-fate",name:"Halls of Fate",activity:{type:st.HallsOfFate},config:{init({localEvents:n,players:e}){n.on({Built(){e.getCurrentPlayer().addHallsOfFateConfig({id:"Level 1",actionCards:[{cost:{gold:300},count:1,item:"#acard-blacksmithing"},{cost:{gold:300},count:2,item:"#acard-armor-forging"},{cost:{gold:300},count:2,item:"#acard-quiescence"}],items:["#item-storm-pike"],spells:[{cost:{gold:1e3},item:"#spell-charged-strike"}]})}})}}}),oC=Fe({id:"#build-castle-halls-of-fate-2",name:"Halls of Fate Level 2",activity:{type:st.HallsOfFate},config:{init({localEvents:n,players:e}){n.on({Built(){e.getCurrentPlayer().addHallsOfFateConfig({id:"Level 2",actionCards:[{cost:{gold:300},count:2,item:"#acard-blacksmithing"},{cost:{gold:300},count:3,item:"#acard-armor-forging"},{cost:{gold:250},count:4,item:"#acard-quiescence"}],items:["#item-battlemage-sword"],spells:[{cost:{gold:1e3,gems:1},item:"#spell-meteor"}]})}})}}}),rC=Fe({id:"#build-castle-garrison",name:"Garrison",description:"Allows to hire groups of units temporarily for reduced cost.",activity:{type:st.Garrison},config:{init({localEvents:n,players:e}){n.on({Built(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:Le("#unit-h00"),count:16},{cost:{gold:340},type:Le("#unit-h20"),count:6}],name:"Castle Garrison"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:Le("#unit-h00"),count:16},{cost:{gold:340},type:Le("#unit-h20"),count:6}],name:"Castle Garrison"})}})}}}),sC={id:"#town-castle",name:"Castle",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:$v,cost:{gold:1e3}}],icon:"capitol",tier:1},"items-market":{baseName:"Items Market",description:"Sells items",icon:"key-basic",levels:[{building:iC,cost:{gold:500}}],tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:zv,cost:{gold:650,wood:2}}],icon:"gavel",tier:2},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:Wv,cost:{gold:1e3,gems:1}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:qv,cost:{gold:850,wood:1}}],icon:"hood",tier:2},garrison:{baseName:"Garrison",description:"Allows to hire units temorary",icon:"guarded-tower",tier:1,levels:[{building:rC,cost:{wood:2,gold:500}}]},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:nC,cost:{gold:1e3}},{building:oC,cost:{gold:1e3,gems:1}}],icon:"barrier",tier:3},"training-camp":{baseName:"Training Camp",description:"Trains Pikemans",levels:[{building:Yv,cost:{gold:450}},{building:Kv,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},"archers-outpost":{baseName:"Archers Outpost",description:"Trains Archers",levels:[{building:Zv,cost:{gold:500,wood:2}},{building:Xv,cost:{gold:400,wood:2}}],icon:"arrow-cluster",tier:1},"halls-of-knights":{baseName:"Halls of Knights",description:"Trains Knights",levels:[{building:Qv,cost:{gold:1e3,wood:5}}],icon:"crossed-swords",tier:2},"cavalry-halls":{baseName:"Cavalry Halls",description:"Trains Cavalry",levels:[{building:Jv,cost:{gold:1e3,wood:5}}],icon:"horseshoe",tier:3},"magic-tower":{baseName:"Magic Tower",description:"Trains Firebirds and Mystical Birds",levels:[{building:eC,cost:{gold:1500,wood:5}},{building:tC,cost:{gold:600,wood:5}}],icon:"tower",tier:4}}};rt.setTownBase(sC);var aC=Fe({id:"#build-fort-town-hall-1",name:"Town Hall",description:"Earns 400 gold each day and gives 1 additional reserve slot.",config:{init({players:n,localEvents:e}){e.on({NewDayBegins(){n.giveResourcesToPlayer(n.getCurrentPlayer(),{gold:400})},Built(){n.getCurrentPlayer().hero.addReserveSlots(1)}})}}}),lC=Fe({id:"#build-fort-market",name:"Market",activity:{type:st.ResourceTrading}}),cC=Fe({id:"#build-fort-tavern",name:"Tavern"}),dC=Fe({id:"#build-fort-rocky-caves",name:"Rocky Caves",description:"Allows to hire units temporarily",activity:{type:st.Garrison},config:{init({localEvents:n,players:e}){n.on({Built(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:Le("#unit-f00")},{cost:{gold:100},count:8,type:Le("#unit-f00")},{cost:{gold:100},count:8,type:Le("#unit-f00")}],name:"Rocky Caves"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:Le("#unit-f00")},{cost:{gold:100},count:8,type:Le("#unit-f00")},{cost:{gold:100},count:8,type:Le("#unit-f00")}],name:"Rocky Caves"})}})}}}),pC=Fe({id:"#build-fort-goblin-huts-1",name:"Goblin Huts",description:"Allows to train Raiders that can be upgraded.",activity:za("#unit-f00",18,"raiders")}),uC=Fe({id:"#build-fort-goblin-huts-2",name:"Upg. Goblin Huts",description:"Allows to train Raiders and Clan.",activity:za("#unit-f00",18,"raiders",!0)}),mC=Fe({id:"#build-fort-stockade-1",name:"Stockade",description:"Allows to train Goblin Archers that can be upgraded.",activity:za("#unit-f10",18,"goblinArcher")}),hC=Fe({id:"#build-fort-stockade-2",name:"Upg. Stockade",description:"Allows to train Goblin Archers and Goblin Shooters.",activity:za("#unit-f10",18,"goblinArcher",!0)}),fC={id:"#town-fort",name:"Castle",availableBuildings:{"town-hall":{baseName:"Town Hall",description:"Grants you daily income",levels:[{building:aC,cost:{gold:1e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:lC,cost:{gold:800}}],icon:"gavel",tier:1},"rocky-caves":{baseName:"Rocky Caves",description:"Allows to hire units temporarily",icon:"guarded-tower",levels:[{building:dC,cost:{gold:200,wood:2}}],tier:1},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:cC,cost:{gold:1250,wood:3}}],icon:"hood",tier:2},"goblin-huts":{baseName:"Golbin Huts",description:"Trains Goblin Huts",levels:[{building:pC,cost:{gold:475}},{building:uC,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},stockade:{baseName:"Stockade",description:"Trains Goblin Archers",levels:[{building:mC,cost:{gold:700}},{building:hC,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1}}};bi.setTownBase(fC);function Ug(n,e,i,t=!1){return{type:st.Hiring,hiring:{unitTypeId:n,growth:e,refillDaysInterval:7},unitGrowthGroup:i,growth:e,growthIntervalDays:7,upgrade:t}}var gC=Fe({id:"#build-stellar-town-center-1",name:"Town Center"}),yC=Fe({id:"#build-stellar-market",activity:{type:st.ResourceTrading},name:"Market"}),_C=Fe({id:"#build-stellar-high-tower",name:"High Tower"}),vC=Fe({id:"#build-stellar-tavern",name:"Tavern"}),CC=Fe({id:"#build-stellar-solar-gate",name:"Solar Gate",description:"Allows to hire units temporarily",activity:{type:st.Garrison},config:{init({localEvents:n,players:e}){n.on({Built(){e.getCurrentPlayer().garrisons.set("solar-gate",{name:"Solar Gate",groups:[{cost:{gold:130},count:8,type:Le("#unit-c00")},{cost:{gold:130},count:8,type:Le("#unit-c00")},{cost:{gold:180},count:8,type:Le("#unit-c20")}]})}})}}}),wC=Fe({id:"#build-stellar-spirit-towers",name:"Spirit Towers",description:"Allows to train Sprites.",activity:Ug("#unit-c00",10,"sprite")}),SC=Fe({id:"#build-stellar-moon-arch-1",name:"Moon Arch",activity:Ug("#unit-c20",8,"saggitar")}),bC=Fe({id:"#build-stellar-fate-halls",name:"Halls of Fate"}),xC={id:"#town-constellation",name:"Constellation",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:gC,cost:{gold:2e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:yC,cost:{gold:700}}],icon:"gavel",tier:1},"star-gate":{baseName:"Solar Gate",description:"Allows to temporarily summon units for reduced cost",icon:"heavy-fall",tier:1,levels:[{building:CC,cost:{gold:500,wood:1}}]},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:_C,cost:{gold:1500,gems:1}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:vC,cost:{gold:1250}}],icon:"hood",tier:2},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:bC,cost:{gold:1500}}],icon:"barrier",tier:2},"spirit-towers":{baseName:"Spirit Towers",description:"Trains Sprites",levels:[{building:wC,cost:{gold:450}}],icon:"spear-head",tier:1},"moon-arch":{baseName:"Moon Arch",description:"Trains Sagittars",levels:[{building:SC,cost:{gold:500,wood:1}}],icon:"arrow-cluster",tier:1}}};Pi.setTownBase(xC);var Wa=class{constructor(e){this.mapSize=T({},e.mapDimensions),this.structures=e.structures,this.startingLocId=e.startLocId}};var qe=function(n){return n.Neutral="neutral",n.EnemyPlayer="enemy",n}(qe||{}),ui=function(n){return n[n.Scripted=0]="Scripted",n}(ui||{}),gt=function(n){return n.SingleResource="resource",n.Resources="resources",n.Item="item",n.UnitsHire="hire",n.Mines="mines",n.UnitsUpgrade="upgrading",n.Scripted="scripted",n.NoReward="no-reward",n}(gt||{});function Qe(n){return wi(n),n}function gc({id:n,name:e,guard:i,unitsForHire:t}){return{id:n,name:e,actionPoints:1,control:qe.Neutral,generateGuard:()=>i,generateReward:()=>({type:gt.UnitsHire,units:t})}}function wn(n,e){return e.map(i=>J(T({},i),{id:`${n}.${i.id}`,pathTo:i.pathTo?i.toOuterBranch?i.pathTo:`${n}.${i.pathTo}`:void 0}))}var Ir=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.name="",this.x=0,this.y=0,this.parentStructs=new Set,this.icon="",this.isInactive=!1,this.isCompleted=!1,this.actionPoints=0}create({iconName:t,x:o,y:r,isRoot:s,generator:d,guardingPlayer:h,pathTo:_,actionPoints:C,structParams:O}){this.x=o,this.y=r,this.icon=t,this.isRoot=s,this.generator=d,this.structParams=O,d&&(this.name=d.description?.({thisStruct:this}).name??d.name),this.actionPoints=C||d?.actionPoints||0,this.guardingPlayer=h,this.pathTo=_}setControls(t){this.controls?this.controls=T(T({},this.controls),t):this.controls=t}getStructParams(){return this.structParams}};e.categoryId="structure";let n=e;return n})();var Vg=gc({id:"#struct-archers-outpost",name:"Archers Outpost",guard:{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-h10",8,11,3]]},unitsForHire:[{unitTypeId:"#unit-h10",maxCount:12}]});var re=function(n){return n.Weapon="Weapon",n.Headgear="Headgear",n.Amulet="Amulet",n.Armor="Armor",n.Boots="Boots",n.Shield="Shield",n}(re||{}),Hg=(()=>{let e=class e extends oi{create(t){this.baseType=t.itemBase,this.state=t.state}};e.categoryId="item";let n=e;return n})();function be({id:n,name:e,icon:i,slot:t,stats:o,enemyStats:r,abilityDescription:s,cost:d,sellingCost:h,spells:_,description:C,config:O}){let R={id:n,name:e,icon:{icon:i},staticMods:o,slotType:t,cost:d,sellingCost:h??{gold:100},bonusAbilities:_,staticEnemyMods:r,description:C??function({thisItemBase:Q}){return{descriptions:[pt(Q),...s?[B(s)]:[]]}},config:O??{init(){}}};return wi(R),R}var jg=18,$g=be({id:"#item-blacklich-sword",name:"Black Lich Sword",icon:"bat-sword",slot:re.Weapon,stats:{heroBonusAttack:3,specialtyNecromancy:1,heroManacostPenalty:1,__unitConditionalMods(n){return n.type.level<=4&&!n.modGroup.getModValue("isRanged")?{lifesteal:jg}:null}},cost:{gold:1e3,gems:1},description({thisItemBase:n}){return{descriptions:[pt(n),B(`Grants ${jg}% Lifesteal to non-ranged units up to level 4.`)]}}});var TL=be({id:"#item-doomstring",name:"Doomstring",slot:re.Weapon,icon:"crossbow",stats:{heroBonusAttack:8,specialtyOffence:3,specialtyArchery:2,specialtyFireMastery:1},cost:{gold:5e3,redCrystals:2,gems:1},description:({thisItemBase:n})=>({descriptions:[pt(n),B("An ancient ballista made in infernal abyss."),B("Grants ability: Doom. Doomed target looses 50% of armor and receives 50% increased physical damage.")]})});var zg=be({id:"#item-eclipse-wand",name:"Eclipse Wand",slot:re.Weapon,stats:{specialtyMagic:1,specialtyMagicRecovery:1,heroMaxMana:5},icon:"crystal-wand",cost:{gold:550},sellingCost:{gold:300},description({thisItemBase:n}){return{descriptions:[pt(n),B("At the beginning of the battle, applies level 1 Enchant to all enemy groups.")]}},config:{init:({actions:n,events:e,ownerPlayer:i})=>{e.on({NewRoundBegins(t){if(t.round===0){let o=n.getEnemyOfPlayer(i);n.getUnitGroupsOfPlayer(o).forEach(s=>{let d=n.createSpellInstance(iu,{initialLevel:1});n.addSpellToUnitGroup(s,d,i)})}}})}}});var NL=be({id:"#item-famine",name:"Famine",slot:re.Weapon,icon:"scythe",stats:{specialtyNecromancy:2,heroBonusAttack:6,heroManacostPenalty:4},enemyStats:{heroBonusDefence:-5,heroBonusAttack:-5,unitGroupSpeedBonus:-6},cost:{gold:6e3,redCrystals:3},description({thisItemBase:n}){return{descriptions:[pt(n),B("Decreases enemy attack and defence by 5, slows down all enemy units by 6")]}}});var jL=be({id:"#item-flaming-sword",name:"Flaming Sword",icon:"sword",slot:re.Weapon,stats:{heroBonusAttack:3,heroMaxMana:6,specialtyFireMastery:3},cost:{gold:1500},sellingCost:{gold:800}});var qL=be({id:"#item-garuda-wind-crown",name:"Garuda's Wind Crown",slot:re.Headgear,stats:{heroBonusAttack:3,heroBonusDefence:6,resistAll:10,unitGroupSpeedBonus:3,specialtyArchery:2,cannotBeSlowed:!0},icon:"feather-wing",cost:{gold:5e3,redCrystals:2,gems:2},sellingCost:{gold:2e3,redCrystals:1,gems:1}});var XL=be({id:"#item-grain-husk",name:"Grain Husk",slot:re.Weapon,icon:"scythe",stats:{heroBonusAttack:2,heroManacostPenalty:3},enemyStats:{heroBonusDefence:-3,heroBonusAttack:-3,unitGroupSpeedBonus:-2},cost:{gold:1700,gems:5},sellingCost:{gold:650}});var hu=jt({prefix:"Items",events:{NewRoundBegins:dt("")}}),fu=hu.events;var yc=class yc{constructor(){this.inventoryItemsMap=new Map,this.equipedItemsSet=new Set}static getSlotTypes(){return this.slotTypes}static getExtendedSlotTypes(){return[...this.extendedSlotsMap.values()]}static getSlotExtendedInfo(e){return this.extendedSlotsMap.get(e)}static filterItemsForSlot(e,i){return i.filter(t=>t.baseType.slotType===e)}equipItem(e){let i=e.baseType.slotType,t=this.inventoryItemsMap.get(i);this.inventoryItemsMap.set(i,e),t&&this.equipedItemsSet.delete(t),this.equipedItemsSet.add(e)}unequipItem(e){this.inventoryItemsMap.delete(this.getItemSlotType(e)),this.equipedItemsSet.delete(e)}unequipSlot(e){let i=this.inventoryItemsMap.get(e);i&&(this.inventoryItemsMap.delete(e),this.equipedItemsSet.delete(i))}getItemInSlot(e){return this.inventoryItemsMap.get(e)||null}isSlotEquipped(e){return this.inventoryItemsMap.has(e)}isItemEquipped(e){return this.equipedItemsSet.has(e)}getEquippedItems(){return[...this.equipedItemsSet]}getItemSlotType(e){return e.baseType.slotType}};yc.slotTypes=[re.Headgear,re.Amulet,re.Weapon,re.Armor,re.Shield,re.Boots],yc.extendedSlotsMap=new Map([[re.Headgear,{slotType:re.Headgear,name:"Headgear",icon:"knight-helmet"}],[re.Amulet,{slotType:re.Amulet,name:"Amulet",icon:"gem-pendant"}],[re.Weapon,{slotType:re.Weapon,name:"Weapon",icon:"sword"}],[re.Armor,{slotType:re.Armor,name:"Armor",icon:"vest"}],[re.Shield,{slotType:re.Shield,name:"Shield",icon:"shield"}],[re.Boots,{slotType:re.Boots,name:"Boots",icon:"boot-stomp"}]]);var Vi=yc;var Wg=be({id:"#item-ice-bow",name:"Ice Bow",slot:re.Weapon,icon:"frozen-arrow",stats:{heroBonusAttack:1,specialtyArchery:1},cost:{gold:500},sellingCost:{gold:400},description({thisItemBase:n}){return{descriptions:[pt(n),B("Bow which radiates cold, grants level 1 Frost Arrow")]}},spells:[{level:1,spell:fg}]});var hN=be({id:"#item-iron-pike",name:"Iron Pike",icon:"spear-head",slot:re.Weapon,cost:{gold:420},sellingCost:{gold:250},stats:{specialtyCombatTactics:1,heroBonusAttack:1}});var qg=be({id:"#item-irton-plate",name:"Irton Plate",slot:re.Armor,icon:"vest",cost:{gold:300},sellingCost:{gold:175},stats:{heroBonusDefence:3}});var wN=be({id:"#item-kite-shield",name:"Kite Shield",icon:"shield",slot:re.Shield,cost:{gold:450},sellingCost:{gold:400},stats:{__attackConditionalModifiers(){return{damageBlockMax:14,damageBlockMin:10,chanceToBlock:1}},heroBonusDefence:1},abilityDescription:"100% chance to block 10-14 damage"});var Yg=50,DN=be({id:"#item-lifeform",name:"Lifeform",slot:re.Armor,icon:"vest",stats:{heroBonusDefence:7,resistFire:25,resistPoison:20,resistLightning:15,resistCold:15},description({thisItemBase:n}){return{descriptions:[pt(n),B(`An incredible artifact that shimmers with bright colors and emits life aura. Heals all units by ${Yg} in the beginning of each round.`)]}},config:{init({events:n,actions:e,ownerPlayer:i}){n.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(i).forEach(o=>{e.healUnit(o,Yg)})}})}}});var gu=2,Kg=gu+3,Zg=be({id:"#item-light-boots",name:"Light Boots",icon:"boot-stomp",slot:re.Boots,cost:{gold:425},sellingCost:{gold:200},stats:{heroBonusDefence:1,__unitConditionalMods(n){return n.type.level===1?n.type.upgraded?{unitGroupSpeedBonus:Kg}:{unitGroupSpeedBonus:gu}:null}},abilityDescription:`Increases speed of tier 1 units by ${gu} (${Kg} if unit is upgraded).`});var ON=be({id:"#item-magic-cape",name:"Magic Cape",slot:re.Armor,icon:"hood",stats:{specialtyMagicRecovery:1,heroBonusDefence:2,heroMaxMana:2},cost:{gold:300,wood:1},sellingCost:{gold:100}});var Xg=be({id:"#item-meteor-sword",name:"Meteor Swords",slot:re.Weapon,icon:"dervish-swords",stats:{heroBonusAttack:2,specialtyFireMastery:1},cost:{gold:1100},sellingCost:{gold:450},spells:[{spell:Cg,level:1}],description({thisItemBase:n}){return{descriptions:[pt(n),B("Two large black swords with an astronomical map depicted in gold on the blade. Grants Level 1 Meteor ability.")]}}});var Qg=be({id:"#item-phoenix-shield",name:"Phoenix Shield",icon:"fire-shield",slot:re.Shield,cost:{gold:750,gems:1},sellingCost:{gold:400},stats:{heroBonusDefence:2,heroBonusAttack:1,resistFire:17},enemyStats:{resistFire:-12},abilityDescription:"Reduces enemy Fire Resistance by 12%"});var Jg=50,WN=be({id:"#item-rising-sun",name:"Rising Sun",icon:"gem-pendant",slot:re.Amulet,stats:{heroBonusDefence:2},description({thisItemBase:n}){return{descriptions:[pt(n),B(`Each round heals your units by ${Jg}`)]}},config:{init({events:n,actions:e,ownerPlayer:i}){n.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(i).forEach(o=>{e.healUnit(o,Jg)})}})}}});var XN=be({id:"#item-storm-pike",name:"Storm Pike",icon:"spear-head",slot:re.Weapon,cost:{gold:600,gems:1},abilityDescription:"Grants ability Charged Strike that supplements unit attacks with lightning damage with additional effectiveness for any cavalry.",sellingCost:{gold:340},stats:{heroBonusAttack:3},spells:[{level:1,spell:ig}]});var iU=be({id:"#item-battlemage-sword",name:"Sword of the Battle Mage",slot:re.Weapon,icon:"sword",stats:{heroBonusAttack:3,heroMaxMana:8,specialtyMagicRecovery:2,specialtyFireMastery:1,specialtyColdMastery:1,specialtyLightningMastery:1},cost:{gold:1e3,gems:2},sellingCost:{gold:600},description({thisItem:n,thisItemBase:e}){return{descriptions:[pt(e)]}}});var e0=be({id:"#item-wind-crest",name:"Wind Crest",slot:re.Headgear,stats:{heroBonusDefence:1},icon:"feather-wing",cost:{gold:500},sellingCost:{gold:250},description({thisItem:n,thisItemBase:e}){return{descriptions:[pt(e),B("At the beginning of the fight, grants Wind Blessing (level 1) effect to your ranged units for 1 round.")]}},config:{init:({actions:n,events:e,ownerPlayer:i})=>{e.on({NewRoundBegins(t){t.round===0&&n.getUnitGroupsOfPlayer(i).filter(o=>o.type.defaultModifiers?.isRanged).forEach(o=>{let r=n.createSpellInstance(Rg);n.addSpellToUnitGroup(o,r,i)})}})}}});var uU=be({id:"#item-wishmaster",name:"Wishmaster",slot:re.Headgear,stats:{heroBonusAttack:5,heroBonusDefence:4,resistAll:13},cost:{gems:20,gold:2e3,redCrystals:2},icon:"feather-wing",description({thisItem:n,thisItemBase:e}){return{descriptions:[pt(e),B("An artefact of incredible strength.")]}}});var ao=Qe({id:"#struct-bandit-camp",name:"Bandit Camp",actionPoints:1,control:qe.Neutral,generateGuard:()=>{let n={maxUnitGroups:2,minUnitGroups:1,units:[["#unit-neut-thief-0",14,24,1],["#unit-neut-gnoll-0",14,24,3]]},e={maxUnitGroups:2,minUnitGroups:2,units:[["#unit-neut-wind-spirit-0",5,8,2]]},i={maxUnitGroups:1,minUnitGroups:1,units:[["#unit-h40",3,4,1]]};return kn(In.TECHBanditCampVariety)?z.randItem([e,n,i]):n},generateReward:()=>z.randBoolean()?{type:gt.Resources,resourceGroups:[[{type:Oe.Gold,count:450},{type:Oe.Gems,count:1}],[{type:Oe.Gold,count:800},{type:Oe.Wood,count:2}]]}:{type:gt.Item,itemGroups:[[z.randBoolean()?e0:Zg],[zg],[Xg],[Wg]]}});var t0=Qe({id:"#struct-big-camp",name:"Big Camp",actionPoints:1,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-forest-troll-0",23,25,1],["#unit-neut-gnoll-0",28,36,1],["#unit-neut-thief-0",15,18,1]]}},control:qe.Neutral,generateReward:()=>({type:gt.Scripted,description:`Big camp is defeated! 

 +450 Experience`,onAccept({playersApi:n}){let e=n.getCurrentPlayer();n.addExperienceToPlayer(e,450)}})});var i0=gc({id:"#struct-cavalry-stalls",name:"Cavalry Stalls",guard:{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h30",3,3,2]]},unitsForHire:[{unitTypeId:"#unit-h30",maxCount:4}]});var n0=Qe({id:"#struct-graveyard",name:"Graveyard",actionPoints:1,control:qe.Neutral,generateGuard:()=>({maxUnitGroups:2,minUnitGroups:3,units:[["#unit-neut-ghost-0",14,18,3]]}),generateReward:()=>({type:gt.UnitsHire,units:[{unitTypeId:"#unit-neut-ghost-0",maxCount:24}]})}),o0=Qe({id:"#struct-undead-beacon",name:"Beacon of the Undead",control:qe.Neutral,description:()=>({descriptions:["Allows to upgrade your ghost units below level 4."]}),generateReward:()=>({type:gt.UnitsUpgrade,getUnits:n=>n.getCurrentPlayerUnitGroups().filter(e=>{let i=e.type;return!i.upgraded&&i.level<=4&&i.defaultModifiers?.isGhost})})});var r0=Qe({id:"#struct-magic-river",control:qe.Neutral,actionPoints:1,name:"Magic River",description:({visitingPlayer:n})=>({descriptions:[`Walking near magic river, you feel your magical powers restored.

+4 to mana and +2 to max mana.`,`+1 Mana per each point of Restoration (${n?.hero.modGroup.getModValue("specialtyMagicRecovery")??0}).`]}),type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i}){n.on({StructVisited({visitingPlayer:t}){e.addMaxManaToPlayer(t,2);let o=t.hero.modGroup.getModValue("specialtyMagicRecovery")??0;console.log(o),e.addManaToPlayer(t,4+o),i.visited=!0}})}}});var s0=Qe({id:"#struct-mountain-nest",control:qe.Neutral,actionPoints:2,name:"Mountain Nest",description:({thisStruct:n})=>{let e=[B(`Walking through mountains, you find a very bright birdnest... 

1-2 Firebirds join your army.`)];return n.controls?.accept===!1&&e.push(B("You have no free slots.")),{descriptions:e}},type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i}){n.on({StructVisited({visitingPlayer:t}){e.addUnitGroupToPlayer(t,"#unit-h40",z.randIntInRange(1,2)),i.visited=!0},StructInspected(){i.setControls({accept:e.getCurrentPlayer().hero.hasFreeUnitSlots()})}})}}});var a0=Qe({id:"#struct-witch-hut",control:qe.Neutral,actionPoints:1,name:"Witch Hut",description:()=>({descriptions:[`Walking trough the woods, you find an abandoned Witch Hut.

Learn "Enchant" level 2`]}),type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i,spells:t}){n.on({StructVisited({visitingPlayer:o}){let r=t.createSpellInstance(sg,{initialLevel:2});e.addSpellToPlayerHero(o,r),i.visited=!0}})}}});var l0=Qe({id:"#struct-thief-lair",name:"Thieves' Lair",actionPoints:2,control:qe.Neutral,generateGuard:()=>({maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-thief-0",12,14,2],["#unit-neut-gnoll-0",14,24,3]]}),generateReward:()=>({type:gt.Item,itemGroups:[[qg],[$g],[Qg]]})});var c0=Qe({id:"#struct-rocky-passage",name:"Rocky Passage",actionPoints:2,description:()=>({descriptions:["A rocky passage held by a powerful dragon."]}),disableWeeklyGuardRise:!0,generateGuard(){return{minUnitGroups:1,maxUnitGroups:1,units:[["#unit-neut-boss-devastator",1,1,1]]}},control:qe.Neutral,generateReward:()=>({type:gt.NoReward})});var d0=Qe({id:"#struct-dark-arts-school",control:qe.Neutral,actionPoints:2,name:"School of Dark Arts",description:()=>({descriptions:[`You are visiting the school of dark arts.

+1 to Necromancy specialty`]}),type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i}){n.on({StructVisited({visitingPlayer:t}){t.hero.addStatsMods({specialtyNecromancy:1}),i.visited=!0}})}}});var p0=Qe({id:"#struct-fire-ring",name:"Fire Ring",actionPoints:2,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-fire-spirit-0",6,7,3]]}},control:qe.Neutral,generateReward:()=>({type:gt.NoReward})}),_c=Qe({id:"#struct-guard-lock",name:"Fire Ring",actionPoints:2,description:({thisStruct:n})=>{let{name:e}=n.getStructParams();return{name:e,descriptions:[]}},generateGuard({thisStruct:n}){let{guards:e}=n.getStructParams();return e},control:qe.Neutral,generateReward:()=>({type:gt.NoReward})});var u0=Qe({id:"#struct-mausoleum",name:"Mausoleum",actionPoints:1,control:qe.Neutral,generateGuard:()=>({minUnitGroups:3,maxUnitGroups:3,units:[["#unit-neut-skeleton-0",22,34,2],["#unit-neut-lich-0",3,4,1]]})});var yu=Qe({id:"#struct-daily-res-mine",name:"Mine with Resources",control:qe.Neutral,description:({thisStruct:n})=>({descriptions:[`You found a mine with resources, each day it will bring you:

`+Wh(n.structParams)]}),type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i,eventFeed:t}){n.on({StructVisited(){i.visited=!0,e.giveResourcesToPlayer(e.getCurrentPlayer(),i.structParams),n.on({NewDayBegins(){e.giveResourcesToPlayer(e.getCurrentPlayer(),i.structParams)}})}})}}});var kr=Qe({id:"#struct-res-pile",name:"Pile of Resources",control:qe.Neutral,description:({thisStruct:n})=>{let e=n.structParams,i=Ul(e),t=i.length>1,o=i[0].resName;return{name:t?"Pile of Resources":`Pile of ${o}`,descriptions:[{type:tt.FreeHtml,htmlContent:`You found a pile of ${t?"resourecs":o}`},{type:tt.Resources,resources:i.map(r=>({resType:r.type,count:r.count}))}]}},type:ui.Scripted,config:{init({localEvents:n,players:e,thisStruct:i}){n.on({StructVisited({visitingPlayer:t}){i.visited=!0,e.giveResourcesToPlayer(t,i.structParams)}})}}});var _u=(n,e)=>({x:n+1700,y:e+1500}),m0=wn("const-start",[J(T({id:"start"},_u(0,0)),{icon:"campfire"}),J(T({id:"1",pathTo:"start"},_u(90,-60)),{icon:"gold-bar",actionPoints:2,struct:kr,structParams:{gold:650}}),J(T({id:"2",pathTo:"start"},_u(10,-70)),{icon:"sword",struct:ao})]);var DC=476,Sn="start";function he(n){return n+DC}var PC=wn("start-bottom-right",[{id:"entry",x:he(60),y:he(30),icon:"tombstone",pathTo:Sn,toOuterBranch:!0,struct:n0,tags:[""]},{id:"1",x:he(120),y:he(40),icon:"sword",pathTo:"entry",struct:ao},{id:"1-1",x:he(140),y:he(-10),icon:"hand-saw",pathTo:"1",actionPoints:1,struct:kr,structParams:{wood:4}},{id:"witch",x:he(180),y:he(60),icon:"book",pathTo:"1",struct:a0},{id:"5",x:he(120),y:he(90),icon:"sword",pathTo:"1",struct:ao},{id:"pre-boss",x:he(40),y:he(80),icon:"sword",pathTo:"5",struct:ao},{id:"7",x:he(170),y:he(141),icon:"horseshoe",pathTo:"5",struct:i0},{id:"7-1",pathTo:"7",x:he(165),y:he(201),icon:"scroll-unfurled",struct:d0},{id:"7-2",actionPoints:2,x:he(240),y:he(148),icon:"hand-saw",pathTo:"7",struct:yu,structParams:{wood:1}},{id:"boss",x:he(45),y:he(145),icon:"monster-skull",pathTo:"pre-boss",actionPoints:2,struct:t0}]),EC=wn("five",[{id:"1",pathTo:Sn,toOuterBranch:!0,x:he(-30),y:he(70),icon:"gold-bar",actionPoints:1,struct:kr,structParams:{gold:650}}]),TC=wn("start-bottom-left",[{id:"entry",x:he(-70),y:he(10),icon:"sword",pathTo:Sn,toOuterBranch:!0,struct:ao},{id:"1",x:he(-120),y:he(-100),icon:"mountains",pathTo:"entry",struct:s0},{id:"2",x:he(-130),y:he(55),icon:"sword",pathTo:"entry",struct:ao},{id:"3",x:he(-120),y:he(-10),icon:"campfire",pathTo:"2",struct:l0},{id:"4",actionPoints:4,x:he(-180),y:he(-80),icon:"crystals",pathTo:"3",struct:yu,structParams:{redCrystals:1}},{id:"pre-boss",x:he(-190),y:he(20),icon:"fire-ring",pathTo:"2",struct:p0,actionPoints:2},{id:"boss",x:he(-250),y:he(-50),icon:"monster-skull",pathTo:"pre-boss",struct:c0,actionPoints:2},{id:"post-boss",pathTo:"boss",icon:"capitol",x:he(-300),y:he(-80),actionPoints:2,struct:u0},{id:"wagon",x:he(-190),y:he(90),icon:"mine-wagon",pathTo:"2",struct:kr,structParams:{gold:450,redCrystals:1,gems:1}}]),IC=wn("start-top-left",[{id:"entry",x:he(-60),y:he(-60),icon:"sword",pathTo:Sn,toOuterBranch:!0,struct:ao},{id:"river",x:he(-40),y:he(-120),icon:"incense",pathTo:"entry",struct:r0,actionPoints:1},{id:"1",x:he(50),y:he(-110),icon:"tower",pathTo:"entry",struct:Vg,actionPoints:1},{id:"gems",x:he(70),y:he(-170),icon:"emerald",pathTo:"1",struct:kr,structParams:{gems:3}}]),kC=wn("post-boss-1",[{id:"entry",x:194,y:338,actionPoints:1,icon:"sword",pathTo:"start-bottom-left.post-boss",toOuterBranch:!0,struct:_c,structParams:{name:"Swamp",guards:{units:[["#unit-neut-poison-ivy-0",20,20,3]],maxUnitGroups:3,minUnitGroups:3}}}]),AC=wn("start-top-right",[{id:"beacon",x:he(35),y:he(-50),icon:"lighthouse",pathTo:Sn,toOuterBranch:!0,struct:o0}]),h0=[{id:Sn,x:he(0),y:he(0),icon:"campfire"},...EC,...PC,...TC,...IC,...AC,...m0,...kC];var lo={registryMap:new Map,register(n,e){this.registryMap.has(n)?this.registryMap.get(n).push(e):this.registryMap.set(n,[e])}};window.triggers=lo;lo.register(no.PrepareGameEvent,{fn:(n,{events:e})=>{if(n.gameMode!==Mr.Normal)return;let i=Sn;n.selectedFaction,Pi,console.log("Structures are prepared.");let t=new Wa({mapDimensions:{heightInCells:27,widthInCells:34,cellSize:86},structures:h0,startLocId:i});e.dispatch(no.GamePreparationFinished({map:t}))}});lo.register(no.PrepareGameEvent,{fn:(n,{events:e})=>{if(n.gameMode!==Mr.SandboxScenario)return;let i=Sn;n.selectedFaction,Pi,console.log("Structures are prepared.");let t=[{id:Sn,x:0,y:0,icon:"campfire"},...wn("enemy",[{id:"1",pathTo:Sn,toOuterBranch:!0,x:100,y:100,icon:"gold-bar",actionPoints:1,struct:_c,structParams:{name:"Swamp",guards:{units:[["#unit-neut-poison-ivy-0",20,20,3]],maxUnitGroups:3,minUnitGroups:3}}}])],o=new Wa({mapDimensions:{heightInCells:27,widthInCells:34,cellSize:86},structures:t,startLocId:i});e.dispatch(no.GamePreparationFinished({map:o}))}});lo.register(On,{fn:(n,e)=>{let i=[{card:rc,count:1/0},{card:so,count:1},{card:Va,count:1}],t=e.players.getCurrentPlayer();e.events.dispatch(xi({player:t,actionCardStacks:i}))}});lo.register(io,{fn:(n,e)=>{e.actions.getMapStructures().filter(t=>!t.visited&&t.guard?.length&&!t.generator?.disableWeeklyGuardRise).forEach(t=>{t.guard?.forEach(o=>o.addUnitsCount(Math.round(o.count*.4)))}),e.events.dispatch(_n({message:"Guards in locations raised by 40%"}))}});lo.register(Ma,{fn:(n,{events:e,players:i})=>{e.dispatch(Ta({title:`You reached level ${n.newLevel}`,subTitle:"Choose your reward",rewards:[...n.hero.spells.filter(t=>n.hero.base.initialState.abilities.includes(t.baseType.id)).map(t=>({display:{icon:t.baseType.icon.icon,title:`Level ${t.currentLevel+1} ${t.name}`},onSumbit:()=>{t&&t.levelUp()}})),{display:{icon:"crystal-ball",title:"+4 to Max/Current Mana"},onSumbit:()=>{let t=i.getCurrentPlayer(),o=4;i.addMaxManaToPlayer(t,o),i.addManaToPlayer(t,o)}}]}))}});var ri=([[n,e],i,t,o,r,s])=>({damageInfo:{minDamage:n,maxDamage:e},attackRating:i,defence:t,health:o,speed:r,mana:s||0});function Hi(n){return Le(n)}var vu={createRandomArmy(n){let e=z.randIntInRange(n.minUnitGroups,n.maxUnitGroups),i=[],t=[...n.units],o=t.reduce((r,s)=>{let[d,h,_,C=1/0]=s;return r.set(s,{unitType:d,min:h,max:_,maxGroupsOfThisType:C,createdTimes:0}),r},new Map);console.log("options ->>",n),console.log("Units Map ->>",o);for(let r=0;r<e;r++){let s=z.randItem(t),d=o.get(s),h=d.unitType,C={count:z.randIntInRange(d.min,d.max),unitType:h};i.push(C),d.createdTimes++,d.createdTimes>=d.maxGroupsOfThisType&&(console.log("this unit was generated max times"),o.delete(s),z.removeItem(t,s))}return console.log("generated groups",i),i}},at=n=>()=>({descriptions:n.map(e=>typeof e=="string"?{type:tt.FreeHtml,htmlContent:e}:e)});var f0={experience:0,gold:0};rt.defineUnitType({id:"#unit-h00",name:"Pikemen",level:1,mainPortraitUrl:ue.Pikemen,baseRequirements:{gold:55},getDescription:at([U("Tier 1 Castle unit. Can be upgraded into Halberdier."),U("<br>While possessing good average stats, Pikemen also strikes back at any attacker."),U("<br>Receives bonuses from Combat Tactics speciality.")]),defaultSpells:["#spell-universal-pin"],defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.7,isPinner:!0},baseStats:{damageInfo:{minDamage:2,maxDamage:3},attackRating:2,defence:2,health:8,speed:13},upgradeDetails:{target:"#unit-h01",upgradeCost:{gold:15}},neutralReward:f0});rt.defineUnitType({id:"#unit-h01",mainPortraitUrl:ue.Pikemen,name:"Halberdier",level:1,baseStats:ri([[3,3],2,3,8,14]),getDescription:at([U("Tier 1 Castle unit. Upgraded version of Pikemen."),U("<br>More durable and strong version of Pikemen, also retains ability to counterattack any attacker."),U("<br>Receives bonuses from Combat Tactics speciality.")]),defaultSpells:["#spell-universal-pin"],defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.85,isPinner:!0,__auraModifiers({remoteness:n,target:e,thisUnit:i}){if(n===1){let t=i.count*.8;return{chanceToBlock:1,damageBlockMin:t,damageBlockMax:t}}return null}},baseRequirements:{gold:70,redCrystals:0},upgraded:!0,neutralReward:f0});rt.defineUnitType({id:"#unit-h10",mainPortraitUrl:ue.Archer,name:"Archers",level:2,getDescription:at([U("Tier 2 Castle ranged unit. Can be upgraded into Crossbowmen."),U("<br>Archers are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),U("<br>In return to their advantages, they are also costly and relatively fragile."),U("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:1,defence:2,health:9,speed:21},upgradeDetails:{target:"#unit-h11",upgradeCost:{gold:25}},getUnitTypeSpecialtyModifiers(n){return n.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.15}:n.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.25}:{}},defaultModifiers:{isRanged:!0},minQuantityPerStack:12,defaultTurnsPerRound:2,baseRequirements:{gold:95},neutralReward:{experience:3,gold:5}});rt.defineUnitType({id:"#unit-h11",mainPortraitUrl:ue.Archer,name:"Crossbowmen",level:2,getDescription:at([U("Tier 2 Castle ranged unit. Upgraded version of Archers."),U("<br>Crossbowmen are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),U("<br>Crossbowmen have higher base stats and less fragile than Archers, but also have 35% block-piercing attack."),U("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:4,defence:3,health:14,speed:21},defaultTurnsPerRound:2,getUnitTypeSpecialtyModifiers(n){return n.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.2}:n.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.3}:{}},defaultModifiers:{isRanged:!0,blockPiercingPercent:.35},upgraded:!0,baseRequirements:{gold:120},neutralReward:{experience:4.5,gold:7}});rt.defineUnitType({id:"#unit-h20",mainPortraitUrl:ue.UnitMelee,name:"Knights",level:3,getDescription:at([U("Tier 3 Castle unit."),U("<br>Knights are possessing high armor and attack. "),U("<br>Chance-based ability to block damage along with +12% to Fire, Cold and Lightning resistances makes them durable fighters.")]),baseStats:ri([[6,9],6,5,17,11]),baseRequirements:{gold:120},defaultSpells:["#spell-knight-block"],defaultModifiers:{resistFire:12,resistCold:12,resistLightning:12},neutralReward:{experience:10,gold:7}});rt.defineUnitType({id:"#unit-h30",name:"Cavalry",mainPortraitUrl:ue.UnitMelee,getDescription:at([U("Tier 4 Castle cavalry unit, can be upgraded into Heavy Cavalry."),U("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:225,wood:1},neutralReward:{experience:20,gold:25},upgradeDetails:{target:"#unit-h31",upgradeCost:{gold:85}}});rt.defineUnitType({id:"#unit-h31",name:"Heavy Cavalry",mainPortraitUrl:ue.UnitMelee,getDescription:at([U("Tier 4 Castle cavalry unit, upgraded version of Cavalry."),U("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:310,wood:1},neutralReward:{experience:25,gold:35},upgraded:!0});rt.defineUnitType({id:"#unit-h40",name:"Mystic Birds",mainPortraitUrl:ue.FireBird,level:5,getDescription:at([U("Tier 5 Castle magical creatures of fire. Can be upgraded to Firebirds."),U("<br>Majestic and powerful creatures of fire that can heal and resurrect allied units. Resistant against fire (10%)."),U("<br>Has base manapool of 5."),U("<br>Deal 20% more damage against magical creatures.")]),baseStats:ri([[18,26],8,10,46,16,5]),defaultSpells:["#spell-revitalize"],defaultModifiers:{resistFire:10,isMagical:!0,__attackConditionalModifiers({attacked:n}){return n.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.2}:{}}},baseRequirements:{gold:350,wood:1},upgradeDetails:{target:"#unit-h41",upgradeCost:{gold:125}},neutralReward:{experience:40,gold:60}});rt.defineUnitType({id:"#unit-h41",name:"Firebirds",mainPortraitUrl:ue.FireBird,level:5,getDescription:at([U("Tier 5 Castle magical creatures of fire, an upgraded version of Mystic Birds."),U("<br>Majestic and powerful creatures of fire that can heal and resurrect allied units, has better stats than Mystical Birds and +17% fire resistance."),U("<br>Has base manapool of 8."),U("<br>Deal 30% more damage against magical creatures.")]),baseStats:ri([[23,29],12,14,57,17,8]),defaultModifiers:{resistFire:17,isMagical:!0,__attackConditionalModifiers({attacked:n}){return n.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.3}:{}}},defaultSpells:["#spell-revitalize"],baseRequirements:{gold:475,wood:1},neutralReward:{experience:45,gold:60}});var vc={experience:0,gold:0};bi.defineUnitType({id:"#unit-f00",mainPortraitUrl:ue.UnitMelee,name:"Raiders",level:1,baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,speed:16,defence:2,health:9},getDescription:at([U("Tier 1 Fort unit. Can be upgraded into Clan."),U("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1,isPinner:!0,pinningIncomingDamagePercent:1.5},defaultSpells:["#spell-universal-pin"],baseRequirements:{gold:35,redCrystals:0},upgradeDetails:{target:"#unit-f01",upgradeCost:{gold:20}},neutralReward:vc});bi.defineUnitType({id:"#unit-f01",mainPortraitUrl:ue.UnitMelee,name:"Clan",level:1,baseStats:{damageInfo:{minDamage:2,maxDamage:2},attackRating:3,speed:17,defence:3,health:9},getDescription:at([U("Tier 1 Fort unit, upgraded version of Raiders."),U("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1,isPinner:!0,pinningIncomingDamagePercent:1.5},defaultSpells:["#spell-universal-pin"],baseRequirements:{gold:55,redCrystals:0},upgraded:!0,neutralReward:vc});bi.defineUnitType({id:"#unit-f10",mainPortraitUrl:ue.UnitRanged,name:"Goblin Archers",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:3,health:14},getDescription:at([U("Tier 2 ranged unit of the Fort. Can be upgraded into Goblin Shooters."),U("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows. Attacks twice per turn.")]),defaultTurnsPerRound:2,defaultModifiers:{isRanged:!0},defaultSpells:["#spell-unit-poison-arrows"],baseRequirements:{gold:60,redCrystals:0},upgradeDetails:{target:"#unit-f11",upgradeCost:{gold:20}},neutralReward:vc});bi.defineUnitType({id:"#unit-f11",mainPortraitUrl:ue.UnitRanged,name:"Goblin Shooters",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:4,health:18},getDescription:at([U("Tier 2 ranged unit of the Fort. Upgraded version of Goblin Archers."),U("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows."),U("<br>As an improved version of Goblin Archers they are equipped with primitive but fast-reloading crossbows, allowing them to attack 3 times per round.")]),defaultModifiers:{isRanged:!0},defaultTurnsPerRound:3,defaultSpells:["#spell-unit-poison-arrows"],baseRequirements:{gold:60,redCrystals:0},upgraded:!0,neutralReward:vc});var g0=Z({id:"#spell-unit-poison-arrows-debuff",name:"Poisoned",icon:{icon:"chemical-arrow",bgClr:"green"},activationType:L.Passive,getDescription:({ownerUnit:n})=>({descriptions:[B("This group is poisoned, receiving poison damage.")]}),config:{init({events:n,actions:e,vfx:i,spellInstance:t}){n.on({SpellPlacedOnUnitGroup({target:o}){i.createDroppingMessageForUnitGroup(o.id,{html:Ui("Poisoned!")}),e.dealDamageTo(o,t.state?.poisonDamage||0,Be.Poison)}})}}}),HH=Z({id:"#spell-unit-poison-arrows",name:"Poison Arrows",icon:{icon:"chemical-arrow"},activationType:L.Passive,getDescription:({ownerUnit:n})=>({descriptions:[B(`Poisons enemy on attack, dealing ${n.count*2} poison damage (2 damage per unit).`)]}),config:{init({events:n,actions:e,vfx:i,ownerUnit:t,ownerPlayer:o}){n.on({UnitGroupAttacks({attacker:r,attacked:s}){if(r!==t)return;let d=e.createSpellInstance(g0);d.state={poisonDamage:r.count*2},!s.spells.some(h=>h.baseType===g0)&&e.addSpellToUnitGroup(s,d,o)}})}}});var OC=ro("#vfx-essence-leak","implosion","rgb(223 165 255)"),FC=Z({id:"#spell-essence-leak-debuff",activationType:L.Debuff,icon:{icon:"implosion"},getDescription:()=>({descriptions:[B("Attacker will heal himself.")]}),name:"Life loss",config:{getManaCost:()=>0,init(){},targetCastConfig:{}}}),QH=Z({id:"#spell-essence-leak",name:"Essence Leak",icon:{icon:"implosion"},activationType:L.Target,getDescription:()=>({descriptions:[B("Places a curse on enemy. Any time target is attacked, the attacker will be healed by 1 point per each Sprite in the current group")]}),config:{getManaCost:()=>2,init({events:n,actions:e,ownerUnit:i,vfx:t}){n.on({PlayerTargetsSpell({target:o}){let r=e.createSpellInstance(FC,{initialLevel:1});o.addSpell(r),t.createEffectForUnitGroup(o,OC,{duration:1e3})}})},targetCastConfig:{canActivate:Ft}}});Pi.defineUnitType({id:"#unit-c00",name:"Sprite",level:1,mainPortraitUrl:ue.UnitMelee,baseRequirements:{gold:75},getDescription:()=>({descriptions:[B("Tier 1 units of the Constellation."),B("<br>One of the strongest tier 1 unit types due to high-value abilities. Sprites can curse specific enemy to heal allied attackers.")]}),defaultSpells:["#spell-essence-leak"],baseStats:{damageInfo:{minDamage:2,maxDamage:3},speed:8,defence:4,health:14,attackRating:4},neutralReward:{experience:12,gold:8}});Pi.defineUnitType({id:"#unit-c10",name:"Fencer",level:2,mainPortraitUrl:ue.UnitMelee,baseRequirements:{gold:75},defaultSpells:["#spell-universal-pin"],defaultModifiers:{isPinner:!0},baseStats:{damageInfo:{minDamage:2,maxDamage:4},speed:7,defence:2,health:13,attackRating:5},neutralReward:{experience:12,gold:8}});Pi.defineUnitType({id:"#unit-c20",name:"Saggitar",level:3,mainPortraitUrl:ue.UnitRanged,baseRequirements:{gold:95},defaultModifiers:{isRanged:!0},baseStats:{damageInfo:{minDamage:6,maxDamage:8},speed:17,defence:4,health:17,attackRating:5},neutralReward:{experience:18,gold:14}});Pi.defineUnitType({id:"#unit-c30",name:"Chariot",level:4,mainPortraitUrl:ue.UnitMelee,baseRequirements:{gold:185},baseStats:{damageInfo:{minDamage:15,maxDamage:24},speed:24,defence:8,health:35,attackRating:9},neutralReward:{experience:18,gold:14}});Pi.defineUnitType({id:"#unit-c60",name:"Star Dragon",level:7,mainPortraitUrl:ue.UnitMelee,baseRequirements:{gold:1e3,gems:1,redCrystals:1},upgradeDetails:{target:"#unit-c61",upgradeCost:{gold:500,gems:1}},baseStats:{damageInfo:{minDamage:40,maxDamage:60},speed:20,defence:18,health:175,attackRating:16},neutralReward:{experience:180,gold:150}});Pi.defineUnitType({id:"#unit-c61",name:"Night Wyvern",level:7,mainPortraitUrl:ue.UnitMelee,baseRequirements:{gold:1500,gems:2,redCrystals:1},baseStats:{damageInfo:{minDamage:47,maxDamage:64},speed:22,defence:21,health:245,attackRating:17},defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.5},defaultSpells:["#spell-dream-aura"],neutralReward:{experience:180,gold:150},upgraded:!0});var yt=ls.createFaction({id:"#faction-neutrals",title:"Neutrals",icon:"monster-skull"});yt.defineUnitType({id:"#unit-neut-brogbat",name:"Brogbats",level:2,mainPortraitUrl:ue.UnitMelee,getDescription:at(["Brogbats are tier 2 creatures with average stats.","Bat species from the dusky lands of Brog."]),baseRequirements:{gold:75},baseStats:{attackRating:3,defence:3,damageInfo:{minDamage:4,maxDamage:5},health:13,speed:2},neutralReward:{experience:12,gold:10}});yt.defineUnitType({id:"#unit-neut-gnoll-0",mainPortraitUrl:ue.UnitMelee,name:"Gnolls",level:1,baseStats:ri([[3,4],1,1,10,12]),getDescription:at([U("Gnolls are tier 1 forest dwellers with average stats."),U("Mostly known for being bandits, they possess a fire resistant fur, giving them +10% to Fire Resist.")]),defaultSpells:["#spell-neut-gnoll-crush"],defaultModifiers:{resistFire:10,isForest:!0},baseRequirements:{gold:100},neutralReward:{experience:3.3,gold:3.2}});yt.defineUnitType({id:"#unit-neut-poison-ivy-0",mainPortraitUrl:ue.UnitMelee,name:"Poison Ivy",level:2,baseStats:ri([[3,4],1,1,10,10]),getDescription:at([U("Tier 2 forest dweller."),U("A living plant, a sturdy enemy with venomous attack, but vulnerable to any magic damage.")]),defaultModifiers:{resistAll:-20,isForest:!0},baseRequirements:{gold:10},neutralReward:{experience:4.5,gold:3.2}});yt.defineUnitType({id:"#unit-neut-thief-0",mainPortraitUrl:ue.UnitMelee,name:"Thieves",level:2,getDescription:at([U("Tier 2 forest dweller."),U("<br>Thieves are very dangerous despite being fragile. Their high speed allows them to have their turn earlier, and ability to attack twice, along with high damage, can result in heavy losses.")]),baseStats:ri([[6,7],2,1,9,16]),defaultTurnsPerRound:2,defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:4.55,gold:4.7}});yt.defineUnitType({id:"#unit-neut-forest-troll-0",mainPortraitUrl:ue.UnitMelee,name:"Forest Trolls",level:3,getDescription:at([U("Tier 3 forest dweller."),U("<br>Durable and strong, groups of Forest Trolls can absorb big damage, but their slowness usually makes them use their move last.")]),baseStats:ri([[5,7],3,4,17,10]),defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:6,gold:6}});yt.defineUnitType({id:"#unit-neut-fire-spirit-0",name:"Fire Spirits",mainPortraitUrl:ue.UnitMelee,baseRequirements:{},level:3,baseStats:ri([[13,18],3,3,22,17,1]),defaultModifiers:{resistFire:20,resistCold:15,isMagical:!0},getDescription:at([U("Tier 3 Neutral magical creature of fire."),U("<br>Tenacious and strong. Have increased resists against Fire (+20%) and Ice (+15%)."),U("<br>Has base manapool of 1.")]),neutralReward:{experience:20,gold:20},defaultSpells:[]});yt.defineUnitType({id:"#unit-neut-wind-spirit-0",name:"Wind Elementals",mainPortraitUrl:ue.UnitMelee,baseRequirements:{},level:3,baseStats:ri([[12,16],4,5,28,16,4]),defaultModifiers:{resistFire:20,resistCold:15,isMagical:!0},getDescription:at([U("Tier 4 Neutral magical creature of wind."),U("<br>Haste spell always grants an additional turn."),U("<br>Has base manapool of 4.")]),neutralReward:{experience:20,gold:20},defaultSpells:[]});yt.defineUnitType({id:"#unit-neut-ghost-0",mainPortraitUrl:ue.UnitMelee,name:"Ghosts",level:1,baseRequirements:{gold:30},getDescription(n){return{descriptions:[U("Undead unit."),U("<br>Possesses no outstanding qualities outside of low price and passive ability Fright. Gains improvements from Necromancy."),U("<br>Can be upgraded into Wraiths, faster unit with better stats, inheriting Fright ability.")]}},getUnitTypeSpecialtyModifiers:n=>n.specialtyNecromancy>1?{unitGroupSpeedBonus:4,heroBonusDefence:1}:null,baseStats:ri([[2,3],1,2,6,8]),defaultSpells:["#spell-fright"],neutralReward:{experience:2.3,gold:3},upgradeDetails:{target:"#unit-neut-ghost-1",upgradeCost:{gold:25}},defaultModifiers:{isGhost:!0}});yt.defineUnitType({id:"#unit-neut-ghost-1",mainPortraitUrl:ue.UnitMelee,name:"Wraiths",level:1,baseRequirements:{gold:55},baseStats:ri([[3,3],2,4,12,12]),getDescription(n){return{descriptions:[U("Undead unit. Upgraded and faster version of Ghosts."),U("<br>While having increased stats, inherits passive ability Fright."),U("<br>Gains improvements from Necromancy.")]}},getUnitTypeSpecialtyModifiers:n=>n.specialtyNecromancy===1?{unitGroupSpeedBonus:4,heroBonusDefence:2}:n.specialtyNecromancy>=2?{unitGroupSpeedBonus:4,heroBonusDefence:2,resistCold:10,resistFire:10}:null,defaultSpells:["#spell-fright"],defaultModifiers:{isGhost:!0},neutralReward:{experience:2.3,gold:2.4},upgraded:!0});yt.defineUnitType({id:"#unit-neut-skeleton-0",name:"Skeletons",mainPortraitUrl:ue.UnitMelee,level:1,getDescription(){return{descriptions:[U("Undead unit."),U("Usually found in big numbers, Skeletons also have ability to block damage with some chance.")]}},baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,defence:2,health:9,speed:11},defaultSpells:["#spell-skeleton-block"],baseRequirements:{gold:55},neutralReward:{experience:3,gold:2}});yt.defineUnitType({id:"#unit-neut-lich-0",name:"Liches",mainPortraitUrl:ue.UnitMelee,level:4,getDescription(){return{descriptions:[U("Tier 4 Undead unit. Can be upgraded into Master Liches."),U("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they also possess 25% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:13,maxDamage:17},attackRating:6,defence:5,health:32,speed:14},defaultModifiers:{lifesteal:25,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:30,gold:2},upgradeDetails:{target:"#unit-neut-lich-1",upgradeCost:{gold:100}}});var w5=yt.defineUnitType({id:"#unit-neut-lich-1",name:"Master Liches",mainPortraitUrl:ue.UnitMelee,level:4,getDescription(){return{descriptions:[U("Tier 4 Undead unit, an upgraded version of Liches."),U("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they possess improved 45% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:7,defence:7,health:35,speed:15},defaultModifiers:{lifesteal:45,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:40,gold:2}});yt.defineUnitType({id:"#unit-neut-imperial-guard",name:"Imperial Guard",level:3,neutralReward:{experience:10,gold:0},baseStats:{attackRating:3,defence:3,damageInfo:{maxDamage:3,minDamage:3},health:14,speed:12},defaultModifiers:{retaliationDamagePercent:.5,counterattacks:!0},defaultSpells:["#spell-tower-shields-block"],getDescription:()=>({descriptions:[B("Imperial Guards, a part of the imperial army, well trained with combat tactics. They can block damage and retaliate.")]}),baseRequirements:{}});yt.defineUnitType({id:"#unit-neut-boss-devastator",name:"Devastator",mainPortraitUrl:ue.UnitMelee,level:8,getDescription:at([U("An evil dragon of fire."),U("<br>Dangerous boss unit with large health pool. Resistant to magic, has +50% to Fire Resist and +20% to All Other Resists, also posseses Fire Breath ability that damages random enemies with fire."),U("<br>His scales allow him to block some damage. Cannot be slowed.")]),baseStats:{damageInfo:{minDamage:66,maxDamage:92},attackRating:9,defence:9,health:820,speed:14},defaultSpells:["#spell-fire-breath","#spell-devastator-block"],defaultModifiers:{isBoss:!0,resistAll:20,resistFire:30,cannotBeSlowed:!0},baseRequirements:{},neutralReward:{experience:120,gold:340},upgraded:!1});yt.defineUnitType({id:"#unit-neut-ranger-0",name:"Rangers",level:2,baseStats:{attackRating:4,damageInfo:{maxDamage:8,minDamage:6},defence:4,health:14,speed:16},defaultModifiers:{__attackConditionalModifiers({attacked:n}){return n.modGroup.getModValue("isForest")?{baseDamagePercentModifier:.75}:{}}},defaultSpells:[],getDescription(n){return{descriptions:[B("Tier 2 Neutral unit."),B("Efficient against forest dwellers, dealing 75% more damage to them.")]}},neutralReward:{experience:1,gold:1},baseRequirements:{gold:100}});var Gn=(()=>{let e=class e{constructor(){this.history=[],this.historyEvent$=new X}logHtmlMessage(t){let o={type:ar.Html,message:t};this.pushMessage(o)}logSimpleMessage(t){let o={type:ar.SimpleMsg,message:t};this.pushMessage(o)}logRoundInfoMessage(t){let o={type:ar.RoundInfoMsg,message:t};this.pushMessage(o)}logDealtDamageMessage(t){let o=T({type:ar.DealtDamageMsg},t);this.pushMessage(o)}pushMessage(t){this.history.push(t),this.historyEvent$.next()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var wt={addItem:n=>e=>[...e,n],removeItem:n=>e=>z.removeItemCopy(e,n)};var mt=function(n){return n.Player="Player",n.AI="AI",n}(mt||{}),Je=function(n){return n.Normal="normal",n.SpellTargeting="spell-targeting",n.WaitsForTurn="waits-for-turn",n}(Je||{}),ms=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.garrisons=new Map,this.hallsOfFateConfig=[],this.actionCards=[],this.activities=k([])}create({color:t,hero:o,resources:r,type:s}){this.color=t,this.resources=r,this.type=s,this.hero=o,this.hero.assignOwnerPlayer(this),this.hero.updateUnitsSpecialtyAndConditionalMods()}addHallsOfFateConfig(t){this.hallsOfFateConfig.push({id:t.id,actionCards:t.actionCards.map(o=>({cost:o.cost,count:k(o.count),item:Le(o.item)})),items:t.items.map(o=>Le(o)),spells:t.spells.map(o=>({cost:o.cost,item:Le(o.item)}))})}addWeeklyActivity(t){this.activities.update(wt.addItem(t))}removeWeeklyActivity(t){this.activities.update(wt.removeItem(t))}addActionCards(t,o){let r=this.actionCards.find(s=>s.card===t);r?r.count+=o:this.actionCards.push({card:t,count:o})}};e.categoryId="player";let n=e;return n})();var bn=class{get signal(){return this._signal}constructor(e){this.defaultState=e,this.state$=new un(e),this._signal=k(e)}debug(e){this.observe().pipe(vo()).subscribe(i=>{console.log(e,i)})}get(){return this.signal()}patch(e){return this.updateState(T(T({},this.state$.getValue()),e))}set(e){this.updateState(e)}revertState(){this.set(this.defaultState)}mapGet(e){return e(this.get())}updateWith(e){let i=this.state$.getValue(),t=e(i)??i;return this.updateState(t),t}patchWith(e){let i=this.state$.getValue(),t=e(i)??i;return this.updateState(T(T({},i),t))}updateWithCopy(e){let i=T({},this.state$.getValue());return e(i),this.updateState(i)}observe(){return this.state$}pick(e){return e(this.get())}select(e){return this.observe().pipe(Xt(e))}selectDistinct(e){return this.select(e).pipe(vo())}updateState(e){return this.state$.next(e),this._signal.set(e),e}},qa=class extends bn{revert(){this.set(this.defaultState)}};function Cc(n){n.next(),n.complete()}var Mt=function(n){return n[n.Normal=0]="Normal",n[n.Initial=1]="Initial",n[n.Retreated=2]="Retreated",n[n.Defending=3]="Defending",n[n.Pinned=4]="Pinned",n[n.Pinning=5]="Pinning",n[n.Fleeing=6]="Fleeing",n[n.Recharging=7]="Recharging",n[n.RechargingFailed=8]="RechargingFailed",n[n.Dead=9]="Dead",n}(Mt||{}),_4={[Mt.Defending]:"shield",[Mt.Initial]:null,[Mt.Normal]:null,[Mt.Dead]:"skull",[Mt.Pinned]:"crossed-swords",[Mt.Pinning]:"crossed-swords",[Mt.Fleeing]:"x-mark",[Mt.Recharging]:"arrow-flights",[Mt.RechargingFailed]:"broken-shield",[Mt.Retreated]:"player-dodge"};var mi=function(n){return n.HeroMods="hMods",n.CombatMods="cMods",n.AuraMods="aMods",n.SpecialtyAndConditionalMods="scMods",n.WeeklyMods="waMods",n.SpellMods="sMods",n}(mi||{}),wc=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.modGroup=ii.empty(),this.state=new bn({combatState:{type:Mt.Normal},groupState:{initialCount:0,spellsOnCooldown:!1,count:0,isAlive:!0,tailHp:0,position:0,turnsLeft:0,currentMana:0,spells:[]},groupStats:{baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,defends:!1,baseSpeed:0,speedBonus:0,finalSpeed:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,totalHealth:0,totalMinDamage:0,totalMaxDamage:0,avgTotalDamage:0,position:0,maxMana:0}}),this.lostDuringBattle=ae(()=>this.state.signal().groupState.initialCount-this.count),this.destroyed$=new X}get count(){return this.getState().groupState.count}get isAlive(){return this.getState().groupState.isAlive}get tailUnitHp(){return this.getState().groupState.tailHp}get spells(){return this.getState().groupState.spells}get turnsLeft(){return this.getState().groupState.turnsLeft}get type(){return this._type}get ownerHero(){return this._ownerHero}get ownerPlayer(){return this._ownerPlayer}create({count:t,unitBase:o,ownerHero:r,isSplitted:s}){(t<=0||!t)&&(console.warn(`Cannot create unit group with ${t} units. Setting count to 1.`,this),t=1),this._type=o,r&&(this.assignOwnerHero(r),this.assignOwnerPlayer(r.ownerPlayer)),this.patchUnitGroupState({tailHp:o.baseStats.health,turnsLeft:o.defaultTurnsPerRound||1}),this.type.defaultModifiers&&this.modGroup.addModsRef(xt.fromMods(this.type.defaultModifiers)),this.patchUnitGroupState({initialCount:t,spellsOnCooldown:!1}),this.setUnitsCount(t),s||this.addMana(this.type.baseStats.mana||0),this.modGroup.attachNamedParentGroup(mi.CombatMods,ii.empty()),this.modGroup.attachNamedParentGroup(mi.SpecialtyAndConditionalMods,ii.empty()),this.modGroup.attachNamedParentGroup(mi.SpellMods,ii.empty()),this.patchUnitGroupState({spells:[]}),this.type.defaultSpells&&this.type.defaultSpells.map(d=>this.getApi().spells.createSpellInstance(Le(d))).forEach(d=>this.addSpell(d)),this.setupStatsUpdating()}onDestroy(){Cc(this.destroyed$),this.spells.forEach(t=>this.getApi().gameObjects.destroyObject(t))}getState(){return this.state.get()}getStateSignal(){return this.state.signal}setPosition(t){this.state.pick(o=>o.groupState.position)!==t&&this.patchUnitGroupState({position:t})}assignOwnerHero(t){this._ownerHero=t,this._ownerPlayer=t.ownerPlayer,this.modGroup.detachNamedParentGroup(mi.HeroMods),this.modGroup.attachNamedParentGroup(mi.HeroMods,this._ownerHero.modGroup)}assignOwnerPlayer(t){this._ownerPlayer=t}addUnitsCount(t){this.setUnitsCount(this.count+t)}setUnitsCount(t){this.patchUnitGroupState({count:t>=0?t:0}),this.recalcHealthBasedStats()}setMana(t){this.patchUnitGroupState({currentMana:z.limitedNumber(t,this.getState().groupStats.maxMana||this.type.baseStats.mana||0)})}addMana(t){let o=this.getState();this.setMana(o.groupState.currentMana+t)}getMana(){return this.getState().groupState.currentMana}hasEnoughMana(t){return this.getMana()>t}addTailUnitHp(t){this.setTailUnitHp((this.tailUnitHp??0)+t)}setTailUnitHp(t){this.patchUnitGroupState({tailHp:t}),this.recalcHealthBasedStats()}listenStats(){return this.state.observe().pipe(Ge(this.destroyed$))}addSpell(t){this.spells.push(t),this.patchUnitGroupState({spells:this.spells}),t.setOwnerObjectId(this.id),t.baseType.config.onAcquired?.({spellInstance:t,ownerUnit:this}),this.getApi().events.dispatch(ds({unitGroup:this}))}removeSpell(t){z.removeItem(this.spells,t),this.patchUnitGroupState({spells:this.spells})}removeDefendingMod(){let t=this.modGroup.getNamedGroup(mi.CombatMods);if(!t)return;let o=t?.getAllRefs().find(r=>r.getModValue("defending"));o&&t?.removeModsRef(o)}attachSpecialtyMods(t){this.getSpecialtyAndConditionalModsGroup().addModsRef(xt.fromMods(t))}clearSpecialtyAndConditionalMods(){this.getSpecialtyAndConditionalModsGroup().clearOwnModRefs()}clearCombatMods(){this.modGroup.getNamedGroup(mi.CombatMods).clearOwnModRefs()}addCombatMods(t){this.modGroup.getNamedGroup(mi.CombatMods).addModsRef(xt.fromMods(t))}removeCombatMods(t){this.modGroup.getNamedGroup(mi.CombatMods).removeRefByModInstance(t)}addSpellMods(t){this.modGroup.getNamedGroup(mi.SpellMods).addModsRef(xt.fromMods(t))}removeSpellMods(t){this.modGroup.getNamedGroup(mi.SpellMods).removeRefByModInstance(t)}recalcHealthBasedStats(){let t=this.state.get(),o=this.type.baseStats,r=this.count,s=t.groupStats,d=r*o.damageInfo.minDamage,h=r*o.damageInfo.maxDamage;this.pushState(J(T({},t),{groupState:J(T({},t.groupState),{count:r}),groupStats:J(T({},s),{totalHealth:o.health*(r-1)+(this.tailUnitHp??0),totalMinDamage:d,totalMaxDamage:h,avgTotalDamage:(d+h)/2})}))}getSpecialtyAndConditionalModsGroup(){return this.modGroup.getNamedGroup(mi.SpecialtyAndConditionalMods)}setupStatsUpdating(){this.modGroup.onValueChanges().pipe(Ge(this.destroyed$)).subscribe(t=>{let o=this.type.baseStats,r=this.ownerPlayer?.hero.base.initialState.stats,s=o.attackRating,d=(t.heroBonusAttack||0)+(r?.baseAttack||0),h=o.defence,_=(t.heroBonusDefence||0)+(r?.baseDefence||0),C=o.speed,O=t.unitGroupSpeedBonus||0;O<0&&t.cannotBeSlowed&&(O=0),t.fixedSpeed&&(O=0,C=t.fixedSpeed||5);let R=t.resistAll||0,Q=this.state.get(),de=Q.groupStats,Ie={baseAttack:s,bonusAttack:d,finalAttack:s+d,defends:t.defending,baseDefence:h,bonusDefence:_,finalDefence:h+_,baseSpeed:C,speedBonus:O,finalSpeed:C+O,fireResist:(t.resistFire||0)+R,coldResist:(t.resistCold||0)+R,lightningResist:(t.resistLightning||0)+R,poisonResist:(t.resistPoison||0)+R,totalHealth:de.totalHealth,totalMinDamage:de.totalMinDamage,totalMaxDamage:de.totalMaxDamage,avgTotalDamage:de.avgTotalDamage,position:de.position,maxMana:o.mana||0};this.pushState(J(T({},Q),{groupStats:Ie}))})}setCombatState(t){this.patchState({combatState:t})}clearCombatState(){this.setCombatState({type:Mt.Normal})}pushState(t){this.state.set(t)}patchState(t){return this.state.patch(t)}patchUnitGroupState(t){return this.patchState({groupState:T(T({},this.getState().groupState),t)})}restoreBattleLosses(){let t=this.getState();this.patchUnitGroupState({count:t.groupState.initialCount,isAlive:!0,tailHp:this.type.baseStats.health})}};e.categoryId="unit-group";let n=e;return n})();var Cu=":";function Sc(n,e){return`${n}${Cu}${e}`}function RC(n){return n.split(Cu)}var je=(()=>{let e=class e{constructor(){this.events=u(oe),this.internalRegistries=new Map,this.allObjects=new Map,this.objectsCustomData=new Map,window.gameObjects=this}createNewGameObject(t,o,r){let s=t.categoryId,d=this.getOrCreateCategoryRegistry(s),h;if(r){let C=Sc(s,r);if(this.allObjects.has(C))throw console.error(`Game object with id '${C}' already exists! New params/old object:`,o,this.allObjects.get(C)),new Error(`Game object with id '${C}' already exists!`);h=C}else h=Sc(s,d.latestId++);let _=new t(h);return this.events.dispatch(Ia({gameObject:_})),_.create(o),d.objects.add(_),this.allObjects.set(h,_),Ki.logGameObjects&&console.log(_),_}getObjectById(t,o){return this.getObjectByFullId(Sc(t.categoryId,o))}getObjectByFullId(t){if(RC(t).length!==2)throw new Error(`Getting object by id '${t}' failed, id doesn't follow format 'CategoryId${Cu}ObjectId'`);let r=this.allObjects.get(t);if(!r)throw new Error(`Failed to get object by '${t}' id: Object doens't exist`);return r}destroyObject(t){let r=Object.getPrototypeOf(t).categoryId;this.internalRegistries.get(r)?.objects.delete(t),t.onDestroy(),this.objectsCustomData.delete(t.id),this.allObjects.delete(t.id)}getObjectId(t,o){let r=o.split(":");return r.length===2&&r[0]===t.categoryId?o:Sc(t.categoryId,o)}addCustomData(t,o){let r=typeof t=="object"?t.id:t,s=this.objectsCustomData.get(r);this.objectsCustomData.set(r,T(T({},s),o))}getCustomData(t){let o=this.objectsCustomData.get(typeof t=="string"?t:t.id);return console.log("Getting custom data:",o),o}getOrCreateCategoryRegistry(t){let o=this.internalRegistries.get(t);return o||(this.initializeRegistryForCategory(t),this.internalRegistries.get(t))}initializeRegistryForCategory(t){this.internalRegistries.set(t,{latestId:0,objects:new Set})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Rt=(()=>{let e=class e{constructor(){this.gameObjectsManager=u(je),this.events=u(oe)}createUnitGroup(t,o,r){return this.gameObjectsManager.createNewGameObject(wc,{count:o.count,ownerHero:r,unitBase:Hi(t)})}createUnitGroupFromGenModel(t){return vu.createRandomArmy(t).map(o=>this.createUnitGroup(o.unitType,{count:o.count}))}createUnitGroupFromGenModelForPlayer(t,o){return vu.createRandomArmy(t).map(r=>this.createUnitGroup(r.unitType,{count:r.count},o))}addModifierToUnitGroup(t,o){this.events.dispatch(aa({mods:o,unit:t}))}removeModifiers(t,o){this.events.dispatch(la({mods:o,unit:t}))}clearUnitModifiers(t){t.clearCombatMods()}getUnitGroupSpeed(t){return t.getState().groupStats.finalSpeed}healUnit(t,o){let r=t.type.baseStats.health,s=Math.floor(o/r),d=s*r,h=o-d,_=t.getState().groupState.initialCount,C=t.count,O=_-C,R=t.tailUnitHp||r,Q=r-R,de=O*r+Q;if(de===0||o<=0)return{revivedUnitsCount:0,totalHealedHp:0};if(t.patchUnitGroupState({isAlive:!0}),o>de)return t.setTailUnitHp(r),t.setUnitsCount(_),{revivedUnitsCount:O,totalHealedHp:de};let Ie=s;return h>Q?(Ie+=1,t.setTailUnitHp(R+h-r)):t.tailUnitHp===0&&h===0&&Ie>0?t.setTailUnitHp(r):t.addTailUnitHp(h),t.addUnitsCount(Ie),{revivedUnitsCount:Ie,totalHealedHp:o}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ln=function(n){return n[n.None=0]="None",n[n.Permanent=1]="Permanent",n}(Ln||{});var hs=class{constructor(){this.triggerMapsByRefsMap=new Map}registerHandlerByRef(e,i,t){let o=this.triggerMapsByRefsMap.get(e);if(o){let r=o.get(i);r?r.push(t):o.set(i,[t])}else this.triggerMapsByRefsMap.set(e,new Map([[i,[t]]]))}triggerAllHandlersByEvent(e){this.triggerMapsByRefsMap.forEach(i=>{i.forEach((t,o)=>t.forEach(r=>{o===e.__eventType.__type&&r(e)}))})}triggerRefEventHandlers(e,i){let t=this.triggerMapsByRefsMap.get(e);t&&t.forEach((o,r)=>{o.forEach(s=>{r===i.__eventType.__type&&s(i)})})}removeAllHandlersForRef(e){this.triggerMapsByRefsMap.delete(e)}removeAllHandlers(){this.triggerMapsByRefsMap.clear()}};var fe=(()=>{let e=class e{constructor(){this.gameSettings=new qa({lossToNeutralPlayers:Ln.Permanent,lossToPlayers:Ln.Permanent,lossToNeutrals:Ln.Permanent,allowNeutralControl:Ki.allowNeutralAIControlByDefault}),this.townsByPlayers=new Map,this.currentGame={day:1,globalDay:1,week:1,actionPoints:4},this.settings={orientation:So.Vertical,mapDebug:!0},this.mainMenu={},this.mapCamera={cameraInitialized:!1,x:0,y:0},this.initializedSpells=new qa({spells:[]}),this.eventHandlers={items:new hs,buildings:new hs,structures:new hs},this.unitsAppliedModifiers=new Map}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var zt=(()=>{let e=class e{constructor(){this.units=u(Rt),this.events=u(oe),this.stateService=u(fe),this.state=new bn({currentPlayer:null,currentUnitGroup:null,round:1,currentGroupTurnsLeft:0}),this.heroesUnitGroupsMap=new Map,this.playerLosses={},this.playersRivalryMap=new Map}resetCurrentPlayer(){this.state.patch({currentPlayer:null})}initBattleState(t,o){this.players=o,this.playersRivalryMap.set(o[0],o[1]),this.playersRivalryMap.set(o[1],o[0]),this.initPlayerLossesMap(),this.initPlayerUnitGroupsMap(t),this.resetFightQueue(),this.updateGroupsTailHpAndCombatInfo(),this.refreshUnitGroups()}initNextTurnByQueue(t=!1){if(t&&this.state.get().currentUnitGroup.count&&this.fightQueue.shift(),!this.fightQueue.length){this.getAllUnits().forEach(d=>{d.modGroup.getModValue("defending")&&d.removeDefendingMod()}),this.resetFightQueue(),this.resetGroupsTurnsLeft(),this.state.updateWithCopy(d=>d.round++),this.events.dispatch(Bi({round:this.state.get().round}));return}let o=this.fightQueue[0],r=this.state.get().currentPlayer;this.state.patch({currentPlayer:o.ownerPlayer,currentUnitGroup:o});let s=this.state.get().currentUnitGroup;s.modGroup.getModValue("defending")?this.state.patch({currentGroupTurnsLeft:s.turnsLeft}):this.state.patch({currentGroupTurnsLeft:s.turnsLeft||1}),this.state.get().currentPlayer!==r?this.events.dispatch(eo({currentPlayer:this.state.get().currentPlayer,previousPlayer:r})):this.events.dispatch(sa())}getFightQueue(){return this.fightQueue}handleDefeatedUnitGroup(t){let o=t.ownerPlayer,r=this.heroesUnitGroupsMap.get(o);t.patchUnitGroupState({isAlive:!1}),this.heroesUnitGroupsMap.set(o,r);let s=this.fightQueue.indexOf(t);s!==-1&&this.fightQueue.splice(s,1)}getEnemyOfPlayer(t){return this.playersRivalryMap.get(t)}canUnitGroupBeAttackedByCurrentPlayerAICheck(t){let o=this.getTargetingData(t);return!o.stateInitialized||o.isCurrentPlayerAI&&!o.isOpponentAI&&!this.stateService.gameSettings.get().allowNeutralControl?!1:!o.doesUnitBelongToActivePlayer}getTargetingData(t){let o=this.state.get().currentPlayer;return o?{stateInitialized:!0,isCurrentPlayerAI:o.type===mt.AI,isOpponentAI:this.getEnemyOfPlayer(o).type===mt.AI,doesUnitBelongToActivePlayer:t.ownerPlayer===o}:{stateInitialized:!1}}processAiPlayer(){setTimeout(()=>{let t=this.getAliveUnitsOfPlayer(this.getEnemyOfPlayer(this.state.get().currentPlayer)),o=Math.round(Math.random()*(t.length-1)),r=t[o],s=this.state.get().currentUnitGroup;if(s.ownerPlayer.type===mt.AI){let d=s.spells.find(h=>h.baseType.config.aiTags?.includes(Ha.RegularAttackSpell));if(r&&d&&!d.cooldown){this.events.dispatch(lr({player:s.ownerPlayer,spell:d,target:r})),s.turnsLeft&&this.processAiPlayer();return}}this.events.dispatch(Jn({attackedGroup:r,attackingGroup:this.state.get().currentUnitGroup}))},1150)}getUnitGroupTotalDamage(t){return t.count*t.type.baseStats.damageInfo.maxDamage}resortFightQueue(t=!1){if(t){this.fightQueue=this.getUnitsSortedBySpeed(this.fightQueue);return}this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.fightQueue.slice(1))]}removeUnitsWithoutTurnsFromFightQueue(){this.fightQueue=this.fightQueue.filter(t=>t.turnsLeft)}getAliveUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(o=>o.isAlive)}getDeadUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(o=>!o.isAlive)}getSummonsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(o=>o.modGroup.getModValue("isSummon"))}playerHasAnyAliveUnits(t){return this.getAliveUnitsOfPlayer(t).length!==0}addTurnsToUnitGroup(t,o){let r=t.turnsLeft;t.patchUnitGroupState({turnsLeft:t.turnsLeft+o}),this.state.get().currentUnitGroup===t&&this.state.updateWithCopy(s=>s.currentGroupTurnsLeft+=o),r<=0&&t.turnsLeft>0&&this.resortFigthQueueWithNewUnits()}summonUnitForPlayer(t,o,r){let s=this.units.createUnitGroup(o,{count:r},t.hero),d=this.heroesUnitGroupsMap.get(t),h=d.length;return d.push(s),s.setPosition(h),this.units.addModifierToUnitGroup(s,{isSummon:!0}),this.resortFigthQueueWithNewUnits(),s}registerPlayerUnitLoss(t,o){let r=this.playerLosses[t.ownerPlayer.id],s=t.type,d=r.get(s);if(d){let h=d+o;h>0?r.set(s,h):r.delete(s)}else r.set(s,o)}initPlayerLossesMap(){this.players.forEach(t=>{this.playerLosses[t.id]=new Map})}resetGroupsTurnsLeft(){this.fightQueue.forEach(t=>t.patchUnitGroupState({turnsLeft:t.turnsLeft+(t.type.defaultTurnsPerRound||1)}))}getUnitsSortedBySpeed(t){return[...t].sort((o,r)=>this.units.getUnitGroupSpeed(r)-this.units.getUnitGroupSpeed(o))}resetFightQueue(){this.fightQueue=this.getUnitsSortedBySpeed([...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])])}getAllUnits(){return[...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])]}initPlayerUnitGroupsMap(t){this.heroesUnitGroupsMap.clear(),t.forEach(o=>{let r=o.ownerPlayer,s=this.heroesUnitGroupsMap.get(r);s?s.push(o):this.heroesUnitGroupsMap.set(r,[o])}),this.heroesUnitGroupsMap.forEach(o=>{o.forEach((r,s)=>{r.setPosition(s)})})}updateGroupsTailHpAndCombatInfo(){this.players.forEach(t=>{t.hero.unitGroups.forEach(o=>{o.tailUnitHp||o.setTailUnitHp(o.type.baseStats.health),o.patchUnitGroupState({initialCount:o.count})})})}refreshUnitGroups(){this.players.forEach(t=>{t.hero.unitGroups.forEach(o=>{o.patchUnitGroupState({turnsLeft:o.type.defaultTurnsPerRound||1})})})}resortFigthQueueWithNewUnits(){this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.getAllAliveUnitsWithTurnsExcept(this.fightQueue[0]))]}getAllAliveUnitsWithTurnsExcept(t){let o=t||this.fightQueue[0];return this.getAllAliveUnitsExcept(o).filter(r=>r.turnsLeft)}getAllAliveUnitsExcept(t){return[...this.heroesUnitGroupsMap.values()].flat().filter(o=>o.isAlive&&o!==t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var bc=(()=>{let e=class e{constructor(){this.mapping=new Map}register(t,o){this.mapping.set(t,o)}unregister(t){this.mapping.delete(t)}get(t){return this.mapping.get(t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Su={[Be.Cold]:"coldResist",[Be.Fire]:"fireResist",[Be.Lightning]:"lightningResist",[Be.Poison]:"poisonResist"},bu=60;var Ce=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-ra-icon"]],inputs:{icon:"icon"},standalone:!1,decls:1,vars:2,consts:[[1,"ra"]],template:function(o,r){o&1&&g(0,"i",0),o&2&&Yi("ra-"+r.icon)},encapsulation:2,changeDetection:0});let n=e;return n})();var en=(()=>{let e=class e{constructor(t){this.domSanitizer=t}transform(t){return this.domSanitizer.bypassSecurityTrustHtml(t)}};e.\u0275fac=function(o){return new(o||e)(G(Rp,16))},e.\u0275pipe=qn({name:"safeHtml",type:e,pure:!0,standalone:!1});let n=e;return n})();var Ar=(()=>{let e=class e{constructor(){this.actionCard=N.required(),this.appearance="normal"}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-action-card"]],hostVars:2,hostBindings:function(o,r){o&2&&Yi(r.appearance)},inputs:{actionCard:[1,"actionCard"],appearance:"appearance"},standalone:!1,decls:7,vars:11,consts:[[1,"icon"],[3,"icon"],[1,"content"],[1,"title"],[1,"description",3,"innerHtml"]],template:function(o,r){o&1&&(a(0,"div",0),g(1,"mw-ra-icon",1),l(),a(2,"div",2)(3,"div",3),p(4),l(),g(5,"div",4),xe(6,"safeHtml"),l()),o&2&&(c(),se("color",r.actionCard().iconColor)("background",r.actionCard().bgColor)("border-color",r.actionCard().borderColor),f("icon",r.actionCard().icon),c(3),D(" ",r.actionCard().title," "),c(),f("innerHtml",Me(6,9,r.actionCard().description),qi))},dependencies:[Ce,en],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;cursor:pointer}.icon[_ngcontent-%COMP%]{width:84px;height:84px;position:relative;bottom:-14px;display:flex}.icon[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{width:74px;height:74px;display:flex;background-color:gray;font-size:74px;border-radius:50%;border:4px solid rgb(82,82,82);color:#fff;margin:auto}.content[_ngcontent-%COMP%]{border:3px solid gray;border-radius:5px;padding:14px 8px 8px;display:flex;flex-direction:column;align-items:center;color:#fff;width:135px;min-height:74px;text-align:center;background-color:#636363;-webkit-user-select:none;user-select:none}.content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;margin-bottom:6px;padding-bottom:4px;border-bottom:2px solid #8d8d8d;width:100%}.content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:13px}.small[_nghost-%COMP%]   .icon[_ngcontent-%COMP%]{width:60px;height:60px}.small[_nghost-%COMP%]   .icon[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{width:50px;height:50px;display:flex;background-color:gray;font-size:50px;border-radius:50%;border:4px solid rgb(82,82,82);color:#fff;margin:auto}"]});let n=e;return n})();var xc=new Se("Popup Reference");var ye=class{constructor(){this.popup=u(xc),this.data=this.popup.data}close(){this.popup.close()}};var gs=(()=>{let e=class e{constructor(){this.keyPress$=_i(document,"keyup"),this.escape$=this.keyPress$.pipe(Ai(t=>t.key==="Escape"))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ei=(()=>{let e=class e{constructor(){this.popups=[],u(gs).escape$.subscribe(t=>{if(!this.popups.length)return;let o=this.popups[this.popups.length-1];(o.isCloseable||o.escape)&&this.removePopup(o)})}createPopup(t){this.popups.push(t)}createBasicPopup(t){this.createPopup(t)}removePopup(t){z.removeItem(this.popups,t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function GC(n,e){n&1&&We(0)}function LC(n,e){n&1&&g(0,"div",1)}var Mc=(()=>{let e=class e{constructor(t,o,r){this.popups=t,this.hostElemRef=o,this.renderer=r,this.isInactive=!1}ngOnInit(){this.popupData.class&&this.renderer.addClass(this.hostElemRef.nativeElement,this.popupData.class),this.injector=Ne.create({providers:[{provide:xc,useValue:{data:this.popupData.data,close:()=>{this.popups.removePopup(this.popupData)}}}]})}preventClick(t){t.stopPropagation()}};e.\u0275fac=function(o){return new(o||e)(G(Ei),G(Ue),G($e))},e.\u0275cmp=v({type:e,selectors:[["mw-popup-wrapper"]],hostBindings:function(o,r){o&1&&y("click",function(d){return r.preventClick(d)})},inputs:{popupData:"popupData",isInactive:"isInactive"},standalone:!1,decls:2,vars:3,consts:[[4,"ngComponentOutlet","ngComponentOutletInjector"],[1,"inactive-overlay"]],template:function(o,r){o&1&&(K(0,GC,1,0,"ng-container",0),x(1,LC,1,0,"div",1)),o&2&&(f("ngComponentOutlet",r.popupData.component)("ngComponentOutletInjector",r.injector),c(),M(r.isInactive?1:-1))},dependencies:[wp],styles:[".inactive-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#48484846}.small-padding[_nghost-%COMP%]{padding:12px}.transparent[_nghost-%COMP%]{background:transparent;width:100%;pointer-events:none;padding:0}"]});let n=e;return n})();var Nn=(()=>{let e=class e{constructor(){this.mwNoContextMenu=new ze}preventContextMenu(t){return t.stopPropagation(),t.preventDefault(),this.mwNoContextMenu.emit(),!1}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["","mwNoContextMenu",""],["","mwUnitGroupCombatAction",""]],hostBindings:function(o,r){o&1&&y("contextmenu",function(d){return r.preventContextMenu(d)})},outputs:{mwNoContextMenu:"mwNoContextMenu"},standalone:!1});let n=e;return n})();function UC(n,e){n&1&&g(0,"div",0)}function VC(n,e){if(n&1&&g(0,"mw-popup-wrapper",3),n&2){let i=e.$implicit,t=e.$index,o=e.$count;f("ngClass",i.class)("popupData",i)("isInactive",t!==o-1)}}function HC(n,e){if(n&1){let i=I();a(0,"div",2),y("click",function(o){w(i);let r=m();return S(r.handleOverlayClick(o))}),P(1,VC,1,3,"mw-popup-wrapper",3,le),l()}if(n&2){let i=m();c(),E(i.popupsService.popups)}}var Dc=(()=>{let e=class e{constructor(t){this.popupsService=t}handleOverlayClick(t){t.preventDefault();let o=this.popupsService.popups,r=Jh(o);r.isCloseable&&this.popupsService.removePopup(r)}};e.\u0275fac=function(o){return new(o||e)(G(Ei))},e.\u0275cmp=v({type:e,selectors:[["mw-popup-container"]],standalone:!1,decls:2,vars:2,consts:[[1,"overlay"],["mwNoContextMenu","",1,"popups-container"],["mwNoContextMenu","",1,"popups-container",3,"click"],[1,"popup",3,"ngClass","popupData","isInactive"]],template:function(o,r){o&1&&(x(0,UC,1,0,"div",0),x(1,HC,3,0,"div",1)),o&2&&(M(r.popupsService.popups.length?0:-1),c(),M(r.popupsService.popups.length?1:-1))},dependencies:[Zi,Nn,Mc],styles:["@keyframes _ngcontent-%COMP%_overlay-appear{0%{background-color:#0000000d}to{background-color:#000000a7}}.popups-container[_ngcontent-%COMP%]{left:0;z-index:9200;top:0;position:fixed;height:100%;width:100%}.overlay[_ngcontent-%COMP%]{left:0;top:0;z-index:4000;position:fixed;height:100%;width:100%;background-color:#0000;animation:_ngcontent-%COMP%_overlay-appear 1s;animation-fill-mode:forwards}.popup[_ngcontent-%COMP%]{position:absolute;display:block;min-width:400px;left:50%;z-index:9500;top:50%;transform:translate(-50%,-50%);background-color:#fff}.dark[_ngcontent-%COMP%]{background-color:#484852}"]});let n=e;return n})();function $C(n,e){if(n&1){let i=I();a(0,"div",5)(1,"mw-action-card",6),y("click",function(){let o=w(i).$implicit,r=m();return S(r.handleCardClick(o))}),l(),a(2,"div",7),p(3),xe(4,"infNum"),l()()}if(n&2){let i=e.$implicit;c(),f("actionCard",i.card)("mwActionHint","Use "+i.card.title),c(2),D("Left: ",Me(4,3,i.count))}}var Ka=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.state=u(fe),this.playersService=u($),this.events=u(oe),this.cards=this.playersService.getCurrentPlayer().actionCards,this.actionPointsLeft=this.state.currentGame.actionPoints}handleCardClick(t){this.events.dispatch(xr({player:this.playersService.getCurrentPlayer(),cardStack:t})),this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-action-cards-popup"]],standalone:!1,features:[V],decls:12,vars:1,consts:[[1,"header"],[1,"action-points"],[1,"points"],["icon","feather-wing"],[1,"cards"],[1,"card-stack"],[3,"click","actionCard","mwActionHint"],[1,"cards-left"]],template:function(o,r){o&1&&(a(0,"div",0),p(1," Available action cards "),a(2,"div",1),p(3," Remaining action points for this day: "),g(4,"br"),a(5,"span",2),g(6,"mw-ra-icon",3),p(7),l()(),g(8,"hr"),l(),a(9,"div",4),P(10,$C,5,5,"div",5,le),l()),o&2&&(c(7),D(" ",r.actionPointsLeft," "),c(3),E(r.cards))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#0000009c;padding:40px 0}.header[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:24px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]{font-size:16px;font-weight:100;line-height:32px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]   .points[_ngcontent-%COMP%]{font-size:32px}.cards[_ngcontent-%COMP%]{display:flex;pointer-events:all;gap:14px;padding-top:15px}.card-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding:0 16px 8px;border-radius:6px;background-color:#fff0;transform:translateY(0);transition:.2s}.card-stack[_ngcontent-%COMP%]:hover{background-color:#ffffff31;transform:translateY(-20px)}.cards-left[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:15px;padding-top:4px}"]});let n=e;return n})();var Pc=(()=>{let e=class e{constructor(){}registerCursorComponent(t){this.cursorComponent=t}setCustomCursor(t,o,r){this.cursorComponent.showCustomCursor=!0,this.updateCursorComponent(),this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.customCursorRef.playAnimation(t,o,r)}setCustomCursorPos(t,o){this.cursorComponent.customCursorPos.x=t,this.cursorComponent.customCursorPos.y=o,this.updateCursorComponent()}clearCustomCursor(){this.updateCursorComponent(),this.cursorComponent.customCursorRef&&(this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.showCustomCursor=!1)}updateCursorComponent(){this.cursorComponent.cdr.detectChanges()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var zC=["customCursorRef"];function WC(n,e){if(n&1&&g(0,"mw-vfx-element",2,0),n&2){let i=m();se("top",i.customCursorPos.y-5,"px")("left",i.customCursorPos.x-2,"px")}}var Za=(()=>{let e=class e{constructor(){this.cursor=u(Pc),this.cdr=An(),this.showCustomCursor=!1,this.customCursorPos={x:0,y:0},this.cursor.registerCursorComponent(this)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-custom-cursor"]],viewQuery:function(o,r){if(o&1&&Et(zC,5),o&2){let s;_t(s=vt())&&(r.customCursorRef=s.first)}},standalone:!1,decls:1,vars:1,consts:[["customCursorRef",""],[1,"custom-cursor",3,"top","left"],[1,"custom-cursor"]],template:function(o,r){o&1&&x(0,WC,2,4,"mw-vfx-element",1),o&2&&M(r.showCustomCursor?0:-1)},styles:["[_nghost-%COMP%]{position:fixed;left:0;top:0;width:0;height:0}.custom-cursor[_ngcontent-%COMP%]{pointer-events:none;position:absolute;z-index:100000;font-size:24px;color:#fff;transform:scaleX(-1)}"]});let n=e;return n})();var Un=(()=>{let e=class e{constructor(){this.size=32}ngOnChanges(){this.imagePath=`url("${Uh[this.icon]}")`}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-img-icon"]],hostVars:6,hostBindings:function(o,r){o&2&&se("width",r.size,"px")("height",r.size,"px")("background-image",r.imagePath)},inputs:{size:"size",icon:"icon"},standalone:!1,features:[bt],decls:0,vars:0,template:function(o,r){},styles:["[_nghost-%COMP%]{display:inline-block;background-size:cover}"],changeDetection:0});let n=e;return n})();var Wt=(()=>{let e=class e{constructor(){this.resType=N.required(),this.amount=N(0),this.iconSize=N(32),this.display="horizontal",this.resDetails=ae(()=>Vh[this.resType()])}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-res-label"]],hostVars:2,hostBindings:function(o,r){o&2&&Yi(r.display)},inputs:{resType:[1,"resType"],amount:[1,"amount"],iconSize:[1,"iconSize"],display:"display"},standalone:!1,decls:3,vars:3,consts:[[3,"icon","size"]],template:function(o,r){o&1&&(g(0,"mw-img-icon",0),a(1,"span"),p(2),l()),o&2&&(f("icon",r.resDetails().imgIcon)("size",r.iconSize()),c(2),H(r.amount()))},dependencies:[Un],styles:["[_nghost-%COMP%]{display:inline-flex;align-items:center}.vertical[_nghost-%COMP%]{flex-direction:column}[_nghost-%COMP%] > mw-img-icon[_ngcontent-%COMP%]{margin-right:2px}"]});let n=e;return n})();function YC(n,e){if(n&1&&(g(0,"div",0),xe(1,"safeHtml")),n&2){let i=m().$implicit;f("innerHTML",Me(1,1,i.htmlContent),qi)}}function KC(n,e){if(n&1&&(a(0,"div"),g(1,"mw-res-label",2),l()),n&2){let i=m().$implicit;c(),f("amount",i.count)("resType",i.resType)("iconSize",i.iconSize??82)}}function ZC(n,e){if(n&1&&(a(0,"div"),g(1,"mw-res-label",2),l()),n&2){let i=e.$implicit;c(),f("amount",i.count)("resType",i.resType)("iconSize",82)}}function XC(n,e){if(n&1&&(a(0,"div",1),P(1,ZC,2,3,"div",null,j),l()),n&2){let i=m().$implicit;c(),E(i.resources)}}function QC(n,e){if(n&1&&x(0,YC,2,3,"div",0)(1,KC,2,3,"div")(2,XC,3,0,"div",1),n&2){let i,t=e.$implicit,o=m();M((i=t.type)===o.DescriptionType.FreeHtml?0:i===o.DescriptionType.Resource?1:i===o.DescriptionType.Resources?2:-1)}}var JC=n=>n.map(e=>typeof e=="string"?{type:tt.FreeHtml,htmlContent:e}:e),si=(()=>{let e=class e{constructor(){this.descriptions=N.required({transform:JC}),this.DescriptionType=tt}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-description"]],inputs:{descriptions:[1,"descriptions"]},standalone:!1,decls:2,vars:0,consts:[[3,"innerHTML"],[1,"resources"],["display","vertical",3,"amount","resType","iconSize"]],template:function(o,r){o&1&&P(0,QC,3,1,null,null,j),o&2&&E(r.descriptions())},dependencies:[Wt,en],styles:[`mw-description>.spell-descr{font-size:13px}mw-description .spell-stats{padding:7px 3px 3px;font-size:12px;line-height:18px;color:#434040}mw-description .spell-stats>.stat>.value{font-weight:600}mw-description .item-mods{padding:0 5px 5px}mw-description .item-mods>.item-mod{font-size:12px}.resources{display:flex;justify-content:center}
`],encapsulation:2,changeDetection:0});let n=e;return n})();var v0=2e3,Tc=(()=>{let e=class e{constructor(){this.elementRef=ti(),this.renderer=as(),this.message=N.required(),this.messageExpired=mn(),this.DescriptionType=tt}ngOnInit(){setTimeout(()=>{this.renderer.addClass(this.elementRef,"visible")},0);let t=this.message();setTimeout(()=>{this.renderer.addClass(this.elementRef,"hidden")},(t.delay||v0)-400),setTimeout(()=>{this.messageExpired.emit()},t.delay||v0)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-event-feed-message"]],inputs:{message:[1,"message"]},outputs:{messageExpired:"messageExpired"},standalone:!1,decls:1,vars:1,consts:[[3,"descriptions"]],template:function(o,r){o&1&&g(0,"mw-description",0),o&2&&f("descriptions",r.message().message)},styles:["[_nghost-%COMP%]{background:#414141;display:inline-block;color:#fff;font-size:13px;border-radius:4px;display:block;padding:3px 10px 3px 5px;overflow:hidden;height:0;opacity:0;position:relative;translate:50% -20px;transition:.4s;text-align:center}.visible[_nghost-%COMP%]{height:100%;translate:50% 0px;opacity:1}.hidden[_nghost-%COMP%]{height:0;opacity:0}"]});let n=e;return n})();var co=(()=>{let e=class e{constructor(){this.visibleMessages=k([]),this.updatableRefs=[]}pushEventFeedMessage(t){this.visibleMessages().push(t),this.updatableRefs.forEach(o=>o.updateView())}pushPlainMessage(t){let o={message:[{htmlContent:t,type:tt.FreeHtml}],delay:2600};this.pushEventFeedMessage(o),this.updatableRefs.forEach(r=>r.updateView())}pushSystemError(t){let o={message:[{htmlContent:`<div style="background: red; font-size: 15px; font-weight: 500">${t.message}</div>`,type:tt.FreeHtml}],delay:5e3};this.pushEventFeedMessage(o)}removeMessage(t){this.visibleMessages.update(o=>z.removeItemCopy(o,t))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function ew(n,e){if(n&1){let i=I();a(0,"mw-event-feed-message",1),y("messageExpired",function(){let o=w(i).$implicit,r=m();return S(r.removeMessage(o))}),l()}if(n&2){let i=e.$implicit;f("message",i)}}var Qa=(()=>{let e=class e{constructor(){this.eventFeed=u(co),this.cdr=An(),this.eventFeed.updatableRefs.push(this),Qh(()=>z.removeItem(this.eventFeed.updatableRefs,this))}updateView(){this.cdr.markForCheck()}removeMessage(t){this.eventFeed.removeMessage(t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-event-feed"]],standalone:!1,decls:2,vars:0,consts:[[3,"message"],[3,"messageExpired","message"]],template:function(o,r){o&1&&P(0,ew,1,1,"mw-event-feed-message",0,j),o&2&&E(r.eventFeed.visibleMessages())},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;pointer-events:none;-webkit-user-select:none;user-select:none}mw-event-feed-message[_ngcontent-%COMP%]{margin-bottom:3px}"]});let n=e;return n})();var iw=["mw-main-button",""],nw=["*"],ee=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["button","mw-main-button",""]],standalone:!1,attrs:iw,ngContentSelectors:nw,decls:1,vars:0,template:function(o,r){o&1&&(lt(),Xe(0))},styles:["[_nghost-%COMP%]{display:block;max-width:100%;padding:10px;background:#6478bb;color:#fff;text-align:center;margin:4px;cursor:pointer;-webkit-user-select:none;user-select:none;border:none;font-family:segoe ui;font-size:15px}[_nghost-%COMP%]:hover{background:#5a6793}[_nghost-%COMP%]:active{background:#4f5a7e}[_nghost-%COMP%]:disabled{background:#939ec4;color:#cfcfcf}"]});let n=e;return n})();var ow=[[["","popupHeader",""]],[["","popupContent",""]],"*"],rw=["[popupHeader]","[popupContent]","*"],we=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-popup-base-content"]],standalone:!1,ngContentSelectors:rw,decls:3,vars:0,template:function(o,r){o&1&&(lt(ow),Xe(0),Xe(1,1),Xe(2,2,["ngProjectAs","[popupButtons]",5,["","popupButtons",""]]))},styles:[`mw-popup-base-content{display:block;padding:16px}mw-popup-base-content [popupHeader]{text-align:center;margin-bottom:4px}mw-popup-base-content [popupContent]{text-align:center}mw-popup-base-content [popupContent] .sub-info p{margin:0;font-size:12px}mw-popup-base-content [popupButtons]{display:flex;justify-content:center;gap:4px;margin-top:4px}
`],encapsulation:2});let n=e;return n})();var Ic=(()=>{let e=class e extends ye{constructor(){super()}goToMainScreen(){location.reload()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-game-over-popup"]],standalone:!1,features:[V],decls:8,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",2,"margin","auto",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2,"Game Over"),l(),a(3,"div",1),p(4,"Go to main menu?"),l(),a(5,"div",2)(6,"button",3),y("click",function(){return r.goToMainScreen()}),p(7,"Accept"),l()()())},dependencies:[ee,we],styles:["[_nghost-%COMP%]{text-align:center}"]});let n=e;return n})();function sw(n,e){n&1&&We(0)}function aw(n,e){if(n&1&&(a(0,"div",1),K(1,sw,1,0,"ng-container",2),l()),n&2){let i=e.$implicit;kh(i.style),se("top",i.offsetTop,"px")("right",i.offsetRight,"px")("left",i.offsetLeft,"px")("bottom",i.offsetBottom,"px"),c(),f("ngTemplateOutlet",i.template)}}var kc=(()=>{let e=class e{constructor(){this.hints=[]}createHint(t,o,r){let s=t.nativeElement,{left:d,top:h,bottom:_}=s.getBoundingClientRect(),C=null,O=h+s.clientHeight/2,R=null,Q="transform: translateY(-50%)",de=null;switch(r){case"after":C=d+s.clientWidth;break;case"before":R=window.innerWidth-d;break;case"above":O=null,Q="transform: translateX(-50%)",de=window.innerHeight-_+s.clientHeight,C=d+s.clientWidth/2;break;case"below":O=_,Q="transform: translateX(-50%)",C=d+s.clientWidth/2}let Ie={targetElement:t,template:o,offsetLeft:C,offsetBottom:de,offsetTop:O,offsetRight:R,style:Q};return this.hints.push(Ie),Ie}removeHint(t){let o=this.hints.indexOf(t);this.hints.splice(o,1)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-hints-container"]],standalone:!1,decls:2,vars:0,consts:[[1,"hint",3,"top","right","left","bottom","style"],[1,"hint"],[4,"ngTemplateOutlet"]],template:function(o,r){o&1&&P(0,aw,2,11,"div",0,le),o&2&&E(r.hints)},dependencies:[Gt],styles:[".container[_ngcontent-%COMP%]{width:0}.hint[_ngcontent-%COMP%]{position:absolute;z-index:10000}"]});let n=e;return n})();var ys=(()=>{let e=class e{constructor(){this.activeMenusCount=0,this.activeMenus=new Set,this.clickOutsideMenu$=_i(window,"click").pipe(Ai(()=>this.activeMenusCount>0)),this.clickOutsideMenu$.subscribe(t=>{let o=t.target,r=o.closest(".menu-hint"),s=o.closest("mw-menu");!r&&!s&&this.closeAllActiveMenus(),s||this.closeClosableMenus()})}closeAllActiveMenus(){this.activeMenus.forEach(t=>this.containerRef.removeHint(t.currentHintRef)),this.activeMenus.clear()}closeClosableMenus(){this.activeMenus.forEach(t=>{t.closeOnClick&&this.containerRef.removeHint(t.currentHintRef),this.activeMenus.delete(t)})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var cw=["elem"],dw=["generalHint"],pw=["*"];function uw(n,e){n&1&&We(0)}function mw(n,e){if(n&1&&(a(0,"div",3),K(1,uw,1,0,"ng-container",4),l()),n&2){let i=m();se("transition",i.transition,"s"),f("ngClass",i.showHintAnimation?"show-hint":"hide-hint"),c(),f("ngTemplateOutlet",i.hintBody)}}var Or=(()=>{let e=class e{constructor(t){this.hintsService=t,this.transition=.15,this.hintPos="after",this.showHintAnimation=!1,this.showTimeoutId=null,this.currentHintRef=null}ngOnDestroy(){this.onMouseLeave()}onMouseEnter(){this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.hintPos),this.showTimeoutId=window.setTimeout(()=>{this.clearShowTimeout(),this.showHintAnimation=!0},0)}onMouseLeave(){this.clearShowTimeout(),this.showHintAnimation=!1;let t=this.currentHintRef;this.currentHintRef=null,window.setTimeout(()=>{this.hintsService.containerRef.removeHint(t)},this.transition*1e3)}clearShowTimeout(){this.showTimeoutId&&window.clearTimeout(this.showTimeoutId),this.showTimeoutId=null}};e.\u0275fac=function(o){return new(o||e)(G(ys))},e.\u0275cmp=v({type:e,selectors:[["mw-hover-hint"]],viewQuery:function(o,r){if(o&1&&(Et(cw,7),Et(dw,7)),o&2){let s;_t(s=vt())&&(r.elem=s.first),_t(s=vt())&&(r.generalHint=s.first)}},inputs:{hintBody:"hintBody",transition:"transition",hintPos:"hintPos"},standalone:!1,ngContentSelectors:pw,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"mouseenter","mouseleave"],[1,"hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(o,r){if(o&1){let s=I();lt(),a(0,"div",2,0),y("mouseenter",function(){return w(s),S(r.onMouseEnter())})("mouseleave",function(){return w(s),S(r.onMouseLeave())}),Xe(2),l(),K(3,mw,2,4,"ng-template",null,1,ve)}},dependencies:[Zi,Gt],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let n=e;return n})();var fw=["*"];function gw(n,e){if(n&1&&g(0,"i",1),n&2){let i=m();Yi("ra-"+i.icon)}}var Fr=(()=>{let e=class e{constructor(){this.disabled=!1}click(){return!this.disabled}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-icon-btn"]],hostVars:2,hostBindings:function(o,r){o&1&&y("click",function(){return r.click()}),o&2&&me("disabled",r.disabled)},inputs:{icon:"icon",disabled:"disabled"},standalone:!1,ngContentSelectors:fw,decls:2,vars:1,consts:[[1,"ra",3,"class"],[1,"ra"]],template:function(o,r){o&1&&(lt(),x(0,gw,1,2,"i",0),Xe(1)),o&2&&M(r.icon?0:-1)},styles:["[_nghost-%COMP%]{display:inline-block;font-size:30px;color:#fff;background:#55575a;cursor:pointer;border-radius:5px}.disabled[_nghost-%COMP%]{filter:brightness(.7);pointer-events:none}"]});let n=e;return n})();var Ac=(()=>{let e=class e{constructor(){this.item=N(),this.itemBase=N.required(),this.descriptions=ae(()=>{let t=this.item()?.baseType||this.itemBase();return t.description({thisItem:this.item(),thisItemBase:t}).descriptions})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-description"]],inputs:{item:[1,"item"],itemBase:[1,"itemBase"]},standalone:!1,decls:1,vars:1,consts:[[3,"descriptions"]],template:function(o,r){o&1&&g(0,"mw-description",0),o&2&&f("descriptions",r.descriptions())},encapsulation:2,changeDetection:0});let n=e;return n})();var yw=(n,e)=>({color:n,background:e}),Oc=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-icon-base"]],inputs:{icon:"icon",itemColor:"itemColor",bgColor:"bgColor"},standalone:!1,decls:2,vars:5,consts:[[1,"player-item","item-icon",3,"ngStyle"],[3,"icon"]],template:function(o,r){o&1&&(a(0,"div",0),g(1,"mw-ra-icon",1),l()),o&2&&(f("ngStyle",Oi(2,yw,r.itemColor,r.bgColor)),c(),f("icon",r.icon))},dependencies:[Qn,Ce],styles:[".player-item[_ngcontent-%COMP%]{width:64px;height:32px;padding:6px 0;box-sizing:border-box;border:1px solid gray;border-radius:6px;margin:1px}.item-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden}"]});let n=e;return n})();var _w=(n,e)=>({color:n,background:e});function vw(n,e){if(n&1&&(a(0,"div",3)(1,"div",4)(2,"div",5),g(3,"mw-ra-icon",6),l(),a(4,"div",7),p(5),a(6,"div",8),p(7),l()()(),a(8,"div",9),g(9,"mw-item-description",10),l()()),n&2){let i=m();c(2),f("ngStyle",Oi(6,_w,i._itemBase.icon.iconClr,i._itemBase.icon.bgClr)),c(),f("icon",i._itemBase.icon.icon),c(2),D(" ",i._itemBase.name," "),c(2),H(i._itemBase.slotType),c(2),f("item",i._item)("itemBase",i._itemBase)}}var tn=(()=>{let e=class e{constructor(){this.hintPos="above"}set item(t){this._itemBase=t.baseType,this._item=t}set itemBase(t){this._itemBase=t}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-icon"]],inputs:{item:"item",itemBase:"itemBase",hintPos:"hintPos"},standalone:!1,decls:4,vars:5,consts:[["hint",""],[3,"hintBody","hintPos"],[3,"icon","itemColor","bgColor"],[2,"max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[3,"icon"],[2,"padding","4px 8px 8px","font-size","14px"],[2,"font-size","9px","color","gray"],[2,"padding","0 8px 8px","font-size","13px"],[3,"item","itemBase"]],template:function(o,r){if(o&1&&(a(0,"mw-hover-hint",1),g(1,"mw-item-icon-base",2),K(2,vw,10,9,"ng-template",null,0,ve),l()),o&2){let s=ce(3);f("hintBody",s)("hintPos",r.hintPos),c(),f("icon",r._itemBase.icon.icon)("itemColor",r._itemBase.icon.iconClr)("bgColor",r._itemBase.icon.bgClr)}},styles:[".tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}"]});let n=e;return n})();function F(n,e,i,t){var o=arguments.length,r=o<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,i):t,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,i,t);else for(var d=n.length-1;d>=0;d--)(s=n[d])&&(r=(o<3?s(r):o>3?s(e,i,r):s(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r}function Cw(n,e){if(n&1&&(a(0,"div"),g(1,"mw-item-icon",3),l()),n&2){let i=m();c(),f("item",i.equippedItem)("itemBase",i.equippedItem.baseType)("hintPos",i.hintPos)}}function ww(n,e){if(n&1&&g(0,"mw-item-icon-base",2),n&2){let i=m();f("icon",i.slotInfo.icon)}}function Sw(n,e){if(n&1){let i=I();a(0,"mw-item-icon",8),y("click",function(){let o=w(i).$implicit,r=m(3);return S(r.equipItem(o))}),l()}if(n&2){let i=e.$implicit;f("item",i)("itemBase",i.baseType)}}function bw(n,e){if(n&1){let i=I();a(0,"div",4)(1,"mw-item-icon-base",6),y("click",function(){w(i);let o=m(2);return S(o.unequipSlot())}),l(),P(2,Sw,1,2,"mw-item-icon",7,le),l()}if(n&2){let i=m(2);c(2),E(i.availableItemsForSlot)}}function xw(n,e){if(n&1&&(a(0,"div",5),p(1),l()),n&2){let i=m(2);c(),D(' No items For "',i.slotInfo.name,'" slot ')}}function Mw(n,e){if(n&1&&x(0,bw,4,0,"div",4)(1,xw,2,1,"div",5),n&2){let i=m();M(i.availableItemsForSlot.length?0:1)}}var _s=class _s extends Te(){constructor(e){super(),this.playersService=e,this.hintPos="after",this.isEquipped=!1,this.equippedItem=null,this.availableItemsForSlot=[],this.hero=this.playersService.getCurrentPlayer().hero}ngOnChanges(e){let i=e.itemSlot;if(i){let t=i.currentValue;this.slotInfo=Vi.getSlotExtendedInfo(t);let o=this.hero.inventory;this.isEquipped=o.isSlotEquipped(t),this.equippedItem=o.getItemInSlot(t),this.availableItemsForSlot=Vi.filterItemsForSlot(t,this.hero.itemsBackpack)}}updateItems(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Vi.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack))}removeItem(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Vi.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack),this.equippedItem=null,this.isEquipped=!1)}updateSlotOnEquip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=e.item,this.isEquipped=!0)}updateSlotOnUnequip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=null,this.isEquipped=!1)}equipItem(e){this.equippedItem!==e&&(this.equippedItem&&this.unequipSlot(),this.events.dispatch(yr({item:e,player:this.playersService.getCurrentPlayer()})))}unequipSlot(){this.isEquipped&&this.equippedItem&&this.events.dispatch(Do({item:this.equippedItem,player:this.playersService.getCurrentPlayer()}))}};_s.\u0275fac=function(i){return new(i||_s)(G($))},_s.\u0275cmp=v({type:_s,selectors:[["mw-item-slot"]],inputs:{itemSlot:"itemSlot",hintPos:"hintPos"},standalone:!1,features:[V,bt],decls:5,vars:2,consts:[["itemsMenuBody",""],["pos","below",3,"menuBody"],["bgColor","white","itemColor","gray",1,"hoverable",3,"icon"],[1,"hoverable",3,"item","itemBase","hintPos"],[1,"items-menu"],[1,"no-items"],["bgColor","white","itemColor","gray","icon","cancel",1,"hoverable",3,"click"],["hintPos","above",1,"hoverable",3,"item","itemBase"],["hintPos","above",1,"hoverable",3,"click","item","itemBase"]],template:function(i,t){if(i&1&&(a(0,"mw-menu",1),x(1,Cw,2,3,"div")(2,ww,1,1,"mw-item-icon-base",2),l(),K(3,Mw,2,1,"ng-template",null,0,ve)),i&2){let o=ce(4);f("menuBody",o),c(),M(t.isEquipped?1:2)}},styles:["mw-item-icon-base[_ngcontent-%COMP%]{cursor:pointer}.items-menu[_ngcontent-%COMP%]{max-width:233px;width:200px;display:flex;flex-wrap:wrap;padding:6px;justify-content:center}.no-items[_ngcontent-%COMP%]{text-align:center;width:150px;font-size:12px;color:gray;padding:10px}.hoverable[_ngcontent-%COMP%]{cursor:pointer}"]});var nn=_s;F([Y(gn)],nn.prototype,"updateItems",null);F([Y(gr)],nn.prototype,"removeItem",null);F([Y(yr)],nn.prototype,"updateSlotOnEquip",null);F([Y(Do)],nn.prototype,"updateSlotOnUnequip",null);function Rc(n){let e=u(gs).escape$.subscribe(()=>n());u(_o).onDestroy(()=>e.unsubscribe())}var Bc=(()=>{let e=class e extends ye{constructor(){super(),this.events=u(oe),this.state=u(fe),this.state.mainMenu.isOpen=!0,Rc(()=>this.close())}ngOnDestroy(){this.state.mainMenu.isOpen=!1}openSettings(){this.events.dispatch(Cr())}openGlossary(){this.events.dispatch(wr())}quitTheGame(){location.reload()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-main-menu-popup"]],standalone:!1,features:[V],decls:11,vars:0,consts:[[2,"text-align","center"],[2,"display","flex","flex-direction","column"],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"div",0),p(1,"Main Menu"),l(),a(2,"div",1)(3,"button",2),y("click",function(){return r.close()}),p(4,"Return to the Game"),l(),a(5,"button",2),y("click",function(){return r.openGlossary()}),p(6,"Glossary"),l(),a(7,"button",2),y("click",function(){return r.openSettings()}),p(8,"Settings"),l(),a(9,"button",2),y("click",function(){return r.quitTheGame()}),p(10,"Quit"),l()())},dependencies:[ee],styles:["[_nghost-%COMP%]{padding:10px;display:block}button[_ngcontent-%COMP%]{min-width:165px;font-weight:600}"]});let n=e;return n})();var Pw=["elem"],Ew=["generalHint"],Tw=["*"];function Iw(n,e){n&1&&We(0)}function kw(n,e){if(n&1&&(a(0,"div",3),K(1,Iw,1,0,"ng-container",4),l()),n&2){let i=m();se("transition",i.transition,"s"),f("ngClass",i.showHintAnimation?"show-hint":"hide-hint"),c(),f("ngTemplateOutlet",i.menuBody)}}var Ja=(()=>{let e=class e{constructor(t,o){this.host=t,this.hintsService=o,this.transition=.15,this.pos="after",this.closeOnClick=!0,this.disabled=!1,this.showHintAnimation=!1,this.currentHintRef=null}onClick(){this.disabled||(this.hintsService.closeAllActiveMenus(),this.showHintAnimation=!0,this.hintsService.activeMenusCount+=1,this.hintsService.activeMenus.add(this),this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.pos))}clearHint(){this.currentHintRef=null}};e.\u0275fac=function(o){return new(o||e)(G(Ue),G(ys))},e.\u0275cmp=v({type:e,selectors:[["mw-menu"]],viewQuery:function(o,r){if(o&1&&(Et(Pw,7),Et(Ew,7)),o&2){let s;_t(s=vt())&&(r.elem=s.first),_t(s=vt())&&(r.generalHint=s.first)}},inputs:{menuBody:"menuBody",transition:"transition",pos:"pos",closeOnClick:"closeOnClick",disabled:"disabled"},standalone:!1,ngContentSelectors:Tw,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"click"],[1,"hint","menu-hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(o,r){if(o&1){let s=I();lt(),a(0,"div",2,0),y("click",function(){return w(s),S(r.onClick())}),Xe(2),l(),K(3,kw,2,4,"ng-template",null,1,ve)}},dependencies:[Zi,Gt],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let n=e;return n})();function Gc(n){n||(n=u(_o));let e=new tr(i=>n.onDestroy(i.next.bind(i)));return i=>i.pipe(Ge(e))}var Oo=(()=>{let e=class e{constructor(){this.hintMessage$=new un(null),this.disableActionHint$=new un(!1)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Lc=(()=>{let e=class e{static ngTemplateContextGuard(t,o){return!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["ng-template","mwTypedTemplate",""]],inputs:{typeToken:[0,"mwTypedTemplate","typeToken"]},standalone:!1});let n=e;return n})();var Du=n=>({hint:n});function Fw(n,e){n&1&&We(0)}function Rw(n,e){if(n&1&&K(0,Fw,1,0,"ng-container",5),n&2){m(2);let i=ce(6),t=q(0);f("ngTemplateOutlet",i)("ngTemplateOutletContext",ht(2,Du,t))}}function Bw(n,e){n&1&&We(0)}function Gw(n,e){if(n&1&&K(0,Bw,1,0,"ng-container",5),n&2){m(2);let i=ce(8),t=q(0);f("ngTemplateOutlet",i)("ngTemplateOutletContext",ht(2,Du,t))}}function Lw(n,e){n&1&&We(0)}function Nw(n,e){if(n&1&&K(0,Lw,1,0,"ng-container",5),n&2){m(2);let i=ce(4),t=q(0);f("ngTemplateOutlet",i)("ngTemplateOutletContext",ht(2,Du,t))}}function Uw(n,e){if(n&1&&(a(0,"div",3),x(1,Rw,1,4,"ng-container")(2,Gw,1,4,"ng-container")(3,Nw,1,4,"ng-container"),l()),n&2){let i,t=m(),o=q(0);c(),M((i=o.type)===t.hintActionTypes.OnHoverEnemyCard?1:i===t.hintActionTypes.OnTargetSpell?2:i===t.hintActionTypes.CustomHtml?3:-1)}}function Vw(n,e){if(n&1&&(g(0,"div",6),xe(1,"safeHtml")),n&2){let i=e.hint;f("innerHTML",Me(1,1,i.html),qi)}}function Hw(n,e){if(n&1&&p(0),n&2){let i=m().hint;D(" -",i.maxDamage," ")}}function jw(n,e){if(n&1&&p(0),n&2){let i=m().hint;D(" -",i.maxCountLoss,`
`)}}function $w(n,e){if(n&1&&(a(0,"span"),p(1,"Attack"),l(),a(2,"span"),p(3),l(),a(4,"span"),p(5," dealing "),l(),a(6,"span"),p(7),x(8,Hw,1,1),l(),a(9,"span"),p(10," damage, killing "),l(),a(11,"span"),p(12),x(13,jw,1,1),l(),a(14,"span"),p(15," units "),l()),n&2){let i=e.hint;c(2),se("color",i.attackedGroup.ownerPlayer.color),c(),D(" ",i.attackedGroup.type.name," "),c(4),D(" ",i.minDamage),c(),M(i.noDamageSpread?-1:8),c(4),D(" ",i.minCountLoss),c(),M(i.noLossSpread?-1:13)}}function zw(n,e){if(n&1&&(g(0,"div",6),xe(1,"safeHtml")),n&2){let i=m().hint;f("innerHTML",Me(1,1,i.addedContent),qi)}}function Ww(n,e){if(n&1&&(a(0,"div")(1,"span"),p(2," Cast "),l(),a(3,"span"),p(4),l(),a(5,"span"),p(6," on "),l(),a(7,"span"),p(8),l()(),a(9,"div"),p(10,"Press RMB to cancel"),l(),x(11,zw,2,3,"div",6)),n&2){let i=e.hint;c(4),D(" ",i.spell.name," "),c(4),D(" ",i.target.type.name," "),c(3),M(i.addedContent?11:-1)}}var Vn=(()=>{let e=class e{constructor(){this.actionHintService=u(Oo),this.hostElem=ti(),this.hintActionTypes=Kn,this.hint$=new un(null),ts([this.actionHintService.disableActionHint$,this.actionHintService.hintMessage$]).pipe(Xt(([t,o])=>t?null:o),ns(t=>{this.hostElem.classList.toggle("hidden",!t),this.hint$.next(t)}),Gc()).subscribe()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-action-hint"]],standalone:!1,decls:9,vars:7,consts:[["customHtml",""],["simple",""],["onTargetSpell",""],[2,"text-align","center"],[3,"mwTypedTemplate"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(o,r){if(o&1&&(Re(0),xe(1,"async"),x(2,Uw,4,1,"div",3),K(3,Vw,2,3,"ng-template",4,0,ve)(5,$w,16,7,"ng-template",4,1,ve)(7,Ww,12,3,"ng-template",4,2,ve)),o&2){let s=Ve(Me(1,4,r.hint$));c(2),M(s?2:-1),c(),f("mwTypedTemplate",r.customHtmlHintType),c(2),f("mwTypedTemplate",r.enemyCardHoverHintType),c(2),f("mwTypedTemplate",r.spellHintType)}},dependencies:[Gt,Lc,Xi,en],styles:["[_nghost-%COMP%]{pointer-events:none;width:fit-content;margin:auto;z-index:10000;display:block}.contrast[_nghost-%COMP%]{background-color:#090909b7;color:#fff;padding:2px 8px;border-radius:4px}.hidden[_nghost-%COMP%]{display:none}"]});let n=e;return n})();var Rr={1:0,2:285,3:400,4:475,5:545,6:600,7:650,8:700};var Fo=function(n){return n.HeroStatMods="hsMods",n.HeroItemMods="hiMods",n.CommonCombatMods="ccMods",n}(Fo||{});function Uc(n,e){let i=n.unitGroup;n.unitGroup=e.unitGroup,e.unitGroup=i}function w0(n){return n.filter(e=>!e.unitGroup).length}var S0=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.experience=0,this.level=1,this.freeSkillpoints=0,this.spells=[],this.modGroup=ii.empty(),this.unitAurasModGroup=ii.empty(),this.specialtiesModGroup=ii.empty(),this.weeklyActivitiesModGroup=ii.empty(),this.itemsBackpack=[],this.inventory=new Vi,this._unitGroups=[],this.state=new bn({baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,currentMana:0,maxMana:0}),this.destroyed$=new X,this.mainUnitSlots=[{unitGroup:null},{unitGroup:null},{unitGroup:null},{unitGroup:null}],this.reserveUnitSlots=[{unitGroup:null,isReserve:!0},{unitGroup:null,isReserve:!0}]}get ownerPlayer(){return this._ownerPlayer}get unitGroups(){return this._unitGroups}create({heroBase:t,unitGroups:o,ownerPlayer:r}){this.base=t,this.name=t.name;let s=t.initialState.stats;r&&(this._ownerPlayer=r),this.stats={currentMana:s.mana},o&&this.setUnitGroups(o),t.initialState.defaultModifiers&&this.modGroup.addModsRef(xt.fromMods(t.initialState.defaultModifiers)),this.modGroup.attachNamedParentGroup(mi.WeeklyMods,this.weeklyActivitiesModGroup)}addExperience(t,o=!1){if(t<=0)return;let r=t;o&&(r=z.increaseByPercent(t,this.weeklyActivitiesModGroup.getCalcNumModValueOrZero("experienceGainBonus"))),this.experience+=r;let s=Rr[this.level+1];s<=this.experience&&(this.level++,this.freeSkillpoints++,this.experience=this.experience-s,this.getApi().events.dispatch(Ma({newLevel:this.level,hero:this})))}getState(){return this.getStats()}addReserveSlots(t){for(let o=0;o<t;o++)this.reserveUnitSlots.push({unitGroup:null,isReserve:!0})}hasFreeUnitSlots(){return this.hasFreeMainSlots()||this.hasFreeReserveSlots()}hasFreeMainSlots(){return this.getFreeMainSlotsCount()!==0}hasFreeReserveSlots(){return this.getFreeReserveSlotsCount()!==0}getFreeUnitSlotsCount(){return this.getFreeMainSlotsCount()+this.getFreeReserveSlotsCount()}getFreeMainSlotsCount(){return w0(this.mainUnitSlots)}getFreeReserveSlotsCount(){return w0(this.reserveUnitSlots)}getMainFilledUnitSlots(){return this.mainUnitSlots.filter(t=>t.unitGroup)}updateUnitGroupPositions(){this.getMainFilledUnitSlots().forEach((t,o)=>{t?.unitGroup?.setPosition(o)})}getAllSlots(){return[...this.mainUnitSlots,...this.reserveUnitSlots]}getAllUnitsFromSlots(){return this.getAllSlots().map(t=>t.unitGroup).filter(Nl)}setUnitGroups(t,o=!0){this._unitGroups=t,this._unitGroups.forEach((r,s)=>{o&&(this.mainUnitSlots[s].unitGroup=r),this.updateUnitGroup(r)}),this.updateUnitGroupPositions()}addUnitGroup(t){let o=this.unitGroups.includes(t);if(this._unitGroups.push(t),this.updateUnitGroup(t),o)return;let r=this.mainUnitSlots.find(d=>!d.unitGroup);if(r){r.unitGroup=t,this.refreshUnitGroupsOrderBySlots();return}let s=this.reserveUnitSlots.find(d=>!d.unitGroup);s&&(s.unitGroup=t),this.refreshUnitGroupsOrderBySlots(),this.getApi().events.dispatch(Hp({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}removeUnitGroup(t){z.removeItem(this.unitGroups,t),this.getApi().events.dispatch(jp({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}refreshUnitGroupsOrderBySlots(){this._unitGroups=this.mainUnitSlots.map(t=>t.unitGroup).filter(Boolean)}assignOwnerPlayer(t){this._ownerPlayer=t;let o=this.base,r=o.initialState;this.spells=r.abilities.map(s=>this.getApi().spells.createSpellInstance(Le(s))),this.initParentModGroups(),this.setupStatsUpdating(o),this.updateUnitGroupPositions()}onDestroy(){Cc(this.destroyed$)}getStats(){return this.state.get()}getStateSignal(){return this.state.signal}listenHeroStats(){return this.state.observe().pipe(Ge(this.destroyed$))}addItem(t){this.itemsBackpack.push(t)}removeItem(t){z.removeItem(this.itemsBackpack,t),this.inventory.isItemEquipped(t)&&this.unequipItem(t)}equipItem(t){this.inventory.equipItem(t);let o=this.getItemModsGroup(),r=t.baseType;if(r.staticMods){let s=xt.fromMods(r.staticMods);o?.addModsRef(s)}r.bonusAbilities&&r.bonusAbilities.forEach(s=>{let d=this.getApi().spells.createSpellInstance(s.spell,{initialLevel:s.level});d.setSourceGameObjectId(t.id),this.spells.push(d)})}unequipItem(t){this.inventory.unequipItem(t);let o=this.getItemModsGroup();t.baseType.staticMods&&o&&o.removeRefByModInstance(t.baseType.staticMods),this.spells=this.spells.filter(r=>r.sourceInfo.gameObjectId!==t.id)}addCommonCombatMods(t){this.modGroup.getNamedGroup(Fo.CommonCombatMods)?.addModsRef(t)}clearCommonCombatMods(){this.modGroup.getNamedGroup(Fo.CommonCombatMods)?.clearOwnModRefs()}updateUnitsSpecialtyAndConditionalMods(){this.unitGroups.forEach(t=>this.updateUnitSpecialtyAndConditionalMods(t))}updateUnitSpecialtyAndConditionalMods(t){t.clearSpecialtyAndConditionalMods(),this.modGroup.getAllModValues("__unitConditionalMods").map(s=>s(t)).filter(Boolean).forEach(s=>t.attachSpecialtyMods(s));let r=t.type.getUnitTypeSpecialtyModifiers?.(this.specialtiesModGroup.getMods());r&&t.attachSpecialtyMods(r)}addStatsMods(t){this.modGroup.getNamedGroup(Fo.HeroStatMods)?.addModsRef(xt.fromMods(t))}addMana(t){this.stats.currentMana+=t;let o=this.getStats().maxMana;this.stats.currentMana>o&&(this.stats.currentMana=o),this.state.patch({currentMana:this.stats.currentMana})}updateUnitGroup(t){t.assignOwnerPlayer(this.ownerPlayer),t.assignOwnerHero(this),this.updateUnitSpecialtyAndConditionalMods(t)}getItemModsGroup(){return this.modGroup.getNamedGroup(Fo.HeroItemMods)}initParentModGroups(){this.modGroup.attachNamedParentGroup(Fo.HeroItemMods,ii.empty()),this.modGroup.attachNamedParentGroup(Fo.HeroStatMods,ii.empty()),this.modGroup.attachNamedParentGroup(Fo.CommonCombatMods,ii.empty())}setupStatsUpdating(t){this.modGroup.onValueChanges().pipe(Ge(this.destroyed$)).subscribe(o=>{this.specialtiesModGroup.clearOwnModRefs(),this.specialtiesModGroup.addModsRef(xt.fromMods(ef(o))),this.updateUnitsSpecialtyAndConditionalMods();let{baseAttack:r,baseDefence:s,mana:d}=t.initialState.stats,h=o.heroBonusAttack||0,_=o.heroBonusDefence||0,C=o.resistAll||0,O=(o.heroMaxMana||0)+d;this.stats.currentMana>O&&(this.stats.currentMana=O);let R={baseAttack:r,bonusAttack:h,finalAttack:r+h,baseDefence:s,bonusDefence:_,finalDefence:s+_,fireResist:(o.resistFire||0)+C,coldResist:(o.resistCold||0)+C,lightningResist:(o.resistLightning||0)+C,poisonResist:(o.resistPoison||0)+C,currentMana:this.stats.currentMana,maxMana:O};this.state.set(R)})}};e.categoryId="hero";let n=e;return n})();var el=(()=>{let e=class e{constructor(t){this.players=t,this.currentPlayer=this.players.getCurrentPlayer(),this.xpToNextLevel=Rr[this.currentPlayer.hero.level+1]}};e.\u0275fac=function(o){return new(o||e)(G($))},e.\u0275cmp=v({type:e,selectors:[["mw-experience-bar"]],standalone:!1,decls:2,vars:2,consts:[[1,"experience-bar"],[1,"experience-progress"]],template:function(o,r){o&1&&(a(0,"div",0),g(1,"div",1),l()),o&2&&(c(),se("width",r.currentPlayer.hero.experience/r.xpToNextLevel*100,"%"))},styles:["[_nghost-%COMP%]{display:block}.experience-bar[_ngcontent-%COMP%]{background:#80808074}.experience-progress[_ngcontent-%COMP%]{background:#4c1f5e;height:3px}"]});let n=e;return n})();function Yw(n,e){if(n&1&&g(0,"mw-item-slot",5),n&2){let i=e.$implicit;f("mwActionHint",i.name)("itemSlot",i.slotType)}}function Kw(n,e){if(n&1){let i=I();a(0,"div",11),y("click",function(){w(i);let o=m().$implicit,r=m();return S(r.displayUnitGroupInfo(o.unitGroup))})("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.displayUnitGroupInfo(o.unitGroup))}),a(1,"div",12),p(2),l(),a(3,"div"),p(4),l()()}if(n&2){let i=m().$implicit,t=m();se("background",t.player.color),f("mwActionHint","Inspect group of "+i.unitGroup.count+" "+i.unitGroup.type.name),c(2),H(i.unitGroup.type.name),c(2),H(i.unitGroup.count)}}function Zw(n,e){if(n&1&&x(0,Kw,5,5,"div",10),n&2){let i=e.$implicit;M(i.unitGroup?0:-1)}}function Xw(n,e){if(n&1){let i=I();a(0,"div",14),y("click",function(){w(i);let o=m().$implicit,r=m();return S(r.displayUnitGroupInfo(o.unitGroup))})("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.displayUnitGroupInfo(o.unitGroup))}),a(1,"div",12),p(2),l(),a(3,"div"),p(4),l()()}if(n&2){let i=m().$implicit,t=m();se("background",t.player.color),f("mwActionHint","Inspect group of "+i.unitGroup.count+" "+i.unitGroup.type.name),c(2),H(i.unitGroup.type.name),c(2),H(i.unitGroup.count)}}function Qw(n,e){if(n&1&&x(0,Xw,5,5,"div",13),n&2){let i=e.$implicit;M(i.unitGroup?0:-1)}}var Br=(()=>{let e=class e{constructor(t,o){this.players=t,this.events=o,this.state=u(fe),this.player=this.players.getCurrentPlayer(),this.itemSlots=Vi.getExtendedSlotTypes()}openPlayerInfo(){this.events.dispatch(pr())}getHeroActionHint(){let t=this.player.hero,o=t.level+1;return`
    <div>${Rr[o]-t.experience}xp is required to reach Level ${o}</div>
    <div>(${t.experience}/${Rr[o]})</div>
    `}displayUnitGroupInfo(t){this.events.dispatch(Rn({unitGroup:t}))}};e.\u0275fac=function(o){return new(o||e)(G($),G(oe))},e.\u0275cmp=v({type:e,selectors:[["mw-player-info-panel"]],standalone:!1,decls:17,vars:10,consts:[["mwActionHint","Inspect Hero",1,"hero-image",2,"cursor","pointer",3,"click","mwNoContextMenu"],["color","linear-gradient(0deg, rgb(121 45 0), rgb(226 209 33))",1,"action-points-bar",3,"maxValue","diffBar","currentValue","barHeight","mwActionHint"],["icon","feather-wing"],[1,"hero-info"],[2,"display","flex","flex-direction","row"],["hintPos","above",1,"info-small-icons",3,"mwActionHint","itemSlot"],[3,"mwActionHint"],[2,"width","270px"],[1,"action-points"],[1,"groups-container"],[1,"player-group-card",3,"background","mwActionHint"],[1,"player-group-card",3,"click","mwNoContextMenu","mwActionHint"],[1,"group-name"],[1,"player-group-card","reserve",3,"background","mwActionHint"],[1,"player-group-card","reserve",3,"click","mwNoContextMenu","mwActionHint"]],template:function(o,r){o&1&&(a(0,"div",0),y("click",function(){return r.openPlayerInfo()})("mwNoContextMenu",function(){return r.openPlayerInfo()}),l(),a(1,"mw-value-bar",1),g(2,"mw-ra-icon",2),l(),a(3,"div",3)(4,"div")(5,"div",4),P(6,Yw,1,2,"mw-item-slot",5,le),l()(),a(8,"div",6),p(9),g(10,"mw-experience-bar",7),l(),g(11,"div",8),a(12,"div",9),P(13,Zw,1,1,null,null,le),P(15,Qw,1,1,null,null,le),l()()),o&2&&(se("background-image","url('"+r.player.hero.base.image+"')"),c(),f("maxValue",4)("diffBar",!1)("currentValue",r.state.currentGame.actionPoints)("barHeight",17)("mwActionHint","You have "+r.state.currentGame.actionPoints+" action points left <br>before next day arrives."),c(5),E(r.itemSlots),c(2),f("mwActionHint",r.getHeroActionHint()),c(),Ee(" ",r.player.hero.name,", Level: ",r.player.hero.level," "),c(4),E(r.player.hero.mainUnitSlots),c(2),E(r.player.hero.reserveUnitSlots))},styles:["[_nghost-%COMP%]{display:flex}.groups-container[_ngcontent-%COMP%]{display:flex}.action-points-bar[_ngcontent-%COMP%]{border-radius:7px;overflow:hidden;border:2px solid #6b3c0a;background-color:#6b3c0a;letter-spacing:2px;width:100px;position:absolute;bottom:7px;left:10px}.action-points[_ngcontent-%COMP%]{margin:4px 0}.hero-info[_ngcontent-%COMP%]{align-self:end;margin-bottom:6px}.hero-image[_ngcontent-%COMP%]{background-size:cover;width:100px;height:100px;border-radius:50%;border:4px solid gray;margin:8px;align-self:end}.player-group-card[_ngcontent-%COMP%]{height:48px;width:48px;color:#fff;display:flex;flex-direction:column;justify-content:center;text-align:center;border-radius:4px;font-size:11px;margin:3px;cursor:pointer}.player-group-card.reserve[_ngcontent-%COMP%]{height:40px;width:40px;font-size:10px;filter:brightness(.7)}.group-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.skillpoints[_ngcontent-%COMP%]{border:1px solid gold;padding:3px;font-size:12px;cursor:pointer;margin:3px;max-width:200px}"]});let n=e;return n})();function Jw(n,e){if(n&1){let i=I();a(0,"div",2),y("click",function(){let o=w(i).$implicit,r=m();return S(r.displayUnitGroupInfo(o))})("mwNoContextMenu",function(){let o=w(i).$implicit,r=m();return S(r.displayUnitGroupInfo(o))}),a(1,"div"),p(2),l(),a(3,"div"),p(4),l()()}if(n&2){let i=e.$implicit;se("background",i.ownerPlayer.color),f("mwActionHint","Inspect "+i.count+" "+i.type.name),c(2),H(i.type.name),c(2),H(i.count)}}var tl=(()=>{let e=class e{constructor(t){this.events=t}displayUnitGroupInfo(t){this.events.dispatch(Rn({unitGroup:t}))}};e.\u0275fac=function(o){return new(o||e)(G(oe))},e.\u0275cmp=v({type:e,selectors:[["mw-unit-groups-list"]],inputs:{unitGroups:"unitGroups"},standalone:!1,decls:3,vars:0,consts:[[1,"list"],[1,"group",3,"mwActionHint","background"],[1,"group",3,"click","mwNoContextMenu","mwActionHint"]],template:function(o,r){o&1&&(a(0,"div",0),P(1,Jw,5,5,"div",1,le),l()),o&2&&(c(),E(r.unitGroups))},styles:[".list[_ngcontent-%COMP%]{display:flex;justify-content:center}.group[_ngcontent-%COMP%]{height:64px;width:64px;font-size:13px;display:flex;justify-content:center;flex-direction:column;align-items:center;text-align:center;color:#fff;margin:3px;border-radius:5px;cursor:pointer}"]});let n=e;return n})();var il=(()=>{let e=class e{constructor(){this.state=u(fe),this.events=u(oe),this.players=u($),this.currentPlayer=this.players.getCurrentPlayer()}goToTown(){this.events.dispatch(ha())}openPlayerInfo(){this.events.dispatch(pr())}openActionCards(){this.events.dispatch(va())}openGarrison(){this.events.dispatch(fr())}setupCampAction(){let t=this.players.getCurrentPlayer();this.events.dispatch(xr({player:t,cardStack:t.actionCards.find(o=>o.card===rc)}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-player-map-actions-panel"]],standalone:!1,decls:13,vars:8,consts:[["icon","castle-emblem",3,"click","mwActionHint"],["mwActionHint","Inspect Hero","icon","aura",3,"click"],[1,"action-points",3,"click","mwActionHint"],[1,"action-info"],["icon","spades-card"],["mwActionHint","Learn new abilities"],["icon","barrier",3,"disabled"],[3,"mwActionHint"],["icon","guarded-tower",3,"click","disabled"],[1,"camp-action",3,"click","mwActionHint"],["icon","campfire"]],template:function(o,r){o&1&&(a(0,"mw-icon-btn",0),y("click",function(){return r.goToTown()}),l(),a(1,"mw-icon-btn",1),y("click",function(){return r.openPlayerInfo()}),l(),a(2,"mw-icon-btn",2),y("click",function(){return r.openActionCards()}),a(3,"div",3),g(4,"mw-ra-icon",4),a(5,"span"),p(6),l()()(),a(7,"div",5),g(8,"mw-icon-btn",6),l(),a(9,"div",7)(10,"mw-icon-btn",8),y("click",function(){return r.openGarrison()}),l()(),a(11,"mw-icon-btn",9),y("click",function(){return r.setupCampAction()}),g(12,"mw-ra-icon",10),l()),o&2&&(f("mwActionHint",Bl("Go to ",r.state.createdGame.faction.title)),c(2),f("mwActionHint","Action Cards<hr>"+r.state.currentGame.actionPoints+" action points left"),c(4),H(r.currentPlayer.actionCards.length),c(2),f("disabled",!0),c(),f("mwActionHint",r.currentPlayer.garrisons.size!==0?"Garrison":"Garrison <hr> No garrisons to hire"),c(),f("disabled",r.currentPlayer.garrisons.size===0),c(),f("mwActionHint","Set up Camp<hr>Skips current day"))},styles:["mw-icon-btn[_ngcontent-%COMP%]{text-align:center;min-width:70px;max-width:70px;min-height:40px;margin-bottom:4px}mw-icon-btn.action-points[_ngcontent-%COMP%]{font-weight:100;font-size:23px;padding-top:4px;box-sizing:border-box}mw-icon-btn[_ngcontent-%COMP%] > .action-info[_ngcontent-%COMP%]{margin-left:-2px}"]});let n=e;return n})();function iS(n,e){if(n&1){let i=I();a(0,"div",7),y("click",function(){let o=w(i).$implicit,r=m();return S(r.setActiveReward(o))}),g(1,"mw-ra-icon",8),a(2,"div",9),p(3),l()()}if(n&2){let i=e.$implicit,t=m();me("active",i===t.activeReward),c(),f("icon",i.display.icon),c(2),H(i.display.title)}}var Vc=(()=>{let e=class e extends ye{setActiveReward(t){this.activeReward=t}acceptReward(){this.activeReward.onSumbit(),this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-reward-popup"]],standalone:!1,features:[V],decls:13,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[1,"rewards"],[1,"reward",3,"active"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],[1,"reward",3,"click"],[3,"icon"],[1,"reward-title"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),l(),a(3,"div",1)(4,"div",2)(5,"p"),p(6),l()(),a(7,"div",3),P(8,iS,4,4,"div",4,le),l()(),a(10,"div",5)(11,"button",6),y("click",function(){return r.acceptReward()}),p(12," Accept "),l()()()),o&2&&(c(2),D(" ",r.data.title," "),c(4),H(r.data.subTitle),c(2),E(r.data.rewards),c(3),f("disabled",!r.activeReward))},dependencies:[Ce,ee,we],styles:[".title[_ngcontent-%COMP%]{font-size:16px;text-align:center}.sub-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}.rewards[_ngcontent-%COMP%]{display:flex;padding-top:10px;width:100%;justify-content:center}.reward[_ngcontent-%COMP%]{display:flex;width:120px;height:80px;align-items:center;justify-content:center;border:1px solid gray;flex-direction:column;margin:10px;cursor:pointer;-webkit-user-select:none;user-select:none}.reward.active[_ngcontent-%COMP%]{border:1px solid gold}.reward[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{font-size:30px}.reward[_ngcontent-%COMP%]   .reward-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}"]});let n=e;return n})();var Pu=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-round-icon"]],inputs:{icon:"icon"},standalone:!1,decls:1,vars:1,consts:[[3,"icon"]],template:function(o,r){o&1&&g(0,"mw-ra-icon",0),o&2&&f("icon",r.icon)},dependencies:[Ce],styles:["[_nghost-%COMP%]{border:5px solid rgb(105,105,105);border-radius:50%;width:28px;height:28px;background-color:gray;color:#fff;display:flex;font-size:20px;justify-content:center;align-items:center}"]});let n=e;return n})(),Hc=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-round-icon-btn"]],inputs:{icon:"icon"},standalone:!1,decls:1,vars:1,consts:[[3,"icon"]],template:function(o,r){o&1&&g(0,"mw-round-icon",0),o&2&&f("icon",r.icon)},dependencies:[Pu],styles:["mw-round-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}mw-round-icon[_ngcontent-%COMP%]:active{filter:brightness(.7)}"]});let n=e;return n})();var Eu=(()=>{let e=class e{constructor(t){this.template=t}ngOnInit(){console.log("------->>",this.templateName)}};e.\u0275fac=function(o){return new(o||e)(G(vi))},e.\u0275dir=pe({type:e,selectors:[["","mwSharedTemplate",""]],inputs:{templateName:[0,"mwSharedTemplate","templateName"]},standalone:!1});let n=e;return n})();function oS(n,e){if(n&1&&g(0,"mw-ra-icon",2),n&2){let i=e.data;f("icon",i.icon)}}function rS(n,e){n&1&&g(0,"mw-vfx-element")}var nl=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-shared-templates"]],standalone:!1,decls:2,vars:0,consts:[["mwSharedTemplate","icon"],["mwSharedTemplate","animation"],[3,"icon"]],template:function(o,r){o&1&&K(0,oS,1,1,"ng-template",0)(1,rS,1,0,"ng-template",1)},encapsulation:2});let n=e;return n})();var Gr=(()=>{let e=class e{constructor(){this.spell=N.required(),this.hero=N(),this.player=N.required(),this.ownerUnit=N(),this.descriptions=ae(()=>{let t=this.spell(),o=t.baseType.getDescription({thisSpell:t.baseType,spellInstance:t,ownerHero:this.hero(),ownerPlayer:this.player(),ownerUnit:this.ownerUnit()}).descriptions;return t.baseType.config.isOncePerBattle&&o.unshift({type:tt.FreeHtml,htmlContent:"Can be cast only once per battle.<br/><hr/>"}),o})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-spell-description"]],inputs:{spell:[1,"spell"],hero:[1,"hero"],player:[1,"player"],ownerUnit:[1,"ownerUnit"]},standalone:!1,decls:1,vars:1,consts:[[3,"descriptions"]],template:function(o,r){o&1&&g(0,"mw-description",0),o&2&&f("descriptions",r.descriptions())},encapsulation:2,changeDetection:0});let n=e;return n})();var jc=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.players=u($),this.gameObjects=u(je),this.events=u(oe),this.toSplit=0}upgadeValue(t){this.toSplit=Number(t.target.value)}displayUnitGroupInfo(){this.close(),setTimeout(()=>{this.events.dispatch(Rn({unitGroup:this.data.unitGroup}))},0)}split(){if(this.toSplit===0){this.close();return}let t=this.data.unitGroup,o=this.players.getCurrentPlayer().hero,r=this.gameObjects.createNewGameObject(wc,{count:this.toSplit,unitBase:t.type,ownerHero:o,isSplitted:!0});o.addUnitGroup(r),t.addUnitsCount(-this.toSplit),this.close()}closePopup(){this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-split-units-popup"]],standalone:!1,features:[V],decls:17,vars:5,consts:[["popupHeader",""],["popupContent",""],["type","range","min","0",3,"input","max","value"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2," Splitting Group "),l(),a(3,"div",1)(4,"div"),p(5),l(),a(6,"div")(7,"input",2),y("input",function(d){return r.upgadeValue(d)}),l(),a(8,"div"),p(9),l()()(),a(10,"div",3)(11,"button",4),y("click",function(){return r.split()}),p(12," Split "),l(),a(13,"button",4),y("click",function(){return r.displayUnitGroupInfo()}),p(14," Show Unit Info "),l(),a(15,"button",4),y("click",function(){return r.closePopup()}),p(16," Close "),l()()()),o&2&&(c(5),Ee(" ",r.popup.data.unitGroup.type.name," ",r.popup.data.unitGroup.count," "),c(2),f("max",r.popup.data.unitGroup.count-1)("value",r.toSplit),c(2),D(" To split: ",r.toSplit," "))},dependencies:[ee,we],encapsulation:2});let n=e;return n})();var ol=(()=>{let e=class e extends ye{};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-info-popup"]],standalone:!1,features:[V],decls:1,vars:1,consts:[[3,"unitGroup"]],template:function(o,r){o&1&&g(0,"mw-unit-group-info",0),o&2&&f("unitGroup",r.data.unitGroup)},encapsulation:2});let n=e;return n})();function lS(n,e){if(n&1&&g(0,"mw-description",13),n&2){let i=m();f("descriptions",i.description.descriptions)}}function cS(n,e){n&1&&p(0," No Description. ")}function dS(n,e){if(n&1&&g(0,"mw-unit-group-spell-icon",19),n&2){let i=e.$implicit,t=m(2);f("hero",t.unitGroup().ownerPlayer.hero)("spell",i)("hintPos","above")("owner",t.unitGroup())}}function pS(n,e){if(n&1&&(a(0,"div",17),g(1,"hr"),a(2,"div",3),p(3,"Abilities:"),l(),a(4,"div",18),P(5,dS,1,4,"mw-unit-group-spell-icon",19,le),l()()),n&2){let i=m();c(5),E(i.spells)}}function uS(n,e){if(n&1&&g(0,"mw-unit-group-spell-icon",19),n&2){let i=e.$implicit,t=m(2);f("hero",t.unitGroup().ownerPlayer.hero)("spell",i)("hintPos","above")("owner",t.unitGroup())}}function mS(n,e){if(n&1&&(a(0,"div",17),g(1,"hr"),a(2,"div",3),p(3,"Effects:"),l(),a(4,"div",18),P(5,uS,1,4,"mw-unit-group-spell-icon",19,le),l()()),n&2){let i=m();c(5),E(i.effects)}}var $c=(()=>{let e=class e{constructor(){this.unitGroup=N.required()}ngOnChanges(t){this.unitStats$=this.unitGroup().listenStats(),this.baseStats=this.unitGroup().type.baseStats;let o=this.unitGroup().spells;this.effects=o.filter(s=>s.isEffect()),this.spells=o.filter(s=>!s.isEffect());let r=this.unitGroup();this.description=r.type.getDescription?.({unit:r,unitBase:r.type})||{descriptions:[]}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-info"]],inputs:{unitGroup:[1,"unitGroup"]},standalone:!1,features:[bt],decls:60,vars:24,consts:[["size","big",1,"unit-portrait",3,"unitGroup","isHero"],[1,"main-group"],[1,"info-header"],[1,"title"],[1,"group"],[1,"tier"],[1,"stats"],[1,"col"],[1,"stat"],["icon","sword"],["icon","health"],["icon","spinning-sword"],[1,"description"],[3,"descriptions"],[1,"secondary-group"],[1,"hor-stats"],[3,"mwNumberModifier"],[1,"abilities"],[1,"abilities-list"],[3,"hero","spell","hintPos","owner"]],template:function(o,r){if(o&1&&(Re(0),xe(1,"async"),g(2,"mw-unit-group-portrait",0),a(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4),p(7),l(),a(8,"div",5),p(9),l()(),a(10,"div",6)(11,"div",7)(12,"div",8),g(13,"mw-ra-icon",9),p(14),l(),a(15,"div",8),g(16,"mw-ra-icon",10),p(17),l()(),a(18,"div",7)(19,"div",8),g(20,"mw-ra-icon",11),p(21),l()()()(),a(22,"div",12),g(23,"hr"),x(24,lS,1,1,"mw-description",13)(25,cS,1,0),l()(),a(26,"div",14)(27,"div",3),p(28,"Group Stats"),l(),g(29,"hr"),a(30,"div",6)(31,"div",7)(32,"div",8),g(33,"mw-ra-icon",9),p(34),l(),a(35,"div",8),g(36,"mw-ra-icon",10),p(37),l(),g(38,"hr"),a(39,"div",15)(40,"div",8)(41,"div"),p(42,"Attack:"),l(),a(43,"div"),p(44),g(45,"span",16),l()(),a(46,"div",8)(47,"div"),p(48,"Defence:"),l(),a(49,"div"),p(50),g(51,"span",16),l()(),a(52,"div",8)(53,"div"),p(54,"Speed"),l(),a(55,"div"),p(56),g(57,"span",16),l()()(),x(58,pS,7,0,"div",17),x(59,mS,7,0,"div",17),l()()()),o&2){let s=Me(1,22,r.unitStats$);c(2),f("unitGroup",r.unitGroup())("isHero",r.unitGroup().type.isHero),c(5),Ee(" ",r.unitGroup().count," ",r.unitGroup().type.name," "),c(2),D("Tier ",r.unitGroup().type.level),c(5),Ee(" ",r.baseStats.damageInfo.minDamage,"-",r.baseStats.damageInfo.maxDamage," "),c(3),D(" ",r.baseStats.health),c(4),D(" Turns per round: ",r.unitGroup().type.defaultTurnsPerRound," "),c(3),M(r.description.descriptions.length?24:25),c(10),Ah(" ",s.groupStats.totalMinDamage,"-",s.groupStats.totalMaxDamage," (avg. ",s.groupStats.avgTotalDamage,") "),c(3),D(" ",s.groupStats.totalHealth),c(7),D(" ",s.groupStats.baseAttack," "),c(),f("mwNumberModifier",s.groupStats.bonusAttack),c(5),D(" ",s.groupStats.baseDefence," "),c(),f("mwNumberModifier",s.groupStats.bonusDefence),c(5),D(" ",s.groupStats.baseSpeed," "),c(),f("mwNumberModifier",s.groupStats.speedBonus),c(),M(r.spells.length?58:-1),c(),M(r.effects.length?59:-1)}},styles:["[_nghost-%COMP%]{display:flex;width:570px}.unit-portrait[_ngcontent-%COMP%]{position:absolute;left:-60px;top:-42px}.info-header[_ngcontent-%COMP%]{display:flex;margin-left:64px;flex-direction:column;height:92px}.stats[_ngcontent-%COMP%]{margin-top:12px;font-size:13px;display:flex}.col[_ngcontent-%COMP%]{margin-left:8px}.tier[_ngcontent-%COMP%]{font-size:13px}.description[_ngcontent-%COMP%]{font-size:12px;max-width:360px}.secondary-group[_ngcontent-%COMP%]{width:202px;flex-grow:1;margin-left:8px}.secondary-group[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-align:center}.secondary-group[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{width:100%}.secondary-group[_ngcontent-%COMP%]   .abilities-list[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4px}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{padding-bottom:2px}"],changeDetection:0});let n=e;return n})();var rl=(()=>{let e=class e{constructor(){this.toRight=!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-portrait"]],hostVars:6,hostBindings:function(o,r){o&2&&(Yi(r.size),me("is-hero",r.isHero)("to-right",r.toRight))},inputs:{unitGroup:"unitGroup",isHero:"isHero",toRight:"toRight",size:"size"},standalone:!1,decls:2,vars:2,consts:[[1,"portrait",3,"src"],["src","assets/common/common-unit-frame.png",1,"portrait-frame"]],template:function(o,r){o&1&&g(0,"img",0)(1,"img",1),o&2&&f("src",Rl(r.unitGroup.type.mainPortraitUrl),wo)},styles:["[_nghost-%COMP%]{position:relative;-webkit-user-select:none;user-select:none;display:inline-block}[_nghost-%COMP%]:not(.is-hero).to-right{scale:-1 1}.is-hero[_nghost-%COMP%]{scale:-1 1}.is-hero.to-right[_nghost-%COMP%]{scale:1 1}[_nghost-%COMP%] > .portrait-frame[_ngcontent-%COMP%]{height:130px;width:121px}[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{position:absolute;z-index:-1;left:30px;width:64px;height:83px;top:20px}.is-hero[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:72px;height:72px;left:25px}.is-hero.big[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:91px;height:91px}.big[_nghost-%COMP%] > .portrait-frame[_ngcontent-%COMP%]{height:170px;width:144px}.big[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:78px;height:102px;top:26px}"],changeDetection:0});let n=e;return n})();var fS=n=>({disabled:n}),x0=(n,e)=>({color:n,background:e});function gS(n,e){if(n&1&&(a(0,"div",7),p(1),l()),n&2){let i=m(2);c(),D("Level ",i.spell().currentLevel)}}function yS(n,e){if(n&1&&(a(0,"div",7),p(1),l()),n&2){let i=m(2);c(),D(" Mana Cost: ",i.spell().currentManaCost," ")}}function _S(n,e){if(n&1&&(a(0,"div",4),g(1,"mw-ra-icon",5),a(2,"div",6)(3,"div"),p(4),l(),x(5,gS,2,1,"div",7),x(6,yS,2,1,"div",7),l()(),a(7,"div",8),g(8,"mw-spell-description",9),l()),n&2){let i=m();c(),f("icon",i.icon().icon)("ngStyle",Oi(9,x0,i.icon().iconClr,i.icon().bgClr)),c(3),H(i.baseType().name),c(),M(i.spellConfig().hideLevel?-1:5),c(),M(!i.isPassive()&&i.spell().currentManaCost?6:-1),c(2),f("spell",i.spell())("player",i.owner().ownerPlayer)("ownerUnit",i.owner())("hero",i.hero())}}var vs=(()=>{let e=class e{constructor(){this.owner=N.required(),this.spell=N.required(),this.hero=N(),this.disabled=N(!1),this.combinedMana=ae(()=>this.owner().getStateSignal()().groupState.currentMana+(this.hero()?.getStateSignal()().currentMana||0)),this.hasEnoughMana=ae(()=>this.isPassive()?!0:this.combinedMana()>=this.spell().currentManaCost),this.onCooldown=N(),this.hintPos=N("above"),this.notActivable=ae(()=>this.onCooldown()||this.disabled()||!this.hasEnoughMana()),this.baseType=ae(()=>this.spell().baseType),this.icon=ae(()=>this.spell().baseType.icon),this.isPassive=ae(()=>this.spell().isPassive()),this.spellConfig=ae(()=>this.spell().baseType.config)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-spell-icon"]],inputs:{owner:[1,"owner"],spell:[1,"spell"],hero:[1,"hero"],disabled:[1,"disabled"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},standalone:!1,decls:5,vars:10,consts:[["buffHint",""],[3,"hintBody","hintPos"],[3,"ngClass"],[1,"spell-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"font-size","12px"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"spell","player","ownerUnit","hero"]],template:function(o,r){if(o&1&&(a(0,"mw-hover-hint",1)(1,"div",2),g(2,"mw-ra-icon",3),l()(),K(3,_S,9,12,"ng-template",null,0,ve)),o&2){let s=ce(4);f("hintBody",s)("hintPos",r.hintPos()),c(),f("ngClass",ht(5,fS,r.notActivable())),c(),f("icon",r.icon().icon)("ngStyle",Oi(7,x0,r.icon().iconClr,r.icon().bgClr))}},styles:[".spell-icon[_ngcontent-%COMP%]{font-size:26px;margin:3px;display:block;height:30px;width:28px;text-align:center}.hint-icon[_ngcontent-%COMP%]{width:38px;height:38px;font-size:26px;text-align:center;padding-top:5px}.disabled[_ngcontent-%COMP%]{filter:brightness(.5)}"],changeDetection:0});let n=e;return n})();var zc=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.players=u($),this.gameObjects=u(je)}swap(){Uc(this.data.sourceSlot,this.data.targetSlot),this.data.postAction(),this.close()}merge(){let t=this.players.getCurrentPlayer().hero,o=this.data.targetSlot.unitGroup,r=this.data.sourceSlot.unitGroup,s=Math.max(o.getMana(),r.getMana());o.addUnitsCount(this.data.sourceSlot.unitGroup.count),this.gameObjects.destroyObject(r),this.data.sourceSlot.unitGroup=null,t.removeUnitGroup(r),o.setMana(s),this.data.postAction(),this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-unit-slots-action-popup"]],standalone:!1,features:[V],decls:14,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),p(3," These groups are of the same type "),l()(),a(4,"div",1)(5,"div"),p(6," What do you want to do? "),l()(),a(7,"div",2)(8,"button",3),y("click",function(){return r.merge()}),p(9," Merge "),l(),a(10,"button",3),y("click",function(){return r.swap()}),p(11," Swap "),l(),a(12,"button",3),y("click",function(){return r.popup.close()}),p(13," Cancel "),l()()())},dependencies:[ee,we],encapsulation:2});let n=e;return n})();var CS=["*"];function wS(n,e){if(n&1&&g(0,"div",4),n&2){let i=m(2);se("width",i.uiBarWidth(),"%")("height",i.barHeight(),"px")}}function SS(n,e){if(n&1&&(x(0,wS,1,4,"div",2),g(1,"div",3)),n&2){let i=m();M(i.diffBar()?0:-1),c(),se("background",i.color())("width",i.uiBarWidth(),"%")("height",i.barHeight(),"px")}}function bS(n,e){if(n&1&&g(0,"div",5),n&2){let i=m();se("background",i.color())("height",i.barHeight(),"px")}}function xS(n,e){if(n&1&&p(0),n&2){let i=m();D(" / ",i.maxValue()," ")}}var sl=(()=>{let e=class e{constructor(){this.hostElem=ti(),this.renderer=as(),this.maxValue=N.required(),this.diffBar=N(!0),this.barStyle=N("normal"),this.showMax=N(!0),this.currentValue=N(0),this.color=N("red"),this.barHeight=N(3),this.side=N("left"),this.uiBarWidth=ae(()=>this.currentValue()/this.maxValue()*100),ss(()=>{this.renderer.setStyle(this.hostElem,"height",`${this.barHeight()}px`)})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-value-bar"]],inputs:{maxValue:[1,"maxValue"],diffBar:[1,"diffBar"],barStyle:[1,"barStyle"],showMax:[1,"showMax"],currentValue:[1,"currentValue"],color:[1,"color"],barHeight:[1,"barHeight"],side:[1,"side"]},standalone:!1,ngContentSelectors:CS,decls:6,vars:5,consts:[[1,"main-bar",2,"width","100%",3,"background","height"],[1,"values"],[1,"diff-bar",3,"width","height"],[1,"main-bar"],[1,"diff-bar"],[1,"main-bar",2,"width","100%"]],template:function(o,r){if(o&1&&(lt(),x(0,SS,2,7)(1,bS,1,4,"div",0),a(2,"span",1),Xe(3),p(4),x(5,xS,1,1),l()),o&2){let s;M((s=r.barStyle())==="normal"?0:s==="static"?1:-1),c(2),me("left",r.side()==="left"),c(2),D(" ",r.currentValue()," "),c(),M(r.showMax()?5:-1)}},styles:["[_nghost-%COMP%]{position:relative;display:block;background:#373737;width:100%}.diff-bar[_ngcontent-%COMP%]{transition:1.1s;background:#ffffff9d;position:absolute;transition-timing-function:ease-in-out}.main-bar[_ngcontent-%COMP%]{transition:.4s;position:absolute}.values[_ngcontent-%COMP%]{position:absolute;display:flex;white-space:nowrap;left:50%;transform:translate(-50%,-2px);text-shadow:1px 2px black;font-size:11px;color:#fff}"],changeDetection:0});let n=e;return n})();var DS=["container"],PS=["iconSfx"],ES=["customizableVfx"],TS=["htmlSfx"],IS=n=>({part:n});function kS(n,e){if(n&1&&g(0,"mw-ra-icon",6),n&2){let i=e.icon;f("icon",i)}}function AS(n,e){if(n&1&&(g(0,"div",7),xe(1,"safeHtml")),n&2){let i=e.html;f("innerHTML",Me(1,1,i),qi)}}function OS(n,e){n&1&&We(0)}function FS(n,e){if(n&1&&K(0,OS,1,0,"ng-container",10),n&2){let i=m().$implicit;m(2);let t=ce(10);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,IS,i))}}function RS(n,e){if(n&1&&(a(0,"div"),x(1,FS,1,4,"ng-container"),l()),n&2){let i,t=e.$implicit;se("color",t.color),c(),M((i=t.type)==="plainPart"?1:-1)}}function BS(n,e){if(n&1&&(a(0,"div",8),P(1,RS,2,3,"div",9,le),l()),n&2){let i=e.data;c(),E(i.parts)}}function GS(n,e){if(n&1&&(g(0,"mw-ra-icon",6)(1,"span",11),xe(2,"safeHtml")),n&2){let i=e.part;f("icon",i.icon),c(),f("innerHTML",Me(2,2,i.text),qi)}}var Hn=(()=>{let e=class e{constructor(t,o){this.renderer=t,this.hostElem=o,this.viewContainerRef=It.required("container",{read:Ht}),this.iconSfx=It.required("iconSfx"),this.customizableVfx=It.required("customizableVfx"),this.htmlSfx=It.required("htmlSfx"),this.createdViews={},this.animationEnded=new ze,this.created=new ze}ngOnInit(){this.created.emit(this)}playAnimation(t,o={duration:1e3},r={}){t.config.layout==="default"&&this.renderer.addClass(this.hostElem.nativeElement,"default-layout");let s=[];return t.elements.forEach(d=>{let h=null;switch(d.type){case oo.Icon:h=this.viewContainerRef().createEmbeddedView(this.iconSfx(),{icon:d.icon});break;case oo.Customizable:h=this.viewContainerRef().createEmbeddedView(this.customizableVfx(),{data:r.custom});break;case oo.Html:h=this.viewContainerRef().createEmbeddedView(this.htmlSfx(),{html:r.custom?.html})}this.createdViews[d.id]=h;let _=h.rootNodes[0];Object.entries(t.elemsDefaultStyles[d.id]).forEach(([R,Q])=>{this.renderer.setStyle(_,R,Q)}),o.skipDlClass||this.renderer.addClass(_,"dl-sfx");let C=t.elemsKeyframes[d.id],O=_.animate(C,{duration:o.duration??1e3,fill:o.type??"forwards",iterations:o.iterations??1});s.push(O)}),{elem:this,animationsList:s}}clearAnimation(){this.viewContainerRef().clear()}};e.\u0275fac=function(o){return new(o||e)(G($e),G(Ue))},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-element"]],viewQuery:function(o,r){o&1&&(Tt(r.viewContainerRef,DS,5,Ht),Tt(r.iconSfx,PS,5),Tt(r.customizableVfx,ES,5),Tt(r.htmlSfx,TS,5)),o&2&&ei(4)},outputs:{animationEnded:"animationEnded",created:"created"},standalone:!1,decls:11,vars:0,consts:[["container",""],["iconSfx",""],["htmlSfx",""],["customizableVfx",""],["plainDamagePart",""],[1,"effect"],[3,"icon"],[2,"text-shadow","1px 1px 2px #202020","color","white",3,"innerHTML"],[2,"text-shadow","1px 1px #4e4e4e","z-index","10000"],[3,"color"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(o,r){o&1&&(a(0,"div",5),We(1,null,0),l(),K(3,kS,1,1,"ng-template",null,1,ve)(5,AS,2,3,"ng-template",null,2,ve)(7,BS,3,0,"ng-template",null,3,ve)(9,GS,3,4,"ng-template",null,4,ve))},dependencies:[Gt,Ce,en],styles:[".default-layout[_ngcontent-%COMP%] > .effect[_ngcontent-%COMP%]{pointer-events:none}.dl-sfx[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%)}"]});let n=e;return n})();var Tu={darkOverlay:!0,duration:1e3},on=(()=>{let e=class e{constructor(){this.latestVfxId=0,this.containersMap=new Map}registerLayerComponent(t){this.layerComponent=t}registerVfxContainer(t,o){this.containersMap.set(t,o)}unregisterVfxContainer(t){this.containersMap.delete(t)}getNewId(){return this.latestVfxId++}createXyVfx(t,o,r,s={}){this.layerComponent.createXyVfx(t,o,r,T(T({},Tu),s))}createVfxForUnitGroup(t,o,r={}){this.layerComponent.createVfxForUnitGroup(t,o,T(T({},Tu),r))}createEffectAnimationForUnitGroup(t,o,r={}){this.layerComponent.createVfxForUnitGroup(t,{type:Bn.VfxElement,animation:o},T(T({},Tu),r))}createEffectAnimationForContainer(t,o,r={}){this.containersMap.get(t)?.addAnimation(o)}createFloatingMessageForUnitGroup(t,o,r={}){this.layerComponent.createFloatingMessageForUnitGroup(t,{custom:o},r)}createDroppingMessageForContainer(t,o,r={}){this.containersMap.get(t)?.addAnimation(zf,T({skipDlClass:!0},r),{custom:o})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var NS=["effectsContainer"],US=["vfxElement"];function VS(n,e){n&1&&g(0,"mw-vfx-element")}var al=(()=>{let e=class e{constructor(){this.vfxService=u(on),this.renderer=as(),this.unitsCardsMapping=u(bc),this.cdr=An(),this.activeEffects=new Map,this.EffectTypes=Bn,this.effectsWithOverlay=0}ngOnInit(){this.vfxService.registerLayerComponent(this)}createXyVfx(t,o,r,s){let d=this.createNewEffect({bottom:0,left:t,right:0,top:o},r);this.instantiateEffect(r,s,d)}createVfxForUnitGroup(t,o,r){let d=this.unitsCardsMapping.get(t).hostElem,{left:h,top:_}=d.getBoundingClientRect(),C=this.createNewEffect({bottom:0,left:h+d.clientWidth/2,right:0,top:_+d.clientHeight/2},o);this.instantiateEffect(o,r,C)}createFloatingMessageForUnitGroup(t,o,r={}){let d=this.unitsCardsMapping.get(t).hostElem,{left:h,top:_}=d.getBoundingClientRect(),C={type:Bn.VfxElement,animation:$f},O=this.createNewEffect({bottom:0,left:h+d.clientWidth/2,right:0,top:_+d.clientHeight/2},C);this.instantiateEffect(C,T({darkOverlay:!1,duration:1e3},r),O,o)}createNewEffect(t,o){return{id:this.vfxService.getNewId(),offset:t,vfx:o}}instantiateEffect(t,o,r,s={}){switch(o.darkOverlay&&this.effectsWithOverlay++,this.activeEffects.set(r.id,r),t.type){case Bn.VfxElement:let d=t,h=this.effectsContainerRef.createComponent(Hn),_=h.instance,C=_.playAnimation(d.animation,{duration:o.duration},s);ts(C.animationsList.map(O=>_i(O,"finish"))).pipe(Co(1)).subscribe(()=>{this.activeEffects.delete(r.id),o.darkOverlay&&this.effectsWithOverlay--,h.destroy()}),this.updateEffectElementPosition(_.hostElem.nativeElement,r)}}updateEffectElementPosition(t,o){this.renderer.setStyle(t,"position","fixed"),this.renderer.setStyle(t,"left",`${o.offset.left}px`),this.renderer.setStyle(t,"top",`${o.offset.top}px`)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-layer"]],viewQuery:function(o,r){if(o&1&&(Et(NS,7,Ht),Et(US,7)),o&2){let s;_t(s=vt())&&(r.effectsContainerRef=s.first),_t(s=vt())&&(r.vfxElementRef=s.first)}},standalone:!1,decls:5,vars:2,consts:[["effectsContainer",""],["vfxElement",""],[1,"basic-overlay"]],template:function(o,r){o&1&&(g(0,"div",2),We(1,null,0),K(3,VS,1,0,"ng-template",null,1,ve)),o&2&&me("visible",r.effectsWithOverlay)},styles:["[_nghost-%COMP%]{position:fixed;pointer-events:none;inset:0}.vfx[_ngcontent-%COMP%]{position:fixed;pointer-events:none}.basic-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;opacity:0;background:#0000006b;transition:.3s;pointer-events:none}.basic-overlay.visible[_ngcontent-%COMP%]{opacity:1}"]});let n=e;return n})();var jS=["*"];function $S(n,e){if(n&1){let i=I();a(0,"mw-vfx-element",1),y("created",function(o){let r=w(i).$implicit,s=m();return S(s.playAnimation(o,r))}),l()}}var ll=(()=>{let e=class e{constructor(){this.vfxService=u(on),this.animations=[]}ngOnInit(){this.vfxService.registerVfxContainer(this.containerId,this)}ngOnDestroy(){this.vfxService.unregisterVfxContainer(this.containerId)}playAnimation(t,o){let r=t.playAnimation(o.anim,o.options,o.data);ts(r.animationsList.map(s=>_i(s,"finish"))).pipe(Co(1)).subscribe(()=>{z.removeItem(this.animations,o)})}addAnimation(t,o,r){this.animations.push({anim:t,options:o,data:r})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-container"]],inputs:{containerId:"containerId"},standalone:!1,ngContentSelectors:jS,decls:4,vars:0,consts:[[2,"position","absolute","z-index","200","left","50%","top","20%"],[3,"created"]],template:function(o,r){o&1&&(lt(),a(0,"div",0),P(1,$S,1,0,"mw-vfx-element",null,le),l(),Xe(3)),o&2&&(c(),E(r.animations))},styles:["[_nghost-%COMP%]{display:block;position:relative}"]});let n=e;return n})();var Wc=(()=>{let e=class e{constructor(){this.unitType=N.required(),this.count=N.required()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-preview"]],inputs:{unitType:[1,"unitType"],count:[1,"count"]},standalone:!1,decls:4,vars:4,consts:[[2,"display","flex","flex-direction","column"],[3,"src"]],template:function(o,r){o&1&&(a(0,"div",0),g(1,"img",1),a(2,"div"),p(3),l()()),o&2&&(c(),f("src",Bl("../",r.unitType().mainPortraitUrl),wo),c(2),Ee(" ",r.unitType().name," (",r.count(),") "))},encapsulation:2,changeDetection:0});let n=e;return n})();var Ro=(()=>{let e=class e extends Te(){constructor(){super(...arguments),this.battleState=u(zt),this.actionHint=u(Oo),this.players=u($),this.unitState=u(qc),this.units=u(Rt),this.history=u(Gn),this.state=u(fe),this.vfx=u(on)}onBattleBegins(){this.initPlayersSpells()}dealDamageTo(t,o,r=Be.PhysicalAttack,s,d={}){let h=o,_=0,C=0,O=0,R=!1;switch(r){case Be.PhysicalAttack:if(d.attackerUnit){console.log("attacker?",d.attackerUnit);let Ie=d.attackerUnit.getState().combatState,nt={attacked:t,attacker:d.attackerUnit},ci=d.attackerUnit.modGroup,El=ci.getAllModValues("__attackConditionalModifiers").map($n=>$n(nt)),Hs=ci.getAllModValues("__unitConditionalMods").map($n=>$n(d.attackerUnit)),Tl=t.modGroup.getAllModValues("__attackConditionalModifiers").map($n=>$n(nt)),go=ii.withRefs([...El.map(xt.fromMods),...Hs.filter(jh).map(xt.fromMods),...ci.getAllRefs()]),Xm=go.getModValue("criticalDamageChance");Xm&&z.chanceRoll(Xm)&&(R=!0,h=h+h*(go.getModValue("criticalDamageMul")||0));let ip=ii.withRefs(Tl.map(xt.fromMods)),np=ip.getModValue("chanceToBlock"),O_=ip.getModValue("damageBlockMin"),F_=ip.getModValue("damageBlockMax");if(np){let $n=z.chanceRoll(np);if(console.log("blocking -> chance to block",np,$n),$n){let th=z.randIntInRange(O_,F_),R_=z.maxPercent(ci.getModValue("blockPiercingPercent")||0);_=Math.round(th-th*R_)}}let Qm=go.getModValue("baseDamagePercentModifier")||0,Jm=go.getModValue("lifesteal")||0;console.log(`damage reduced by ${Qm}%`),Ie.type===Mt.Pinned&&t!==Ie.pinnedBy&&(h=z.increaseByPercent(h,-.25)),h=z.nonNegative(Math.round(h+h*Qm)-_);let eh=go.getModValue("retaliationDamagePercent");d.isCounterattack&&eh&&(h*=eh),Jm&&(C=Math.round(h*(Jm/100)),console.log("Lifesteal: ",C))}break;default:if(Su[r]){let nt=t.modGroup.getModValue("amplifiedTakenMagicDamagePercent")||0;h+=o*nt,h=Math.round(h);let ci=t.getState().groupStats[Su[r]];ci>bu&&(ci=bu),console.log(o,r,"resist:",ci),h=h-h*(ci/100)}}let Q=t.count;if(h=Math.round(h),C&&d.attackerUnit){let Ie=this.units.healUnit(d.attackerUnit,C);O=Ie.revivedUnitsCount,this.events.dispatch(dr({healedUnitsCount:Ie.revivedUnitsCount,target:d.attackerUnit}))}let de=this.unitState.dealPureDamageToUnitGroup(t,h);return de.finalUnitLoss&&this.events.dispatch(ca({unit:t,loss:de.finalUnitLoss})),s&&s({unitLoss:de.finalUnitLoss,finalDamage:de.finalDamage,initialUnitCount:Q}),r===Be.PhysicalAttack?J(T({},de),{blockedDamage:_,stolenLife:C,stolenLifeUnitsRestored:O,isCritical:R}):(de.isDamageFatal&&(this.battleState.handleDefeatedUnitGroup(t),this.events.dispatch(Mo({target:t,targetPlayer:t.ownerPlayer,loss:de.finalUnitLoss}))),de.finalUnitLoss&&this.events.dispatch(Lp({unitLoss:de.finalUnitLoss,group:t})),J(T({},de),{blockedDamage:_,stolenLife:C,stolenLifeUnitsRestored:O,isCritical:R}))}handleAttackInteraction(t){let{attackingGroup:o,attackedGroup:r,action:s}=t,d=s===Qi.GroupCounterattacks,h=d?r:o,_=d?o:r;this.triggerEventForAllSpellsHandler(Io.UnitGroupAttacks({attacked:_,attacker:h}));let C=this.unitState.getDetailedAttackInfo(h,_),O=this.unitState.getFinalDamageInfoFromDamageDetailedInfo(C),R=this.dealDamageTo(_,O.finalDamage,Be.PhysicalAttack,void 0,{attackerUnit:h,isCounterattack:d});if(d&&(this.vfx.createDroppingMessageForContainer(_.id,{html:Ui(`
          <div style="font-size: 14px">Retaliated! ${Ua({icon:"skull"})} ${R.finalUnitLoss}</div>
        `,{width:130})},{duration:1500}),this.history.logHtmlMessage(Zf({attacked:_,attacker:h,damage:R.finalDamage,originalNumber:C.originalAttackersCount,unitLoss:R.finalUnitLoss}))),d?this.events.dispatch(Np({attackingGroup:h,attackedGroup:_,loss:R.finalUnitLoss,damage:R.finalDamage})):(this.battleState.state.updateWithCopy(Q=>Q.currentGroupTurnsLeft--),h.patchUnitGroupState({turnsLeft:this.battleState.state.get().currentGroupTurnsLeft}),this.events.dispatch(cr({attackingGroup:h,attackedGroup:_,attackedCount:C.originalAttackedCount,attackersCount:C.originalAttackersCount,loss:R.finalUnitLoss,damage:R.finalDamage,damageBlocked:R.blockedDamage,lifeStolen:R.stolenLife,lifeStolenUnitsRestored:R.stolenLifeUnitsRestored,isCritical:R.isCritical}))),R.isDamageFatal){this.battleState.handleDefeatedUnitGroup(_),this.events.dispatch(Mo({target:_,targetPlayer:_.ownerPlayer,loss:R.finalUnitLoss})),t.action=Qi.AttackInteractionCompleted,this.events.dispatch(xo(t));return}if(!d){C.enemyCanCounterattack?t.action=Qi.GroupCounterattacks:t.action=Qi.AttackInteractionCompleted,this.events.dispatch(xo(t));return}d&&(t.action=Qi.AttackInteractionCompleted),this.events.dispatch(xo(t))}setDamageHintMessageOnCardHover(t){let o=this.getTargetAttackActionInfo(t.hoveredCard);this.actionHint.hintMessage$.next(o)}getTargetAttackActionInfo(t){let o=this.battleState.state.get().currentUnitGroup,r=this.unitState.getDetailedAttackInfo(o,t);return{type:Kn.OnHoverEnemyCard,attackedGroup:r.attacked,minDamage:r.multipliedMinDamage,maxDamage:r.multipliedMaxDamage,noDamageSpread:r.multipliedMinDamage===r.multipliedMaxDamage,minCountLoss:r.minUnitCountLoss,maxCountLoss:r.maxUnitCountLoss,noLossSpread:r.minUnitCountLoss===r.maxUnitCountLoss,attackSuperiority:r.attackSuperiority}}forEachUnitGroup(t){this.battleState.heroesUnitGroupsMap.forEach((o,r)=>{o.forEach(s=>{t(s,r)})})}applyDispellToUnitGroup(t){let o=[L.Buff,L.Debuff];t.spells.forEach(r=>{o.includes(r.baseType.activationType)&&this.removeSpellFromUnitGroup(t,r)}),this.units.clearUnitModifiers(t)}triggerEventForAllSpellsHandler(t){this.state.initializedSpells.get().spells.forEach(o=>{o.combatEventHandlers.triggerEvent(t)})}triggerEventForSpellHandler(t,o){t.combatEventHandlers.triggerEvent(o)}initAllUnitGroupSpells(){this.forEachUnitGroup((t,o)=>{t.spells&&t.spells.forEach(r=>this.initSpell(r,o,t))})}resetAllUnitGroupsCooldowns(){this.forEachUnitGroup(t=>t.patchUnitGroupState({spellsOnCooldown:!1}))}getRandomEnemyUnitGroup(){let t=this.players.getEnemyPlayer(),o=this.battleState.heroesUnitGroupsMap.get(t);return z.randItem(o.filter(r=>r.isAlive))}addSpellToUnitGroup(t,o,r){t.addSpell(o),this.events.dispatch(ds({unitGroup:t})),this.initSpell(o,r),this.triggerEventForSpellHandler(o,Io.SpellPlacedOnUnitGroup({target:t}))}removeSpellFromUnitGroup(t,o){t.removeSpell(o),o.combatEventHandlers.removeAllHandlers(),this.events.dispatch(ds({unitGroup:t}))}initSpell(t,o,r){this.events.dispatch(ka({spell:t,player:o,ownerUnit:r}))}initPlayersSpells(){[this.players.getCurrentPlayer(),this.players.getEnemyPlayer()].forEach(t=>{t.hero.spells.forEach(o=>{this.initSpell(o,t)})})}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var qS=Z({id:"#spell-null",activationType:L.Instant,name:"",icon:{icon:""},getDescription(n){return{descriptions:[]}},config:{getManaCost(n){return 0},init:()=>{}}}),Bo=class Bo extends Te(){constructor(){super(...arguments),this.players=u($),this.gameObjectsManager=u(je),this.NULL_SPELL_INSTANCE=this.gameObjectsManager.createNewGameObject(ac,{initialLevel:0,spellBaseType:qS,state:{}},"null-spell"),this.state=new bn({currentPlayer:null,currentSpell:this.NULL_SPELL_INSTANCE,currentCasterUnit:void 0,playerCurrentState:Je.Normal,areSpellsOnCooldown:!1})}playersInit(){this.state.patch({currentPlayer:this.players.getCurrentPlayer()})}resetSpellsCooldowns(){this.state.patch({areSpellsOnCooldown:!1})}setSpellsOnCooldown(){let e=this.state.get().currentCasterUnit;e?(e.patchUnitGroupState({spellsOnCooldown:!0}),this.state.patch({currentCasterUnit:void 0})):this.state.patch({areSpellsOnCooldown:!0})}onSpellClick(e,i){switch(this.state.patch({currentSpell:e,currentCasterUnit:i}),e.baseType.activationType){case L.Instant:this.onCurrentSpellCast(),this.events.dispatch(ia({player:this.state.get().currentPlayer,spell:e})),this.setSpellsOnCooldown();break;case L.Target:this.setPlayerState(Je.SpellTargeting);break;case L.Passive:break;default:break}}isSpellBeingCast(){return this.state.get().currentSpell!==this.NULL_SPELL_INSTANCE}resetCurrentSpell(){this.state.patch({currentSpell:this.NULL_SPELL_INSTANCE})}cancelCurrentSpell(){this.resetCurrentSpell(),this.setPlayerState(Je.Normal),this.state.patch({currentCasterUnit:void 0})}onCurrentSpellCast(){let e=this.state.get().currentSpell,i=e.currentManaCost;e.baseType.config.isOncePerBattle&&e.setCooldown(1/0);let t=this.state.get().currentCasterUnit,o=this.state.get().currentPlayer;if(o){if(t){let r=t.getMana(),s=z.limitedNumber(i,r),d=i-s;s&&t.addMana(-s),d&&o.hero.addMana(-d);return}o.hero.addMana(-i)}}setPlayerState(e){this.state.patch({playerCurrentState:e})}};Bo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Bo)))(t||Bo)}})(),Bo.\u0275prov=A({token:Bo,factory:Bo.\u0275fac,providedIn:"root"});var Dt=Bo;F([ge(On)],Dt.prototype,"playersInit",null);var YS=Jf({id:"#hero-non-player-neutral",name:"neutral-hero",generalDescription:U(""),abilities:[],army:[],items:[],resources:Qf,stats:{mana:0,baseAttack:0,baseDefence:0}}),Cs=(()=>{let e=class e{constructor(){this.gameObjectsManager=u(je),this.unitGroups=u(Rt)}addManaToHero(t,o){t.addMana(o)}addSpellToHero(t,o){t.spells.push(o)}createHero(t){return this.gameObjectsManager.createNewGameObject(S0,{heroBase:t,unitGroups:t.initialState.army.length?[...this.unitGroups.createUnitGroupFromGenModel(t.initialState.army[0]),...Ki.enableHeroUnits?[this.unitGroups.createUnitGroup(`#unit-!hero-${t.id}`,{count:1})]:[]]:[]})}createNeutralHero(){return this.createHero(YS)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var rn=(()=>{let e=class e{constructor(){this.events=u(oe),this.state=u(fe),this.gameObjectsManager=u(je)}createItem(t){let o=t.icon;return o.bgClr||(o.bgClr=Si.DefaultItemIconBg),o.iconClr||(o.iconClr=Si.DefaultItemIconClr),this.gameObjectsManager.createNewGameObject(Hg,{itemBase:t,state:t.defaultState})}registerItemsEventHandlers(t,o){this.events.dispatch(Aa({item:t,ownerPlayer:o}))}triggerEventForAllItemsHandlers(t){this.state.eventHandlers.items.triggerAllHandlersByEvent(t)}triggerEventForItemHandlers(t,o){this.state.eventHandlers.items.triggerRefEventHandlers(t,o)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var sn=function(n){return n.Main="main",n.Neutral="neutral",n}(sn||{});var $=(()=>{let e=class e extends Te(){constructor(){super(...arguments),this.heroesService=u(Cs),this.state=u(fe),this.gameObjectsManager=u(je),this.currentPlayerId=this.gameObjectsManager.getObjectId(ms,sn.Main)}get playersMap(){return this.state.gameState.playersMap}createPlayer(t,o){return this.gameObjectsManager.createNewGameObject(ms,o,t)}getCurrentPlayer(){return this.playersMap.get(this.currentPlayerId)}addResourceToPlayer(t,o,r){t.resources[o]+=r}addResourcesToPlayer(t,o){Object.entries(o).forEach(([r,s])=>t.resources[r]+=s)}removeResourcesFromPlayer(t,o){Object.entries(o).forEach(([r,s])=>t.resources[r]-=s)}playerHasResources(t,o){let r=t.resources;return Object.entries(o).every(([s,d])=>r[s]>=d)}getMissingResources(t,o){let r=t.resources;return Object.entries(o).reduce((s,[d,h])=>{let _=r[d]-h;return _<0&&(s[d]=Math.abs(_)),s},{})}getCurrentPlayerId(){return this.currentPlayerId}isEnemyUnitGroup(t){return this.getUnitGroupsOfPlayer(this.getEnemyPlayer().id).includes(t)}getPlayerUnitsCountOfType(t,o){return t.hero.unitGroups.reduce((r,s)=>r+(s.type.id===o?s.count:0),0)}addExperienceToPlayersHero(t,o){this.getPlayerById(t).hero.addExperience(o)}getPlayerById(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(ms,t))}getNeutralPlayer(){return this.playersMap.get(this.gameObjectsManager.getObjectId(ms,sn.Neutral))}getEnemyPlayer(){return this.getNeutralPlayer()}getUnitGroupsOfPlayer(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(ms,t)).hero.unitGroups}addUnitGroupToTypeStack(t,o){let r=t.hero.unitGroups.find(s=>s.type===o.type);r?r.addUnitsCount(o.count):t.hero.addUnitGroup(o)}removeNUnitsFromGroup(t,o,r){if(o.addUnitsCount(-r),o.count<=0){t.hero.removeUnitGroup(o),this.gameObjectsManager.destroyObject(o);let s=o.ownerHero.getAllSlots().find(d=>d.unitGroup===o);s&&(s.unitGroup=null)}}removeUnitTypeCountFromPlayer(t,o,r){let s=t.hero.getAllUnitsFromSlots().filter(O=>O.type.id===o),d=s.reduce((O,R)=>R.count+O,0),h=d<r?d:r,_=h,C=0;for(;_>0;){let O=s[C++],R=O.count,Q=_>R?R:_;this.removeNUnitsFromGroup(t,O,Q),_-=Q}return h}addManaToPlayer(t,o){t.hero.addMana(o)}addItemToPlayer(t,o){this.events.dispatch(gn({player:t,item:o}))}addSpellToPlayer(t,o){t.hero.spells.push(o)}removeItemFromPlayer(t,o){this.events.dispatch(Do({player:t,item:o}))}createPlayerWithHero(t,o,r){return{color:t,hero:this.heroesService.createHero(o),resources:o.initialState.resources,type:r}}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var M0=(()=>{let e=class e{constructor(){this.playersService=u($)}getPlayerInfo(){return this.playersService.getEnemyPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(sn.Neutral)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var D0=(()=>{let e=class e{constructor(){this.playersService=u($)}getPlayerInfo(){return this.playersService.getCurrentPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(sn.Main)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Go=(()=>{let e=class e{constructor(){this.gameObjectManager=u(je)}createSpellInstance(t,o={}){let r=o.initialLevel??1,s=t.icon;return s.bgClr||(s.bgClr=Si.DefaultItemIconBg),s.iconClr||(s.iconClr=Si.DefaultItemIconClr),this.gameObjectManager.createNewGameObject(ac,{spellBaseType:t,initialLevel:r,state:o.state})}createModifiers(t){return t}canSpellBeCastOnUnit(t,o,r){let d=t.baseType.config.targetCastConfig?.canActivate;return d?d({unitGroup:o,isEnemy:r}):!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var an=(()=>{let e=class e{constructor(){this.playersService=u($),this.unitGroups=u(Rt),this.gameObjectsManager=u(je),this.events=u(oe),this.initialStructs=[],this.availableStructuresMap={}}initStructures(t){this.neutralPlayer=this.playersService.getNeutralPlayer(),this.initialStructs=t.map.structures,this.startingLocationId=t.map.startingLocId,this.playerCurrentLocId=this.gameObjectsManager.getObjectId(Ir,this.startingLocationId),this.viewStructures=this.createViewStructures(this.initialStructs),this.updateParentLinks(),this.updateAvailableStructures()}updateParentLinks(){this.viewStructures.forEach(t=>{this.viewStructures.filter(r=>t.pathTo===r.id).forEach(r=>t.parentStructs.add(r.id))})}updateAvailableStructures(){Object.keys(this.availableStructuresMap).forEach(t=>{this.viewStructures.filter(r=>[...r.parentStructs].find(s=>this.gameObjectsManager.getObjectByFullId(this.gameObjectsManager.getObjectId(Ir,s))?.visited)&&r.parentStructs.has(t)).forEach(r=>this.availableStructuresMap[r.id]=!0)})}createViewStructures(t){let o=t.map(r=>this.gameObjectsManager.createNewGameObject(Ir,{iconName:r.icon,x:r.x,y:r.y,generator:r.struct,guardingPlayer:void 0,isRoot:r.id===this.startingLocationId,pathTo:r.pathTo?this.gameObjectsManager.getObjectId(Ir,r.pathTo):void 0,actionPoints:r.actionPoints,structParams:r.structParams},r.id));return o.map(r=>{this.events.dispatch(Fa({structure:r}));let s=r.pathTo;if(r.isRoot&&(r.isRoot=!0,r.visited=!0,this.availableStructuresMap[r.id]=!0),s){let d=o.find(ci=>ci.id===r.pathTo);r.pathTo=s;let{x:h,y:_}=r,C=Math.min(h,d.x),O=Math.min(_,d.y),R=Math.max(h,d.x),de=Math.max(_,d.y)-O,Ie=R-C;r.svg={x:C,y:O,height:de,width:Ie,ox:d.x>h?Ie:0,oy:d.y>_?de:0,tx:h<d.x?0:Ie,ty:_<d.y?0:de};let nt=r.generator;nt?.generateGuard&&(r.guard=this.unitGroups.createUnitGroupFromGenModel(nt.generateGuard({thisStruct:r})),r.guard.forEach(ci=>ci.assignOwnerPlayer(this.playersService.getNeutralPlayer())),r.guardingPlayer=this.playersService.getNeutralPlayer()),nt?.generateReward&&(r.reward=nt.generateReward())}return r})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var qc=(()=>{let e=class e{getTailUnitHealth(t){let{tailUnitHp:o}=t;return o===0?0:o===void 0?t.type.baseStats.health:o}getUnitGroupTotalHp(t){return(t.count-1)*t.type.baseStats.health+this.getTailUnitHealth(t)}getUnitGroupDamage(t,o=0){let s=t.type.baseStats.damageInfo,d=t.count,h=s.minDamage*t.count,_=s.maxDamage*t.count,C=o*(o>=0?.05:.035),O=h+h*C,R=_+_*C;return{attacker:t,attackingUnitsCount:d,minDamage:h,maxDamage:_,attackSuperiority:o,damageMultiplier:C,multipliedMinDamage:Math.round(O),multipliedMaxDamage:Math.round(R)}}getDetailedAttackInfo(t,o){let s=o.type.baseStats,d=t.getState(),h=o.getState(),_=d.groupStats.finalAttack,C=h.groupStats.finalDefence,O=_-C,R=this.getUnitGroupDamage(t,O),Q=this.calcUnitCountLoss(R.multipliedMinDamage,s.health,o.count),de=this.calcUnitCountLoss(R.multipliedMaxDamage,s.health,o.count),Ie=this.canGroupCounterattack(o);return J(T({},R),{attacked:o,originalAttackedCount:o.count,originalAttackersCount:t.count,enemyCanCounterattack:Ie,minUnitCountLoss:Q,maxUnitCountLoss:de})}getFinalDamageInfoFromDamageDetailedInfo(t){let o=z.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage);return this.getFinalDamageInfo(t.attacked,o)}getFinalDamageInfo(t,o){let r=t,s=r.type.baseStats,d=t.count,h=this.getUnitGroupTotalHp(r),_=h-o,C=o>=h,O=_%s.health,R=C?0:O===0?s.health:O,Q=Math.ceil(_/s.health),de=d-Q;return{finalDamage:o,finalUnitLoss:de>t.count?t.count:de,finalTotalUnitLoss:de,tailHpLeft:R,isDamageFatal:o>=h}}dealPureDamageToUnitGroup(t,o){let r=this.getFinalDamageInfo(t,o);return t.addUnitsCount(-r.finalTotalUnitLoss),t.setTailUnitHp(r.tailHpLeft),r}calcUnitCountLoss(t,o,r){let s=Math.floor(t/o);return s>r?r:s}canGroupCounterattack(t){return!!t.type.defaultModifiers?.counterattacks}isUnitGroupRanged(t){return!!t.type.defaultModifiers?.isRanged}rollDamage(t){return z.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Ti=(()=>{let e=class e{constructor(){this.playersService=u($),this.heroes=u(Cs),this.unitGroups=u(Rt),this.players=u($),this.spells=u(Go),this.events=u(oe),this.state=u(fe),this.structures=u(an)}getPlayerApi(){return{removeUnitTypeFromPlayer:(t,o,r)=>this.players.removeUnitTypeCountFromPlayer(t,o,r),playerHasResources:(t,o)=>this.players.playerHasResources(t,o),removeResourcesFromPlayer:(t,o)=>this.players.removeResourcesFromPlayer(t,o),addExperienceToPlayer:(t,o)=>{this.players.addExperienceToPlayersHero(t.id,o)},addUnitGroupToPlayer:(t,o,r)=>{let s=this.unitGroups.createUnitGroup(o,{count:r},t.hero);this.players.addUnitGroupToTypeStack(t,s)},addManaToPlayer:(t,o)=>{this.heroes.addManaToHero(t.hero,o)},addMaxManaToPlayer:(t,o)=>{t.hero.addStatsMods({heroMaxMana:o})},giveResourceToPlayer:(t,o,r)=>this.playersService.addResourceToPlayer(t,o,r),addSpellToPlayerHero:(t,o)=>{this.heroes.addSpellToHero(t.hero,o)},getCurrentPlayer:()=>this.playersService.getCurrentPlayer(),getCurrentPlayerUnitGroups:()=>this.playersService.getUnitGroupsOfPlayer(this.playersService.getCurrentPlayer().id),giveResourcesToPlayer:(t,o)=>this.playersService.addResourcesToPlayer(t,o)}}getSpellsApi(){return{createSpellInstance:(t,o)=>this.spells.createSpellInstance(t,o)}}getGameApi(){return{events:this.getGlobalEventsApi(),players:this.getPlayerApi(),actions:{getMapStructures:()=>this.structures.viewStructures,getActionPointsLeft:()=>this.state.currentGame.actionPoints,scheduleActionInGameDays:(t,o)=>{this.events.dispatch(_r({action:t,dayOffset:o}))},getTownOfPlayer:t=>this.state.townsByPlayers.get(t.id)}}}getGlobalEventsApi(){return{dispatch:t=>this.events.dispatch(t),onEvent:t=>this.events.onEvent(t)}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var P0=(()=>{let e=class e extends Te(){constructor(){super(),this.apiProvider=u(Ti),this.initTriggersFromTriggersRegistry()}initTriggersFromTriggersRegistry(){lo.registryMap.forEach((t,o)=>{t.forEach(r=>{this.events.onEvent(o).subscribe(s=>{r.fn(s,this.apiProvider.getGameApi())})})})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Lo=class Lo extends Te(){constructor(){super(...arguments),this.battleLog=u(Gn)}clearLogOnFightStart(){this.battleLog.history=[]}logGroupDamagedByGroup({attackingGroup:e,attackedGroup:i,damage:t,loss:o,attackedCount:r,attackersCount:s,damageBlocked:d,lifeStolen:h,lifeStolenUnitsRestored:_,isCritical:C}){this.battleLog.logDealtDamageMessage({attacked:i.type,attackedPlayer:i.ownerPlayer,attackersNumber:s,attackedNumber:r,attacker:e.type,attackingPlayer:e.ownerPlayer,damage:t,damageBlocked:d,losses:o,stolenLife:h,stolenLifeUnitsRestored:_,isCritical:C})}logPlayerStartsTurn(e){this.battleLog.logRoundInfoMessage(`Player ${e.currentPlayer.type} starts his turn`)}logFightEnds(e){this.battleLog.logRoundInfoMessage(e.win?"Win!":"Defeat")}logNextRoundStarts(e){this.battleLog.logRoundInfoMessage(`Round ${e.round} starts`)}};Lo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Lo)))(t||Lo)}})(),Lo.\u0275prov=A({token:Lo,factory:Lo.\u0275fac});var po=Lo;F([ge(Gi)],po.prototype,"clearLogOnFightStart",null);F([Y(cr)],po.prototype,"logGroupDamagedByGroup",null);F([Y(eo)],po.prototype,"logPlayerStartsTurn",null);F([Y(fn)],po.prototype,"logFightEnds",null);F([Y(Bi)],po.prototype,"logNextRoundStarts",null);var No=class No extends Te(){constructor(){super(...arguments),this.battleState=u(zt),this.curPlayerState=u(Dt),this.strucuresService=u(an),this.playersService=u($),this.vfx=u(on),this.state=u(fe),this.historyLog=u(Gn),this.gameObjectsManager=u(je)}beforeBattleInit(){this.applyStaticModsFromEquippedItems()}prepareFightState(){this.battleState.resetCurrentPlayer(),this.battleState.initNextTurnByQueue()}defendAction(){let e=this.battleState.state.get().currentUnitGroup;e.addCombatMods({fixedSpeed:5,heroBonusDefence:5,defending:!0}),this.battleState.resortFightQueue(!0),this.vfx.createDroppingMessageForContainer(e.id,{html:Ui("Defending!",{width:80})},{duration:1e3}),this.historyLog.logSimpleMessage(`${e.count} ${e.type.name} choose to defend. Their speed is fixed to 5, and armor is increased by 5.`),this.battleState.initNextTurnByQueue()}recalcTurnQueue(){this.battleState.initNextTurnByQueue()}updatePlayerState({currentPlayer:e}){e.type===mt.AI?(this.curPlayerState.setPlayerState(Je.WaitsForTurn),this.battleState.processAiPlayer()):this.curPlayerState.setPlayerState(Je.Normal)}updateQueueOnGroupTurnEnd(){this.battleState.initNextTurnByQueue(!0)}registerHealedUnits(e){e.healedUnitsCount&&this.battleState.registerPlayerUnitLoss(e.target,-e.healedUnitsCount)}registerUnitLossOnAnyOtherDamageSources({loss:e,unit:i}){this.battleState.registerPlayerUnitLoss(i,e)}checkIfFightEndedOnUnitGroupDeath(){let e=this.strucuresService.currentStruct,i=this.playersService.getCurrentPlayer(),t=this.battleState.getAliveUnitsOfPlayer(i);if(!t.length){this.playersService.getCurrentPlayer().hero.setUnitGroups(t),this.events.dispatch(fn({struct:e,win:!1}));return}let o=this.battleState.getEnemyOfPlayer(i);if(!this.battleState.getAliveUnitsOfPlayer(o).length){let s=this.battleState.getDeadUnitsOfPlayer(i),d=this.battleState.getSummonsOfPlayer(i),h=this.state.gameSettings.get().lossToNeutrals===Ln.None;h&&i.hero.unitGroups.forEach(R=>{R.restoreBattleLosses()});let _=this.battleState.getDeadUnitsOfPlayer(o);[...h?[]:s,..._,...d].forEach(R=>{this.gameObjectsManager.destroyObject(R)});let C=t.filter(R=>!R.modGroup.getModValue("isSummon")),O=this.playersService.getCurrentPlayer().hero;O.spells.forEach(R=>R.clearCooldown()),O.unitGroups.filter(R=>!R.isAlive).forEach(R=>{let Q=O.getAllSlots().find(de=>de.unitGroup===R);Q&&(Q.unitGroup=null)}),O.setUnitGroups(C,!1),e.isInactive=!0,this.events.dispatch(fn({struct:e,win:!0}));return}}processAiPlayer(){this.battleState.state.get().currentPlayer.type===mt.AI&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer()}checkControlWhenGroupRunsOutOfTurns({groupHasMoreTurns:e,groupPlayer:i,groupStillAlive:t}){i.type===mt.AI&&e&&t&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer(),(!e||!t)&&this.events.dispatch(Jl({playerEndsTurn:i}))}updateFightQueryDueToSpeedChange(){this.battleState.resortFightQueue()}cleanUpHandlersOnFightEnd(){this.cleanupStaticModsFromEquippedItems(),this.events.dispatch(tc())}cleanUpHandlers(){this.state.initializedSpells.get().spells.forEach(e=>e.removeCombatHandlers()),this.state.initializedSpells.revert()}enemyHasAnyLivingUnits(){return this.battleState.playerHasAnyAliveUnits(this.battleState.getEnemyOfPlayer(this.battleState.state.get().currentPlayer))}applyStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.inventory.getEquippedItems().forEach(e=>{console.log(e);let i=e.baseType.staticEnemyMods;i&&this.playersService.getEnemyPlayer().hero.addCommonCombatMods(xt.fromMods(i))})}cleanupStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.clearCommonCombatMods(),this.playersService.getEnemyPlayer().hero.clearCommonCombatMods()}};No.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(No)))(t||No)}})(),No.\u0275prov=A({token:No,factory:No.\u0275fac});var qt=No;F([ge(wa)],qt.prototype,"beforeBattleInit",null);F([ge(Gi)],qt.prototype,"prepareFightState",null);F([ge(da)],qt.prototype,"defendAction",null);F([ge(Bi)],qt.prototype,"recalcTurnQueue",null);F([Y(eo)],qt.prototype,"updatePlayerState",null);F([ge(Jl)],qt.prototype,"updateQueueOnGroupTurnEnd",null);F([Y(dr)],qt.prototype,"registerHealedUnits",null);F([Y(ca)],qt.prototype,"registerUnitLossOnAnyOtherDamageSources",null);F([ge(Mo)],qt.prototype,"checkIfFightEndedOnUnitGroupDeath",null);F([ge(sa)],qt.prototype,"processAiPlayer",null);F([Y(ra)],qt.prototype,"checkControlWhenGroupRunsOutOfTurns",null);F([ge(na)],qt.prototype,"updateFightQueryDueToSpeedChange",null);F([ge(fn)],qt.prototype,"cleanUpHandlersOnFightEnd",null);F([ge(tc)],qt.prototype,"cleanUpHandlers",null);var Uo=class Uo extends Te(){constructor(){super(...arguments),this.combatInteractor=u(Ro)}dispellAllUnitsOnStructCompleted(){this.combatInteractor.forEachUnitGroup(e=>this.combatInteractor.applyDispellToUnitGroup(e))}prepareSpellsOnFightStart(){this.combatInteractor.initAllUnitGroupSpells(),this.combatInteractor.resetAllUnitGroupsCooldowns()}startCombatInteraction(e){this.events.dispatch(xo({action:Qi.GroupAttacks,attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}))}processCombatInteraction(e){switch(e.action){case Qi.GroupAttacks:this.combatInteractor.handleAttackInteraction(e);break;case Qi.GroupCounterattacks:this.combatInteractor.handleAttackInteraction(e);break;case Qi.AttackInteractionCompleted:let i=e.attackingGroup;this.events.dispatch(ra({group:i,groupPlayer:i.ownerPlayer,groupStillAlive:!!i.count,groupHasMoreTurns:!!i.turnsLeft}))}}resetCooldownsAndEmitNewRoundEventToSpells(e){this.combatInteractor.triggerEventForAllSpellsHandler(Io.NewRoundBegins({round:e.round})),this.combatInteractor.resetAllUnitGroupsCooldowns()}dispelUnitOnDeath(e){this.combatInteractor.applyDispellToUnitGroup(e.target)}addCombatModsToUnit({mods:e,unit:i}){i.addCombatMods(e)}removeCombatModsToUnit({mods:e,unit:i}){i.removeCombatMods(e)}};Uo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Uo)))(t||Uo)}})(),Uo.\u0275prov=A({token:Uo,factory:Uo.\u0275fac});var ln=Uo;F([ge(to)],ln.prototype,"dispellAllUnitsOnStructCompleted",null);F([ge(Gi)],ln.prototype,"prepareSpellsOnFightStart",null);F([Y(Jn)],ln.prototype,"startCombatInteraction",null);F([Y(xo)],ln.prototype,"processCombatInteraction",null);F([Y(Bi)],ln.prototype,"resetCooldownsAndEmitNewRoundEventToSpells",null);F([Y(Mo)],ln.prototype,"dispelUnitOnDeath",null);F([Y(aa)],ln.prototype,"addCombatModsToUnit",null);F([Y(la)],ln.prototype,"removeCombatModsToUnit",null);var Yc=dt,ku=jt({prefix:"Structure",events:{NewDayBegins:Yc(),NewWeekBegins:Yc(),StructVisited:Yc(),StructInspected:Yc()}}),ws=ku.events;var Kc=(()=>{let e=class e extends oi{constructor(){super(...arguments),this.marketState=k({resources:{gems:0,gold:0,redCrystals:0,wood:0}})}create({townBase:t}){this.base=t,this.initTownBuildings(),this.initUnitGrowthAndAvailability(),this.getApi().events.on(io).subscribe(o=>{this.updateAvailableUnitsByWeeklyGrowth(),this.getApi().eventFeed.pushPlainMessage(`The army of ${this.base.name} has grown`)}),this.setMarketResources({gold:750,wood:5})}addMarketResources(t){let o=this.marketState().resources;this.setMarketResources(qh(T({},o),t))}setMarketResources(t){this.marketState.update(o=>J(T({},o),{resources:T(T({},o.resources),t)}))}updateAvailableUnitsByWeeklyGrowth(){this.getHiringBuildings().forEach(t=>{let o=t.currentBuilding.activity;this.unitsAvailableMap[o.unitGrowthGroup]+=o.growth})}initTownBuildings(){this.buildings=Object.keys(this.base.availableBuildings).reduce((t,o)=>J(T({},t),{[o]:this.getApi().gameObjects.createNewGameObject(Ng,{base:this.base.availableBuildings[o]})}),{})}initUnitGrowthAndAvailability(){let t=this.getHiringBuildings();this.growthMap=t.reduce((o,r)=>{let s=r.currentBuilding.activity,d=s.unitGrowthGroup;return o[d]=s.growth,o},{}),this.unitsAvailableMap=t.reduce((o,r)=>{let s=r.currentBuilding.activity;return o[s.unitGrowthGroup]=s.growth,o},{})}getHiringBuildings(){return Object.values(this.buildings).filter(t=>t.currentBuilding.activity?.type===st.Hiring)}};e.categoryId="town";let n=e;return n})();var Au=dt,Ou=jt({prefix:"Building",events:{NewDayBegins:Au(),NewWeekStarts:Au(),Built:Au()}}),Lr=Ou.events;var Vo=class Vo extends Te(){constructor(){super(...arguments),this.battleState=u(zt),this.structuresService=u(an),this.players=u($),this.heroesService=u(Cs),this.state=u(fe),this.eventFeedUiService=u(co),this.gameApiProvider=u(Ti),this.eventFeed=u(co),this.gameObjectsManager=u(je),this.scheduledActions=[]}openMainScreenOnGameStart(){this.events.dispatch(Li())}initializeGameMap(e){this.state.mapsState={currentMap:e.map,maps:[e.map]},this.structuresService.initStructures(e),this.events.dispatch(ga())}testSandboxScenario(e){this.state.createdGame={faction:e.faction,selectedColor:Zn.BLUE,selectedHero:e.hero,town:this.gameObjectsManager.createNewGameObject(Kc,{townBase:e.townBase})};let i=this.players.createPlayer(sn.Main,this.players.createPlayerWithHero(this.state.createdGame.selectedColor,this.state.createdGame.selectedHero,mt.Player)),t=this.players.createPlayer(sn.Neutral,{color:Zn.GRAY,type:this.state.gameSettings.get().allowNeutralControl?mt.Player:mt.AI,hero:this.heroesService.createNeutralHero(),resources:T({},Cn)});i.hero.assignOwnerPlayer(i),t.hero.assignOwnerPlayer(t),i.hero.unitGroups.forEach(o=>o.assignOwnerHero(i.hero)),t.hero.unitGroups.forEach(o=>o.assignOwnerHero(t.hero)),this.state.gameState={players:[i,t],currentPlayer:i,playersMap:new Map([[i.id,i],[t.id,t]])},this.events.dispatch(On({})),this.events.dispatch(no.PrepareGameEvent({gameMode:Mr.SandboxScenario,selectedFaction:this.state.createdGame.faction})),this.events.dispatch(br())}initPlayersOnGameStart(){let e=this.players.createPlayer(sn.Main,this.players.createPlayerWithHero(this.state.createdGame.selectedColor,this.state.createdGame.selectedHero,mt.Player)),i=this.players.createPlayer(sn.Neutral,{color:Zn.GRAY,type:this.state.gameSettings.get().allowNeutralControl?mt.Player:mt.AI,hero:this.heroesService.createNeutralHero(),resources:T({},Cn)});e.hero.assignOwnerPlayer(e),i.hero.assignOwnerPlayer(i),e.hero.unitGroups.forEach(t=>t.assignOwnerHero(e.hero)),i.hero.unitGroups.forEach(t=>t.assignOwnerHero(i.hero)),this.state.gameState={players:[e,i],currentPlayer:e,playersMap:new Map([[e.id,e],[i.id,i]])},this.events.dispatch(On({})),this.events.dispatch(no.PrepareGameEvent({gameMode:Mr.Normal,selectedFaction:this.state.createdGame.faction})),this.events.dispatch(br())}notifyBuildingsNewDayStarted(){this.state.eventHandlers.buildings.triggerAllHandlersByEvent(Lr.NewDayBegins()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(ws.NewDayBegins());let e=this.state.currentGame.globalDay;this.scheduledActions.filter(t=>t.day===e).forEach(t=>t.action()),this.scheduledActions=this.scheduledActions.filter(t=>t.day!==e)}pushEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage(e)}pushPlainEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage({message:[{type:tt.FreeHtml,htmlContent:e.message}],delay:e.delay})}addActionCardsToPlayer(e){this.eventFeedUiService.pushPlainMessage(`Received action cards:<hr> ${e.actionCardStacks.map(({card:i,count:t})=>`x${qs(t)} ${vn(i)}`).join("<br>")}`),e.actionCardStacks.forEach(({card:i,count:t})=>{e.player.addActionCards(i,t)})}activateActionCard({player:e,cardStack:i}){console.log(i);let t=i.card;i.count--,t.actionPoints&&this.events.dispatch(Qt({points:t.actionPoints})),i.count||z.removeItem(e.actionCards,i),this.eventFeed.pushPlainMessage(`${vn(t)} is used. Left: ${qs(i.count)}`),t.type===ft.PlayerAction&&t.config?.onUsedInstantly?.(this.gameApiProvider.getGameApi())}notifyBuildignsNewWeekStarted(e){this.eventFeedUiService.pushPlainMessage(`Week ${e.week} started`),this.state.eventHandlers.buildings.triggerAllHandlersByEvent(Lr.NewWeekStarts()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(ws.NewWeekBegins())}scheduleAction(e){this.scheduledActions.push({action:e.action,day:this.state.currentGame.globalDay+e.dayOffset})}openMapScreenWhenPlayerLeavesTown(){this.events.dispatch(br())}initFight(e){this.state.currentBattleState={currentPlayer:this.state.gameState.currentPlayer,enemyPlayer:e.struct.guardingPlayer}}fightStartInitQueue({players:e,unitGroups:i}){this.events.dispatch(wa()),this.battleState.initBattleState(i,e),this.events.dispatch(Gi({}))}onStructSelected(e){this.structuresService.currentStruct=e.struct}};Vo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Vo)))(t||Vo)}})(),Vo.\u0275prov=A({token:Vo,factory:Vo.\u0275fac});var Nt=Vo;F([ge(pa)],Nt.prototype,"openMainScreenOnGameStart",null);F([Y(no.GamePreparationFinished)],Nt.prototype,"initializeGameMap",null);F([Y(ma)],Nt.prototype,"testSandboxScenario",null);F([ge(ua)],Nt.prototype,"initPlayersOnGameStart",null);F([ge(mr)],Nt.prototype,"notifyBuildingsNewDayStarted",null);F([Y(yn)],Nt.prototype,"pushEventFeedMessage",null);F([Y(_n)],Nt.prototype,"pushPlainEventFeedMessage",null);F([Y(xi)],Nt.prototype,"addActionCardsToPlayer",null);F([Y(xr)],Nt.prototype,"activateActionCard",null);F([Y(io)],Nt.prototype,"notifyBuildignsNewWeekStarted",null);F([Y(_r)],Nt.prototype,"scheduleAction",null);F([ge(fa)],Nt.prototype,"openMapScreenWhenPlayerLeavesTown",null);F([Y(hr)],Nt.prototype,"initFight",null);F([Y(Ca)],Nt.prototype,"fightStartInitQueue",null);F([Y(ur)],Nt.prototype,"onStructSelected",null);var Ho=class Ho extends Te(){constructor(){super(...arguments),this.itemsService=u(rn)}triggerEventsForItems(e){this.itemsService.triggerEventForAllItemsHandlers(fu.NewRoundBegins({round:e.round}))}trigger(){this.itemsService.triggerEventForAllItemsHandlers(fu.NewRoundBegins({round:0}))}};Ho.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Ho)))(t||Ho)}})(),Ho.\u0275prov=A({token:Ho,factory:Ho.\u0275fac});var Ss=Ho;F([Y(Bi)],Ss.prototype,"triggerEventsForItems",null);F([ge(Gi)],Ss.prototype,"trigger",null);var jo=class jo extends Te(){constructor(){super(...arguments),this.curPlayerState=u(Dt),this.itemsService=u(rn),this.state=u(fe)}resetCooldowns(){this.curPlayerState.resetSpellsCooldowns()}addItemToPlayer({item:e,player:i}){let t=i.hero;t.addItem(e),t.inventory.isSlotEquipped(e.baseType.slotType)||this.events.dispatch(yr({item:e,player:i}))}removeItemFromPlayer({item:e,player:i}){i.hero.removeItem(e)}equipItem({item:e,player:i}){i.hero.equipItem(e),this.itemsService.registerItemsEventHandlers(e,i)}unequipItem({player:e,item:i}){e.hero.unequipItem(i),this.state.eventHandlers.items.removeAllHandlersForRef(i)}};jo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(jo)))(t||jo)}})(),jo.\u0275prov=A({token:jo,factory:jo.\u0275fac});var uo=jo;F([ge(Bi),ge(Gi)],uo.prototype,"resetCooldowns",null);F([Y(gn)],uo.prototype,"addItemToPlayer",null);F([Y(gr)],uo.prototype,"removeItemFromPlayer",null);F([Y(yr)],uo.prototype,"equipItem",null);F([Y(Do)],uo.prototype,"unequipItem",null);var $o=class $o extends Te(){constructor(){super(...arguments),this.structuresService=u(an),this.state=u(fe),this.gameObjectsManager=u(je)}removeActionPoints({points:e}){let i=this.state.currentGame;i.actionPoints-=e,i.actionPoints<=0&&(i.day+=1,i.globalDay+=1,i.actionPoints+=4,this.events.dispatch(mr({day:i.day})),i.day%7===0&&(i.week+=1,i.day=1,this.events.dispatch(io({week:i.week}))))}handleCompletedStructure(e){let i=e.struct.id;this.structuresService.availableStructuresMap[i]=!0,this.gameObjectsManager.getObjectByFullId(i).visited=!0,this.structuresService.playerCurrentLocId=i,this.structuresService.updateAvailableStructures(),this.events.dispatch(Qt({points:e.struct.actionPoints}))}panMapCamera(e){this.state.mapCamera.x=e.x,this.state.mapCamera.y=e.y}};$o.\u0275fac=(()=>{let e;return function(t){return(e||(e=W($o)))(t||$o)}})(),$o.\u0275prov=A({token:$o,factory:$o.\u0275fac});var Nr=$o;F([Y(Qt)],Nr.prototype,"removeActionPoints",null);F([Y(to)],Nr.prototype,"handleCompletedStructure",null);F([Y(Po)],Nr.prototype,"panMapCamera",null);var zo=class zo extends Te(){constructor(){super(...arguments),this.combatInteractor=u(Ro),this.actionHint=u(Oo),this.curPlayerState=u(Dt),this.popupService=u(Ei)}handleEnemyCardClick(e){let i=this.curPlayerState.state.get().playerCurrentState;if(i===Je.Normal){this.events.dispatch(Jn({attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}));return}i===Je.SpellTargeting&&(this.curPlayerState.onCurrentSpellCast(),this.events.dispatch(lr({player:e.attackingPlayer,spell:this.curPlayerState.state.get().currentSpell,target:e.attackedGroup})),this.curPlayerState.setSpellsOnCooldown())}handleAllyGroupClick(e){if(this.curPlayerState.state.get().playerCurrentState===Je.SpellTargeting){this.curPlayerState.onCurrentSpellCast();let i=e.unitGroup;this.events.dispatch(lr({player:i.ownerPlayer,spell:this.curPlayerState.state.get().currentSpell,target:i})),this.curPlayerState.setSpellsOnCooldown()}}handlePlayerHover(e){let i=e.hoveredCard,t=this.curPlayerState.state.get().playerCurrentState,o=this.curPlayerState.state.get().currentSpell;switch(e.hoverType){case ni.EnemyCard:if(t===Je.Normal&&this.combatInteractor.setDamageHintMessageOnCardHover(e),t===Je.SpellTargeting){let r={type:Kn.OnTargetSpell,spell:o,target:i,addedContent:o.baseType.config.getTargetActionHint?.({target:i,ownerHero:e.currentCard?.ownerHero,ownerPlayer:e.currentCard?.ownerPlayer,spellInstance:o,ownerUnit:this.curPlayerState.state.get().currentCasterUnit})};this.actionHint.hintMessage$.next(r)}break;case ni.AllyCard:if(t===Je.SpellTargeting){let r={type:Kn.OnTargetSpell,spell:o,target:i,addedContent:o.baseType.config.getTargetActionHint?.({target:i,ownerHero:e.currentCard?.ownerHero,ownerPlayer:e.currentCard?.ownerPlayer,spellInstance:o,ownerUnit:this.curPlayerState.state.get().currentCasterUnit})};this.actionHint.hintMessage$.next(r)}break;case ni.Unhover:this.actionHint.hintMessage$.next(null)}}handleRightClick(e){this.events.dispatch(Rn({unitGroup:e.unitGroup}))}displayUnitGroupInfo(e){Ki.logObjectsOnRightClick&&console.log("show info for:",e),this.popupService.createBasicPopup({data:{unitGroup:e.unitGroup},component:ol,isCloseable:!0,class:"small-padding"})}disableActionHintOnEnemyTurn(e){e.currentPlayer!==this.curPlayerState.state.get().currentPlayer?this.actionHint.disableActionHint$.next(!0):this.actionHint.disableActionHint$.next(!1)}enableActionHint(){this.actionHint.disableActionHint$.next(!1)}playerTargetsSpell(e){let i=e.player;this.combatInteractor.triggerEventForSpellHandler(e.spell,Io.PlayerTargetsSpell({target:e.target})),i.type!==mt.AI&&(this.curPlayerState.setPlayerState(Je.Normal),this.curPlayerState.resetCurrentSpell())}playerUsesInstantSpell(e){this.combatInteractor.triggerEventForSpellHandler(e.spell,Io.PlayerCastsInstantSpell({player:e.player,spell:e.spell}))}};zo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(zo)))(t||zo)}})(),zo.\u0275prov=A({token:zo,factory:zo.\u0275fac});var $i=zo;F([Y(Ba)],$i.prototype,"handleEnemyCardClick",null);F([Y(Ga)],$i.prototype,"handleAllyGroupClick",null);F([Y(Fn)],$i.prototype,"handlePlayerHover",null);F([Y(La)],$i.prototype,"handleRightClick",null);F([Y(Rn)],$i.prototype,"displayUnitGroupInfo",null);F([Y(eo)],$i.prototype,"disableActionHintOnEnemyTurn",null);F([ge(fn)],$i.prototype,"enableActionHint",null);F([Y(lr)],$i.prototype,"playerTargetsSpell",null);F([Y(ia)],$i.prototype,"playerUsesInstantSpell",null);var Wo=class Wo extends Te(){constructor(){super(...arguments),this.combatInteractor=u(Ro),this.vfxService=u(on),this.battleState=u(zt),this.spellsService=u(Go),this.units=u(Rt),this.battleLog=u(Gn),this.players=u($),this.itemsService=u(rn),this.apiProvider=u(Ti),this.state=u(fe),this.gameObjectsManager=u(je),this.eventFeed=u(co),this.structures=u(an),this.currentPlayer=u(Dt)}initPlayerItems(){let e=this.players.getCurrentPlayer();e.hero.base.initialState.items.forEach(i=>{this.events.dispatch(gn({player:e,item:this.itemsService.createItem(Le(i))}))})}initSpell({spell:e,player:i,ownerUnit:t}){e.baseType.config.flags?.isAura||(this.state.initializedSpells.updateWithCopy(r=>r.spells.push(e)),e.initCombatHandlers({actions:this.createActionsApiRef(),events:{on:r=>{Object.entries(r).forEach(([s,d])=>{let h=Jp.getEventByName(s);e.combatEventHandlers.addEventHandler(h,d)})}},vfx:{createEffectForUnitGroup:(r,s,d)=>{this.vfxService.createVfxForUnitGroup(r,{type:Bn.VfxElement,animation:s},d)},createEffectByIdForUnitGroup:(r,s,d)=>{this.vfxService.createVfxForUnitGroup(r,{type:Bn.VfxElement,animation:Le(s)},d)},createFloatingMessageForUnitGroup:(r,s,d={})=>{this.vfxService.createFloatingMessageForUnitGroup(r,s,d)},createDroppingMessageForUnitGroup:(r,s,d)=>{this.vfxService.createDroppingMessageForContainer(r,s,d)}},thisSpell:e.baseType,ownerPlayer:i,spellInstance:e,ownerHero:i.hero,ownerUnit:t}))}initItem({item:e,ownerPlayer:i}){e.baseType.config.init({actions:this.createActionsApiRef(),events:{on:t=>{Object.entries(t).forEach(([o,r])=>{let s=hu.getEventByName(o);this.state.eventHandlers.items.registerHandlerByRef(e,s,r)})}},ownerHero:i.hero,ownerPlayer:i,thisInstance:e})}buildBuilding({buildingId:e,player:i}){let t=this.state.townsByPlayers.get(i.id);if(console.log(this.state.townsByPlayers),!t)throw new Error(`Couldn't find a town by player id ${i.id}`);let o=t.buildings[e];console.log(o,t.buildings),o.built=!0,this.events.dispatch(us({building:o,player:this.players.getCurrentPlayer()})),this.state.eventHandlers.buildings.triggerRefEventHandlers(o,Lr.Built())}initBuilding({building:e,player:i}){this.state.eventHandlers.buildings.removeAllHandlersForRef(e),e.currentBuilding.config?.init({players:this.apiProvider.getPlayerApi(),localEvents:{on:t=>{Object.entries(t).forEach(([o,r])=>{let s=Ou.getEventByName(o);this.state.eventHandlers.buildings.registerHandlerByRef(e,s,r)})}},globalEvents:this.apiProvider.getGlobalEventsApi(),thisBuilding:e,gameObjects:this.gameObjectsManager})}initStructureGameObject({structure:e}){e.generator?.config?.init({structures:{updateAvailableLocations:()=>this.structures.updateAvailableStructures(),markLocationVisited:i=>{i.visited=!0,this.structures.updateAvailableStructures()}},players:this.apiProvider.getPlayerApi(),thisStruct:e,localEvents:{on:i=>{Object.entries(i).forEach(([t,o])=>{let r=ku.getEventByName(t);this.state.eventHandlers.structures.registerHandlerByRef(e,r,o)})}},eventFeed:{postEventFeedMessage:i=>this.eventFeed.pushEventFeedMessage(i),pushPlainMessage:i=>this.eventFeed.pushPlainMessage(i)},spells:this.apiProvider.getSpellsApi()})}initializeGameObjectApi(e){let i=e.gameObject;i.api={spells:this.apiProvider.getSpellsApi(),events:{on:t=>this.events.onEvent(t),dispatch:t=>this.events.dispatch(t)},gameObjects:this.gameObjectsManager,eventFeed:{postEventFeedMessage:t=>{this.eventFeed.pushEventFeedMessage(t)},pushPlainMessage:t=>this.eventFeed.pushPlainMessage(t)}}}createActionsApiRef(){return{isEnemyUnitGroup:e=>e.ownerPlayer!==this.currentPlayer.state.get().currentPlayer,getUnitsFromFightQueue:()=>this.battleState.getFightQueue(),removeTurnsFromUnitGroup:(e,i=e.turnsLeft)=>{let t=e.turnsLeft-i;t<0&&(t=0),e.patchUnitGroupState({turnsLeft:t}),this.battleState.removeUnitsWithoutTurnsFromFightQueue()},addTurnsToUnitGroup:(e,i)=>{this.battleState.addTurnsToUnitGroup(e,i)},unitGroupAttack:(e,i)=>this.events.dispatch(Jn({attackingGroup:e,attackedGroup:i})),pinAttempt:(e,i)=>{let t=e.getState(),o=i.getState();if(t.combatState.type===Mt.Pinned)return{pinFailed:!0};if(!t.groupState.isAlive||!o.groupState.isAlive)return{pinFailed:!1,pinCanceled:!0};let r=(i.modGroup.getModValue("isCavalry")||i.modGroup.getModValue("isBigCreature"))&&z.chanceRoll(.3),s=i.modGroup.getModValue("isBoss")&&z.chanceRoll(.85),d=i.modGroup.getModValue("isGiant");return r||s||d?{pinFailed:!0,unitEscapedPin:!0}:((t.combatState.type===Mt.Pinning&&t.combatState.pinning)!==i&&i.clearCombatMods(),e.setCombatState({type:Mt.Pinning,pinning:i}),i.setCombatState({type:Mt.Pinned,pinnedBy:e}),{pinFailed:!1})},getCurrentUnitGroup:()=>this.battleState.state.get().currentUnitGroup,summonUnitsForPlayer:(e,i,t)=>{let o=this.battleState.summonUnitForPlayer(e,i,t);return this.events.dispatch(oa({unitGroup:o})),o},dealDamageTo:(e,i,t,o)=>{this.combatInteractor.dealDamageTo(e,i,t,o)},createSpellInstance:(e,i)=>this.spellsService.createSpellInstance(e,i),addModifiersToUnitGroup:(e,i)=>{this.units.addModifierToUnitGroup(e,i),i.unitGroupSpeedBonus&&this.events.dispatch(na({unitGroup:e})),this.events.dispatch(Ql({unitGroup:e}))},createModifiers:e=>this.spellsService.createModifiers(e),removeModifiresFromUnitGroup:(e,i)=>{this.units.removeModifiers(e,i),this.events.dispatch(Ql({unitGroup:e}))},addSpellToUnitGroup:(e,i,t)=>{this.combatInteractor.addSpellToUnitGroup(e,i,t)},removeSpellFromUnitGroup:(e,i)=>{this.combatInteractor.removeSpellFromUnitGroup(e,i)},getUnitGroupsOfPlayer:e=>this.battleState.heroesUnitGroupsMap.get(e),getAliveUnitGroupsOfPlayer:e=>this.battleState.getAliveUnitsOfPlayer(e),getRandomEnemyPlayerGroup:()=>this.combatInteractor.getRandomEnemyUnitGroup(),getEnemyOfPlayer:e=>this.battleState.getEnemyOfPlayer(e),historyLog:e=>{this.battleLog.logSimpleMessage(e)},healUnit:(e,i)=>{let t=this.units.healUnit(e,i);return this.events.dispatch(dr({target:e,healedUnitsCount:t.revivedUnitsCount})),t}}}};Wo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Wo)))(t||Wo)}})(),Wo.\u0275prov=A({token:Wo,factory:Wo.\u0275fac});var xn=Wo;F([ge(On)],xn.prototype,"initPlayerItems",null);F([Y(ka)],xn.prototype,"initSpell",null);F([Y(Aa)],xn.prototype,"initItem",null);F([Y(Oa)],xn.prototype,"buildBuilding",null);F([Y(us)],xn.prototype,"initBuilding",null);F([Y(Fa)],xn.prototype,"initStructureGameObject",null);F([Y(Ia)],xn.prototype,"initializeGameObjectApi",null);var cl=class{_attachedHost;attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;e!=null&&(this._attachedHost=null,e.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},bs=class extends cl{component;viewContainerRef;injector;projectableNodes;constructor(e,i,t,o){super(),this.component=e,this.viewContainerRef=i,this.injector=t,this.projectableNodes=o}},qo=class extends cl{templateRef;viewContainerRef;context;injector;constructor(e,i,t,o){super(),this.templateRef=e,this.viewContainerRef=i,this.context=t,this.injector=o}get origin(){return this.templateRef.elementRef}attach(e,i=this.context){return this.context=i,super.attach(e)}detach(){return this.context=void 0,super.detach()}},Fu=class extends cl{element;constructor(e){super(),this.element=e instanceof Ue?e.nativeElement:e}},xs=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(e){if(e instanceof bs)return this._attachedPortal=e,this.attachComponentPortal(e);if(e instanceof qo)return this._attachedPortal=e,this.attachTemplatePortal(e);if(this.attachDomPortal&&e instanceof Fu)return this._attachedPortal=e,this.attachDomPortal(e)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},Zc=class extends xs{outletElement;_appRef;_defaultInjector;constructor(e,i,t){super(),this.outletElement=e,this._appRef=i,this._defaultInjector=t}attachComponentPortal(e){let i;if(e.viewContainerRef){let t=e.injector||e.viewContainerRef.injector,o=t.get(zs,null,{optional:!0})||void 0;i=e.viewContainerRef.createComponent(e.component,{index:e.viewContainerRef.length,injector:t,ngModuleRef:o,projectableNodes:e.projectableNodes||void 0}),this.setDisposeFn(()=>i.destroy())}else{let t=this._appRef,o=e.injector||this._defaultInjector||Ne.NULL,r=o.get(is,t.injector);i=Gl(e.component,{elementInjector:o,environmentInjector:r,projectableNodes:e.projectableNodes||void 0}),t.attachView(i.hostView),this.setDisposeFn(()=>{t.viewCount>0&&t.detachView(i.hostView),i.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(i)),this._attachedPortal=e,i}attachTemplatePortal(e){let i=e.viewContainerRef,t=i.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return t.rootNodes.forEach(o=>this.outletElement.appendChild(o)),t.detectChanges(),this.setDisposeFn(()=>{let o=i.indexOf(t);o!==-1&&i.remove(o)}),this._attachedPortal=e,t}attachDomPortal=e=>{let i=e.element;i.parentNode;let t=this.outletElement.ownerDocument.createComment("dom-portal");i.parentNode.insertBefore(t,i),this.outletElement.appendChild(i),this._attachedPortal=e,super.setDisposeFn(()=>{t.parentNode&&t.parentNode.replaceChild(i,t)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}};var Ru=(()=>{class n extends xs{_moduleRef=u(zs,{optional:!0});_document=u(ke);_viewContainerRef=u(Ht);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(i){this.hasAttached()&&!i&&!this._isInitialized||(this.hasAttached()&&super.detach(),i&&super.attach(i),this._attachedPortal=i||null)}attached=new ze;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(i){i.setAttachedHost(this);let t=i.viewContainerRef!=null?i.viewContainerRef:this._viewContainerRef,o=t.createComponent(i.component,{index:t.length,injector:i.injector||t.injector,projectableNodes:i.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return t!==this._viewContainerRef&&this._getRootNode().appendChild(o.hostView.rootNodes[0]),super.setDisposeFn(()=>o.destroy()),this._attachedPortal=i,this._attachedRef=o,this.attached.emit(o),o}attachTemplatePortal(i){i.setAttachedHost(this);let t=this._viewContainerRef.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=i,this._attachedRef=t,this.attached.emit(t),t}attachDomPortal=i=>{let t=i.element;t.parentNode;let o=this._document.createComment("dom-portal");i.setAttachedHost(this),t.parentNode.insertBefore(o,t),this._getRootNode().appendChild(t),this._attachedPortal=i,super.setDisposeFn(()=>{o.parentNode&&o.parentNode.replaceChild(t,o)})};_getRootNode(){let i=this._viewContainerRef.element.nativeElement;return i.nodeType===i.ELEMENT_NODE?i:i.parentNode}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[V]})}return n})();var Bu=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({})}return n})();function Xc(n){return n.buttons===0||n.detail===0}function Qc(n){let e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!e&&e.identifier===-1&&(e.radiusX==null||e.radiusX===1)&&(e.radiusY==null||e.radiusY===1)}var Gu;function KS(){if(Gu==null){let n=typeof document<"u"?document.head:null;Gu=!!(n&&(n.createShadowRoot||n.attachShadow))}return Gu}function Ms(n){if(KS()){let e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}function Jc(){let n=typeof document<"u"&&document?document.activeElement:null;for(;n&&n.shadowRoot;){let e=n.shadowRoot.activeElement;if(e===n)break;n=e}return n}function ai(n){return n.composedPath?n.composedPath()[0]:n.target}var Lu;try{Lu=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Lu=!1}var Ii=(()=>{class n{_platformId=u(or);isBrowser=this._platformId?xp(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||Lu)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var dl;function ZS(){if(dl==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>dl=!0}))}finally{dl=dl||!1}return dl}function E0(n){return ZS()?n:!!n.capture}function Nu(n,e=0){return XS(n)?Number(n):arguments.length===2?e:0}function XS(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function ki(n){return n instanceof Ue?n.nativeElement:n}var QS=new Se("cdk-input-modality-detector-options"),JS={ignoreKeys:[18,17,224,91,16]},T0=650,Uu={passive:!0,capture:!0},id=(()=>{class n{_platform=u(Ii);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new un(null);_options;_lastTouchMs=0;_onKeydown=i=>{this._options?.ignoreKeys?.some(t=>t===i.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=ai(i))};_onMousedown=i=>{Date.now()-this._lastTouchMs<T0||(this._modality.next(Xc(i)?"keyboard":"mouse"),this._mostRecentTarget=ai(i))};_onTouchstart=i=>{if(Qc(i)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=ai(i)};constructor(){let i=u(Ae),t=u(ke),o=u(QS,{optional:!0});if(this._options=T(T({},JS),o),this.modalityDetected=this._modality.pipe(ap(1)),this.modalityChanged=this.modalityDetected.pipe(vo()),this._platform.isBrowser){let r=u(pi).createRenderer(null,null);this._listenerCleanups=i.runOutsideAngular(()=>[r.listen(t,"keydown",this._onKeydown,Uu),r.listen(t,"mousedown",this._onMousedown,Uu),r.listen(t,"touchstart",this._onTouchstart,Uu)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(i=>i())}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),td=function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n}(td||{}),eb=new Se("cdk-focus-monitor-default-options"),ed=E0({passive:!0,capture:!0}),nd=(()=>{class n{_ngZone=u(Ae);_platform=u(Ii);_inputModalityDetector=u(id);_origin=null;_lastFocusOrigin;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=u(ke,{optional:!0});_stopInputModalityDetector=new X;constructor(){let i=u(eb,{optional:!0});this._detectionMode=i?.detectionMode||td.IMMEDIATE}_rootNodeFocusAndBlurListener=i=>{let t=ai(i);for(let o=t;o;o=o.parentElement)i.type==="focus"?this._onFocus(i,o):this._onBlur(i,o)};monitor(i,t=!1){let o=ki(i);if(!this._platform.isBrowser||o.nodeType!==1)return es();let r=Ms(o)||this._getDocument(),s=this._elementInfo.get(o);if(s)return t&&(s.checkChildren=!0),s.subject;let d={checkChildren:t,subject:new X,rootNode:r};return this._elementInfo.set(o,d),this._registerGlobalListeners(d),d.subject}stopMonitoring(i){let t=ki(i),o=this._elementInfo.get(t);o&&(o.subject.complete(),this._setClasses(t),this._elementInfo.delete(t),this._removeGlobalListeners(o))}focusVia(i,t,o){let r=ki(i),s=this._getDocument().activeElement;r===s?this._getClosestElementsInfo(r).forEach(([d,h])=>this._originChanged(d,t,h)):(this._setOrigin(t),typeof r.focus=="function"&&r.focus(o))}ngOnDestroy(){this._elementInfo.forEach((i,t)=>this.stopMonitoring(t))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(i){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(i)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:i&&this._isLastInteractionFromInputLabel(i)?"mouse":"program"}_shouldBeAttributedToTouch(i){return this._detectionMode===td.EVENTUAL||!!i?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(i,t){i.classList.toggle("cdk-focused",!!t),i.classList.toggle("cdk-touch-focused",t==="touch"),i.classList.toggle("cdk-keyboard-focused",t==="keyboard"),i.classList.toggle("cdk-mouse-focused",t==="mouse"),i.classList.toggle("cdk-program-focused",t==="program")}_setOrigin(i,t=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=i,this._originFromTouchInteraction=i==="touch"&&t,this._detectionMode===td.IMMEDIATE){clearTimeout(this._originTimeoutId);let o=this._originFromTouchInteraction?T0:1;this._originTimeoutId=setTimeout(()=>this._origin=null,o)}})}_onFocus(i,t){let o=this._elementInfo.get(t),r=ai(i);!o||!o.checkChildren&&t!==r||this._originChanged(t,this._getFocusOrigin(r),o)}_onBlur(i,t){let o=this._elementInfo.get(t);!o||o.checkChildren&&i.relatedTarget instanceof Node&&t.contains(i.relatedTarget)||(this._setClasses(t),this._emitOrigin(o,null))}_emitOrigin(i,t){i.subject.observers.length&&this._ngZone.run(()=>i.subject.next(t))}_registerGlobalListeners(i){if(!this._platform.isBrowser)return;let t=i.rootNode,o=this._rootNodeFocusListenerCount.get(t)||0;o||this._ngZone.runOutsideAngular(()=>{t.addEventListener("focus",this._rootNodeFocusAndBlurListener,ed),t.addEventListener("blur",this._rootNodeFocusAndBlurListener,ed)}),this._rootNodeFocusListenerCount.set(t,o+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ge(this._stopInputModalityDetector)).subscribe(r=>{this._setOrigin(r,!0)}))}_removeGlobalListeners(i){let t=i.rootNode;if(this._rootNodeFocusListenerCount.has(t)){let o=this._rootNodeFocusListenerCount.get(t);o>1?this._rootNodeFocusListenerCount.set(t,o-1):(t.removeEventListener("focus",this._rootNodeFocusAndBlurListener,ed),t.removeEventListener("blur",this._rootNodeFocusAndBlurListener,ed),this._rootNodeFocusListenerCount.delete(t))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(i,t,o){this._setClasses(i,t),this._emitOrigin(o,t),this._lastFocusOrigin=t}_getClosestElementsInfo(i){let t=[];return this._elementInfo.forEach((o,r)=>{(r===i||o.checkChildren&&r.contains(i))&&t.push([r,o])}),t}_isLastInteractionFromInputLabel(i){let{_mostRecentTarget:t,mostRecentModality:o}=this._inputModalityDetector;if(o!=="mouse"||!t||t===i||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA"||i.disabled)return!1;let r=i.labels;if(r){for(let s=0;s<r.length;s++)if(r[s].contains(t))return!0}return!1}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var od=new WeakMap,Ur=(()=>{class n{_appRef;_injector=u(Ne);_environmentInjector=u(is);load(i){let t=this._appRef=this._appRef||this._injector.get(Ws),o=od.get(t);o||(o={loaders:new Set,refs:[]},od.set(t,o),t.onDestroy(()=>{od.get(t)?.refs.forEach(r=>r.destroy()),od.delete(t)})),o.loaders.has(i)||(o.loaders.add(i),o.refs.push(Gl(i,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var I0=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(t,o){},styles:[`.cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}
`],encapsulation:2,changeDetection:0})}return n})();function Vu(n){return Array.isArray(n)?n:[n]}var ju=(()=>{class n{_platform=u(Ii);constructor(){}isDisabled(i){return i.hasAttribute("disabled")}isVisible(i){return ib(i)&&getComputedStyle(i).visibility==="visible"}isTabbable(i){if(!this._platform.isBrowser)return!1;let t=tb(db(i));if(t&&(k0(t)===-1||!this.isVisible(t)))return!1;let o=i.nodeName.toLowerCase(),r=k0(i);return i.hasAttribute("contenteditable")?r!==-1:o==="iframe"||o==="object"||this._platform.WEBKIT&&this._platform.IOS&&!lb(i)?!1:o==="audio"?i.hasAttribute("controls")?r!==-1:!1:o==="video"?r===-1?!1:r!==null?!0:this._platform.FIREFOX||i.hasAttribute("controls"):i.tabIndex>=0}isFocusable(i,t){return cb(i)&&!this.isDisabled(i)&&(t?.ignoreVisibility||this.isVisible(i))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function tb(n){try{return n.frameElement}catch{return null}}function ib(n){return!!(n.offsetWidth||n.offsetHeight||typeof n.getClientRects=="function"&&n.getClientRects().length)}function nb(n){let e=n.nodeName.toLowerCase();return e==="input"||e==="select"||e==="button"||e==="textarea"}function ob(n){return sb(n)&&n.type=="hidden"}function rb(n){return ab(n)&&n.hasAttribute("href")}function sb(n){return n.nodeName.toLowerCase()=="input"}function ab(n){return n.nodeName.toLowerCase()=="a"}function A0(n){if(!n.hasAttribute("tabindex")||n.tabIndex===void 0)return!1;let e=n.getAttribute("tabindex");return!!(e&&!isNaN(parseInt(e,10)))}function k0(n){if(!A0(n))return null;let e=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(e)?-1:e}function lb(n){let e=n.nodeName.toLowerCase(),i=e==="input"&&n.type;return i==="text"||i==="password"||e==="select"||e==="textarea"}function cb(n){return ob(n)?!1:nb(n)||rb(n)||n.hasAttribute("contenteditable")||A0(n)}function db(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}var Hu=class{_element;_checker;_ngZone;_document;_injector;_startAnchor;_endAnchor;_hasAttached=!1;startAnchorListener=()=>this.focusLastTabbableElement();endAnchorListener=()=>this.focusFirstTabbableElement();get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(e,this._startAnchor),this._toggleAnchorTabIndex(e,this._endAnchor))}_enabled=!0;constructor(e,i,t,o,r=!1,s){this._element=e,this._checker=i,this._ngZone=t,this._document=o,this._injector=s,r||this.attachAnchors()}destroy(){let e=this._startAnchor,i=this._endAnchor;e&&(e.removeEventListener("focus",this.startAnchorListener),e.remove()),i&&(i.removeEventListener("focus",this.endAnchorListener),i.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(e){return new Promise(i=>{this._executeOnStable(()=>i(this.focusInitialElement(e)))})}focusFirstTabbableElementWhenReady(e){return new Promise(i=>{this._executeOnStable(()=>i(this.focusFirstTabbableElement(e)))})}focusLastTabbableElementWhenReady(e){return new Promise(i=>{this._executeOnStable(()=>i(this.focusLastTabbableElement(e)))})}_getRegionBoundary(e){let i=this._element.querySelectorAll(`[cdk-focus-region-${e}], [cdkFocusRegion${e}], [cdk-focus-${e}]`);return e=="start"?i.length?i[0]:this._getFirstTabbableElement(this._element):i.length?i[i.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(e){let i=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(i){if(!this._checker.isFocusable(i)){let t=this._getFirstTabbableElement(i);return t?.focus(e),!!t}return i.focus(e),!0}return this.focusFirstTabbableElement(e)}focusFirstTabbableElement(e){let i=this._getRegionBoundary("start");return i&&i.focus(e),!!i}focusLastTabbableElement(e){let i=this._getRegionBoundary("end");return i&&i.focus(e),!!i}hasAttached(){return this._hasAttached}_getFirstTabbableElement(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;let i=e.children;for(let t=0;t<i.length;t++){let o=i[t].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(i[t]):null;if(o)return o}return null}_getLastTabbableElement(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;let i=e.children;for(let t=i.length-1;t>=0;t--){let o=i[t].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(i[t]):null;if(o)return o}return null}_createAnchor(){let e=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,e),e.classList.add("cdk-visually-hidden"),e.classList.add("cdk-focus-trap-anchor"),e.setAttribute("aria-hidden","true"),e}_toggleAnchorTabIndex(e,i){e?i.setAttribute("tabindex","0"):i.removeAttribute("tabindex")}toggleAnchors(e){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(e,this._startAnchor),this._toggleAnchorTabIndex(e,this._endAnchor))}_executeOnStable(e){this._injector?Pn(e,{injector:this._injector}):setTimeout(e)}},O0=(()=>{class n{_checker=u(ju);_ngZone=u(Ae);_document=u(ke);_injector=u(Ne);constructor(){u(Ur).load(I0)}create(i,t=!1){return new Hu(i,this._checker,this._ngZone,this._document,t,this._injector)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function hi(n,...e){return e.length?e.some(i=>n[i]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}function $u(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Pt(n){return n==null?"":typeof n=="string"?n:`${n}px`}var pb=new Se("cdk-dir-doc",{providedIn:"root",factory:ub});function ub(){return u(ke)}var mb=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function hb(n){let e=n?.toLowerCase()||"";return e==="auto"&&typeof navigator<"u"&&navigator?.language?mb.test(navigator.language)?"rtl":"ltr":e==="rtl"?"rtl":"ltr"}var Mn=(()=>{class n{get value(){return this.valueSignal()}valueSignal=k("ltr");change=new ze;constructor(){let i=u(pb,{optional:!0});if(i){let t=i.body?i.body.dir:null,o=i.documentElement?i.documentElement.dir:null;this.valueSignal.set(hb(t||o||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Vr;function F0(){if(Vr==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Vr=!1,Vr;if("scrollBehavior"in document.documentElement.style)Vr=!0;else{let n=Element.prototype.scrollTo;n?Vr=!/\{\s*\[native code\]\s*\}/.test(n.toString()):Vr=!1}}return Vr}var pl=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({})}return n})();var fb=20,rd=(()=>{class n{_ngZone=u(Ae);_platform=u(Ii);_renderer=u(pi).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new X;_scrolledCount=0;scrollContainers=new Map;register(i){this.scrollContainers.has(i)||this.scrollContainers.set(i,i.elementScrolled().subscribe(()=>this._scrolled.next(i)))}deregister(i){let t=this.scrollContainers.get(i);t&&(t.unsubscribe(),this.scrollContainers.delete(i))}scrolled(i=fb){return this._platform.isBrowser?new tr(t=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let o=i>0?this._scrolled.pipe(sp(i)).subscribe(t):this._scrolled.subscribe(t);return this._scrolledCount++,()=>{o.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):es()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((i,t)=>this.deregister(t)),this._scrolled.complete()}ancestorScrolled(i,t){let o=this.getAncestorScrollContainers(i);return this.scrolled(t).pipe(Ai(r=>!r||o.indexOf(r)>-1))}getAncestorScrollContainers(i){let t=[];return this.scrollContainers.forEach((o,r)=>{this._scrollableContainsElement(r,i)&&t.push(r)}),t}_scrollableContainsElement(i,t){let o=ki(t),r=i.getElementRef().nativeElement;do if(o==r)return!0;while(o=o.parentElement);return!1}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var gb=20,Hr=(()=>{class n{_platform=u(Ii);_listeners;_viewportSize;_change=new X;_document=u(ke,{optional:!0});constructor(){let i=u(Ae),t=u(pi).createRenderer(null,null);i.runOutsideAngular(()=>{if(this._platform.isBrowser){let o=r=>this._change.next(r);this._listeners=[t.listen("window","resize",o),t.listen("window","orientationchange",o)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(i=>i()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let i={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),i}getViewportRect(){let i=this.getViewportScrollPosition(),{width:t,height:o}=this.getViewportSize();return{top:i.top,left:i.left,bottom:i.top+o,right:i.left+t,height:o,width:t}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let i=this._document,t=this._getWindow(),o=i.documentElement,r=o.getBoundingClientRect(),s=-r.top||i.body.scrollTop||t.scrollY||o.scrollTop||0,d=-r.left||i.body.scrollLeft||t.scrollX||o.scrollLeft||0;return{top:s,left:d}}change(i=gb){return i>0?this._change.pipe(sp(i)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let i=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:i.innerWidth,height:i.innerHeight}:{width:0,height:0}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var zu=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({})}return n})(),Wu=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({imports:[pl,zu,pl,zu]})}return n})();var qu={},jr=(()=>{class n{_appId=u($s);getId(i){return this._appId!=="ng"&&(i+=this._appId),qu.hasOwnProperty(i)||(qu[i]=0),`${i}${qu[i]++}`}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var R0=F0();function ud(n){return new sd(n.get(Hr),n.get(ke))}var sd=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(e,i){this._viewportRuler=e,this._document=i}attach(){}enable(){if(this._canBeEnabled()){let e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=Pt(-this._previousScrollPosition.left),e.style.top=Pt(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let e=this._document.documentElement,i=this._document.body,t=e.style,o=i.style,r=t.scrollBehavior||"",s=o.scrollBehavior||"";this._isEnabled=!1,t.left=this._previousHTMLStyles.left,t.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),R0&&(t.scrollBehavior=o.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),R0&&(t.scrollBehavior=r,o.scrollBehavior=s)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let i=this._document.documentElement,t=this._viewportRuler.getViewportSize();return i.scrollHeight>t.height||i.scrollWidth>t.width}};function H0(n,e){return new ad(n.get(rd),n.get(Ae),n.get(Hr),e)}var ad=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(e,i,t,o){this._scrollDispatcher=e,this._ngZone=i,this._viewportRuler=t,this._config=o}attach(e){this._overlayRef,this._overlayRef=e}enable(){if(this._scrollSubscription)return;let e=this._scrollDispatcher.scrolled(0).pipe(Ai(i=>!i||!this._overlayRef.overlayElement.contains(i.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{let i=this._viewportRuler.getViewportScrollPosition().top;Math.abs(i-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}};var ul=class{enable(){}disable(){}attach(){}};function Yu(n,e){return e.some(i=>{let t=n.bottom<i.top,o=n.top>i.bottom,r=n.right<i.left,s=n.left>i.right;return t||o||r||s})}function B0(n,e){return e.some(i=>{let t=n.top<i.top,o=n.bottom>i.bottom,r=n.left<i.left,s=n.right>i.right;return t||o||r||s})}function Ps(n,e){return new ld(n.get(rd),n.get(Hr),n.get(Ae),e)}var ld=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(e,i,t,o){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=t,this._config=o}attach(e){this._overlayRef,this._overlayRef=e}enable(){if(!this._scrollSubscription){let e=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(e).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let i=this._overlayRef.overlayElement.getBoundingClientRect(),{width:t,height:o}=this._viewportRuler.getViewportSize();Yu(i,[{width:t,height:o,bottom:o,right:t,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},j0=(()=>{class n{_injector=u(Ne);constructor(){}noop=()=>new ul;close=i=>H0(this._injector,i);block=()=>ud(this._injector);reposition=i=>Ps(this._injector,i);static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Yo=class{positionStrategy;scrollStrategy=new ul;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;constructor(e){if(e){let i=Object.keys(e);for(let t of i)e[t]!==void 0&&(this[t]=e[t])}}},zr=class{offsetX;offsetY;panelClass;originX;originY;overlayX;overlayY;constructor(e,i,t,o,r){this.offsetX=t,this.offsetY=o,this.panelClass=r,this.originX=e.originX,this.originY=e.originY,this.overlayX=i.overlayX,this.overlayY=i.overlayY}};var cd=class{connectionPair;scrollableViewProperties;constructor(e,i){this.connectionPair=e,this.scrollableViewProperties=i}};var $0=(()=>{class n{_attachedOverlays=[];_document=u(ke);_isAttached;constructor(){}ngOnDestroy(){this.detach()}add(i){this.remove(i),this._attachedOverlays.push(i)}remove(i){let t=this._attachedOverlays.indexOf(i);t>-1&&this._attachedOverlays.splice(t,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),z0=(()=>{class n extends $0{_ngZone=u(Ae);_renderer=u(pi).createRenderer(null,null);_cleanupKeydown;add(i){super.add(i),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=i=>{let t=this._attachedOverlays;for(let o=t.length-1;o>-1;o--)if(t[o]._keydownEvents.observers.length>0){this._ngZone.run(()=>t[o]._keydownEvents.next(i));break}};static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),W0=(()=>{class n extends $0{_platform=u(Ii);_ngZone=u(Ae);_renderer=u(pi).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget;_cleanups;add(i){if(super.add(i),!this._isAttached){let t=this._document.body,o={capture:!0},r=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[r.listen(t,"pointerdown",this._pointerDownListener,o),r.listen(t,"click",this._clickListener,o),r.listen(t,"auxclick",this._clickListener,o),r.listen(t,"contextmenu",this._clickListener,o)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=t.style.cursor,t.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(i=>i()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=i=>{this._pointerDownEventTarget=ai(i)};_clickListener=i=>{let t=ai(i),o=i.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:t;this._pointerDownEventTarget=null;let r=this._attachedOverlays.slice();for(let s=r.length-1;s>-1;s--){let d=r[s];if(d._outsidePointerEvents.observers.length<1||!d.hasAttached())continue;if(G0(d.overlayElement,t)||G0(d.overlayElement,o))break;let h=d._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>h.next(i)):h.next(i)}};static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function G0(n,e){let i=typeof ShadowRoot<"u"&&ShadowRoot,t=e;for(;t;){if(t===n)return!0;t=i&&t instanceof ShadowRoot?t.host:t.parentNode}return!1}var q0=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(t,o){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}
`],encapsulation:2,changeDetection:0})}return n})(),md=(()=>{class n{_platform=u(Ii);_containerElement;_document=u(ke);_styleLoader=u(Ur);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let i="cdk-overlay-container";if(this._platform.isBrowser||$u()){let o=this._document.querySelectorAll(`.${i}[platform="server"], .${i}[platform="test"]`);for(let r=0;r<o.length;r++)o[r].remove()}let t=this._document.createElement("div");t.classList.add(i),$u()?t.setAttribute("platform","test"):this._platform.isBrowser||t.setAttribute("platform","server"),this._document.body.appendChild(t),this._containerElement=t}_loadStyles(){this._styleLoader.load(q0)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ku=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(e,i,t,o){this._renderer=i,this._ngZone=t,this.element=e.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=i.listen(this.element,"click",o)}detach(){this._ngZone.runOutsideAngular(()=>{let e=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(e,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),e.style.pointerEvents="none",e.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}},Ds=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new X;_attachments=new X;_detachments=new X;_positionStrategy;_scrollStrategy;_locationChanges=yi.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_previousHostParent;_keydownEvents=new X;_outsidePointerEvents=new X;_afterNextRenderRef;constructor(e,i,t,o,r,s,d,h,_,C=!1,O,R){this._portalOutlet=e,this._host=i,this._pane=t,this._config=o,this._ngZone=r,this._keyboardDispatcher=s,this._document=d,this._location=h,this._outsideClickDispatcher=_,this._animationsDisabled=C,this._injector=O,this._renderer=R,o.scrollStrategy&&(this._scrollStrategy=o.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=o.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let i=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=Pn(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof i?.onDestroy=="function"&&i.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),i}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let e=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){let e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,e&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=T(T({},this._config),e),this._updateElementSize()}setDirection(e){this._config=J(T({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){let e=this._config.direction;return e?typeof e=="string"?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let e=this._pane.style;e.width=Pt(this._config.width),e.height=Pt(this._config.height),e.minWidth=Pt(this._config.minWidth),e.minHeight=Pt(this._config.minHeight),e.maxWidth=Pt(this._config.maxWidth),e.maxHeight=Pt(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){let e="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new Ku(this._document,this._renderer,this._ngZone,i=>{this._backdropClick.next(i)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(e))}):this._backdropRef.element.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(e,i,t){let o=Vu(i||[]).filter(r=>!!r);o.length&&(t?e.classList.add(...o):e.classList.remove(...o))}_detachContentWhenEmpty(){let e=!1;try{this._detachContentAfterRenderRef=Pn(()=>{e=!0,this._detachContent()},{injector:this._injector})}catch(i){if(e)throw i;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let e=this._scrollStrategy;e?.disable(),e?.detach?.()}},L0="cdk-overlay-connected-position-bounding-box",yb=/([A-Za-z%]+)$/;function hd(n,e){return new dd(e,n.get(Hr),n.get(ke),n.get(Ii),n.get(md))}var dd=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed;_boundingBox;_lastPosition;_lastScrollVisibility;_positionChanges=new X;_resizeSubscription=yi.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount;positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(e,i,t,o,r){this._viewportRuler=i,this._document=t,this._platform=o,this._overlayContainer=r,this.setOrigin(e)}attach(e){this._overlayRef&&this._overlayRef,this._validatePositions(),e.hostElement.classList.add(L0),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let e=this._originRect,i=this._overlayRect,t=this._viewportRect,o=this._containerRect,r=[],s;for(let d of this._preferredPositions){let h=this._getOriginPoint(e,o,d),_=this._getOverlayPoint(h,i,d),C=this._getOverlayFit(_,i,t,d);if(C.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(d,h);return}if(this._canFitWithFlexibleDimensions(C,_,t)){r.push({position:d,origin:h,overlayRect:i,boundingBoxRect:this._calculateBoundingBoxRect(h,d)});continue}(!s||s.overlayFit.visibleArea<C.visibleArea)&&(s={overlayFit:C,overlayPoint:_,originPoint:h,position:d,overlayRect:i})}if(r.length){let d=null,h=-1;for(let _ of r){let C=_.boundingBoxRect.width*_.boundingBoxRect.height*(_.position.weight||1);C>h&&(h=C,d=_)}this._isPushed=!1,this._applyPosition(d.position,d.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(s.position,s.originPoint);return}this._applyPosition(s.position,s.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&$r(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(L0),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let i=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,i)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,e.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,i,t){let o;if(t.originX=="center")o=e.left+e.width/2;else{let s=this._isRtl()?e.right:e.left,d=this._isRtl()?e.left:e.right;o=t.originX=="start"?s:d}i.left<0&&(o-=i.left);let r;return t.originY=="center"?r=e.top+e.height/2:r=t.originY=="top"?e.top:e.bottom,i.top<0&&(r-=i.top),{x:o,y:r}}_getOverlayPoint(e,i,t){let o;t.overlayX=="center"?o=-i.width/2:t.overlayX==="start"?o=this._isRtl()?-i.width:0:o=this._isRtl()?0:-i.width;let r;return t.overlayY=="center"?r=-i.height/2:r=t.overlayY=="top"?0:-i.height,{x:e.x+o,y:e.y+r}}_getOverlayFit(e,i,t,o){let r=U0(i),{x:s,y:d}=e,h=this._getOffset(o,"x"),_=this._getOffset(o,"y");h&&(s+=h),_&&(d+=_);let C=0-s,O=s+r.width-t.width,R=0-d,Q=d+r.height-t.height,de=this._subtractOverflows(r.width,C,O),Ie=this._subtractOverflows(r.height,R,Q),nt=de*Ie;return{visibleArea:nt,isCompletelyWithinViewport:r.width*r.height===nt,fitsInViewportVertically:Ie===r.height,fitsInViewportHorizontally:de==r.width}}_canFitWithFlexibleDimensions(e,i,t){if(this._hasFlexibleDimensions){let o=t.bottom-i.y,r=t.right-i.x,s=N0(this._overlayRef.getConfig().minHeight),d=N0(this._overlayRef.getConfig().minWidth),h=e.fitsInViewportVertically||s!=null&&s<=o,_=e.fitsInViewportHorizontally||d!=null&&d<=r;return h&&_}return!1}_pushOverlayOnScreen(e,i,t){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};let o=U0(i),r=this._viewportRect,s=Math.max(e.x+o.width-r.width,0),d=Math.max(e.y+o.height-r.height,0),h=Math.max(r.top-t.top-e.y,0),_=Math.max(r.left-t.left-e.x,0),C=0,O=0;return o.width<=r.width?C=_||-s:C=e.x<this._viewportMargin?r.left-t.left-e.x:0,o.height<=r.height?O=h||-d:O=e.y<this._viewportMargin?r.top-t.top-e.y:0,this._previousPushAmount={x:C,y:O},{x:e.x+C,y:e.y+O}}_applyPosition(e,i){if(this._setTransformOrigin(e),this._setOverlayElementStyles(i,e),this._setBoundingBoxStyles(i,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._positionChanges.observers.length){let t=this._getScrollVisibility();if(e!==this._lastPosition||!this._lastScrollVisibility||!_b(this._lastScrollVisibility,t)){let o=new cd(e,t);this._positionChanges.next(o)}this._lastScrollVisibility=t}this._lastPosition=e,this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;let i=this._boundingBox.querySelectorAll(this._transformOriginSelector),t,o=e.overlayY;e.overlayX==="center"?t="center":this._isRtl()?t=e.overlayX==="start"?"right":"left":t=e.overlayX==="start"?"left":"right";for(let r=0;r<i.length;r++)i[r].style.transformOrigin=`${t} ${o}`}_calculateBoundingBoxRect(e,i){let t=this._viewportRect,o=this._isRtl(),r,s,d;if(i.overlayY==="top")s=e.y,r=t.height-s+this._viewportMargin;else if(i.overlayY==="bottom")d=t.height-e.y+this._viewportMargin*2,r=t.height-d+this._viewportMargin;else{let Q=Math.min(t.bottom-e.y+t.top,e.y),de=this._lastBoundingBoxSize.height;r=Q*2,s=e.y-Q,r>de&&!this._isInitialRender&&!this._growAfterOpen&&(s=e.y-de/2)}let h=i.overlayX==="start"&&!o||i.overlayX==="end"&&o,_=i.overlayX==="end"&&!o||i.overlayX==="start"&&o,C,O,R;if(_)R=t.width-e.x+this._viewportMargin*2,C=e.x-this._viewportMargin;else if(h)O=e.x,C=t.right-e.x;else{let Q=Math.min(t.right-e.x+t.left,e.x),de=this._lastBoundingBoxSize.width;C=Q*2,O=e.x-Q,C>de&&!this._isInitialRender&&!this._growAfterOpen&&(O=e.x-de/2)}return{top:s,left:O,bottom:d,right:R,width:C,height:r}}_setBoundingBoxStyles(e,i){let t=this._calculateBoundingBoxRect(e,i);!this._isInitialRender&&!this._growAfterOpen&&(t.height=Math.min(t.height,this._lastBoundingBoxSize.height),t.width=Math.min(t.width,this._lastBoundingBoxSize.width));let o={};if(this._hasExactPosition())o.top=o.left="0",o.bottom=o.right=o.maxHeight=o.maxWidth="",o.width=o.height="100%";else{let r=this._overlayRef.getConfig().maxHeight,s=this._overlayRef.getConfig().maxWidth;o.height=Pt(t.height),o.top=Pt(t.top),o.bottom=Pt(t.bottom),o.width=Pt(t.width),o.left=Pt(t.left),o.right=Pt(t.right),i.overlayX==="center"?o.alignItems="center":o.alignItems=i.overlayX==="end"?"flex-end":"flex-start",i.overlayY==="center"?o.justifyContent="center":o.justifyContent=i.overlayY==="bottom"?"flex-end":"flex-start",r&&(o.maxHeight=Pt(r)),s&&(o.maxWidth=Pt(s))}this._lastBoundingBoxSize=t,$r(this._boundingBox.style,o)}_resetBoundingBoxStyles(){$r(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){$r(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,i){let t={},o=this._hasExactPosition(),r=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(o){let C=this._viewportRuler.getViewportScrollPosition();$r(t,this._getExactOverlayY(i,e,C)),$r(t,this._getExactOverlayX(i,e,C))}else t.position="static";let d="",h=this._getOffset(i,"x"),_=this._getOffset(i,"y");h&&(d+=`translateX(${h}px) `),_&&(d+=`translateY(${_}px)`),t.transform=d.trim(),s.maxHeight&&(o?t.maxHeight=Pt(s.maxHeight):r&&(t.maxHeight="")),s.maxWidth&&(o?t.maxWidth=Pt(s.maxWidth):r&&(t.maxWidth="")),$r(this._pane.style,t)}_getExactOverlayY(e,i,t){let o={top:"",bottom:""},r=this._getOverlayPoint(i,this._overlayRect,e);if(this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,t)),e.overlayY==="bottom"){let s=this._document.documentElement.clientHeight;o.bottom=`${s-(r.y+this._overlayRect.height)}px`}else o.top=Pt(r.y);return o}_getExactOverlayX(e,i,t){let o={left:"",right:""},r=this._getOverlayPoint(i,this._overlayRect,e);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,t));let s;if(this._isRtl()?s=e.overlayX==="end"?"left":"right":s=e.overlayX==="end"?"right":"left",s==="right"){let d=this._document.documentElement.clientWidth;o.right=`${d-(r.x+this._overlayRect.width)}px`}else o.left=Pt(r.x);return o}_getScrollVisibility(){let e=this._getOriginRect(),i=this._pane.getBoundingClientRect(),t=this._scrollables.map(o=>o.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:B0(e,t),isOriginOutsideView:Yu(e,t),isOverlayClipped:B0(i,t),isOverlayOutsideView:Yu(i,t)}}_subtractOverflows(e,...i){return i.reduce((t,o)=>t-Math.max(o,0),e)}_getNarrowedViewportRect(){let e=this._document.documentElement.clientWidth,i=this._document.documentElement.clientHeight,t=this._viewportRuler.getViewportScrollPosition();return{top:t.top+this._viewportMargin,left:t.left+this._viewportMargin,right:t.left+e-this._viewportMargin,bottom:t.top+i-this._viewportMargin,width:e-2*this._viewportMargin,height:i-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,i){return i==="x"?e.offsetX==null?this._offsetX:e.offsetX:e.offsetY==null?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&Vu(e).forEach(i=>{i!==""&&this._appliedPanelClasses.indexOf(i)===-1&&(this._appliedPanelClasses.push(i),this._pane.classList.add(i))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){let e=this._origin;if(e instanceof Ue)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();let i=e.width||0,t=e.height||0;return{top:e.y,bottom:e.y+t,left:e.x,right:e.x+i,height:t,width:i}}};function $r(n,e){for(let i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n}function N0(n){if(typeof n!="number"&&n!=null){let[e,i]=n.split(yb);return!i||i==="px"?parseFloat(e):null}return n||null}function U0(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}function _b(n,e){return n===e?!0:n.isOriginClipped===e.isOriginClipped&&n.isOriginOutsideView===e.isOriginOutsideView&&n.isOverlayClipped===e.isOverlayClipped&&n.isOverlayOutsideView===e.isOverlayOutsideView}var Zu=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}],Xu=[{originX:"end",originY:"top",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"start",overlayY:"bottom"},{originX:"start",originY:"top",overlayX:"end",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"end",overlayY:"bottom"}],V0="cdk-global-overlay-wrapper";function fd(n){return new pd}var pd=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(e){let i=e.getConfig();this._overlayRef=e,this._width&&!i.width&&e.updateSize({width:this._width}),this._height&&!i.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(V0),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let e=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement.style,t=this._overlayRef.getConfig(),{width:o,height:r,maxWidth:s,maxHeight:d}=t,h=(o==="100%"||o==="100vw")&&(!s||s==="100%"||s==="100vw"),_=(r==="100%"||r==="100vh")&&(!d||d==="100%"||d==="100vh"),C=this._xPosition,O=this._xOffset,R=this._overlayRef.getConfig().direction==="rtl",Q="",de="",Ie="";h?Ie="flex-start":C==="center"?(Ie="center",R?de=O:Q=O):R?C==="left"||C==="end"?(Ie="flex-end",Q=O):(C==="right"||C==="start")&&(Ie="flex-start",de=O):C==="left"||C==="start"?(Ie="flex-start",Q=O):(C==="right"||C==="end")&&(Ie="flex-end",de=O),e.position=this._cssPosition,e.marginLeft=h?"0":Q,e.marginTop=_?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=h?"0":de,i.justifyContent=Ie,i.alignItems=_?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let e=this._overlayRef.overlayElement.style,i=this._overlayRef.hostElement,t=i.style;i.classList.remove(V0),t.justifyContent=t.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}},Y0=(()=>{class n{_injector=u(Ne);constructor(){}global(){return fd()}flexibleConnectedTo(i){return hd(this._injector,i)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Es(n,e){n.get(Ur).load(q0);let i=n.get(md),t=n.get(ke),o=n.get(jr),r=n.get(Ws),s=n.get(Mn),d=t.createElement("div"),h=t.createElement("div");h.id=o.getId("cdk-overlay-"),h.classList.add("cdk-overlay-pane"),d.appendChild(h),i.getContainerElement().appendChild(d);let _=new Zc(h,r,n),C=new Yo(e),O=n.get($e,null,{optional:!0})||n.get(pi).createRenderer(null,null);return C.direction=C.direction||s.value,new Ds(_,d,h,C,n.get(Ae),n.get(z0),t,n.get(Hl),n.get(W0),e?.disableAnimations??n.get(hh,null,{optional:!0})==="NoopAnimations",n.get(is),O)}var K0=(()=>{class n{scrollStrategies=u(j0);_positionBuilder=u(Y0);_injector=u(Ne);constructor(){}create(i){return Es(this._injector,i)}position(){return this._positionBuilder}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var vb=new Se("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let n=u(Ne);return()=>Ps(n)}});function Cb(n){let e=u(Ne);return()=>Ps(e)}var wb={provide:vb,useFactory:Cb},gd=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({providers:[K0,wb],imports:[pl,Bu,Wu,Wu]})}return n})();function bb(n,e){}var Ts=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;closePredicate;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;disableAnimations=!1;providers;container;templateContext};var xb=(()=>{class n extends xs{_elementRef=u(Ue);_focusTrapFactory=u(O0);_config;_interactivityChecker=u(ju);_ngZone=u(Ae);_focusMonitor=u(nd);_renderer=u($e);_platform=u(Ii);_document=u(ke,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=u(hn);_injector=u(Ne);_isDestroyed=!1;constructor(){super(),this._config=u(Ts,{optional:!0})||new Ts,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(i){this._ariaLabelledByQueue.push(i),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(i){let t=this._ariaLabelledByQueue.indexOf(i);t>-1&&(this._ariaLabelledByQueue.splice(t,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(i){this._portalOutlet.hasAttached();let t=this._portalOutlet.attachComponentPortal(i);return this._contentAttached(),t}attachTemplatePortal(i){this._portalOutlet.hasAttached();let t=this._portalOutlet.attachTemplatePortal(i);return this._contentAttached(),t}attachDomPortal=i=>{this._portalOutlet.hasAttached();let t=this._portalOutlet.attachDomPortal(i);return this._contentAttached(),t};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(i,t){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let o=()=>{r(),s(),i.removeAttribute("tabindex")},r=this._renderer.listen(i,"blur",o),s=this._renderer.listen(i,"mousedown",o)})),i.focus(t)}_focusByCssSelector(i,t){let o=this._elementRef.nativeElement.querySelector(i);o&&this._forceFocus(o,t)}_trapFocus(i){this._isDestroyed||Pn(()=>{let t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus(i);break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement(i)||this._focusDialogContainer(i);break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]',i);break;default:this._focusByCssSelector(this._config.autoFocus,i);break}},{injector:this._injector})}_restoreFocus(){let i=this._config.restoreFocus,t=null;if(typeof i=="string"?t=this._document.querySelector(i):typeof i=="boolean"?t=i?this._elementFocusedBeforeDialogWasOpened:null:i&&(t=i),this._config.restoreFocus&&t&&typeof t.focus=="function"){let o=Jc(),r=this._elementRef.nativeElement;(!o||o===this._document.body||o===r||r.contains(o))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(i){this._elementRef.nativeElement.focus?.(i)}_containsFocus(){let i=this._elementRef.nativeElement,t=Jc();return i===t||i.contains(t)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Jc()))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(t,o){if(t&1&&Et(Ru,7),t&2){let r;_t(r=vt())&&(o._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(t,o){t&2&&Ci("id",o._config.id||null)("role",o._config.role)("aria-modal",o._config.ariaModal)("aria-labelledby",o._config.ariaLabel?null:o._ariaLabelledByQueue[0])("aria-label",o._config.ariaLabel)("aria-describedby",o._config.ariaDescribedBy||null)},features:[V],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,o){t&1&&K(0,bb,0,0,"ng-template",0)},dependencies:[Ru],styles:[`.cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}
`],encapsulation:2})}return n})(),mo=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new X;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(e,i){this.overlayRef=e,this.config=i,this.disableClose=i.disableClose,this.backdropClick=e.backdropClick(),this.keydownEvents=e.keydownEvents(),this.outsidePointerEvents=e.outsidePointerEvents(),this.id=i.id,this.keydownEvents.subscribe(t=>{t.keyCode===27&&!this.disableClose&&!hi(t)&&(t.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{!this.disableClose&&this._canClose()?this.close(void 0,{focusOrigin:"mouse"}):this.containerInstance._recaptureFocus?.()}),this._detachSubscription=e.detachments().subscribe(()=>{i.closeOnOverlayDetachments!==!1&&this.close()})}close(e,i){if(this._canClose(e)){let t=this.closed;this.containerInstance._closeInteractionType=i?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),t.next(e),t.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(e="",i=""){return this.overlayRef.updateSize({width:e,height:i}),this}addPanelClass(e){return this.overlayRef.addPanelClass(e),this}removePanelClass(e){return this.overlayRef.removePanelClass(e),this}_canClose(e){let i=this.config;return!!this.containerInstance&&(!i.closePredicate||i.closePredicate(e,i,this.componentInstance))}},Mb=new Se("DialogScrollStrategy",{providedIn:"root",factory:()=>{let n=u(Ne);return()=>ud(n)}}),Ju=new Se("DialogData"),Db=new Se("DefaultDialogConfig");function Pb(n){let e=k(n),i=new ze;return{valueSignal:e,get value(){return e()},change:i,ngOnDestroy(){i.complete()}}}var Is=(()=>{class n{_injector=u(Ne);_defaultOptions=u(Db,{optional:!0});_parentDialog=u(n,{optional:!0,skipSelf:!0});_overlayContainer=u(md);_idGenerator=u(jr);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new X;_afterOpenedAtThisLevel=new X;_ariaHiddenElements=new Map;_scrollStrategy=u(Mb);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=rh(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Wn(void 0)));constructor(){}open(i,t){let o=this._defaultOptions||new Ts;t=T(T({},o),t),t.id=t.id||this._idGenerator.getId("cdk-dialog-"),t.id&&this.getDialogById(t.id);let r=this._getOverlayConfig(t),s=Es(this._injector,r),d=new mo(s,t),h=this._attachContainer(s,d,t);return d.containerInstance=h,this._attachDialogContent(i,d,h,t),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(d),d.closed.subscribe(()=>this._removeOpenDialog(d,!0)),this.afterOpened.next(d),d}closeAll(){Qu(this.openDialogs,i=>i.close())}getDialogById(i){return this.openDialogs.find(t=>t.id===i)}ngOnDestroy(){Qu(this._openDialogsAtThisLevel,i=>{i.config.closeOnDestroy===!1&&this._removeOpenDialog(i,!1)}),Qu(this._openDialogsAtThisLevel,i=>i.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(i){let t=new Yo({positionStrategy:i.positionStrategy||fd().centerHorizontally().centerVertically(),scrollStrategy:i.scrollStrategy||this._scrollStrategy(),panelClass:i.panelClass,hasBackdrop:i.hasBackdrop,direction:i.direction,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,width:i.width,height:i.height,disposeOnNavigation:i.closeOnNavigation,disableAnimations:i.disableAnimations});return i.backdropClass&&(t.backdropClass=i.backdropClass),t}_attachContainer(i,t,o){let r=o.injector||o.viewContainerRef?.injector,s=[{provide:Ts,useValue:o},{provide:mo,useValue:t},{provide:Ds,useValue:i}],d;o.container?typeof o.container=="function"?d=o.container:(d=o.container.type,s.push(...o.container.providers(o))):d=xb;let h=new bs(d,o.viewContainerRef,Ne.create({parent:r||this._injector,providers:s}));return i.attach(h).instance}_attachDialogContent(i,t,o,r){if(i instanceof vi){let s=this._createInjector(r,t,o,void 0),d={$implicit:r.data,dialogRef:t};r.templateContext&&(d=T(T({},d),typeof r.templateContext=="function"?r.templateContext():r.templateContext)),o.attachTemplatePortal(new qo(i,null,d,s))}else{let s=this._createInjector(r,t,o,this._injector),d=o.attachComponentPortal(new bs(i,r.viewContainerRef,s));t.componentRef=d,t.componentInstance=d.instance}}_createInjector(i,t,o,r){let s=i.injector||i.viewContainerRef?.injector,d=[{provide:Ju,useValue:i.data},{provide:mo,useValue:t}];return i.providers&&(typeof i.providers=="function"?d.push(...i.providers(t,i,o)):d.push(...i.providers)),i.direction&&(!s||!s.get(Mn,null,{optional:!0}))&&d.push({provide:Mn,useValue:Pb(i.direction)}),Ne.create({parent:s||r,providers:d})}_removeOpenDialog(i,t){let o=this.openDialogs.indexOf(i);o>-1&&(this.openDialogs.splice(o,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((r,s)=>{r?s.setAttribute("aria-hidden",r):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),t&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let i=this._overlayContainer.getContainerElement();if(i.parentElement){let t=i.parentElement.children;for(let o=t.length-1;o>-1;o--){let r=t[o];r!==i&&r.nodeName!=="SCRIPT"&&r.nodeName!=="STYLE"&&!r.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Qu(n,e){let i=n.length;for(;i--;)e(n[i])}var Dn=(()=>{let e=class e{constructor(){this.hostElem=ti(),this.renderer=u($e),this.value=N.required({alias:"mwNumberModifier"}),this.format=N("normal",{alias:"mwNumberModifierFormat"}),this.hideEmpty=N(!0),this.renderer.addClass(this.hostElem,"mod-text")}ngOnDestroy(){this.renderer.removeClass(this.hostElem,"mod-text")}ngOnChanges(){let t=this.hostElem,o=this.value();if(this.hideEmpty()&&!o){t.innerHTML="";return}if(typeof o!="number"){t.innerHTML="";return}let r=String(o);this.format()==="shortPercent"&&(r=(o*100).toFixed(0)+"%"),r=(o>0?"+":"")+r,t.innerHTML=String(r),this.renderer.setStyle(t,"color",o<0?"red":"lime")}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["","mwNumberModifier",""]],inputs:{value:[1,"mwNumberModifier","value"],format:[1,"mwNumberModifierFormat","format"],hideEmpty:[1,"hideEmpty"]},standalone:!1,features:[bt]});let n=e;return n})();function ho({api:{actions:n,players:e},expires:i=!0,expiresInNDays:t=7,mods:o}){let r=e.getCurrentPlayer().hero,s=xt.fromMods(o);r.weeklyActivitiesModGroup.addModsRef(s),i&&n.scheduleActionInGameDays(()=>{r.weeklyActivitiesModGroup.removeModsRef(s)},t)}var Ut=function(n){return n[n.WeekStart=0]="WeekStart",n[n.FullWeek=1]="FullWeek",n[n.Permanent=2]="Permanent",n[n.WeekEnd=3]="WeekEnd",n}(Ut||{}),Z0=[{id:"architecture",name:"Architecture",type:Ut.WeekStart,descriptions:["You start week with town center built, your units above tier 1 are slowed down by 4."],init({actions:n,events:e,players:i}){e.dispatch(Oa({buildingId:"town-center",player:i.getCurrentPlayer()}));let t={unitGroupSpeedBonus:-4},o={__unitConditionalMods(r){return r.type.level>1?t:null}};i.getCurrentPlayer().hero.weeklyActivitiesModGroup.addModsRef(xt.fromMods(o)),n.scheduleActionInGameDays(()=>{i.getCurrentPlayer().hero.weeklyActivitiesModGroup.removeRefByModInstance(o)},7)}},{id:"gem-cutting",name:"Gem Cutting",type:Ut.WeekEnd,descriptions:[{type:tt.Resource,resType:Oe.Gems,iconSize:48},"+8 Gems."],init({actions:n,events:e,players:i}){n.scheduleActionInGameDays(()=>{i.giveResourcesToPlayer(i.getCurrentPlayer(),{gems:8})},7)}},{id:"war-training",name:"War Training",type:Ut.FullWeek,descriptions:["Tier 1 units gain +2 to attack and defence."],init({actions:n,players:e}){let i={heroBonusAttack:2,heroBonusDefence:2},t={__unitConditionalMods(o){return o.type.level===1?i:null}};e.getCurrentPlayer().hero.weeklyActivitiesModGroup.addModsRef(xt.fromMods(t)),n.scheduleActionInGameDays(()=>{e.getCurrentPlayer().hero.weeklyActivitiesModGroup.removeRefByModInstance(t)},7)}},{id:"prosperity",name:"Prosperity",type:Ut.FullWeek,descriptions:["Income from structures increased by 10%."]},{id:"scholar",name:"Scholar",type:Ut.FullWeek,descriptions:["Experience gain is increased by 13%"],init(n){ho({api:n,mods:{experienceGainBonus:.13}})}},{id:"magic-hood",name:"Magic Hood",type:Ut.Permanent,descriptions:["Resistance against magic is increased by 5%"],init(n){ho({api:n,mods:{resistAll:5},expires:!1})}},{id:"mysticism",name:"Mysticism",type:Ut.Permanent,descriptions:["+1 Restore action card<br> +6 to Hero Mana/Max Mana (scaling)"],init(n){ho({api:n,mods:{heroMaxMana:6},expires:!1}),n.players.getCurrentPlayer().hero.addMana(6);let e=[{card:Xp,count:1}],i=n.players.getCurrentPlayer();n.events.dispatch(xi({player:i,actionCardStacks:e}))}},{id:"necromancy",name:"Necromancy",type:Ut.FullWeek,descriptions:["+1(scaling) to Necromancy"],init(n){ho({api:n,mods:{specialtyNecromancy:1}})}},{id:"standard-bearer",name:"Standard Bearer",type:Ut.Permanent,descriptions:["+1 Attack<br> +1 Defence<br> +100 Hero Health<br> +10 Hero Damage"],init(n){ho({api:n,mods:{heroBonusAttack:1,heroBonusDefence:1},expires:!1})}},{id:"masonry",name:"Masonry",type:Ut.FullWeek,descriptions:["Gold and wood requirements for building are reduced by 10%"],init(n){ho({api:n,mods:{townBuildingCostFactor:-.1}})}},{id:"nest-of-fire",name:"Nest of Fire",type:Ut.WeekEnd,descriptions:["+2 Firebirds"]},{id:"hirelings",name:"Hirelings",type:Ut.WeekEnd,descriptions:["Hire a random Tier 4."]},{id:"wind-elementals",name:"Wind Elementals",type:Ut.WeekStart,descriptions:["Replaces default army with 8 Wind Elementals"]},{id:"crystal-illness",name:"Crystal Illness",type:Ut.Permanent,descriptions:["Every day you restore +1 Mana, but gain -3 to Defence"],init(n){ho({api:n,mods:{heroBonusDefence:-3}}),n.events.onEvent(mr).subscribe(()=>{n.players.getCurrentPlayer().hero.addMana(1)})}},{id:"fire-mastery",name:"Fire Mastery",type:Ut.Permanent,descriptions:["+1 Fire Mastery"],init(n){ho({api:n,mods:{specialtyFireMastery:1}})}},{id:"tribute",name:"Tribute",type:Ut.WeekStart,descriptions:["Gives you action card 'Tribute', that allows to collect 300 gold and 2 wood for 2 action points"],init({actions:n,players:e,events:i}){let t=[{card:Zp,count:1}],o=e.getCurrentPlayer();i.dispatch(xi({player:o,actionCardStacks:t}))}}];function Eb(n,e){n&1&&p(0," Active during the week ")}function Tb(n,e){n&1&&p(0," End of the week ")}function Ib(n,e){n&1&&p(0," Start of the week ")}function kb(n,e){n&1&&p(0," Permanent Effect ")}var ks=(()=>{let e=class e{constructor(){this.activity=N.required(),this.ActivityType=Ut}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-week-activity-card"]],inputs:{activity:[1,"activity"]},standalone:!1,decls:10,vars:3,consts:[[1,"type"],[3,"descriptions"]],template:function(o,r){if(o&1&&(p(0),g(1,"hr"),a(2,"div",0),p(3," ("),x(4,Eb,1,0)(5,Tb,1,0)(6,Ib,1,0)(7,kb,1,0),p(8,`)
`),l(),g(9,"mw-description",1)),o&2){let s,d=r.activity();D(" ",d.name,`
`),c(4),M((s=r.activity().type)===r.ActivityType.FullWeek?4:s===r.ActivityType.WeekEnd?5:s===r.ActivityType.WeekStart?6:s===r.ActivityType.Permanent?7:-1),c(5),f("descriptions",d.descriptions)}},dependencies:[si],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;font-size:12px;text-align:center}[_nghost-%COMP%] > hr[_ngcontent-%COMP%]{width:90%}.active[_nghost-%COMP%]{background-color:#9296cf3b}[_nghost-%COMP%] > .type[_ngcontent-%COMP%]{color:gray;white-space:nowrap;padding-bottom:2px}"]});let n=e;return n})();var Q0=(n,e)=>({color:n,background:e});function Ab(n,e){if(n&1&&(a(0,"div",5)(1,"div",6)(2,"div",7),g(3,"mw-ra-icon",3),l(),a(4,"div",8)(5,"div",9),p(6),l(),a(7,"div",10),p(8),l(),a(9,"div",10),p(10),l()()(),a(11,"div",11),g(12,"mw-spell-description",12),l()()),n&2){let i=m();c(2),f("ngStyle",Oi(8,Q0,i.uiSpellIcon().iconClr,i.uiSpellIcon().bgClr)),c(),f("icon",i.uiSpellIcon().icon),c(3),H(i.spell().name),c(2),D("Level: ",i.spell().currentLevel),c(2),D("Mana Cost: ",i.spell().currentManaCost),c(2),f("spell",i.spell())("player",i.player())("hero",i.hero())}}var ml=(()=>{let e=class e{constructor(){this.spell=N.required(),this.player=N.required(),this.hero=N.required(),this.disabled=N(!1),this.isActive=N(!1),this.hintPos=N("above"),this.clicked=mn(),this.isCurrentSpell=ae(()=>this.isActive()&&this.spell().baseType.activationType===this.activationTypes.Target),this.uiSpellIcon=ae(()=>this.spell().baseType.icon),this.activationTypes=L}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-spell-button"]],inputs:{spell:[1,"spell"],player:[1,"player"],hero:[1,"hero"],disabled:[1,"disabled"],isActive:[1,"isActive"],hintPos:[1,"hintPos"]},outputs:{clicked:"clicked"},standalone:!1,decls:6,vars:13,consts:[["hint",""],[3,"hintBody","hintPos"],[1,"ability","spell-icon",3,"click","ngStyle"],[3,"icon"],[1,"ra","light"],[2,"min-width","170px","max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[2,"padding","4px"],[2,"font-size","14px"],[2,"font-size","12px"],[2,"font-size","12px","padding","4px"],[3,"spell","player","hero"]],template:function(o,r){if(o&1){let s=I();a(0,"mw-hover-hint",1)(1,"div",2),y("click",function(){return w(s),S(r.clicked.emit(r.spell()))}),g(2,"mw-ra-icon",3)(3,"i",4),l(),K(4,Ab,13,11,"ng-template",null,0,ve),l()}if(o&2){let s=ce(5);f("hintBody",s)("hintPos",r.hintPos()),c(),me("disabled",r.disabled())("current-ability",r.isCurrentSpell()),f("ngStyle",Oi(10,Q0,r.uiSpellIcon().iconClr,r.uiSpellIcon().bgClr)),c(),f("icon",r.uiSpellIcon().icon),c(),Yi("ra-"+r.uiSpellIcon().icon)}},styles:["[_nghost-%COMP%]{display:block;max-width:56px}.ability[_ngcontent-%COMP%]{width:48px;height:42px;border:1px solid gray;font-size:13px;display:flex;justify-content:center;align-items:center;border-radius:4px;margin:4px;cursor:pointer}.current-ability[_ngcontent-%COMP%]{border:1px solid gold}.disabled[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.5}.spell-icon[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;font-size:42px;overflow:hidden}.tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}.light[_ngcontent-%COMP%]{position:absolute;mix-blend-mode:hard-light;filter:blur(4px);display:none}.ability[_ngcontent-%COMP%]:not(.no-mana):not(.disabled):hover   .light[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]:active   .spell-icon[_ngcontent-%COMP%], .spell-icon.current-ability[_ngcontent-%COMP%]{filter:brightness(.65)}"],changeDetection:0});let n=e;return n})();function Fb(n,e){if(n&1&&g(0,"mw-item-slot",4),n&2){let i=e.$implicit;f("itemSlot",i)}}function Rb(n,e){if(n&1){let i=I();a(0,"div",21),y("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.splitGroup(o))})("click",function(){w(i);let o=m().$implicit,r=m();return S(r.clickOnSlot(o))}),a(1,"span"),p(2),l(),a(3,"span"),p(4),l()()}if(n&2){let i=m().$implicit,t=m();se("background",i.unitGroup.ownerPlayer.color),me("active",i===t.activeGroupSlot),c(2),H(i.unitGroup.type.name),c(2),H(i.unitGroup.count)}}function Bb(n,e){if(n&1){let i=I();a(0,"div",21),y("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.splitGroup(o))})("click",function(){w(i);let o=m().$implicit,r=m();return S(r.clickOnSlot(o))}),l()}}function Gb(n,e){if(n&1&&x(0,Rb,5,6,"div",19)(1,Bb,1,0,"div",20),n&2){let i=e.$implicit;M(i.unitGroup?0:1)}}function Lb(n,e){if(n&1){let i=I();a(0,"div",24),y("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.splitGroup(o))})("click",function(){w(i);let o=m().$implicit,r=m();return S(r.clickOnSlot(o))}),a(1,"span"),p(2),l(),a(3,"span"),p(4),l()()}if(n&2){let i=m().$implicit,t=m();se("background",i.unitGroup.ownerPlayer.color),me("active",i===t.activeGroupSlot),c(2),H(i.unitGroup.type.name),c(2),H(i.unitGroup.count)}}function Nb(n,e){if(n&1){let i=I();a(0,"div",24),y("mwNoContextMenu",function(){w(i);let o=m().$implicit,r=m();return S(r.splitGroup(o))})("click",function(){w(i);let o=m().$implicit,r=m();return S(r.clickOnSlot(o))}),l()}}function Ub(n,e){if(n&1&&x(0,Lb,5,6,"div",22)(1,Nb,1,0,"div",23),n&2){let i=e.$implicit;M(i.unitGroup?0:1)}}function Vb(n,e){if(n&1&&(a(0,"div")(1,"div"),p(2),l()()),n&2){let i=e.$implicit;c(2),H(i)}}function Hb(n,e){if(n&1&&P(0,Vb,3,1,"div",null,j),n&2){m();let i=q(43);E(i)}}function jb(n,e){n&1&&(a(0,"div"),p(1,"No specialties"),l())}function $b(n,e){if(n&1&&(a(0,"div",13),g(1,"mw-spell-button",25),a(2,"div",26),p(3),l()()),n&2){let i=e.$implicit,t=m();c(),f("spell",i)("player",t.currentPlayer)("hero",t.currentPlayer.hero),c(2),D(" ",i.baseType.name," ")}}function zb(n,e){if(n&1&&g(0,"mw-week-activity-card",16),n&2){let i=e.$implicit;f("activity",i)}}var em=(()=>{let e=class e extends ye{constructor(t,o,r,s){super(),this.playersService=t,this.state=o,this.curPlayerState=r,this.events=s,this.currentPlayer=this.playersService.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.heroStats$=this.hero.listenHeroStats(),this.itemSlots=Vi.getSlotTypes(),this.heroSpecialties$=this.hero.specialtiesModGroup.onValueChanges().pipe(Xt(d=>Xn(d).filter(([,h])=>h).map(([h,_])=>`${Xh[h]}: ${_}`)))}splitGroup(t){this.activeGroupSlot=void 0,!(!t.unitGroup||t.unitGroup.count===1)&&this.hero.hasFreeUnitSlots()&&this.events.dispatch(ya({unitGroup:t.unitGroup}))}clickOnSlot(t){if(!this.activeGroupSlot){t.unitGroup&&(this.activeGroupSlot=t);return}if(this.activeGroupSlot){if(this.activeGroupSlot===t){this.activeGroupSlot=void 0;return}if(t.unitGroup){if(t.unitGroup.type===this.activeGroupSlot.unitGroup?.type){this.events.dispatch(_a({sourceSlot:this.activeGroupSlot,targetSlot:t,postAction:()=>{this.activeGroupSlot=void 0,this.hero.refreshUnitGroupsOrderBySlots()}}));return}Uc(this.activeGroupSlot,t),this.activeGroupSlot=void 0}else{let o=this.hero.mainUnitSlots.filter(r=>r.unitGroup).length;if(!this.activeGroupSlot.isReserve&&t.isReserve&&o===1){this.activeGroupSlot=void 0;return}t.unitGroup=this.activeGroupSlot.unitGroup,this.activeGroupSlot.unitGroup=null,this.activeGroupSlot=void 0}this.hero.refreshUnitGroupsOrderBySlots()}}};e.\u0275fac=function(o){return new(o||e)(G($),G(fe),G(Dt),G(oe))},e.\u0275cmp=v({type:e,selectors:[["mw-hero-popup"]],standalone:!1,features:[V],decls:63,vars:16,consts:[["popupContent",""],[1,"hero-panel"],[1,"items"],[2,"display","flex","flex-direction","column"],[3,"itemSlot"],[1,"info"],[2,"width","270px"],[1,"unit-groups-slots"],[1,"stats-panel"],[1,"stats"],[3,"mwNumberModifier","hideEmpty"],[1,"specialties"],[2,"margin-bottom","5px","text-align","center"],[2,"display","flex","flex-direction","column","align-items","center"],[2,"display","flex","flex-wrap","wrap","justify-content","center","gap","4px"],[1,"additional"],[1,"active",3,"activity"],["popupButtons","",2,"justify-content","end"],["mw-main-button","",3,"click"],[1,"unit-slot",3,"active","background"],[1,"unit-slot"],[1,"unit-slot",3,"mwNoContextMenu","click"],[1,"unit-slot","reserve",3,"active","background"],[1,"unit-slot","reserve"],[1,"unit-slot","reserve",3,"mwNoContextMenu","click"],[3,"spell","player","hero"],[2,"font-size","10px","text-align","center"]],template:function(o,r){if(o&1){let s=I();Re(0),xe(1,"async"),a(2,"mw-popup-base-content")(3,"div",0)(4,"div",1)(5,"div",2)(6,"div"),p(7,"Your items:"),l(),a(8,"div",3),P(9,Fb,1,1,"mw-item-slot",4,le),l()(),a(11,"div",5)(12,"div"),p(13),l(),a(14,"div"),p(15),l(),g(16,"mw-experience-bar",6),a(17,"div",7),P(18,Gb,2,1,null,null,j),l(),p(20," Reserve: "),a(21,"div",7),P(22,Ub,2,1,null,null,j),l()()(),a(24,"div",8)(25,"div",9)(26,"div"),p(27,"Resistances:"),l(),a(28,"div"),p(29," Fire: "),g(30,"span",10),l(),a(31,"div"),p(32," Cold: "),g(33,"span",10),l(),a(34,"div"),p(35," Lightning: "),g(36,"span",10),l(),a(37,"div"),p(38," Poison: "),g(39,"span",10),l(),g(40,"hr"),a(41,"div",11),p(42," Specialties: "),Re(43),xe(44,"async"),x(45,Hb,2,0)(46,jb,2,0,"div"),l(),g(47,"hr"),a(48,"div",12),p(49,"Spells:"),l(),a(50,"div",13)(51,"div",14),P(52,$b,4,4,"div",13,le),l()()(),a(54,"div",15)(55,"div"),p(56,"Activities:"),l(),a(57,"div",11),P(58,zb,1,1,"mw-week-activity-card",16,j),l()()()(),a(60,"div",17)(61,"button",18),y("click",function(){return w(s),S(r.close())}),p(62," Close "),l()()()}if(o&2){let s=Me(1,11,r.heroStats$);c(9),E(r.itemSlots),c(4),H(r.hero.base.name),c(2),D("Level ",r.hero.level),c(3),E(r.hero.mainUnitSlots),c(4),E(r.hero.reserveUnitSlots),c(8),f("mwNumberModifier",s.fireResist)("hideEmpty",!1),c(3),f("mwNumberModifier",s.coldResist)("hideEmpty",!1),c(3),f("mwNumberModifier",s.lightningResist)("hideEmpty",!1),c(3),f("mwNumberModifier",s.poisonResist)("hideEmpty",!1),c(4);let d=Ve(Me(44,13,r.heroSpecialties$));c(2),M(d.length?45:46),c(7),E(r.currentPlayer.hero.spells),c(6),E(r.hero.ownerPlayer.activities())}},dependencies:[Dn,Nn,nn,ee,we,el,ks,ml,Xi],styles:[".buttons[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}[_nghost-%COMP%]{width:500px}.hero-panel[_ngcontent-%COMP%]{text-align:left;display:flex}.items[_ngcontent-%COMP%]{margin-right:16px;font-size:10px}.info[_ngcontent-%COMP%]{font-size:12px}.unit-groups-slots[_ngcontent-%COMP%]{display:flex;padding-top:6px;gap:4px;text-align:center}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;flex-direction:column;cursor:pointer;width:52px;height:52px;border:1px solid gray;box-sizing:border-box;border-radius:4px;-webkit-user-select:none;user-select:none}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.reserve[_ngcontent-%COMP%]{width:40px;height:40px;font-size:10px;filter:brightness(.8)}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.active[_ngcontent-%COMP%]{border-color:gold;border-width:2px}.stats-panel[_ngcontent-%COMP%]{display:flex;position:absolute;left:calc(100% + 15px);box-sizing:border-box;top:0;background:#fff;font-size:13px;padding:6px 8px;width:300px;gap:6px}.stats-panel[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1}.stats-panel[_ngcontent-%COMP%]   .specialties[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.stats-panel[_ngcontent-%COMP%]   .specialties[_ngcontent-%COMP%]   mw-week-activity-card[_ngcontent-%COMP%]{padding:3px}"]});let n=e;return n})();var _d=(()=>{let e=class e{constructor(){this.imgSrc=N.required(),this.gradientClr=N.required(),this.bgGradient=ae(()=>`
    linear-gradient(
      90deg,
      ${this.gradientClr()} 0%,
      rgba(33, 33, 33, 0.272233893557423) 5%,
      rgba(255, 255, 255, 0) 50%,
      rgba(32, 32, 32, 0.1966036414565826) 95%,
      ${this.gradientClr()} 100%
    )`)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-gradient-img"]],inputs:{imgSrc:[1,"imgSrc"],gradientClr:[1,"gradientClr"]},standalone:!1,decls:2,vars:3,consts:[[3,"src"],[1,"gradient"]],template:function(o,r){o&1&&g(0,"img",0)(1,"div",1),o&2&&(f("src",r.imgSrc(),wo),c(),se("background",r.bgGradient()))},styles:["[_nghost-%COMP%]{display:block;position:relative}img[_ngcontent-%COMP%]{width:inherit;height:inherit}.gradient[_ngcontent-%COMP%]{width:inherit;height:inherit;position:absolute;inset:0}"]});let n=e;return n})();function qb(n,e){if(n&1){let i=I();a(0,"button",3),y("click",function(){w(i);let o=m();return S(o.openSandboxMode())}),p(1," Sandbox Mode "),l()}}function Yb(n,e){if(n&1){let i=I();a(0,"button",3),y("click",function(){w(i);let o=m();return S(o.openScenarioMode())}),p(1," Scenario Editor "),l()}}function Kb(n,e){if(n&1){let i=I();a(0,"button",3),y("click",function(){w(i);let o=m();return S(o.openMultiplayer())}),p(1," Multiplayer "),l()}}var J0=(()=>{let e=class e{constructor(){this.events=u(oe),this.isSandboxEnabled=kn(In.SandboxMode),this.isMultiplayerEnabled=kn(In.MultiplayerServer),this.isScenarioEditorEnabled=kn(In.ScenarioEditor)}openNewGameScreen(){this.events.dispatch(vr())}openSandboxMode(){this.events.dispatch(Da())}openScenarioMode(){this.events.dispatch(Pa())}openGlossary(){this.events.dispatch(wr())}openSettings(){this.events.dispatch(Cr())}openMultiplayer(){this.events.dispatch(Ea())}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-main-screen"]],standalone:!1,decls:14,vars:3,consts:[[1,"backdrop"],["gradientClr","rgb(12,12,12)","imgSrc","assets/background/serpent.jpg"],[1,"block"],["mw-main-button","",3,"click"],["mw-main-button",""]],template:function(o,r){o&1&&(g(0,"div",0)(1,"mw-gradient-img",1),a(2,"div",2),p(3," Mirrorwalk "),a(4,"div")(5,"button",3),y("click",function(){return r.openNewGameScreen()}),p(6," New Game "),l(),x(7,qb,2,0,"button",4),x(8,Yb,2,0,"button",4),x(9,Kb,2,0,"button",4),a(10,"button",3),y("click",function(){return r.openGlossary()}),p(11," Glossary "),l(),a(12,"button",3),y("click",function(){return r.openSettings()}),p(13," Settings "),l()()()),o&2&&(c(7),M(r.isSandboxEnabled?7:-1),c(),M(r.isScenarioEditorEnabled?8:-1),c(),M(r.isMultiplayerEnabled?9:-1))},dependencies:[_d,ee],styles:["[_nghost-%COMP%]{display:block;position:relative}.backdrop[_ngcontent-%COMP%]{background:#0b0b0b;width:100vw;height:100vh;position:fixed}mw-gradient-img[_ngcontent-%COMP%]{width:78vw;left:5%}.block[_ngcontent-%COMP%]{position:fixed;right:0;bottom:40px;width:250px;min-height:200px;padding:20px}[mw-main-button][_ngcontent-%COMP%]{width:100%}"]});let n=e;return n})();function Xb(n,e){if(n&1){let i=I();a(0,"div")(1,"input",4),y("click",function(){let o=w(i).$implicit,r=m();return S(r.setOrientation(o.value))}),l(),a(2,"label",5),p(3),l()()}if(n&2){let i=e.$implicit,t=m();c(),f("id","orient-"+i.value)("value",i.value)("checked",t.settings.orientation===i.value),c(),f("for","orient-"+i.value),c(),H(i.label)}}var ey=(()=>{let e=class e extends ye{constructor(t){super(),this.state=t,this.orientation=So,this.orientationOptions=[{label:"Vertical",value:So.Vertical},{label:"Horizontal",value:So.Horizontal}],this.settings=this.state.settings}setOrientation(t){this.state.settings.orientation=t}loadScript(){import("./chunk-DKPW6USJ.js").then(t=>{console.log("loaded script successfully!",t)})}loadScriptByPath(){var t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=o=>{var r=o.target.files[0];console.log(r);var s=new FileReader;s.readAsText(r),s.onload=d=>{var h=d.target.result;console.log(h);var _=document.createElement("script");_.innerHTML=h,_.setAttribute("type","module"),document.head.appendChild(_)}},t.click()}};e.\u0275fac=function(o){return new(o||e)(G(fe))},e.\u0275cmp=v({type:e,selectors:[["mw-settings-popup"]],standalone:!1,features:[V],decls:13,vars:0,consts:[["popupHeader",""],["popupContent",""],["mw-main-button","",3,"click"],["popupButtons",""],["type","radio","name","orientation",3,"click","id","value","checked"],[3,"for"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2," Units Orientation "),l(),a(3,"div",1),P(4,Xb,4,5,"div",null,le),a(6,"button",2),y("click",function(){return r.loadScriptByPath()}),p(7," Load Script By Path "),l(),a(8,"button",2),y("click",function(){return r.loadScript()}),p(9," Load Mod "),l()(),a(10,"div",3)(11,"button",2),y("click",function(){return r.close()}),p(12," Close "),l()()()),o&2&&(c(4),E(r.orientationOptions))},dependencies:[ee,we],encapsulation:2});let n=e;return n})();var Qb=["mapCanvas"],Jb=["underlay"],As=class As extends Te(){constructor(e,i,t){super(),this.state=e,this.ngZone=i,this.renderer=t,this.hostElem=ti(),this.mapCanvasRef=It.required("mapCanvas"),this.underlayRef=It.required("underlay"),this.mapDragEvent=mn(),this.cellSize=0,this.windowWidth=0,this.windowHeight=0,this.windowWidthHalf=0,this.windowHeightHalf=0,this.mapTotalWidth=0,this.mapTotalHeight=0,this.offsetX=0,this.offsetY=0}ngOnInit(){this.canvasElem=this.mapCanvasRef().nativeElement,this.canvasCtx=this.canvasElem.getContext("2d"),this.underlayElem=this.underlayRef().nativeElement,this.currentMap=this.state.mapsState.currentMap,this.renderMapCellsGrid(),this.setupWindowResizingHandling(),this.setupMapDragging(),this.resetCanvasPosition()}onMapClick(e){Rh()&&console.log({id:"new-id",x:e.clientX-this.offsetX,y:e.clientY-this.offsetY,icon:"sword"})}panCameraCenterTo(e){console.log("[Map View]: Pan camera center to",e);let i=-(e.x-this.windowWidthHalf),t=-(e.y-this.windowHeightHalf);this.setMapElementsPosition(i,t),this.mapDragEvent.emit({finalPosX:i,finalPosY:t})}setupMapDragging(){this.ngZone.runOutsideAngular(()=>{_i(this.hostElem,"mousedown").pipe(nr(e=>{let i=e,t=parseInt(this.canvasElem.style.left),o=parseInt(this.canvasElem.style.top);return _i(window,"mousemove").pipe(Xt(r=>{let s=r;return{xDragOffset:s.clientX-i.clientX,yDragOffset:s.clientY-i.clientY,mapPosX:t,mapPosY:o}}),Ge(yo(_i(window,"mouseup"),_i(window,"onfocusout")).pipe(Co(1))))}),this.untilDestroyed).subscribe(e=>{let i=this.windowWidthHalf,t=this.windowHeightHalf,o=e.mapPosX+e.xDragOffset,r=e.mapPosY+e.yDragOffset,s=o,d=r;o>i?s=i:o<-(this.mapTotalWidth-i)&&(s=-(this.mapTotalWidth-i)),r>t?d=t:r<-(this.mapTotalHeight-t)&&(d=-(this.mapTotalHeight-t)),this.state.mapCamera.x=s*-1+i,this.state.mapCamera.y=d*-1+t,this.setMapElementsPosition(s,d),this.mapDragEvent.emit({finalPosX:s,finalPosY:d})})})}setMapElementsPosition(e,i){this.offsetX=e,this.offsetY=i,this.renderer.setStyle(this.canvasElem,"left",`${e}px`),this.renderer.setStyle(this.canvasElem,"top",`${i}px`)}resetCanvasPosition(){this.offsetX=0,this.offsetY=0,this.renderer.setStyle(this.canvasElem,"left","0px"),this.renderer.setStyle(this.canvasElem,"top","0px")}renderMapCellsGrid(){let{heightInCells:e,widthInCells:i,cellSize:t}=this.currentMap.mapSize;this.cellSize=t;let o=i*t,r=e*t;this.mapTotalWidth=o,this.mapTotalHeight=r,this.canvasElem.width=o,this.canvasElem.height=r;let s=this.canvasCtx;for(let d=0;d<=e;d++)s.moveTo(0,d*t),s.lineTo(o,d*t);for(let d=0;d<=i;d++)s.moveTo(d*t,0),s.lineTo(d*t,r);s.setLineDash([5,8]),s.lineWidth=.5,s.strokeStyle="gray",s.stroke()}setupWindowResizingHandling(){this.updateWindowSizeData(),this.updateUnderlaySize(),this.ngZone.runOutsideAngular(()=>{_i(window,"resize").pipe(this.untilDestroyed).subscribe(()=>{this.updateWindowSizeData(),this.updateUnderlaySize(),this.panCameraCenterTo(this.state.mapCamera)})})}updateWindowSizeData(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.windowWidthHalf=this.windowWidth/2,this.windowHeightHalf=this.windowHeight/2}updateUnderlaySize(){this.renderer.setStyle(this.underlayElem,"width",`${this.windowWidth}px`),this.renderer.setStyle(this.underlayElem,"height",`${this.windowHeight}px`)}};As.\u0275fac=function(i){return new(i||As)(G(fe),G(Ae),G($e))},As.\u0275cmp=v({type:As,selectors:[["mw-map-canvas"]],viewQuery:function(i,t){i&1&&(Tt(t.mapCanvasRef,Qb,5),Tt(t.underlayRef,Jb,5)),i&2&&ei(2)},outputs:{mapDragEvent:"mapDragEvent"},standalone:!1,features:[V],decls:4,vars:0,consts:[["underlay",""],["mapCanvas",""],[1,"underlay"],[3,"click"]],template:function(i,t){if(i&1){let o=I();g(0,"div",2,0),a(2,"canvas",3,1),y("click",function(s){return w(o),S(t.onMapClick(s))}),l()}},styles:[".underlay[_ngcontent-%COMP%]{background-color:#e9e9e9;z-index:-3;position:absolute;-webkit-user-select:none;user-select:none}canvas[_ngcontent-%COMP%]{position:absolute;background:#f5f5f5;z-index:-2;-webkit-user-select:none;user-select:none}"]});var Os=As;F([Y(Po)],Os.prototype,"panCameraCenterTo",null);var Yt=(()=>{let e=class e{constructor(){this.actionHint=u(Oo),this.mwActionHint=N.required()}ngOnDestroy(){this.actionHint.hintMessage$.next(null)}showHint(){this.actionHint.hintMessage$.next({type:Kn.CustomHtml,html:this.mwActionHint()})}hideHint(){this.actionHint.hintMessage$.next(null)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["","mwActionHint",""]],hostBindings:function(o,r){o&1&&y("mouseenter",function(){return r.showHint()})("mouseleave",function(){return r.hideHint()})},inputs:{mwActionHint:[1,"mwActionHint"]},standalone:!1});let n=e;return n})();function tx(n,e){if(n&1&&(a(0,"div",1),p(1),l()),n&2){let i=m();c(),D(" ",i.struct.actionPoints," ")}}var tm=(()=>{let e=class e{constructor(){this.isAvailable=!1,this.isCurrentLoc=!1,this.activeLocColor="",this.structSelected=new ze}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-map-structure"]],inputs:{struct:"struct",isAvailable:"isAvailable",isCurrentLoc:"isCurrentLoc",activeLocColor:"activeLocColor"},outputs:{structSelected:"structSelected"},standalone:!1,decls:2,vars:13,consts:[[1,"struct-icon",3,"click","mwActionHint","icon"],[1,"loc-action-points"]],template:function(o,r){o&1&&(a(0,"mw-ra-icon",0),y("click",function(){return r.structSelected.emit(r.struct)}),l(),x(1,tx,2,1,"div",1)),o&2&&(se("border-color",r.isCurrentLoc?r.activeLocColor:"rgb(90, 90, 90)"),me("available",r.isAvailable&&!r.struct.visited)("completed",r.struct.visited)("disabled",!r.isAvailable)("guards",r.struct.guard&&!r.struct.visited&&r.isAvailable),f("mwActionHint",(r.struct.guard&&r.isAvailable&&!r.struct.visited?"Attack the guard of ":"")+r.struct.name+(r.struct.visited?"<hr/>Visited":r.struct.actionPoints?"<hr/>Cost: "+r.struct.actionPoints+" action points":""))("icon",r.struct.icon),c(),M(r.isAvailable&&!r.struct.visited&&r.struct.actionPoints?1:-1))},dependencies:[Yt,Ce],styles:[".struct-icon[_ngcontent-%COMP%]{position:absolute;cursor:pointer;z-index:50;transform:translate(-50%,-50%) scale(1.2);text-align:center;font-size:20px;border:4px solid rgb(90,90,90);background-color:gray;color:#fff;border-radius:50%;width:20px;height:20px;display:block;filter:brightness(1)}.struct-icon[_ngcontent-%COMP%]:hover{filter:brightness(1);transition:.4s;transform:translate(-50%,-50%) scale(1.4)}.available[_ngcontent-%COMP%]{outline:4px solid rgba(151,133,27,.28)}.struct-icon.disabled[_ngcontent-%COMP%]{filter:brightness(.7)}.struct-icon[_ngcontent-%COMP%]:not(.disabled) ~ .path-line[_ngcontent-%COMP%]{opacity:1}.struct-icon[_ngcontent-%COMP%]:hover ~ .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:pathanim 2s linear infinite}.structure[_ngcontent-%COMP%]{width:100px;margin:10px;border-radius:6px;background:gray;color:#fff;padding:14px;cursor:pointer}.inactive[_ngcontent-%COMP%]{opacity:.5}.loc-action-points[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;z-index:50;position:relative;background:#4d4d4d;width:14px;height:14px;border-radius:50%;font-size:11px;text-align:center;color:#fff;border:2px solid;top:7px;left:5px}"]});let n=e;return n})();var nx=["locationsContainer"];function ox(n,e){if(n&1){let i=I();a(0,"mw-map-canvas",5),y("mapDragEvent",function(o){w(i);let r=m();return S(r.updateLocationsPosition(o))}),l()}}function rx(n,e){if(n&1&&(a(0,"div",6)(1,"span",10),p(2),l()()),n&2){let i=m().$implicit;se("left",i.x,"px")("top",i.y,"px"),c(2),D(" ",i.id," ")}}function sx(n,e){if(n&1&&(ch(),a(0,"svg",11),g(1,"line",12),l()),n&2){let i=m().$implicit;se("left",i.svg.x,"px")("top",i.svg.y,"px"),Ci("width",i.svg.width)("height",i.svg.height),c(),Ci("x1",i.svg.ox)("y1",i.svg.oy)("x2",i.svg.tx)("y2",i.svg.ty)}}function ax(n,e){if(n&1){let i=I();a(0,"div",2)(1,"div",6)(2,"mw-map-structure",7),y("structSelected",function(o){w(i);let r=m();return S(r.onStructureSelected(o))}),l()(),x(3,rx,3,5,"div",8),x(4,sx,2,10,":svg:svg",9),l()}if(n&2){let i=e.$implicit,t=m();c(),se("left",i.x,"px")("top",i.y,"px"),c(),f("struct",i)("isAvailable",t.structsService.availableStructuresMap[i.id])("isCurrentLoc",t.structsService.playerCurrentLocId===i.id)("activeLocColor",t.state.createdGame.selectedColor),c(),M(t.isLocIdVisible?3:-1),c(),M(i.svg?4:-1)}}var im=(()=>{let e=class e extends Te(){constructor(t,o,r,s,d){super(),this.playersService=t,this.state=o,this.structsService=r,this.renderer=s,this.gameObjectsManager=d,this.player=this.playersService.getCurrentPlayer(),this.isLocIdVisible=Ki.showLocationsIds,Rc(()=>{this.state.mainMenu.isOpen||this.events.dispatch(Sr())})}ngAfterViewInit(){if(this.state.mapCamera.cameraInitialized){let{x:r,y:s}=this.state.mapCamera;this.events.dispatch(Po({x:r,y:s}));return}let t=this.state.mapsState.currentMap.startingLocId,o=this.gameObjectsManager.getObjectById(Ir,t);o?this.events.dispatch(Po({x:o.x,y:o.y})):console.warn(`[Map View]: Couldn't find location with id ${t} to pan camera center on game start`),this.state.mapCamera.cameraInitialized=!0}updateLocationsPosition(t){let o=this.locationsRef.nativeElement;this.renderer.setStyle(o,"left",`${t.finalPosX}px`),this.renderer.setStyle(o,"top",`${t.finalPosY}px`)}onStructureSelected(t){!this.structsService.availableStructuresMap[t.id]||!t.generator||t.isInactive||(t.guard&&this.playersService.getEnemyPlayer().hero.setUnitGroups(t.guard),this.events.dispatch(ur({struct:t})))}};e.\u0275fac=function(o){return new(o||e)(G($),G(fe),G(an),G($e),G(je))},e.\u0275cmp=v({type:e,selectors:[["mw-structures-view"]],viewQuery:function(o,r){if(o&1&&Et(nx,5),o&2){let s;_t(s=vt())&&(r.locationsRef=s.first)}},standalone:!1,features:[V],decls:8,vars:1,consts:[["locationsContainer",""],[1,"map-view"],[1,"struct"],[1,"player-info-panel"],[1,"player-actions"],[3,"mapDragEvent"],[2,"position","absolute"],[3,"structSelected","struct","isAvailable","isCurrentLoc","activeLocColor"],[2,"position","absolute",3,"left","top"],["version","1.1","xmlns","http://www.w3.org/2000/svg",1,"path-line",3,"left","top"],[1,"loc-name"],["version","1.1","xmlns","http://www.w3.org/2000/svg",1,"path-line"],["stroke-dasharray","10, 13",1,"line"]],template:function(o,r){o&1&&(x(0,ox,1,0,"mw-map-canvas"),a(1,"div",1,0),P(3,ax,5,10,"div",2,le),l(),g(5,"mw-player-info-panel",3)(6,"mw-action-hint")(7,"mw-player-map-actions-panel",4)),o&2&&(M(r.state.settings.mapDebug?0:-1),c(3),E(r.structsService.viewStructures))},dependencies:[Vn,il,Br,tm,Os],styles:[".map-view[_ngcontent-%COMP%]{height:0;width:0;position:absolute;left:0;top:0;z-index:-1}@keyframes _ngcontent-%COMP%_pathanim{0%{stroke-dashoffset:0}to{stroke-dashoffset:-23}}.path-line[_ngcontent-%COMP%]{position:absolute;opacity:.4;transition:.4s;overflow:visible;min-width:15px;pointer-events:none}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%]{opacity:.6}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:_ngcontent-%COMP%_pathanim 2s linear infinite}.line[_ngcontent-%COMP%]{stroke:#000;stroke-width:5;stroke-dashoffset:0;opacity:.6}.guards[_ngcontent-%COMP%]{font-size:13px}.player-info-panel[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0}.player-actions[_ngcontent-%COMP%]{position:fixed;left:70px;top:55%;display:flex;flex-direction:column;transform:translateY(-50%)}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}.loc-name[_ngcontent-%COMP%]{position:relative;left:-50%;background:#525252;text-align:center;color:#fff;display:block;font-size:9px;padding:2px;border-radius:3px;top:12px;z-index:100000}"]});let n=e;return n})();var Rs=(()=>{let e=class e{transform(t){return Le(t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275pipe=qn({name:"entity",type:e,pure:!0,standalone:!1});let n=e;return n})();function cx(n,e){if(n&1&&g(0,"mw-res-label",9),n&2){let i=e.$implicit;f("resType",i.key)("amount",i.value)}}function dx(n,e){if(n&1){let i=I();a(0,"div",4)(1,"div"),p(2),xe(3,"entity"),l(),a(4,"div"),p(5),l(),a(6,"input",7),y("input",function(o){let r=w(i).$implicit,s=m();return S(s.updateCountForGroup(r,o))}),l(),a(7,"div"),p(8,"Cost:"),l(),a(9,"div",8),P(10,cx,1,2,"mw-res-label",9,j),xe(12,"keyvalue"),l()()}if(n&2){let i=e.$implicit,t=m();c(2),H(Me(3,6,i.hire.unitTypeId).name),c(3),H(i.count),c(),f("min",0)("max",i.hire.maxCount)("value",0)("disabled",!t.playerHasFreeSlots),c(4),E(Me(12,8,i.currentCost))}}function px(n,e){n&1&&(a(0,"div"),p(1,"You don't have enough free slots in army."),l())}var nm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.playersService=u($),this.unitGroups=u(Rt),this.canConfirm=!0,this.playerHasFreeSlots=this.playersService.getCurrentPlayer().hero.hasFreeUnitSlots()}ngOnInit(){this.hiredGroups=this.data.struct.reward.units.map(t=>{let o={},r={},s=Hi(t.unitTypeId).baseRequirements;return[Oe.Gems,Oe.Gold,Oe.RedCrystals,Oe.Wood].forEach(h=>{s[h]&&(o[h]=s[h],r[h]=0)}),{hire:t,count:0,baseCost:o,currentCost:r}})}updateCountForGroup(t,o){t.count=Number(o.target.value),this.canConfirm=!0,Object.entries(t.baseCost).forEach(([r,s])=>{t.currentCost[r]=s*t.count}),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),o=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,o),this.hiredGroups.forEach(r=>{if(r.count){let s=this.unitGroups.createUnitGroup(r.hire.unitTypeId,{count:r.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,o)=>(Object.entries(o.currentCost).forEach(([r,s])=>{let d=r;t[d]?t[d]+=o.currentCost[d]:t[d]=o.currentCost[d]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-hiring-reward-popup"]],standalone:!1,features:[V],decls:11,vars:2,consts:[[2,"padding","10px"],["popupHeader",""],["popupContent",""],[1,"units"],[1,"unit-column"],["popupButtons",""],["mw-main-button","",1,"button",3,"click","disabled"],["type","range",3,"input","min","max","value","disabled"],[1,"cost"],["display","vertical",1,"resource",3,"resType","amount"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content",0)(1,"div",1),p(2,"Hire units:"),l(),a(3,"div",2)(4,"div",3),P(5,dx,13,10,"div",4,le),l(),x(7,px,2,0,"div"),l(),a(8,"div",5)(9,"button",6),y("click",function(){return r.confirmHire()}),p(10," Confirm "),l()()()),o&2&&(c(5),E(r.hiredGroups),c(2),M(r.playerHasFreeSlots?-1:7),c(2),f("disabled",!r.canConfirm))},dependencies:[Wt,ee,we,Ri,Rs],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let n=e;return n})();function ux(n,e){if(n&1&&(a(0,"div",8),g(1,"mw-item-icon",9),a(2,"div",10),p(3),l()()),n&2){let i=e.$implicit;c(),f("item",i)("hintPos","above"),c(2),D(" ",i.baseType.name," ")}}function mx(n,e){if(n&1){let i=I();a(0,"div",7),y("click",function(){let o=w(i).$implicit,r=m();return S(r.setSelectedGroup(o))}),P(1,ux,4,3,"div",8,le),l()}if(n&2){let i=e.$implicit,t=m();me("selected",i===t.selectedGroup),c(),E(i)}}var om=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.itemsService=u(rn),this.playersService=u($)}ngOnInit(){let t=this.data.struct.reward;this.itemGroups=t.itemGroups.map(o=>o.map(r=>this.itemsService.createItem(r)))}setSelectedGroup(t){this.selectedGroup=t}onSubmit(){this.selectedGroup.forEach(t=>{this.playersService.addItemToPlayer(this.playersService.getCurrentPlayer(),t)}),this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-item-reward-popup"]],standalone:!1,features:[V],decls:11,vars:1,consts:[["popupHeader",""],[2,"text-align","center","padding-bottom","20px"],["popupContent",""],[1,"reward-container"],[1,"items-group",3,"selected"],["popupButtons","",2,"padding-top","18px"],["mw-main-button","",3,"click","disabled"],[1,"items-group",3,"click"],[2,"display","flex","flex-direction","column","align-items","center"],[3,"item","hintPos"],[2,"font-size","11px","text-align","center"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),p(3," Select Item "),l()(),a(4,"div",2)(5,"div",3),P(6,mx,3,2,"div",4,le),l()(),a(8,"div",5)(9,"button",6),y("click",function(){return r.onSubmit()}),p(10," Submit "),l()()()),o&2&&(c(6),E(r.itemGroups),c(3),f("disabled",!r.selectedGroup))},dependencies:[tn,ee,we],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.reward-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.items-group[_ngcontent-%COMP%]{margin:14px;padding:16px;border:1px solid gray;cursor:pointer}.selected[_ngcontent-%COMP%]{border-color:gold}"]});let n=e;return n})();function hx(n,e){if(n&1&&(a(0,"div",5)(1,"span"),p(2),l(),a(3,"span"),p(4),l()()),n&2){let i=e.$implicit;c(2),H(i.type.name),c(2),H(i.count)}}function fx(n,e){if(n&1&&(a(0,"div",5)(1,"span"),p(2),l(),a(3,"span"),p(4),l()()),n&2){let i=e.$implicit;c(2),H(i.type.name),c(2),H(i.count)}}function gx(n,e){if(n&1&&(p(0," ("),g(1,"span",8),p(2,") ")),n&2){let i=m(2);c(),f("mwNumberModifier",i.experienceGainBonus)}}function yx(n,e){if(n&1&&(a(0,"div")(1,"div"),p(2),x(3,gx,3,1),l()()),n&2){let i=m();c(2),D(" Experience: +",i.totalExperienceReward," "),c(),M(i.experienceGainBonus?3:-1)}}var rm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.players=u($),this.events=u(oe),this.totalGoldReward=0,this.totalExperienceReward=0,this.experienceGainBonus=this.players.getCurrentPlayer().hero.modGroup.getCalcNumModValueOrZero("experienceGainBonus")}ngOnInit(){this.data.enemyLosses.forEach(t=>{this.totalExperienceReward+=z.increaseByPercent(Math.round(t.count*t.type.neutralReward.experience),this.experienceGainBonus)})}onContinue(t){if(!t.isWin){this.close(),this.events.dispatch(Sa());return}this.close(),this.players.addExperienceToPlayersHero(this.players.getCurrentPlayerId(),this.totalExperienceReward);let r=this.players.getCurrentPlayer().resources;r[Oe.Gold]+=this.totalGoldReward,this.events.dispatch(to({struct:t.struct}))}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-post-fight-reward-popup"]],standalone:!1,features:[V],decls:21,vars:2,consts:[["popupHeader",""],[1,"header"],["popupContent",""],[2,"text-align","center"],[1,"losses-container"],[1,"loss-card"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click"],["mwNumberModifierFormat","shortPercent",3,"mwNumberModifier"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),p(3),l()(),a(4,"div",2)(5,"div")(6,"div",3),p(7,"Player's Losses"),l(),a(8,"div",4),P(9,hx,5,2,"div",5,le),l()(),a(11,"div")(12,"div",3),p(13,"Enemy's Losses"),l(),a(14,"div",4),P(15,fx,5,2,"div",5,le),l()(),x(17,yx,4,2,"div"),l(),a(18,"div",6)(19,"button",7),y("click",function(){return r.onContinue(r.data)}),p(20," Continue "),l()()()),o&2&&(c(3),H(r.data.isWin?"Win!":"Defeat"),c(6),E(r.data.playerLosses),c(6),E(r.data.enemyLosses),c(2),M(r.data.isWin?17:-1))},dependencies:[Dn,ee,we],styles:[".header[_ngcontent-%COMP%]{text-align:center;padding-bottom:16px}.losses-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.loss-card[_ngcontent-%COMP%]{width:72px;height:72px;background-color:gray;border-radius:6px;color:#fff;margin:4px;text-align:center;padding:12px 0;font-size:13px;box-sizing:border-box;display:flex;flex-direction:column}"]});let n=e;return n})();var _x=n=>({thisStruct:n});function vx(n,e){if(n&1&&(a(0,"div",2),g(1,"mw-description",7),l()),n&2){let i,t=m();c(),f("descriptions",t.data.struct.generator==null||(i=t.data.struct.generator.description(ht(1,_x,t.data.struct)))==null?null:i.descriptions)}}function Cx(n,e){if(n&1&&(p(0," ("),g(1,"span",8),p(2,") ")),n&2){let i=m();c(),f("mwNumberModifier",i.experienceGainBonus)}}var sm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.events=u(oe),this.playersService=u($),this.struct=this.data.struct,this.totalGoldReward=0,this.totalExpReward=0,this.experienceGainBonus=this.playersService.getCurrentPlayer().hero.modGroup.getCalcNumModValueOrZero("experienceGainBonus")}ngOnInit(){this.data.struct.guard?.forEach(t=>{this.totalExpReward+=Math.round(t.count*t.type.neutralReward.experience)}),this.totalExpReward=z.increaseByPercent(this.totalExpReward,this.experienceGainBonus)}onBattleConfirmed(){this.close(),this.events.dispatch(hr({struct:this.popup.data.struct}))}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-pre-fight-popup"]],standalone:!1,features:[V],decls:17,vars:5,consts:[["popupHeader",""],["popupContent",""],[1,"description"],[3,"unitGroups"],["popupButtons",""],["mw-main-button","",3,"click"],["icon","crossed-swords"],[3,"descriptions"],["mwNumberModifierFormat","shortPercent",3,"mwNumberModifier"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),l(),a(3,"div",1),x(4,vx,2,3,"div",2),a(5,"div"),g(6,"mw-unit-groups-list",3),l(),a(7,"div")(8,"div"),p(9),x(10,Cx,3,1),l()()(),a(11,"div",4)(12,"button",5),y("click",function(){return r.onBattleConfirmed()}),g(13,"mw-ra-icon",6),p(14," Fight "),l(),a(15,"button",5),y("click",function(){return r.close()}),p(16," Cancel "),l()()()),o&2&&(c(2),D(" ",r.data.struct.generator==null?null:r.data.struct.generator.name," "),c(2),M(r.data.struct.generator!=null&&r.data.struct.generator.description?4:-1),c(2),f("unitGroups",r.data.struct.guard),c(3),D(" Experience: ",r.totalExpReward," "),c(),M(r.experienceGainBonus?10:-1))},dependencies:[Dn,si,tl,Ce,ee,we],styles:[".description[_ngcontent-%COMP%]{padding:10px;text-align:center}"]});let n=e;return n})();var wx=n=>({thisStruct:n});function Sx(n,e){if(n&1&&g(0,"mw-description",3),n&2){let i,t=m();f("descriptions",t.struct.generator==null||(i=t.struct.generator.description(ht(1,wx,t.struct)))==null?null:i.descriptions)}}var am=(()=>{let e=class e extends ye{constructor(t,o,r,s){super(),this.players=t,this.apiProvider=o,this.state=r,this.events=s,this.struct=this.data.struct,this.state.eventHandlers.structures.triggerRefEventHandlers(this.struct,ws.StructInspected())}closePopup(){this.close()}accept(){let t=this.players.getCurrentPlayer(),o=this.data.struct;o.generator?.onVisited?.({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:t}),this.state.eventHandlers.structures.triggerRefEventHandlers(this.data.struct,ws.StructVisited({visitingPlayer:this.players.getCurrentPlayer()}));let r=this.data.struct.actionPoints;r&&this.events.dispatch(Qt({points:r})),o.isInactive=!0,this.closePopup()}};e.\u0275fac=function(o){return new(o||e)(G($),G(Ti),G(fe),G(oe))},e.\u0275cmp=v({type:e,selectors:[["mw-preview-popup"]],standalone:!1,features:[V],decls:11,vars:3,consts:[["popupHeader",""],["popupContent",""],[2,"white-space","pre","padding","16px"],[3,"descriptions"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),l(),a(3,"div",1)(4,"div",2),x(5,Sx,1,3,"mw-description",3),l()(),a(6,"div",4)(7,"button",5),y("click",function(){return r.accept()}),p(8,"Accept"),l(),a(9,"button",6),y("click",function(){return r.closePopup()}),p(10,"Cancel"),l()()()),o&2&&(c(2),D(" ",r.data.struct.name," "),c(3),M(r.struct.generator!=null&&r.struct.generator.description?5:-1),c(2),f("disabled",(r.struct.controls==null?null:r.struct.controls.accept)===!1))},dependencies:[si,ee,we],styles:["[_nghost-%COMP%]{text-align:center}"]});let n=e;return n})();function bx(n,e){if(n&1&&(a(0,"div",7),g(1,"mw-res-label",8),l()),n&2){let i=e.$implicit;c(),f("resType",i.type)("amount",i.count)}}function xx(n,e){if(n&1){let i=I();a(0,"div",6),y("click",function(){let o=w(i).$implicit,r=m();return S(r.setCurrentReward(r.data,o))}),P(1,bx,2,2,"div",7,le),l()}if(n&2){let i=e.$implicit,t=m();me("selected",t.data.selectedRewardGroup===i),c(),E(i)}}var lm=(()=>{let e=class e extends ye{constructor(t){super(),this.playersService=t}ngOnInit(){this.resourceGroups=this.data.struct.reward.resourceGroups}setCurrentReward(t,o){t.selectedRewardGroup=o}confirmResources(t){this.close(),t.selectedRewardGroup&&t.selectedRewardGroup.forEach(o=>{this.playersService.addResourceToPlayer(this.playersService.getCurrentPlayer(),o.type,o.count)})}};e.\u0275fac=function(o){return new(o||e)(G($))},e.\u0275cmp=v({type:e,selectors:[["mw-resources-reward-popup"]],standalone:!1,features:[V],decls:10,vars:1,consts:[["popupHeader",""],["popupContent",""],[1,"reources-rewards"],[1,"resource-column",3,"selected"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click","disabled"],[1,"resource-column",3,"click"],[1,"resource-card"],["display","vertical",3,"resType","amount"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2,"Select Reward:"),l(),a(3,"div",1)(4,"div",2),P(5,xx,3,2,"div",3,le),l()(),a(7,"div",4)(8,"button",5),y("click",function(){return r.confirmResources(r.data)}),p(9," Confirm "),l()()()),o&2&&(c(5),E(r.resourceGroups),c(3),f("disabled",!r.data.selectedRewardGroup))},dependencies:[Wt,ee,we],styles:[".reources-rewards[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 10px}.resource-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;margin:0 20px;cursor:pointer;width:120px}.resource-column.selected[_ngcontent-%COMP%]{border:1px solid gold;margin:0 20px}.resource-card[_ngcontent-%COMP%]{text-align:center;margin:10px}"]});let n=e;return n})();var cm=(()=>{let e=class e extends ye{constructor(t,o,r){super(),this.players=t,this.apiProvider=o,this.events=r}ngOnInit(){let o=this.data.struct.generator?.generateReward?.();o&&(this.reward=o,this.description=o.description)}closePopup(){this.reward.onAccept({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:this.players.getCurrentPlayer()});let t=this.data.struct.actionPoints;t&&this.events.dispatch(Qt({points:t})),this.close()}};e.\u0275fac=function(o){return new(o||e)(G($),G(Ti),G(oe))},e.\u0275cmp=v({type:e,selectors:[["mw-scripted-reward-popup"]],standalone:!1,features:[V],decls:9,vars:1,consts:[["popupHeader",""],["popupContent",""],[2,"padding","10px 8px"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2," Victory! "),l(),a(3,"div",1)(4,"div",2),p(5),l()(),a(6,"div",3)(7,"button",4),y("click",function(){return r.closePopup()}),p(8,"Continue"),l()()()),o&2&&(c(5),H(r.description))},dependencies:[ee,we],encapsulation:2});let n=e;return n})();var Mx=n=>({thisStruct:n});function Dx(n,e){if(n&1&&(a(0,"div",2),g(1,"mw-description",8),l()),n&2){let i,t=m();c(),f("descriptions",t.data.struct.generator==null||(i=t.data.struct.generator.description(ht(1,Mx,t.data.struct)))==null?null:i.descriptions)}}function Px(n,e){if(n&1&&(a(0,"div",11)(1,"div"),p(2),l(),a(3,"div"),p(4),l()()),n&2){let i=e.$implicit;c(2),H(i.key),c(2),H(i.value)}}function Ex(n,e){if(n&1){let i=I();a(0,"div",4)(1,"div"),p(2),l(),a(3,"div"),p(4,"to"),l(),a(5,"div"),p(6),xe(7,"entity"),l(),a(8,"input",9),y("input",function(o){let r=w(i).$implicit,s=m();return S(s.updateCountForGroup(r,o))}),l(),a(9,"div"),p(10,"Cost:"),l(),a(11,"div",10),P(12,Px,5,2,"div",11,le),xe(14,"keyvalue"),l()()}if(n&2){let i=e.$implicit;c(2),Ee("",i.originalGroup.count," ",i.originalGroup.type.name),c(4),Ee("",i.count," ",Me(7,7,i.hire.unitTypeId).name),c(2),f("min",0)("max",i.hire.maxCount)("value",0),c(4),E(Me(14,9,i.currentCost))}}var dm=(()=>{let e=class e extends ye{constructor(t,o,r){super(),this.apiProvider=t,this.playersService=o,this.unitGroups=r,this.canConfirm=!0}ngOnInit(){this.hiredGroups=this.data.struct.reward.getUnits(this.apiProvider.getPlayerApi()).map(t=>{let o={},r={},s=t.type.upgradeDetails?.upgradeCost;return[Oe.Gems,Oe.Gold,Oe.RedCrystals,Oe.Wood].forEach(h=>{s[h]&&(o[h]=s[h],r[h]=0)}),{hire:{maxCount:t.count,unitTypeId:t.type.upgradeDetails?.target},count:0,baseCost:o,currentCost:r,originalGroup:t}})}updateCountForGroup(t,o){t.count=Number(o.target.value);let r=this.playersService.getCurrentPlayer().resources;this.canConfirm=!0,Object.entries(t.baseCost).forEach(([s,d])=>{t.currentCost[s]=d*t.count}),this.updateCanConfirm()}cancel(){this.close()}confirmHire(){let t=this.playersService.getCurrentPlayer(),o=t.resources,r=this.calcTotalCosts();Object.entries(r).forEach(([s,d])=>{o[s]-=d}),this.hiredGroups.forEach(s=>{if(s.count){this.playersService.removeNUnitsFromGroup(t,s.originalGroup,s.count);let d=this.unitGroups.createUnitGroup(s.hire.unitTypeId,{count:s.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,d)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,o)=>(Object.entries(o.currentCost).forEach(([r,s])=>{let d=r;t[d]?t[d]+=o.currentCost[d]:t[d]=o.currentCost[d]}),t),{})}updateCanConfirm(){let t=this.playersService.getCurrentPlayer().resources,o=this.calcTotalCosts();this.canConfirm=Object.entries(o).every(([r,s])=>t[r]>=s)}};e.\u0275fac=function(o){return new(o||e)(G(Ti),G($),G(Rt))},e.\u0275cmp=v({type:e,selectors:[["mw-upgrade-reward-popup"]],standalone:!1,features:[V],decls:13,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"description"],[1,"units"],[1,"unit-column"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[3,"descriptions"],["type","range",3,"input","min","max","value"],[1,"cost"],[1,"resource"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),l(),a(3,"div",1),x(4,Dx,2,3,"div",2),a(5,"div",3),P(6,Ex,15,11,"div",4,le),l()(),a(8,"div",5)(9,"button",6),y("click",function(){return r.confirmHire()}),p(10," Confirm "),l(),a(11,"button",7),y("click",function(){return r.cancel()}),p(12," Cancel "),l()()()),o&2&&(c(2),D(" ",r.data.struct.generator==null?null:r.data.struct.generator.name," "),c(2),M(r.data.struct.generator!=null&&r.data.struct.generator.description?4:-1),c(2),E(r.hiredGroups),c(3),f("disabled",!r.canConfirm))},dependencies:[si,ee,we,Ri,Rs],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.description[_ngcontent-%COMP%]{text-align:center;font-size:13px;padding:7px}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let n=e;return n})();var iy=[{tabId:"start",tabName:"Welcome",icon:"book",descriptions:["Welcome to the Glossary!","Here you can learn about the concepts, special interactions and other details without leaving the game."]},{tabId:"specialties",tabName:"Specialties",icon:"health-increase",descriptions:["While in the game, at the beginning of each week you are welcomed by Specialties dialog.","In this dialog you can select list of bonuses & rewards granted for this week, which may affect your hero, town, units, game progression, etc.","Bonus value and variety can change with time, level, progression, etc."]},{tabId:"market",tabName:"Town: Market",icon:"gavel",descriptions:["Market is a buildable town structure where you can exchange resources.","By default, market allows you to trade basic resources: gold and wood. Market has limited amount of each resource type, preventing limitless resource conversion.","By fighting enemies on the map you are freeing passages and trading routes, enabling more resources to reach your market. In this way, aside from getting more of basic resources, advanced resources, like gems and crystals, can also appear in a wider variety on your market.","Fighting rare and more dangerous enemies will more likely yield rare resources.","Every new week your market will lose some amount of resources gained from previous week. You can upgrade market to reduce the loss and increase base resources count.","Some buildings in your town can synergize with Market, yielding some rare resources weekly."]},{tabId:"spells",tabName:"Spells & Mana",icon:"burning-book",descriptions:["Spells are special abilities of units and heroes that can be cast during the fight","Most heroic spells are only castable once per fight, forcing you to employ the strategy both during the battle and the choice of abilities.","Abilities come in 3 main activation types:","- Targetable: Requires to select a target","- Instant: Doesn't require a target, cast instantly","- Passive: Ability cannot be activated, but has a passive effect","Mana is the resource that limits your ability to cast spells for your hero and units. Units can have their own manapool, when drained - mana will be taken from their hero. As soon as mana is fully drained, abilities that require mana can no longer be cast.","Game provides different sources to replenish mana. Specialty Restoration increases most effects that restore your mana."]},{tabId:"pin",tabName:"Universal Move: Pin",icon:"crossed-swords",descriptions:["Pin is a universal attack-ability, all towns have an early unit type that can pin an opponent. Pinning an opponent will inflict normal attack and force them to do reduced damage against all your groups aside from the pinning group.","On pin, both groups enter respective states: Pinning and Pinned. A pinning group also recives increased damage from enemy's unpinned groups and deals less damage to them (by default - 25% ratio).","Special Interactions:","- Attacking or pinning another target will release previous target from pin. Attacking other group will make you lose Pinning state.","- Ranged units have lesser damage penalty when pinned.","- Cavalry and Big Creature units have natural 30% chance to escape pinning. Boss units have 85% chance to escape pin.","- Tier 1-4 units cannot pin units of 6+ tier (as well as Giant and Colossal creatures).","- Pinned units have a chance of getting increased damage from ranged units."]}];var uy=(()=>{class n{_renderer;_elementRef;onChange=i=>{};onTouched=()=>{};constructor(i,t){this._renderer=i,this._elementRef=t}setProperty(i,t){this._renderer.setProperty(this._elementRef.nativeElement,i,t)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static \u0275fac=function(t){return new(t||n)(G($e),G(Ue))};static \u0275dir=pe({type:n})}return n})(),Ns=(()=>{class n extends uy{static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,features:[V]})}return n})(),Wr=new Se(""),Tx={provide:Wr,useExisting:Wi(()=>fm),multi:!0},fm=(()=>{class n extends Ns{writeValue(i){this.setProperty("checked",i)}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(t,o){t&1&&y("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[et([Tx]),V]})}return n})(),Ix={provide:Wr,useExisting:Wi(()=>li),multi:!0};function kx(){let n=Fi()?Fi().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Ax=new Se(""),li=(()=>{class n extends uy{_compositionMode;_composing=!1;constructor(i,t,o){super(i,t),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!kx())}writeValue(i){let t=i??"";this.setProperty("value",t)}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static \u0275fac=function(t){return new(t||n)(G($e),G(Ue),G(Ax,8))};static \u0275dir=pe({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,o){t&1&&y("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[et([Ix]),V]})}return n})();var my=new Se(""),Ox=new Se("");function Fx(n){return e=>{if(e.value==null||n==null)return null;let i=parseFloat(e.value);return!isNaN(i)&&i<n?{min:{min:n,actual:e.value}}:null}}function ny(n){return null}function hy(n){return n!=null}function fy(n){return Fl(n)?ih(n):n}function gy(n){let e={};return n.forEach(i=>{e=i!=null?T(T({},e),i):e}),Object.keys(e).length===0?null:e}function yy(n,e){return e.map(i=>i(n))}function Rx(n){return!n.validate}function _y(n){return n.map(e=>Rx(e)?e:i=>e.validate(i))}function Bx(n){if(!n)return null;let e=n.filter(hy);return e.length==0?null:function(i){return gy(yy(i,e))}}function vy(n){return n!=null?Bx(_y(n)):null}function Gx(n){if(!n)return null;let e=n.filter(hy);return e.length==0?null:function(i){let t=yy(i,e).map(fy);return sh(t).pipe(Xt(gy))}}function Cy(n){return n!=null?Gx(_y(n)):null}function oy(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Lx(n){return n._rawValidators}function Nx(n){return n._rawAsyncValidators}function pm(n){return n?Array.isArray(n)?n:[n]:[]}function Cd(n,e){return Array.isArray(n)?n.includes(e):n===e}function ry(n,e){let i=pm(e);return pm(n).forEach(o=>{Cd(i,o)||i.push(o)}),i}function sy(n,e){return pm(e).filter(i=>!Cd(n,i))}var wd=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=vy(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Cy(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,i){return this.control?this.control.hasError(e,i):!1}getError(e,i){return this.control?this.control.getError(e,i):null}},um=class extends wd{name;get formDirective(){return null}get path(){return null}},_l=class extends wd{_parent=null;name=null;valueAccessor=null},mm=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Ux={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},gee=J(T({},Ux),{"[class.ng-submitted]":"isSubmitted"}),Kt=(()=>{class n extends mm{constructor(i){super(i)}static \u0275fac=function(t){return new(t||n)(G(_l,2))};static \u0275dir=pe({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,o){t&2&&me("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[V]})}return n})();var hl="VALID",vd="INVALID",Bs="PENDING",fl="DISABLED",Ls=class{},Sd=class extends Ls{value;source;constructor(e,i){super(),this.value=e,this.source=i}},gl=class extends Ls{pristine;source;constructor(e,i){super(),this.pristine=e,this.source=i}},yl=class extends Ls{touched;source;constructor(e,i){super(),this.touched=e,this.source=i}},Gs=class extends Ls{status;source;constructor(e,i){super(),this.status=e,this.source=i}};function Vx(n){return(bd(n)?n.validators:n)||null}function Hx(n){return Array.isArray(n)?vy(n):n||null}function jx(n,e){return(bd(e)?e.asyncValidators:n)||null}function $x(n){return Array.isArray(n)?Cy(n):n||null}function bd(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var hm=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,i){this._assignValidators(e),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return En(this.statusReactive)}set status(e){En(()=>this.statusReactive.set(e))}_status=ae(()=>this.statusReactive());statusReactive=k(void 0);get valid(){return this.status===hl}get invalid(){return this.status===vd}get pending(){return this.status==Bs}get disabled(){return this.status===fl}get enabled(){return this.status!==fl}errors;get pristine(){return En(this.pristineReactive)}set pristine(e){En(()=>this.pristineReactive.set(e))}_pristine=ae(()=>this.pristineReactive());pristineReactive=k(!0);get dirty(){return!this.pristine}get touched(){return En(this.touchedReactive)}set touched(e){En(()=>this.touchedReactive.set(e))}_touched=ae(()=>this.touchedReactive());touchedReactive=k(!1);get untouched(){return!this.touched}_events=new X;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(ry(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(ry(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(sy(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(sy(e,this._rawAsyncValidators))}hasValidator(e){return Cd(this._rawValidators,e)}hasAsyncValidator(e){return Cd(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let i=this.touched===!1;this.touched=!0;let t=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(J(T({},e),{sourceControl:t})),i&&e.emitEvent!==!1&&this._events.next(new yl(!0,t))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(i=>i.markAllAsTouched(e))}markAsUntouched(e={}){let i=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let t=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:t})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t),i&&e.emitEvent!==!1&&this._events.next(new yl(!1,t))}markAsDirty(e={}){let i=this.pristine===!0;this.pristine=!1;let t=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(J(T({},e),{sourceControl:t})),i&&e.emitEvent!==!1&&this._events.next(new gl(!1,t))}markAsPristine(e={}){let i=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let t=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&e.emitEvent!==!1&&this._events.next(new gl(!0,t))}markAsPending(e={}){this.status=Bs;let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Gs(this.status,i)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(J(T({},e),{sourceControl:i}))}disable(e={}){let i=this._parentMarkedDirty(e.onlySelf);this.status=fl,this.errors=null,this._forEachChild(o=>{o.disable(J(T({},e),{onlySelf:!0}))}),this._updateValue();let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Sd(this.value,t)),this._events.next(new Gs(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(J(T({},e),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let i=this._parentMarkedDirty(e.onlySelf);this.status=hl,this._forEachChild(t=>{t.enable(J(T({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(J(T({},e),{skipPristineCheck:i}),this),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(e,i){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},i),this._parent._updateTouched({},i))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let t=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===hl||this.status===Bs)&&this._runAsyncValidator(t,e.emitEvent)}let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Sd(this.value,i)),this._events.next(new Gs(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(J(T({},e),{sourceControl:i}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?fl:hl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,i){if(this.asyncValidator){this.status=Bs,this._hasOwnPendingAsyncValidator={emitEvent:i!==!1,shouldHaveEmitted:e!==!1};let t=fy(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:i,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,i={}){this.errors=e,this._updateControlsErrors(i.emitEvent!==!1,this,i.shouldHaveEmitted)}get(e){let i=e;return i==null||(Array.isArray(i)||(i=i.split(".")),i.length===0)?null:i.reduce((t,o)=>t&&t._find(o),this)}getError(e,i){let t=i?this.get(i):this;return t&&t.errors?t.errors[e]:null}hasError(e,i){return!!this.getError(e,i)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,i,t){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||t)&&this._events.next(new Gs(this.status,i)),this._parent&&this._parent._updateControlsErrors(e,i,t)}_initObservables(){this.valueChanges=new ze,this.statusChanges=new ze}_calculateStatus(){return this._allControlsDisabled()?fl:this.errors?vd:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Bs)?Bs:this._anyControlsHaveStatus(vd)?vd:hl}_anyControlsHaveStatus(e){return this._anyControls(i=>i.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,i){let t=!this._anyControlsDirty(),o=this.pristine!==t;this.pristine=t,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),o&&this._events.next(new gl(this.pristine,i))}_updateTouched(e={},i){this.touched=this._anyControlsTouched(),this._events.next(new yl(this.touched,i)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){bd(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let i=this._parent&&this._parent.dirty;return!e&&!!i&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Hx(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=$x(this._rawAsyncValidators)}};var wy=new Se("",{providedIn:"root",factory:()=>gm}),gm="always";function zx(n,e){return[...e.path,n]}function Wx(n,e,i=gm){Yx(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||i==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Kx(n,e),Xx(n,e),Zx(n,e),qx(n,e)}function ay(n,e){n.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(e)})}function qx(n,e){if(e.valueAccessor.setDisabledState){let i=t=>{e.valueAccessor.setDisabledState(t)};n.registerOnDisabledChange(i),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(i)})}}function Yx(n,e){let i=Lx(n);e.validator!==null?n.setValidators(oy(i,e.validator)):typeof i=="function"&&n.setValidators([i]);let t=Nx(n);e.asyncValidator!==null?n.setAsyncValidators(oy(t,e.asyncValidator)):typeof t=="function"&&n.setAsyncValidators([t]);let o=()=>n.updateValueAndValidity();ay(e._rawValidators,o),ay(e._rawAsyncValidators,o)}function Kx(n,e){e.valueAccessor.registerOnChange(i=>{n._pendingValue=i,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Sy(n,e)})}function Zx(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Sy(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Sy(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Xx(n,e){let i=(t,o)=>{e.valueAccessor.writeValue(t),o&&e.viewToModelUpdate(t)};n.registerOnChange(i),e._registerOnDestroy(()=>{n._unregisterOnChange(i)})}function Qx(n,e){if(!n.hasOwnProperty("model"))return!1;let i=n.model;return i.isFirstChange()?!0:!Object.is(e,i.currentValue)}function Jx(n){return Object.getPrototypeOf(n.constructor)===Ns}function e1(n,e){if(!e)return null;Array.isArray(e);let i,t,o;return e.forEach(r=>{r.constructor===li?i=r:Jx(r)?t=r:o=r}),o||t||i||null}function ly(n,e){let i=n.indexOf(e);i>-1&&n.splice(i,1)}function cy(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var t1=class extends hm{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,i,t){super(Vx(i),jx(t,i)),this._applyFormState(e),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),bd(i)&&(i.nonNullable||i.initialValueIsDefault)&&(cy(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,i={}){this.value=this._pendingValue=e,this._onChange.length&&i.emitModelToViewChange!==!1&&this._onChange.forEach(t=>t(this.value,i.emitViewToModelChange!==!1)),this.updateValueAndValidity(i)}patchValue(e,i={}){this.setValue(e,i)}reset(e=this.defaultValue,i={}){this._applyFormState(e),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ly(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ly(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){cy(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var i1={provide:_l,useExisting:Wi(()=>Vt)},dy=Promise.resolve(),Vt=(()=>{class n extends _l{_changeDetectorRef;callSetDisabledState;control=new t1;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new ze;constructor(i,t,o,r,s,d){super(),this._changeDetectorRef=s,this.callSetDisabledState=d,this._parent=i,this._setValidators(t),this._setAsyncValidators(o),this.valueAccessor=e1(this,r)}ngOnChanges(i){if(this._checkForErrors(),!this._registered||"name"in i){if(this._registered&&(this._checkName(),this.formDirective)){let t=i.name.previousValue;this.formDirective.removeControl({name:t,path:this._getPath(t)})}this._setUpControl()}"isDisabled"in i&&this._updateDisabled(i),Qx(i,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Wx(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(i){dy.then(()=>{this.control.setValue(i,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(i){let t=i.isDisabled.currentValue,o=t!==0&&Tn(t);dy.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(i){return this._parent?zx(i,this._parent):[i]}static \u0275fac=function(t){return new(t||n)(G(um,9),G(my,10),G(Ox,10),G(Wr,10),G(hn,8),G(wy,8))};static \u0275dir=pe({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[et([i1]),V,bt]})}return n})();var n1={provide:Wr,useExisting:Wi(()=>qr),multi:!0},qr=(()=>{class n extends Ns{writeValue(i){let t=i??"";this.setProperty("value",t)}registerOnChange(i){this.onChange=t=>{i(t==""?null:parseFloat(t))}}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(t,o){t&1&&y("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[et([n1]),V]})}return n})();var o1={provide:Wr,useExisting:Wi(()=>ym),multi:!0},ym=(()=>{class n extends Ns{writeValue(i){this.setProperty("value",parseFloat(i))}registerOnChange(i){this.onChange=t=>{i(t==""?null:parseFloat(t))}}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(t,o){t&1&&y("change",function(s){return o.onChange(s.target.value)})("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[et([o1]),V]})}return n})();var r1={provide:Wr,useExisting:Wi(()=>xd),multi:!0};function by(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function s1(n){return n.split(":")[0]}var xd=(()=>{class n extends Ns{value;_optionMap=new Map;_idCounter=0;set compareWith(i){this._compareWith=i}_compareWith=Object.is;writeValue(i){this.value=i;let t=this._getOptionId(i),o=by(t,i);this.setProperty("value",o)}registerOnChange(i){this.onChange=t=>{this.value=this._getOptionValue(t),i(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(i){for(let t of this._optionMap.keys())if(this._compareWith(this._optionMap.get(t),i))return t;return null}_getOptionValue(i){let t=s1(i);return this._optionMap.has(t)?this._optionMap.get(t):i}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,o){t&1&&y("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[et([r1]),V]})}return n})(),xy=(()=>{class n{_element;_renderer;_select;id;constructor(i,t,o){this._element=i,this._renderer=t,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(i){this._select!=null&&(this._select._optionMap.set(this.id,i),this._setElementValue(by(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._setElementValue(i),this._select&&this._select.writeValue(this._select.value)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(t){return new(t||n)(G(Ue),G($e),G(xd,9))};static \u0275dir=pe({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),a1={provide:Wr,useExisting:Wi(()=>My),multi:!0};function py(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function l1(n){return n.split(":")[0]}var My=(()=>{class n extends Ns{value;_optionMap=new Map;_idCounter=0;set compareWith(i){this._compareWith=i}_compareWith=Object.is;writeValue(i){this.value=i;let t;if(Array.isArray(i)){let o=i.map(r=>this._getOptionId(r));t=(r,s)=>{r._setSelected(o.indexOf(s.toString())>-1)}}else t=(o,r)=>{o._setSelected(!1)};this._optionMap.forEach(t)}registerOnChange(i){this.onChange=t=>{let o=[],r=t.selectedOptions;if(r!==void 0){let s=r;for(let d=0;d<s.length;d++){let h=s[d],_=this._getOptionValue(h.value);o.push(_)}}else{let s=t.options;for(let d=0;d<s.length;d++){let h=s[d];if(h.selected){let _=this._getOptionValue(h.value);o.push(_)}}}this.value=o,i(o)}}_registerOption(i){let t=(this._idCounter++).toString();return this._optionMap.set(t,i),t}_getOptionId(i){for(let t of this._optionMap.keys())if(this._compareWith(this._optionMap.get(t)._value,i))return t;return null}_getOptionValue(i){let t=l1(i);return this._optionMap.has(t)?this._optionMap.get(t)._value:i}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,o){t&1&&y("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[et([a1]),V]})}return n})(),Dy=(()=>{class n{_element;_renderer;_select;id;_value;constructor(i,t,o){this._element=i,this._renderer=t,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(i){this._select!=null&&(this._value=i,this._setElementValue(py(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._select?(this._value=i,this._setElementValue(py(this.id,i)),this._select.writeValue(this._select.value)):this._setElementValue(i)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}_setSelected(i){this._renderer.setProperty(this._element.nativeElement,"selected",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(t){return new(t||n)(G(Ue),G($e),G(My,9))};static \u0275dir=pe({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function c1(n){return typeof n=="number"?n:parseFloat(n)}var d1=(()=>{class n{_validator=ny;_onChange;_enabled;ngOnChanges(i){if(this.inputName in i){let t=this.normalizeInput(i[this.inputName].currentValue);this._enabled=this.enabled(t),this._validator=this._enabled?this.createValidator(t):ny,this._onChange&&this._onChange()}}validate(i){return this._validator(i)}registerOnValidatorChange(i){this._onChange=i}enabled(i){return i!=null}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,features:[bt]})}return n})();var p1={provide:my,useExisting:Wi(()=>Yr),multi:!0},Yr=(()=>{class n extends d1{min;inputName="min";normalizeInput=i=>c1(i);createValidator=i=>Fx(i);static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(t,o){t&2&&Ci("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[et([p1]),V]})}return n})();var u1=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({})}return n})();var Zt=(()=>{class n{static withConfig(i){return{ngModule:n,providers:[{provide:wy,useValue:i.callSetDisabledState??gm}]}}static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({imports:[u1]})}return n})();var Py=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-action-card-stack-item"]],inputs:{cardStack:"cardStack"},standalone:!1,decls:3,vars:7,consts:[[3,"icon"],[2,"font-weight","600"]],template:function(o,r){o&1&&(g(0,"mw-ra-icon",0),a(1,"span",1),p(2),l()),o&2&&(se("color",r.cardStack.card.iconColor)("background",r.cardStack.card.bgColor),f("icon",r.cardStack.card.icon),c(2),Ee("",r.cardStack.card.title," x",r.cardStack.count))},dependencies:[Ce],styles:["[_nghost-%COMP%]{display:block}mw-ra-icon[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0});let n=e;return n})();var m1=["*"],Md=(()=>{let e=class e{constructor(){this.selectedItem=Yn()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-base-select"]],inputs:{selectedItem:[1,"selectedItem"]},outputs:{selectedItem:"selectedItemChange"},standalone:!1,ngContentSelectors:m1,decls:2,vars:1,consts:[[3,"ngModelChange","ngModel"]],template:function(o,r){o&1&&(lt(),a(0,"select",0),ne("ngModelChange",function(d){return ie(r.selectedItem,d)||(r.selectedItem=d),d}),Xe(1),l()),o&2&&te("ngModel",r.selectedItem)},dependencies:[xd,Kt,Vt],encapsulation:2});let n=e;return n})();function f1(n,e){if(n&1&&(a(0,"option",4),p(1),l()),n&2){let i=e.$implicit;f("value",i.lossMode),c(),H(i.label)}}function g1(n,e){if(n&1&&(a(0,"option",4),p(1),l()),n&2){let i=e.$implicit;f("value",i.lossMode),c(),H(i.label)}}var Dd=(()=>{let e=class e{constructor(){this.state=u(fe),this.dialogRef=u(mo),this.gameSettingsFeature=this.state.gameSettings,this.initialSettings=this.gameSettingsFeature.get(),this.lossModes=[{label:"No losses",lossMode:Ln.None},{label:"Permanent",lossMode:Ln.Permanent}],this.lossesFromNeutrals=k(this.initialSettings.lossToNeutrals),this.lossesFromPlayers=k(this.initialSettings.lossToPlayers),this.allowNeutralControl=k(this.initialSettings.allowNeutralControl)}accept(){this.state.gameSettings.patch({lossToNeutrals:this.lossesFromNeutrals(),lossToNeutralPlayers:this.lossesFromPlayers()}),this.close()}close(){this.dialogRef.close()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-game-settings-dialog"]],standalone:!1,decls:22,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"setting"],[3,"selectedItemChange","selectedItem"],[3,"value"],["type","checkbox",3,"ngModelChange","ngModel"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2,"New Game Settings"),l(),a(3,"div",1)(4,"div",2),p(5," Losses From Neutrals: "),a(6,"mw-base-select",3),ne("selectedItemChange",function(d){return ie(r.lossesFromNeutrals,d)||(r.lossesFromNeutrals=d),d}),P(7,f1,2,2,"option",4,j),l()(),a(9,"div",2),p(10," Losses From Players: "),a(11,"mw-base-select",3),ne("selectedItemChange",function(d){return ie(r.lossesFromPlayers,d)||(r.lossesFromPlayers=d),d}),P(12,g1,2,2,"option",4,j),l()(),a(14,"div",2),p(15," Allow neutral control "),a(16,"input",5),ne("ngModelChange",function(d){return ie(r.allowNeutralControl,d)||(r.allowNeutralControl=d),d}),l()()(),a(17,"div",6)(18,"button",7),y("click",function(){return r.accept()}),p(19," Accept "),l(),a(20,"button",7),y("click",function(){return r.close()}),p(21," Cancel "),l()()()),o&2&&(c(6),te("selectedItem",r.lossesFromNeutrals),c(),E(r.lossModes),c(4),te("selectedItem",r.lossesFromPlayers),c(),E(r.lossModes),c(4),te("ngModel",r.allowNeutralControl))},dependencies:[xy,Dy,fm,Kt,Vt,Md,ee,we],styles:["mw-popup-base-content[_ngcontent-%COMP%]{background-color:#fff}"]});let n=e;return n})();function y1(n,e){if(n&1&&g(0,"mw-res-label",0),n&2){let i=e.$implicit;f("resType",i.key)("amount",i.value)}}var Ko=(()=>{let e=class e{constructor(){this.capitalize=!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-resources-cost"]],hostVars:2,hostBindings:function(o,r){o&2&&me("capitalize",r.capitalize)},inputs:{cost:"cost",capitalize:"capitalize"},standalone:!1,decls:3,vars:2,consts:[["display","vertical",3,"resType","amount"]],template:function(o,r){o&1&&(P(0,y1,1,2,"mw-res-label",0,j),xe(2,"keyvalue")),o&2&&E(Me(2,0,r.cost))},dependencies:[Wt,Ri],encapsulation:2});let n=e;return n})();var Us=class{constructor(){this.dialogData=u(Ju),this.dialogRef=u(mo)}close(){this.dialogRef.close()}};function _1(n,e){if(n&1){let i=I();a(0,"mw-week-activity-card",8),y("click",function(){let o=w(i).$implicit,r=m().$implicit;return S(r.choice.set(o))}),l()}if(n&2){let i=e.$implicit,t=m().$implicit;me("active",i===t.choice()),f("activity",i)}}function v1(n,e){if(n&1&&(a(0,"div",2)(1,"div",5),p(2),l(),a(3,"div",6),P(4,_1,1,3,"mw-week-activity-card",7,j),l()()),n&2){let i=e.$implicit;c(2),H(i.name),c(2),E(i.activityBases)}}function cn(n){return Z0.find(e=>e.id===n)}var Pd=(()=>{let e=class e extends Us{constructor(){super(...arguments),this.apiProvider=u(Ti),this.playersService=u($),this.categories=k([{name:"Basic",activityBases:[cn("war-training"),cn("tribute"),cn("scholar")],choice:k(cn("war-training"))},{name:"Medium",activityBases:[cn("gem-cutting"),cn("mysticism"),cn("necromancy")],choice:k(cn("gem-cutting"))},{name:"Advanced",activityBases:[cn("masonry"),cn("architecture"),cn("crystal-illness")],choice:k(cn("masonry"))}])}confirm(){let t=this.categories().map(r=>r.choice()),o=this.playersService.getCurrentPlayer();t.forEach(r=>{r.init?.(this.apiProvider.getGameApi()),o.addWeeklyActivity(r)}),this.close()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-week-activities-popup"]],standalone:!1,features:[V],decls:8,vars:0,consts:[[1,"dialog-header"],[1,"categories"],[1,"category"],[1,"footer"],["mw-main-button","",3,"click"],[1,"category-title"],[1,"activities"],[3,"activity","active"],[3,"click","activity"]],template:function(o,r){o&1&&(a(0,"div",0),p(1,` Select your activities and specialties for this week
`),l(),a(2,"div",1),P(3,v1,6,1,"div",2,j),l(),a(5,"div",3)(6,"button",4),y("click",function(){return r.confirm()}),p(7,"Confirm"),l()()),o&2&&(c(3),E(r.categories()))},dependencies:[ee,ks],styles:["[_nghost-%COMP%]{display:block;background:#fff;padding:10px}.dialog-header[_ngcontent-%COMP%]{text-align:center}.categories[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px}.categories[_ngcontent-%COMP%]   .category-title[_ngcontent-%COMP%]{text-align:center;padding-bottom:3px}.categories[_ngcontent-%COMP%]   .activities[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.categories[_ngcontent-%COMP%]   .activities[_ngcontent-%COMP%] > mw-week-activity-card[_ngcontent-%COMP%]{width:175px;cursor:pointer}.footer[_ngcontent-%COMP%]{display:flex;justify-content:center}"],changeDetection:0});let n=e;return n})();var Ed=(()=>{let e=class e{constructor(){this.hostElem=ti(),this.renderer=u($e),this.cursor=u(Pc),this.ngZone=u(Ae),this.isHovered=!1,this.destroyed$=new X,this.setNativeCursorVisibility(!1),this.ngZone.runOutsideAngular(()=>{this.unlistenMouseMove=this.renderer.listen(this.hostElem,"mousemove",t=>{this.cursor.setCustomCursorPos(t.clientX,t.clientY)})})}ngOnDestroy(){this.cursor.clearCustomCursor(),this.isHovered=!1,this.destroyed$.next(),this.unlistenMouseMove()}onMouseOver(t){t.stopPropagation(),this.isHovered=!0;let o=this.getCursorToShow();o?(this.cursor.setCustomCursor(o.animation,o.options,o.data),this.setNativeCursorVisibility(!1)):(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}onMouseOut(t){t.stopPropagation(),this.isHovered=!1,this.cursor.clearCustomCursor()}getCursorToShow(){return this.cursorAnimation}setCursorIcon(t){this.isHovered&&t&&(this.setNativeCursorVisibility(!1),this.cursor.setCustomCursor(t.animation,t.options,t.data)),t||(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}recalcCursorIcon(){let t=this.getCursorToShow();this.isHovered&&t&&(this.setCursorIcon(t),this.setNativeCursorVisibility(!1)),t||(this.cursor.clearCustomCursor(),this.setNativeCursorVisibility(!0))}setNativeCursorVisibility(t){this.renderer.setStyle(this.hostElem,"cursor",t?"auto":"none")}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["","mwCustomCursor",""]],hostBindings:function(o,r){o&1&&y("mouseenter",function(d){return r.onMouseOver(d)})("mouseleave",function(d){return r.onMouseOut(d)})},standalone:!1});let n=e;return n})();var vl=new Se("UI element unit group provider"),Td=(()=>{let e=class e extends Ed{constructor(){super(...arguments),this.curPlayerState=u(Dt),this.spells=u(Go),this.battleState=u(zt),this.unitGroupProvider=u(vl),this.state=u(fe)}ngOnInit(){this.unitGroup=this.unitGroupProvider.getUnitGroup(),this.curPlayerState.state.select(t=>t.playerCurrentState).pipe(Ge(this.destroyed$)).subscribe(()=>this.recalcCursorIcon())}getCursorToShow(){let t=this.battleState.getTargetingData(this.unitGroup);if(!t.stateInitialized)return null;let o=t.isCurrentPlayerAI?!t.isOpponentAI&&t.doesUnitBelongToActivePlayer&&!this.state.gameSettings.get().allowNeutralControl:!t.doesUnitBelongToActivePlayer,r=this.curPlayerState.state.get().playerCurrentState;if(r!==Je.SpellTargeting&&!o)return null;if(r===Je.Normal&&(!o||o&&!this.unitGroup.isAlive))return this.createStaticCursor("interdiction");let s=this.spells.canSpellBeCastOnUnit(this.curPlayerState.state.get().currentSpell,this.unitGroup,o);if(r===Je.SpellTargeting&&!s)return this.createStaticCursor("interdiction");let d={[Je.Normal]:"sword",[Je.SpellTargeting]:"burning-book",[Je.WaitsForTurn]:"hourglass"};return r===Je.SpellTargeting?{animation:jf,options:{duration:2e3,iterations:1/0}}:this.createStaticCursor(d[r])}createStaticCursor(t){return t==="interdiction"?{animation:Hf,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}:{animation:Vf,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275dir=pe({type:e,selectors:[["","mwUnitEventsCursor",""]],standalone:!1,features:[V]});let n=e;return n})();var Id=(()=>{let e=class e{constructor(){this.curPlayerState=u(Dt),this.players=u($),this.mwBattleStateService=u(zt),this.events=u(oe),this.unitGroupProvider=u(vl)}get isEnemyCard(){return this.mwBattleStateService.canUnitGroupBeAttackedByCurrentPlayerAICheck(this.actionTargetUnitGroup)}ngOnInit(){this.actionTargetUnitGroup=this.unitGroupProvider.getUnitGroup()}onContextMenu(t){return t.stopPropagation(),t.preventDefault(),!1}onMouseDown(t){t.button===2&&(t.preventDefault(),this.curPlayerState.isSpellBeingCast()?(this.curPlayerState.cancelCurrentSpell(),this.dispatchUnitGroupHovered(this.isEnemyCard?ni.EnemyCard:ni.AllyCard)):this.events.dispatch(La({unitGroup:this.actionTargetUnitGroup})))}onClick(){if(!this.canActivateCurrentSpell()){this.curPlayerState.cancelCurrentSpell();return}if(this.isEnemyCard){if(!this.actionTargetUnitGroup.isAlive)return;let t=this.mwBattleStateService.state.get();this.events.dispatch(Ba({attackedGroup:this.actionTargetUnitGroup,attackingGroup:t.currentUnitGroup,attackingPlayer:t.currentPlayer})),this.dispatchUnitGroupHovered(ni.EnemyCard)}else this.events.dispatch(Ga({unitGroup:this.actionTargetUnitGroup})),this.dispatchUnitGroupHovered(ni.Unhover)}canActivateCurrentSpell(){let o=this.curPlayerState.state.get().currentSpell.baseType.config.targetCastConfig?.canActivate;return o?o({unitGroup:this.actionTargetUnitGroup,isEnemy:this.isEnemyCard}):!0}dispatchUnitGroupHovered(t){this.events.dispatch(Fn({hoverType:t,currentCard:this.mwBattleStateService.state.get().currentUnitGroup,hoveredCard:this.actionTargetUnitGroup}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=pe({type:e,selectors:[["","mwUnitGroupCombatAction",""]],hostBindings:function(o,r){o&1&&y("contextmenu",function(d){return r.onContextMenu(d)})("mousedown",function(d){return r.onMouseDown(d)})("click",function(d){return r.onClick(d)})},standalone:!1});let n=e;return n})();var vm=(()=>{let e=class e{transform(t){return qs(t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275pipe=qn({name:"infNum",type:e,pure:!0,standalone:!1});let n=e;return n})();var S1=[Rs,vm,en],b1=[Ed,Dn,Id,Td,Yt,Nn,Lc],Gte=[...b1,...S1,Md,Ko,Ar,Ka,Py,Ic,Eu,nl,si,Ac,Oc,tn,nn,Gr,ol,$c,rl,vs,tl,Wc,Hn,al,Za,ll,_d,Un,Wt,Qa,Tc,kc,Or,Vn,Ce,Dc,Mc,Ja,Fr,ee,sl,Pu,Hc,we,il,Br,el,Vc,jc,zc,Bc,Pd,Dd,ks],Ke=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Zt]});let n=e;return n})();ot(Ka,[Yt,Ar,Ce],[vm]);ot(nl,[Eu,Hn,Ce],[]);ot(Ac,[si],[]);ot(tn,[Qn,Ac,Oc,Or,Ce],[]);ot(nn,[Oc,tn,Ja],[]);ot(Gr,[si],[]);ot(ol,[$c],[]);ot($c,[Dn,si,rl,vs,Ce],[Xi]);ot(vs,[Zi,Qn,Gr,Or,Ce],[]);ot(tl,[Yt,Nn],[]);ot(al,[Hn],[]);ot(Za,[Hn],[]);ot(ll,[Hn],[]);ot(Qa,[Tc],[]);ot(Tc,[si],[]);ot(il,[Yt,Ce,Fr],[]);ot(Br,[Yt,Nn,nn,Ce,sl,el],[]);function x1(n,e){if(n&1&&g(0,"mw-ra-icon",7),n&2){let i=m().$implicit;f("icon",i.icon)}}function M1(n,e){if(n&1){let i=I();a(0,"div",6),y("click",function(){let o=w(i).$implicit,r=m();return S(r.activeTab.set(o))}),x(1,x1,1,1,"mw-ra-icon",7),p(2),l()}if(n&2){let i=e.$implicit,t=m();me("active",i===t.activeTab()),c(),M(i.icon?1:-1),c(),D(" ",i.tabName," ")}}function D1(n,e){if(n&1&&(a(0,"p",5),p(1),l()),n&2){let i=e.$implicit;c(),H(i)}}var Ey=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.glossaryTabs=iy,this.activeTab=k(this.glossaryTabs[0])}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-glossary"]],features:[V],decls:10,vars:0,consts:[["popupHeader","",1,"header"],["popupContent","",1,"content"],[1,"tabs"],[1,"tab",3,"active"],[1,"tab-content"],[1,"description"],[1,"tab",3,"click"],[3,"icon"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2," Glossary "),l(),a(3,"div",1)(4,"div",2),P(5,M1,3,4,"div",3,j),l(),a(7,"div",4),P(8,D1,2,1,"p",5,j),l()()()),o&2&&(c(5),E(r.glossaryTabs),c(3),E(r.activeTab().descriptions))},dependencies:[Ke,Ce,we],styles:["[_nghost-%COMP%]{height:400px;display:block;padding-bottom:10px;box-sizing:border-box}mw-popup-base-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:100%;height:100%;box-sizing:border-box}.description[_ngcontent-%COMP%]:first-of-type{margin:0}.header[_ngcontent-%COMP%]{padding-bottom:10px}.content[_ngcontent-%COMP%]{display:flex;flex-grow:1;overflow:hidden}.tabs[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:200px}.tab[_ngcontent-%COMP%]{cursor:pointer;padding:5px;text-align:left}.tab.active[_ngcontent-%COMP%]{background-color:#29292916}.tab[_ngcontent-%COMP%]:hover{background-color:#29292923}.tab-content[_ngcontent-%COMP%]{padding:4px 15px;max-height:450px;overflow-y:auto;font-size:13px;text-align:left;overflow:auto}"]});let n=e;return n})();function P1(n,e){if(n&1&&(a(0,"span"),p(1," ("),a(2,"span",9),p(3),l(),p(4,") "),l()),n&2){let i=m().$implicit,t=m();c(3),D("-",t.missingCostMap[i.type])}}function E1(n,e){if(n&1&&(a(0,"div",4),g(1,"mw-res-label",8),x(2,P1,5,1,"span"),l()),n&2){let i=e.$implicit,t=m();c(),f("resType",i.type)("amount",i.count),c(),M(t.missingCostMap[i.type]?2:-1)}}function T1(n,e){n&1&&(a(0,"div"),p(1," You don't have enough resources. "),l())}var Kr=(()=>{let e=class e extends ye{constructor(){super(),this.players=u($),this.events=u(oe),this.state=u(fe),this.costFactor=this.players.getCurrentPlayer().hero.modGroup.getCalcNumModValueOrZero("townBuildingCostFactor");let t=this.data.building;this.buildingLevel=t.base.levels[this.data.targetLevel-1];let o=this.getBuildingCost();this.cost=Ul(o),this.missingCostMap=this.players.getMissingResources(this.players.getCurrentPlayer(),o),this.canBuild=this.players.playerHasResources(this.players.getCurrentPlayer(),o)}build(){let t=this.data.building;this.data.targetLevel===1?t.built=!0:(t.currentLevel=this.data.targetLevel-1,t.currentBuilding=t.base.levels[this.data.targetLevel-1].building),this.events.dispatch(us({building:t,player:this.players.getCurrentPlayer()})),this.players.removeResourcesFromPlayer(this.players.getCurrentPlayer(),this.getBuildingCost()),this.state.eventHandlers.buildings.triggerRefEventHandlers(this.data.building,Lr.Built()),this.close()}getBuildingCost(){return zh(this.buildingLevel.cost,this.costFactor)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-build-popup"]],standalone:!1,features:[V],decls:16,vars:6,consts:[["popupHeader",""],[2,"display","block","font-size","40px","margin","8px 0",3,"icon"],["popupContent",""],[2,"padding-bottom","8px"],[1,"resource"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[3,"resType","amount"],[2,"color","red"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),g(3,"mw-ra-icon",1),l(),a(4,"div",2)(5,"div",3),p(6),l(),a(7,"div"),P(8,E1,3,3,"div",4,le),l(),x(10,T1,2,0,"div"),l(),a(11,"div",5)(12,"button",6),y("click",function(){return r.build()}),p(13," Build "),l(),a(14,"button",7),y("click",function(){return r.close()}),p(15,"Close"),l()()()),o&2&&(c(2),Ee(" Build: ",r.data.building.currentBuilding.name,", level ",r.data.targetLevel," "),c(),f("icon",r.data.building.base.icon),c(3),D(" ",r.buildingLevel.building.description," "),c(2),E(r.cost),c(2),M(r.canBuild?-1:10),c(2),f("disabled",!r.canBuild))},dependencies:[Wt,Ce,ee,we],styles:["[_nghost-%COMP%]{text-align:center;display:flex;flex-direction:column;font-size:14px;color:wheat}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}.resource[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]});let n=e;return n})();function I1(n,e){if(n&1){let i=I();a(0,"div",11),y("click",function(){let o=w(i).$implicit,r=m().$implicit,s=m();return S(s.selectItem(o,r.value))}),g(1,"mw-unit-group-preview",12)(2,"hr")(3,"mw-resources-cost",13),l()}if(n&2){let i=e.$implicit,t=m(2);me("selected",t.selectedGroup===i),c(),f("unitType",i.type)("count",i.count),c(2),f("cost",i.cost)}}function k1(n,e){if(n&1&&(a(0,"div",3)(1,"div",8),p(2),l(),a(3,"div",9),P(4,I1,4,5,"div",10,j),l()()),n&2){let i=e.$implicit;c(2),H(i.value.name),c(2),E(i.value.groups)}}function A1(n,e){n&1&&(a(0,"span"),p(1,"You don't have enough resources"),l())}var Cm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.players=u($),this.unitsService=u(Rt),this.events=u(oe),this.currentPlayer=this.players.getCurrentPlayer(),this.canHire=!0}selectItem(t,o){this.selectedGroup=t,this.selectedGarrison=o,this.canHire=this.players.playerHasResources(this.currentPlayer,t.cost)}hire(){if(!this.selectedGroup||!this.selectedGarrison||!this.canHire)return;let t=this.selectedGroup;z.removeItem(this.selectedGarrison.groups,t),this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost);let o=this.unitsService.createUnitGroup(t.type.id,{count:t.count},this.currentPlayer.hero);this.players.addUnitGroupToTypeStack(this.currentPlayer,o),this.events.dispatch(_n({message:`${t.count} ${t.type.name} joined your army for 3 days.`})),this.events.dispatch(_r({action:()=>{let r=this.players.removeUnitTypeCountFromPlayer(this.currentPlayer,t.type.id,t.count);r&&this.events.dispatch(_n({message:`${r} ${t.type.name} have left your army.`}))},dayOffset:3})),this.selectedGarrison=void 0,this.selectedGroup=void 0}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-garrison-popup"]],standalone:!1,features:[V],decls:19,vars:4,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[1,"hiring-section"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["icon","guarded-tower"],["mw-main-button","",3,"click"],[1,"header"],[1,"groups"],[1,"group",3,"selected"],[1,"group",3,"click"],[3,"unitType","count"],[3,"cost"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2,"Garrison"),l(),a(3,"div",1)(4,"div",2)(5,"p"),p(6,"Hire units temporarily (3 days) for reduced cost."),l(),a(7,"p"),p(8,"Garrison is reset each week."),l()(),P(9,k1,6,1,"div",3,le),xe(11,"keyvalue"),x(12,A1,2,0,"span"),l(),a(13,"div",4)(14,"button",5),y("click",function(){return r.hire()}),g(15,"mw-ra-icon",6),p(16," Hire "),l(),a(17,"button",7),y("click",function(){return r.close()}),p(18," Leave "),l()()()),o&2&&(c(9),E(Me(11,2,r.currentPlayer.garrisons)),c(3),M(r.canHire?-1:12),c(2),f("disabled",!r.selectedGroup||!r.canHire))},dependencies:[Ko,Wc,Ce,ee,we,Ri],styles:[".hiring-section[_ngcontent-%COMP%]{padding-top:8px}.groups[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{width:70px;font-size:13px;padding:3px 4px;-webkit-user-select:none;user-select:none;border:1px solid black;cursor:pointer}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]   .group-name[_ngcontent-%COMP%]{padding-bottom:4px}.groups[_ngcontent-%COMP%]   .group.selected[_ngcontent-%COMP%]{border:1px solid gold}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}"]});let n=e;return n})();function O1(n,e){if(n&1){let i=I();a(0,"div",4),y("click",function(){w(i);let o=m(2);return S(o.setMode("upgrade"))}),p(1),l()}if(n&2){let i=m(2);me("active",i.currentMode==="upgrade"),c(),D(" Upgrade: ",i.countToUpgrade-i.plannedToUpgrade," ")}}function F1(n,e){if(n&1&&x(0,O1,2,3,"div",11),n&2){let i=m();M(i.activity.upgrade?0:-1)}}function R1(n,e){if(n&1&&(a(0,"div",14),g(1,"mw-res-label",16),l()),n&2){let i=e.$implicit;c(),f("resType",i.key)("amount",i.value)("iconSize",48)}}function B1(n,e){if(n&1){let i=I();a(0,"div",6)(1,"div"),p(2),l(),a(3,"div"),p(4),l(),a(5,"input",12),y("input",function(o){let r=w(i).$implicit,s=m();return S(s.updateCountForGroupFromEvent(r,o))}),l(),a(6,"div"),p(7,"Cost:"),l(),a(8,"div",13),P(9,R1,2,3,"div",14,le),xe(11,"keyvalue"),l(),a(12,"button",15),y("click",function(){let o=w(i).$implicit,r=m();return S(r.setMaxHire(o))}),p(13," Max "),l()()}if(n&2){let i=e.$implicit,t=m();c(2),H(i.hire.unitType.name),c(2),H(i.count),c(),f("min",0)("max",i.hire.maxCount)("value",i.count)("disabled",!t.playerHasFreeSlots),c(4),E(Me(11,7,i.currentCost)),c(3),f("disabled",!t.playerHasFreeSlots)}}function G1(n,e){n&1&&(a(0,"div"),p(1,"You don't have free unit group slots!"),l())}function L1(n,e){if(n&1){let i=I();a(0,"button",17),y("click",function(){w(i);let o=m();return S(o.upgradeBuilding())}),p(1," Upgrade Building "),l()}}var wm=(()=>{let e=class e extends ye{constructor(){super(),this.playersService=u($),this.unitsService=u(Rt),this.popupService=u(Ei),this.gameObjectsManager=u(je),this.hirableGroups=[],this.canConfirm=!0,this.plannedToHire=0,this.plannedToUpgrade=0,this.currentMode="hire",this.playerHasFreeSlots=this.playersService.getCurrentPlayer().hero.hasFreeUnitSlots(),this.unitType=Hi(this.data.hiringActivity.hiring.unitTypeId),this.activity=this.data.hiringActivity,this.currentBuilding=this.data.building.currentBuilding,this.canBeUpgraded=this.data.building.base.levels.length-1>this.data.building.currentLevel}ngOnInit(){console.log(this.data);let t=this.data.building.currentBuilding.activity;this.originalCountToHire=this.data.town.unitsAvailableMap[t.unitGrowthGroup],this.countToHire=this.originalCountToHire,this.activity.upgrade&&(this.countToUpgrade=this.playersService.getPlayerUnitsCountOfType(this.playersService.getCurrentPlayer(),this.activity.hiring.unitTypeId)),this.hirableGroups=this.getGroupsToHire().map(o=>{let r={},s={},d=Hi(o.unitTypeId).baseRequirements;return[Oe.Gems,Oe.Gold,Oe.RedCrystals,Oe.Wood].forEach(_=>{d[_]&&(r[_]=d[_],s[_]=0)}),{hire:{maxCount:this.data.town.unitsAvailableMap[t.unitGrowthGroup],unitType:Hi(o.unitTypeId)},count:0,baseCost:r,currentCost:s}})}setMaxHire(t){let o=Yh(this.playersService.getCurrentPlayer().resources,t.baseCost,t.hire.maxCount);this.updateCountForGroup(t,o)}setMode(t){if(this.currentMode===t)return;t==="hire"?this.plannedToUpgrade=0:this.plannedToHire=0,this.currentMode=t;let o=this.data.building.currentBuilding.activity;this.hirableGroups=this.getGroupsToHire().map(r=>{let s={},d={},h=Hi(this.activity.hiring.unitTypeId),_=this.currentMode==="hire"?Hi(r.unitTypeId).baseRequirements:h.upgradeDetails.upgradeCost;return[Oe.Gems,Oe.Gold,Oe.RedCrystals,Oe.Wood].forEach(O=>{_[O]&&(s[O]=_[O],d[O]=0)}),{hire:{maxCount:this.currentMode==="hire"?this.data.town.unitsAvailableMap[o.unitGrowthGroup]:this.countToUpgrade,unitType:Hi(r.unitTypeId)},count:0,baseCost:s,currentCost:d}})}getGroupsToHire(){let t=this.data.building.currentBuilding.activity,o=Hi(t.hiring.unitTypeId);return this.currentMode==="hire"?t.upgrade?[t.hiring,...o.upgradeDetails?.target?[{growth:0,unitTypeId:Hi(t.hiring?.unitTypeId).upgradeDetails?.target}]:[]]:[t.hiring]:[...o.upgradeDetails?.target?[{growth:0,unitTypeId:o.upgradeDetails.target}]:[]]}updateCountForGroupFromEvent(t,o){this.updateCountForGroup(t,Number(o.target.value))}updateCountForGroup(t,o){t.count=o,this.canConfirm=!0,Object.entries(t.baseCost).forEach(([r,s])=>{t.currentCost[r]=s*t.count}),this.currentMode==="hire"?this.plannedToHire=this.hirableGroups.reduce((r,s)=>r+s.count,0):this.plannedToUpgrade=this.hirableGroups.reduce((r,s)=>r+s.count,0),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),o=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,o),this.currentMode==="hire"?this.hirableGroups.forEach(r=>{if(r.count){let s=this.unitsService.createUnitGroup(r.hire.unitType.id,{count:r.count},t.hero),d=this.data.building.currentBuilding.activity;this.data.town.unitsAvailableMap[d.unitGrowthGroup]-=r.count,this.playersService.addUnitGroupToTypeStack(t,s)}}):this.hirableGroups.forEach(r=>{if(r.count){this.playersService.removeUnitTypeCountFromPlayer(t,this.activity.hiring.unitTypeId,r.count);let s=this.unitsService.createUnitGroup(r.hire.unitType.id,{count:r.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}upgradeBuilding(){this.close(),this.popupService.createBasicPopup({component:Kr,data:{building:this.data.building,targetLevel:2},class:"dark"})}calcTotalCosts(){return this.hirableGroups.reduce((t,o)=>(Object.entries(o.currentCost).forEach(([r,s])=>{let d=r;t[d]?t[d]+=o.currentCost[d]:t[d]=o.currentCost[d]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-hiring-popup"]],standalone:!1,features:[V],decls:21,vars:9,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[2,"display","flex","justify-content","center"],[1,"type",3,"click"],[1,"hiring-panel"],[1,"unit-column"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",2,"font-size","12px"],["mw-main-button","",3,"click"],[1,"type",3,"active"],["type","range",3,"input","min","max","value","disabled"],[1,"cost"],[1,"resource"],["mw-main-button","","mwActionHint","Maximize amount of units you can afford to hire/upgrade",3,"click","disabled"],["display","vertical",3,"resType","amount","iconSize"],["mw-main-button","",2,"font-size","12px",3,"click"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0),p(2),l(),a(3,"div",1)(4,"div",2)(5,"p"),p(6),l()(),a(7,"div",3)(8,"div",4),y("click",function(){return r.setMode("hire")}),p(9),l(),x(10,F1,1,1),l(),a(11,"div",5),P(12,B1,14,9,"div",6,j),l(),x(14,G1,2,0,"div"),l(),a(15,"div",7)(16,"button",8),y("click",function(){return r.confirmHire()}),p(17," Hire "),l(),x(18,L1,2,0,"button",9),a(19,"button",10),y("click",function(){return r.close()}),p(20," Close "),l()()()),o&2&&(c(2),D(" ",r.currentBuilding.name," "),c(4),D("Hire ",r.unitType.name),c(2),me("active",r.currentMode==="hire"),c(),D(" Hire: ",r.countToHire-r.plannedToHire," "),c(),M(r.activity.upgrade?10:-1),c(2),E(r.hirableGroups),c(2),M(r.playerHasFreeSlots?-1:14),c(2),f("disabled",!r.canConfirm||r.countToHire-r.plannedToHire<0),c(2),M(r.canBeUpgraded?18:-1))},dependencies:[Yt,Wt,ee,we,Ri],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.type[_ngcontent-%COMP%]{padding:8px;margin:4px;font-size:12px;border:1px solid black;cursor:pointer}.type.active[_ngcontent-%COMP%]{border:1px solid gold}.hiring-panel[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let n=e;return n})();function kd(n){let e=u(oe),i=u(gs).escape$.subscribe(()=>e.dispatch(Ni({view:n})));u(_o).onDestroy(()=>i.unsubscribe())}function N1(n,e){if(n&1){let i=I();a(0,"div",8),y("click",function(){let o=w(i).$implicit,r=m();return S(r.itemToBuy.set(o))}),g(1,"mw-item-icon",9),p(2),g(3,"mw-resources-cost",10),l()}if(n&2){let i=e.$implicit,t=m();me("active",t.itemToBuy()===i),c(),f("itemBase",i),c(),D(" ",i.name," "),c(),f("cost",i.cost)}}function U1(n,e){if(n&1){let i=I();a(0,"div",8),y("click",function(){let o=w(i).$implicit,r=m(2);return S(r.itemToSell.set(o))}),g(1,"mw-item-icon",9),p(2),g(3,"mw-resources-cost",10),l()}if(n&2){let i=e.$implicit,t=m(2);me("active",t.itemToSell()===i),c(),f("itemBase",i.baseType),c(),D(" ",i.baseType.name," "),c(),f("cost",i.baseType.sellingCost)}}function V1(n,e){if(n&1&&(a(0,"div"),p(1,"Sell:"),l(),a(2,"div",2),P(3,U1,4,5,"div",3,j),l()),n&2){let i=m();c(3),E(i.hero.itemsBackpack)}}function H1(n,e){if(n&1){let i=I();a(0,"button",4),y("click",function(){w(i);let o=m();return S(o.sellItem())}),p(1," Sell "),l()}if(n&2){let i=m();f("disabled",!i.canSell())}}var Sm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.players=u($),this.itemsService=u(rn),this.events=u(oe),this.currentPlayer=this.players.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.sellingData=this.data.building.getCustomData(),this.items=Nh(this.sellingData?.items??[]),this.allowsSelling=this.sellingData?.selling,this.itemToBuy=k(null),this.itemToSell=k(null),this.canBuy=ae(()=>{let t=this.itemToBuy();return this.itemToSell(),!!t&&this.players.playerHasResources(this.currentPlayer,t.cost)}),this.canSell=ae(()=>!!this.itemToSell())}buyItem(){let t=this.itemToBuy(),o=this.itemsService.createItem(t);this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost||{}),this.events.dispatch(gn({item:o,player:this.currentPlayer})),z.removeItem(this.items,t),this.itemToBuy.set(null)}sellItem(){let t=this.itemToSell();this.players.addResourcesToPlayer(this.currentPlayer,t.baseType.sellingCost||{}),this.events.dispatch(gr({item:t,player:this.currentPlayer})),this.itemToSell.set(null)}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-items-selling-popup"]],standalone:!1,features:[V],decls:17,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"item-list"],[1,"item",3,"active"],["mw-main-button","",3,"click","disabled"],["popupButtons",""],["mw-main-button","",3,"disabled"],["mw-main-button","",3,"click"],[1,"item",3,"click"],[3,"itemBase"],[2,"display","flex","flex-direction","column",3,"cost"]],template:function(o,r){o&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),p(3,"Items Market"),l(),a(4,"div"),p(5,"Buy:"),l()(),a(6,"div",1)(7,"div",2),P(8,N1,4,5,"div",3,j),l(),a(10,"button",4),y("click",function(){return r.buyItem()}),p(11," Buy "),l(),x(12,V1,5,0),l(),a(13,"div",5),x(14,H1,2,1,"button",6),a(15,"button",7),y("click",function(){return r.popup.close()}),p(16," Close "),l()()()),o&2&&(c(8),E(r.items),c(2),f("disabled",!r.canBuy()),c(2),M(r.allowsSelling?12:-1),c(2),M(r.allowsSelling?14:-1))},dependencies:[Ko,tn,ee,we],styles:[".item-list[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center}.item[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:4px;font-size:13px;cursor:pointer;max-width:94px;display:flex;flex-direction:column;align-items:center;text-align:center}.item.active[_ngcontent-%COMP%]{border-color:gold}"]});let n=e;return n})();function j1(n,e){if(n&1&&(a(0,"div"),p(1),a(2,"div"),g(3,"mw-res-label",10),l()()),n&2){let i=e.$implicit;c(),D(" ",i.title," "),c(2),f("resType","gold")("amount",i.trader.goldEntry.max)}}function $1(n,e){if(n&1){let i=I();a(0,"div")(1,"input",13),ne("ngModelChange",function(o){w(i);let r=m(2).$implicit;return ie(r.count,o)||(r.count=o),S(o)}),l(),p(2),l()}if(n&2){let i=m(2).$implicit;c(),f("max",i.max),te("ngModel",i.count),c(),D(" ",i.count()," ")}}function z1(n,e){if(n&1&&(a(0,"div",12)(1,"div"),g(2,"mw-res-label",10),l(),x(3,$1,3,3,"div"),l()),n&2){let i=m().$implicit;c(2),f("resType",i.resType)("amount",i.max),c(),M(i.isGold?-1:3)}}function W1(n,e){if(n&1&&x(0,z1,4,3,"div",12),n&2){let i=e.$implicit;M(i.isGold?-1:0)}}function q1(n,e){if(n&1&&(a(0,"div",5)(1,"div",11),P(2,W1,1,1,null,null,j),l()()),n&2){let i=e.$implicit;c(2),E(i.trader.resourceEntries())}}function Y1(n,e){if(n&1&&g(0,"mw-res-label",10),n&2){let i=e.$implicit;f("resType",i.resType)("amount",i.count)}}function K1(n,e){if(n&1&&(a(0,"div",1),p(1,"You will get:"),l(),g(2,"mw-res-label",14),a(3,"div"),P(4,Y1,1,2,"mw-res-label",10,j),l()),n&2){let i=m();c(2),f("amount",i.dealCost()),c(2),E(i.dealResources())}}function Z1(n,e){n&1&&p(0," You don't have enough money! ")}function X1(n,e){n&1&&p(0," Market doesn't have enough money! ")}function Q1(n,e){if(n&1&&(a(0,"div"),x(1,Z1,1,0)(2,X1,1,0),l()),n&2){let i;m();let t=q(11);c(),M((i=t.cantTrade)==="player"?1:i==="market"?2:-1)}}var Ad=class{constructor(e,i){this.resources=e,this.multipliers=i,this.resourceEntries=k([]),this.costInGold=ae(()=>this.resourceEntries().reduce((t,o)=>Hh[o.resType]*o.count()+t,0)),this.resourceEntries.set(Xn(e).map(([t,o])=>({resType:t,count:k(0),max:o}))),this.goldEntry=this.resourceEntries().find(t=>t.resType===Oe.Gold),this.goldEntry.isGold=!0}applyCounts(){this.resourceEntries().forEach(e=>{let i=e.count();e.max-=i,e.count.set(0)})}addToResource(e,i){this.resources[e]+=i,this.goldEntry.max+=i}addToResources(e){Xn(e).forEach(([i,t])=>{this.resources[i]+=t})}removeResources(e){Xn(e).forEach(([i,t])=>{this.resources[i]-=t;let o=this.getResourceEntry(i);o.max-=t,o.count.set(0)})}addResources(e){Xn(e).forEach(([i,t])=>{this.resources[i]+=t;let o=this.getResourceEntry(i);o.max+=t,o.count.set(0)})}addMaxResources(e,i){Xn(e).forEach(([t,o])=>{let r=this.getResourceEntry(t);r.isGold?i?r.max-=o:r.max+=o:i?r.max+=o:r.max-=o})}getResourceEntry(e){return this.resourceEntries().find(i=>i.resType===e)}getCountsAsResourcesDiff(e=!1){return this.resourceEntries().reduce((i,t)=>(i[t.resType]=t.isGold?this.costInGold():t.count(),e?t.isGold&&(i[t.resType]=-i[t.resType]):t.isGold||(i[t.resType]=-i[t.resType]),i),{})}getCountsAsResources(e=!1){return this.resourceEntries().reduce((i,t)=>(i[t.resType]=t.isGold?e?0:this.costInGold():t.count(),i),{})}},bm=(()=>{let e=class e extends ye{constructor(){super(...arguments),this.playersService=u($),this.currentPlayer=this.playersService.getCurrentPlayer(),this.playerTrader=new Ad(this.currentPlayer.resources),this.marketTrader=new Ad(this.data.town.marketState().resources),this.traders=[{title:"Your Gold",trader:this.playerTrader},{title:"Market Gold",trader:this.marketTrader}],this.dealCost=ae(()=>this.playerTrader.costInGold()-this.marketTrader.costInGold()),this.canTradeDetails=ae(()=>{let t=this.dealCost();return t===0&&(this.marketTrader.costInGold()===0||this.playerTrader.costInGold()===0)?{canTrade:!1}:t<0?{canTrade:this.playerTrader.goldEntry.max+this.marketTrader.goldEntry.count()>=Math.abs(t),cantTrade:"player"}:{canTrade:this.marketTrader.goldEntry.max+this.playerTrader.goldEntry.count()>=Math.abs(t),cantTrade:"market"}}),this.dealResources=ae(()=>{let t=this.playerTrader.getCountsAsResources(!0),o=this.marketTrader.getCountsAsResources(!0);return Xn(o).map(([r,s])=>({resType:r,count:s-t[r]})).filter(r=>r.count&&r.resType!==Oe.Gold)})}trade(){let t=this.playerTrader,o=this.marketTrader,r=t.getCountsAsResources(!0),s=o.getCountsAsResources(!0);t.addToResource(Oe.Gold,this.dealCost()),o.addToResource(Oe.Gold,this.dealCost()*-1),console.log(r,s),t.removeResources(r),o.removeResources(s),t.addResources(s),o.addResources(r)}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-market-dialog"]],standalone:!1,features:[V],decls:23,vars:6,consts:[[1,"header"],[1,"title"],[1,"res"],[1,"earnings"],[1,"trading"],[1,"trader"],[1,"deal-info"],[1,"buttons"],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[3,"resType","amount"],[1,"resources"],[1,"resource"],["type","range","step","1","min","0",3,"ngModelChange","max","ngModel"],["resType","gold",3,"amount"]],template:function(o,r){if(o&1){let s=I();a(0,"div",0)(1,"div",1),p(2,"Market"),l(),a(3,"div",2),P(4,j1,4,3,"div",null,j),l(),a(6,"div",3)(7,"div"),p(8),l(),a(9,"div"),p(10),l()()(),Re(11),a(12,"div",4),P(13,q1,4,0,"div",5,j),l(),a(15,"div",6),x(16,K1,6,1),x(17,Q1,3,1,"div"),l(),a(18,"div",7)(19,"button",8),y("click",function(){return w(s),S(r.trade())}),p(20," Trade "),l(),a(21,"button",9),y("click",function(){return w(s),S(r.close())}),p(22," Leave "),l()()}if(o&2){c(4),E(r.traders),c(4),D("Will Earn: ",r.playerTrader.costInGold()),c(2),D("Will Spend: ",r.marketTrader.costInGold()),c();let s=Ve(r.canTradeDetails());c(2),E(r.traders),c(3),M(r.dealResources().length?16:-1),c(),M(!s.canTrade&&r.dealCost()?17:-1),c(2),f("disabled",!s.canTrade)}},dependencies:[Wt,ee,li,ym,Kt,Vt],styles:[".title[_ngcontent-%COMP%]{text-align:center}.earnings[_ngcontent-%COMP%], .res[_ngcontent-%COMP%]{display:flex}.earnings[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .res[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1;text-align:center}.trading[_ngcontent-%COMP%]{display:flex}.trading[_ngcontent-%COMP%]   .trader[_ngcontent-%COMP%]{flex:1;text-align:center}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:center}.deal-info[_ngcontent-%COMP%]{text-align:center}"],changeDetection:0});let n=e;return n})();var Od=(()=>{let e=class e{constructor(){this.templateRef=Oh.required(vi),this.disableClose=N(!1),this.dialog=u(Is)}open(){this.dialogRef=this.dialog.open(this.templateRef(),{disableClose:this.disableClose()})}close(){this.dialogRef?.close()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-local-dialog"]],contentQueries:function(o,r,s){o&1&&Ih(s,r.templateRef,vi,5),o&2&&ei()},inputs:{disableClose:[1,"disableClose"]},decls:0,vars:0,template:function(o,r){},styles:["[_nghost-%COMP%]{display:none}"]});let n=e;return n})();function J1(n,e){if(n&1){let i=I();a(0,"div",14),y("click",function(){w(i);let o=m().$implicit,r=m().$implicit,s=m(),d=ce(31);return s.actionCardToBuy.set(o),s.activeHallsOfFateConfig.set(r),S(d.open())}),g(1,"mw-action-card",15)(2,"mw-resources-cost",16),a(3,"div",17),p(4),l()()}if(n&2){let i=m().$implicit;c(),f("actionCard",i.item),c(),f("cost",i.cost),c(2),D("Count: ",i.count())}}function eM(n,e){if(n&1&&x(0,J1,5,3,"div",13),n&2){let i=e.$implicit;M(i.count()?0:-1)}}function tM(n,e){if(n&1&&P(0,eM,1,1,null,null,j),n&2){let i=e.$implicit;E(i.actionCards)}}function iM(n,e){if(n&1){let i=I();a(0,"div",19),y("click",function(){let o=w(i).$implicit,r=m().$implicit,s=m(),d=ce(34);return s.itemToBuy.set(o),s.activeHallsOfFateConfig.set(r),S(d.open())}),g(1,"mw-item-icon",20)(2,"mw-resources-cost",16),l()}if(n&2){let i=e.$implicit;c(),f("itemBase",i),c(),f("cost",i.cost)}}function nM(n,e){if(n&1&&P(0,iM,3,2,"div",18,j),n&2){let i=e.$implicit;E(i.items)}}function oM(n,e){if(n&1){let i=I();a(0,"div",22),y("click",function(){let o=w(i).$implicit,r=m().$implicit,s=m(),d=ce(37);return s.spellToBuy.set(o),s.activeHallsOfFateConfig.set(r),S(d.open())}),g(1,"mw-ra-icon",23),p(2),g(3,"mw-resources-cost",16),l()}if(n&2){let i=e.$implicit;c(),f("icon",i.item.icon.icon),c(),D(" ",i.item.name," "),c(),f("cost",i.cost)}}function rM(n,e){if(n&1&&P(0,oM,4,3,"div",21,j),n&2){let i=e.$implicit;E(i.spells)}}function sM(n,e){n&1&&(a(0,"div"),p(1,"You don't have enough resources!"),l())}function aM(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",3),p(2,"Buy Action Card"),l(),a(3,"div",4),p(4," Are you sure you want to buy an action card? "),x(5,sM,2,0,"div"),l(),a(6,"div",11)(7,"button",24),y("click",function(){w(i);let o=m(),r=ce(31);return o.buyActionCard(),S(r.close())}),p(8," Buy "),l(),a(9,"button",12),y("click",function(){w(i);let o=m();return ce(31).close(),S(o.actionCardToBuy.set(null))}),p(10," Close "),l()()()}if(n&2){let i=m();c(5),M(i.canPurchaseActionCard()?-1:5),c(2),f("disabled",!i.canPurchaseActionCard())}}function lM(n,e){n&1&&(a(0,"div"),p(1,"You don't have enough resources!"),l())}function cM(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",3),p(2,"Buy Item"),l(),a(3,"div",4),p(4," Are you sure you want to buy an item? "),x(5,lM,2,0,"div"),l(),a(6,"div",11)(7,"button",24),y("click",function(){w(i);let o=m(),r=ce(34);return o.buyItem(),S(r.close())}),p(8," Buy "),l(),a(9,"button",12),y("click",function(){w(i);let o=m();return ce(34).close(),S(o.itemToBuy.set(null))}),p(10," Close "),l()()()}if(n&2){let i=m();c(5),M(i.canPurchaseItem()?-1:5),c(2),f("disabled",!i.canPurchaseItem())}}function dM(n,e){n&1&&(a(0,"div"),p(1,"You don't have enough resources!"),l())}function pM(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",3),p(2,"Buy Spell"),l(),a(3,"div",4),p(4," Are you sure you want to buy a spell? "),x(5,dM,2,0,"div"),l(),a(6,"div",11)(7,"button",24),y("click",function(){w(i);let o=m(),r=ce(37);return o.buySpell(),S(r.close())}),p(8," Buy "),l(),a(9,"button",12),y("click",function(){w(i);let o=m();return ce(37).close(),S(o.spellToBuy.set(null))}),p(10," Close "),l()()()}if(n&2){let i=m();c(5),M(i.canPurchaseSpell()?-1:5),c(2),f("disabled",!i.canPurchaseSpell())}}var Ty=(()=>{let e=class e extends Us{constructor(){super(...arguments),this.playersService=u($),this.events=u(oe),this.itemsService=u(rn),this.spellsService=u(Go),this.popupsService=u(Ei),this.player=this.playersService.getCurrentPlayer(),this.hero=this.player.hero,this.actionCardToBuy=k(null),this.itemToBuy=k(null),this.spellToBuy=k(null),this.activeHallsOfFateConfig=k(null)}upgradeBuilding(){this.close(),this.popupsService.createBasicPopup({component:Kr,data:{building:this.dialogData.building,targetLevel:2},class:"dark"})}buyActionCard(){let t=this.actionCardToBuy();t?.count.update(o=>--o),this.playersService.removeResourcesFromPlayer(this.player,t.cost),t?.count()||z.removeItem(this.activeHallsOfFateConfig().actionCards,t),this.events.dispatch(xi({player:this.player,actionCardStacks:[{card:t.item,count:1}]}))}buyItem(){let t=this.itemToBuy();this.playersService.removeResourcesFromPlayer(this.player,t.cost),z.removeItem(this.activeHallsOfFateConfig().items,t),this.playersService.addItemToPlayer(this.playersService.getCurrentPlayer(),this.itemsService.createItem(t))}buySpell(){let t=this.spellToBuy();this.playersService.removeResourcesFromPlayer(this.player,t.cost),z.removeItem(this.activeHallsOfFateConfig().spells,t);let o=this.spellsService.createSpellInstance(t.item);this.playersService.addSpellToPlayer(this.player,o)}canPurchaseActionCard(){let t=this.actionCardToBuy();return t?this.playersService.playerHasResources(this.player,t.cost):!1}canPurchaseItem(){let t=this.itemToBuy();return t?.cost?this.playersService.playerHasResources(this.player,t.cost):!1}canPurchaseSpell(){let t=this.spellToBuy();return t?this.playersService.playerHasResources(this.player,t.cost):!1}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-halls-of-fate"]],features:[V],decls:39,vars:2,consts:[["buyActionCardDialog",""],["buyItemDialog",""],["buySpellDialog",""],["popupHeader",""],["popupContent",""],[1,"header"],[1,"action-cards"],[1,"groups"],[1,"group"],[1,"items"],[1,"spells"],["popupButtons",""],["mw-main-button","",3,"click"],[1,"card"],[1,"card",3,"click"],["appearance","small",3,"actionCard"],[3,"cost"],[1,"count"],[1,"item"],[1,"item",3,"click"],[3,"itemBase"],[1,"spell"],[1,"spell",3,"click"],[1,"spell-icon",3,"icon"],["mw-main-button","",3,"click","disabled"]],template:function(o,r){if(o&1){let s=I();a(0,"mw-popup-base-content")(1,"div",3),p(2),l(),a(3,"div",4),p(4),g(5,"hr"),a(6,"div",5),p(7,"Action Cards:"),l(),a(8,"div",6),P(9,tM,2,0,null,null,j),l(),g(11,"hr"),a(12,"div",7)(13,"div",8)(14,"div",5),p(15,"Items:"),l(),a(16,"div",9),P(17,nM,2,0,null,null,j),l()(),a(19,"div",8)(20,"div",5),p(21,"Spells:"),l(),a(22,"div",10),P(23,rM,2,0,null,null,j),l()()()(),a(25,"div",11)(26,"button",12),y("click",function(){return w(s),S(r.upgradeBuilding())}),p(27," Upgrade Building "),l(),a(28,"button",12),y("click",function(){return w(s),S(r.close())}),p(29," Close "),l()()(),a(30,"mw-local-dialog",null,0),K(32,aM,11,2,"ng-template"),l(),a(33,"mw-local-dialog",null,1),K(35,cM,11,2,"ng-template"),l(),a(36,"mw-local-dialog",null,2),K(38,pM,11,2,"ng-template"),l()}o&2&&(c(2),H(r.dialogData.building.base.baseName),c(2),D(" ",r.hero.base.name," "),c(5),E(r.player.hallsOfFateConfig),c(8),E(r.player.hallsOfFateConfig),c(6),E(r.player.hallsOfFateConfig))},dependencies:[Ke,Ko,Ar,tn,Ce,ee,we,Od],styles:["mw-popup-base-content[_ngcontent-%COMP%]{background-color:#fff}.action-cards[_ngcontent-%COMP%], .items[_ngcontent-%COMP%], .spells[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:center}.card[_ngcontent-%COMP%], .spell[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:5px}.card[_ngcontent-%COMP%]:hover, .spell[_ngcontent-%COMP%]:hover, .item[_ngcontent-%COMP%]:hover{background:#b7b7b761}.spell[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]{cursor:pointer}.groups[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around}"]});let n=e;return n})();var xm=(()=>{class n{_listeners=[];notify(i,t){for(let o of this._listeners)o(i,t)}listen(i){return this._listeners.push(i),()=>{this._listeners=this._listeners.filter(t=>i!==t)}}ngOnDestroy(){this._listeners=[]}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var uM=200,Fd=class{_letterKeyStream=new X;_items=[];_selectedItemIndex=-1;_pressedLetters=[];_skipPredicateFn;_selectedItem=new X;selectedItem=this._selectedItem;constructor(e,i){let t=typeof i?.debounceInterval=="number"?i.debounceInterval:uM;i?.skipPredicate&&(this._skipPredicateFn=i.skipPredicate),this.setItems(e),this._setupKeyHandler(t)}destroy(){this._pressedLetters=[],this._letterKeyStream.complete(),this._selectedItem.complete()}setCurrentSelectedItemIndex(e){this._selectedItemIndex=e}setItems(e){this._items=e}handleKey(e){let i=e.keyCode;e.key&&e.key.length===1?this._letterKeyStream.next(e.key.toLocaleUpperCase()):(i>=65&&i<=90||i>=48&&i<=57)&&this._letterKeyStream.next(String.fromCharCode(i))}isTyping(){return this._pressedLetters.length>0}reset(){this._pressedLetters=[]}_setupKeyHandler(e){this._letterKeyStream.pipe(ns(i=>this._pressedLetters.push(i)),Il(e),Ai(()=>this._pressedLetters.length>0),Xt(()=>this._pressedLetters.join("").toLocaleUpperCase())).subscribe(i=>{for(let t=1;t<this._items.length+1;t++){let o=(this._selectedItemIndex+t)%this._items.length,r=this._items[o];if(!this._skipPredicateFn?.(r)&&r.getLabel?.().toLocaleUpperCase().trim().indexOf(i)===0){this._selectedItem.next(r);break}}this._pressedLetters=[]})}};var Rd=class{_items;_activeItemIndex=k(-1);_activeItem=k(null);_wrap=!1;_typeaheadSubscription=yi.EMPTY;_itemChangesSubscription;_vertical=!0;_horizontal;_allowedModifierKeys=[];_homeAndEnd=!1;_pageUpAndDown={enabled:!1,delta:10};_effectRef;_typeahead;_skipPredicateFn=e=>e.disabled;constructor(e,i){this._items=e,e instanceof cp?this._itemChangesSubscription=e.changes.subscribe(t=>this._itemsChanged(t.toArray())):rp(e)&&(this._effectRef=ss(()=>this._itemsChanged(e()),{injector:i}))}tabOut=new X;change=new X;skipPredicate(e){return this._skipPredicateFn=e,this}withWrap(e=!0){return this._wrap=e,this}withVerticalOrientation(e=!0){return this._vertical=e,this}withHorizontalOrientation(e){return this._horizontal=e,this}withAllowedModifierKeys(e){return this._allowedModifierKeys=e,this}withTypeAhead(e=200){this._typeaheadSubscription.unsubscribe();let i=this._getItemsArray();return this._typeahead=new Fd(i,{debounceInterval:typeof e=="number"?e:void 0,skipPredicate:t=>this._skipPredicateFn(t)}),this._typeaheadSubscription=this._typeahead.selectedItem.subscribe(t=>{this.setActiveItem(t)}),this}cancelTypeahead(){return this._typeahead?.reset(),this}withHomeAndEnd(e=!0){return this._homeAndEnd=e,this}withPageUpDown(e=!0,i=10){return this._pageUpAndDown={enabled:e,delta:i},this}setActiveItem(e){let i=this._activeItem();this.updateActiveItem(e),this._activeItem()!==i&&this.change.next(this._activeItemIndex())}onKeydown(e){let i=e.keyCode,o=["altKey","ctrlKey","metaKey","shiftKey"].every(r=>!e[r]||this._allowedModifierKeys.indexOf(r)>-1);switch(i){case 9:this.tabOut.next();return;case 40:if(this._vertical&&o){this.setNextItemActive();break}else return;case 38:if(this._vertical&&o){this.setPreviousItemActive();break}else return;case 39:if(this._horizontal&&o){this._horizontal==="rtl"?this.setPreviousItemActive():this.setNextItemActive();break}else return;case 37:if(this._horizontal&&o){this._horizontal==="rtl"?this.setNextItemActive():this.setPreviousItemActive();break}else return;case 36:if(this._homeAndEnd&&o){this.setFirstItemActive();break}else return;case 35:if(this._homeAndEnd&&o){this.setLastItemActive();break}else return;case 33:if(this._pageUpAndDown.enabled&&o){let r=this._activeItemIndex()-this._pageUpAndDown.delta;this._setActiveItemByIndex(r>0?r:0,1);break}else return;case 34:if(this._pageUpAndDown.enabled&&o){let r=this._activeItemIndex()+this._pageUpAndDown.delta,s=this._getItemsArray().length;this._setActiveItemByIndex(r<s?r:s-1,-1);break}else return;default:(o||hi(e,"shiftKey"))&&this._typeahead?.handleKey(e);return}this._typeahead?.reset(),e.preventDefault()}get activeItemIndex(){return this._activeItemIndex()}get activeItem(){return this._activeItem()}isTyping(){return!!this._typeahead&&this._typeahead.isTyping()}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._getItemsArray().length-1,-1)}setNextItemActive(){this._activeItemIndex()<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex()<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(e){let i=this._getItemsArray(),t=typeof e=="number"?e:i.indexOf(e),o=i[t];this._activeItem.set(o??null),this._activeItemIndex.set(t),this._typeahead?.setCurrentSelectedItemIndex(t)}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._effectRef?.destroy(),this._typeahead?.destroy(),this.tabOut.complete(),this.change.complete()}_setActiveItemByDelta(e){this._wrap?this._setActiveInWrapMode(e):this._setActiveInDefaultMode(e)}_setActiveInWrapMode(e){let i=this._getItemsArray();for(let t=1;t<=i.length;t++){let o=(this._activeItemIndex()+e*t+i.length)%i.length,r=i[o];if(!this._skipPredicateFn(r)){this.setActiveItem(o);return}}}_setActiveInDefaultMode(e){this._setActiveItemByIndex(this._activeItemIndex()+e,e)}_setActiveItemByIndex(e,i){let t=this._getItemsArray();if(t[e]){for(;this._skipPredicateFn(t[e]);)if(e+=i,!t[e])return;this.setActiveItem(e)}}_getItemsArray(){return rp(this._items)?this._items():this._items instanceof cp?this._items.toArray():this._items}_itemsChanged(e){this._typeahead?.setItems(e);let i=this._activeItem();if(i){let t=e.indexOf(i);t>-1&&t!==this._activeItemIndex()&&(this._activeItemIndex.set(t),this._typeahead?.setCurrentSelectedItemIndex(t))}}};var Bd=class extends Rd{_origin="program";setFocusOrigin(e){return this._origin=e,this}setActiveItem(e){super.setActiveItem(e),this.activeItem&&this.activeItem.focus(this._origin)}};var ky=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkMenuGroup",""]],hostAttrs:["role","group",1,"cdk-menu-group"],exportAs:["cdkMenuGroup"],features:[et([{provide:xm,useClass:xm}])]})}return n})(),Im=new Se("cdk-menu"),Zo=function(n){return n[n.nextItem=0]="nextItem",n[n.previousItem=1]="previousItem",n[n.currentItem=2]="currentItem",n}(Zo||{}),Xo=new Se("cdk-menu-stack"),fM={provide:Xo,deps:[[new js,new lp,new kl(Xo)]],useFactory:n=>n||new Ay},gM=n=>({provide:Xo,deps:[[new js,new lp,new kl(Xo)]],useFactory:e=>e||Ay.inline(n)}),Ay=(()=>{class n{id=u(jr).getId("cdk-menu-stack-");_elements=[];_close=new X;_empty=new X;_hasFocus=new X;closed=this._close;hasFocus=this._hasFocus.pipe(Wn(!1),Il(0),vo());emptied=this._empty;_inlineMenuOrientation=null;static inline(i){let t=new n;return t._inlineMenuOrientation=i,t}push(i){this._elements.push(i)}close(i,t){let{focusNextOnEmpty:o,focusParentTrigger:r}=T({},t);if(this._elements.indexOf(i)>=0){let s;do s=this._elements.pop(),this._close.next({item:s,focusParentTrigger:r});while(s!==i);this.isEmpty()&&this._empty.next(o)}}closeSubMenuOf(i){let t=!1;if(this._elements.indexOf(i)>=0)for(t=this.peek()!==i;this.peek()!==i;)this._close.next({item:this._elements.pop()});return t}closeAll(i){let{focusNextOnEmpty:t,focusParentTrigger:o}=T({},i);if(!this.isEmpty()){for(;!this.isEmpty();){let r=this._elements.pop();r&&this._close.next({item:r,focusParentTrigger:o})}this._empty.next(t)}}isEmpty(){return!this._elements.length}length(){return this._elements.length}peek(){return this._elements[this._elements.length-1]}hasInlineMenu(){return this._inlineMenuOrientation!=null}inlineMenuOrientation(){return this._inlineMenuOrientation}setHasFocus(i){this._hasFocus.next(i)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac})}return n})(),km=new Se("cdk-menu-trigger"),yM=new Se("cdk-menu-scroll-strategy",{providedIn:"root",factory:()=>{let n=u(Ne);return()=>Ps(n)}}),_M=(()=>{class n{injector=u(Ne);viewContainerRef=u(Ht);menuStack=u(Xo);menuScrollStrategy=u(yM);menuPosition;opened=new ze;closed=new ze;menuTemplateRef;menuData;overlayRef=null;destroyed=new X;stopOutsideClicksListener=yo(this.closed,this.destroyed);childMenu;_menuPortal;_childMenuInjector;ngOnDestroy(){this._destroyOverlay(),this.destroyed.next(),this.destroyed.complete()}isOpen(){return!!this.overlayRef?.hasAttached()}registerChildMenu(i){this.childMenu=i}getMenuContentPortal(){let i=this.menuTemplateRef!==this._menuPortal?.templateRef;return this.menuTemplateRef&&(!this._menuPortal||i)&&(this._menuPortal=new qo(this.menuTemplateRef,this.viewContainerRef,this.menuData,this._getChildMenuInjector())),this._menuPortal}isElementInsideMenuStack(i){for(let t=i;t;t=t?.parentElement??null)if(t.getAttribute("data-cdk-menu-stack-id")===this.menuStack.id)return!0;return!1}_destroyOverlay(){this.overlayRef&&(this.overlayRef.dispose(),this.overlayRef=null)}_getChildMenuInjector(){return this._childMenuInjector=this._childMenuInjector||Ne.create({providers:[{provide:km,useValue:this},{provide:Xo,useValue:this.menuStack}],parent:this.injector}),this._childMenuInjector}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,hostVars:2,hostBindings:function(t,o){t&2&&Ci("aria-controls",o.childMenu==null?null:o.childMenu.id)("data-cdk-menu-stack-id",o.menuStack.id)}})}return n})();var Am=new Se("cdk-menu-aim");function Oy(n,e){if(!e.isTrusted)return!1;let i=n.nativeElement,t=e.keyCode;return i.nodeName==="BUTTON"&&!i.disabled?t===13||t===32:i.nodeName==="A"?t===13:!1}var Cl=(()=>{class n extends _M{_elementRef=u(Ue);_ngZone=u(Ae);_changeDetectorRef=u(hn);_inputModalityDetector=u(id);_directionality=u(Mn,{optional:!0});_renderer=u($e);_injector=u(Ne);_cleanupMouseenter;_parentMenu=u(Im,{optional:!0});_menuAim=u(Am,{optional:!0});constructor(){super(),this._setRole(),this._registerCloseHandler(),this._subscribeToMenuStackClosed(),this._subscribeToMouseEnter(),this._subscribeToMenuStackHasFocus(),this._setType()}toggle(){this.isOpen()?this.close():this.open()}open(){!this.isOpen()&&this.menuTemplateRef!=null&&(this.opened.next(),this.overlayRef=this.overlayRef||Es(this._injector,this._getOverlayConfig()),this.overlayRef.attach(this.getMenuContentPortal()),this._changeDetectorRef.markForCheck(),this._subscribeToOutsideClicks())}close(){this.isOpen()&&(this.closed.next(),this.overlayRef.detach(),this._changeDetectorRef.markForCheck()),this._closeSiblingTriggers()}getMenu(){return this.childMenu}ngOnChanges(i){i.menuPosition&&this.overlayRef&&this.overlayRef.updatePositionStrategy(this._getOverlayPositionStrategy())}ngOnDestroy(){this._cleanupMouseenter(),super.ngOnDestroy()}_toggleOnKeydown(i){let t=this._parentMenu?.orientation==="vertical";switch(i.keyCode){case 32:case 13:!hi(i)&&!Oy(this._elementRef,i)&&(this.toggle(),this.childMenu?.focusFirstItem("keyboard"));break;case 39:hi(i)||this._parentMenu&&t&&this._directionality?.value!=="rtl"&&(i.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 37:hi(i)||this._parentMenu&&t&&this._directionality?.value==="rtl"&&(i.preventDefault(),this.open(),this.childMenu?.focusFirstItem("keyboard"));break;case 40:case 38:hi(i)||t||(i.preventDefault(),this.open(),i.keyCode===40?this.childMenu?.focusFirstItem("keyboard"):this.childMenu?.focusLastItem("keyboard"));break}}_handleClick(){this.toggle(),this.childMenu?.focusFirstItem("mouse")}_setHasFocus(i){this._parentMenu||this.menuStack.setHasFocus(i)}_subscribeToMouseEnter(){this._cleanupMouseenter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{if(this._inputModalityDetector.mostRecentModality!=="touch"&&!this.menuStack.isEmpty()&&!this.isOpen()){let i=()=>this._ngZone.run(()=>{this._closeSiblingTriggers(),this.open()});this._menuAim?this._menuAim.toggle(i):i()}}))}_closeSiblingTriggers(){this._parentMenu?!this.menuStack.closeSubMenuOf(this._parentMenu)&&this.menuStack.peek()!==this._parentMenu&&this.menuStack.closeAll():this.menuStack.closeAll()}_getOverlayConfig(){return new Yo({positionStrategy:this._getOverlayPositionStrategy(),scrollStrategy:this.menuScrollStrategy(),direction:this._directionality||void 0})}_getOverlayPositionStrategy(){return hd(this._injector,this._elementRef).withLockedPosition().withFlexibleDimensions(!1).withPositions(this._getOverlayPositions())}_getOverlayPositions(){return this.menuPosition??(!this._parentMenu||this._parentMenu.orientation==="horizontal"?Zu:Xu)}_registerCloseHandler(){this._parentMenu||this.menuStack.closed.pipe(Ge(this.destroyed)).subscribe(({item:i})=>{i===this.childMenu&&this.close()})}_subscribeToOutsideClicks(){this.overlayRef&&this.overlayRef.outsidePointerEvents().pipe(Ge(this.stopOutsideClicksListener)).subscribe(i=>{let t=ai(i),o=this._elementRef.nativeElement;t!==o&&!o.contains(t)&&(this.isElementInsideMenuStack(t)?this._closeSiblingTriggers():this.menuStack.closeAll())})}_subscribeToMenuStackHasFocus(){this._parentMenu||this.menuStack.hasFocus.pipe(Ge(this.destroyed)).subscribe(i=>{i||this.menuStack.closeAll()})}_subscribeToMenuStackClosed(){this._parentMenu||this.menuStack.closed.subscribe(({focusParentTrigger:i})=>{i&&!this.menuStack.length()&&this._elementRef.nativeElement.focus()})}_setRole(){this._parentMenu||this._elementRef.nativeElement.setAttribute("role","button")}_setType(){let i=this._elementRef.nativeElement;i.nodeName==="BUTTON"&&!i.getAttribute("type")&&i.setAttribute("type","button")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkMenuTriggerFor",""]],hostAttrs:[1,"cdk-menu-trigger"],hostVars:2,hostBindings:function(t,o){t&1&&y("focusin",function(){return o._setHasFocus(!0)})("focusout",function(){return o._setHasFocus(!1)})("keydown",function(s){return o._toggleOnKeydown(s)})("click",function(){return o._handleClick()}),t&2&&Ci("aria-haspopup",o.menuTemplateRef?"menu":null)("aria-expanded",o.menuTemplateRef==null?null:o.isOpen())},inputs:{menuTemplateRef:[0,"cdkMenuTriggerFor","menuTemplateRef"],menuPosition:[0,"cdkMenuPosition","menuPosition"],menuData:[0,"cdkMenuTriggerData","menuData"]},outputs:{opened:"cdkMenuOpened",closed:"cdkMenuClosed"},exportAs:["cdkMenuTriggerFor"],features:[et([{provide:km,useExisting:n},fM]),V,bt]})}return n})(),vM=(()=>{class n{_dir=u(Mn,{optional:!0});_elementRef=u(Ue);_ngZone=u(Ae);_inputModalityDetector=u(id);_renderer=u($e);_cleanupMouseEnter;_menuAim=u(Am,{optional:!0});_menuStack=u(Xo);_parentMenu=u(Im,{optional:!0});_menuTrigger=u(Cl,{optional:!0,self:!0});disabled=!1;typeaheadLabel;triggered=new ze;get hasMenu(){return this._menuTrigger?.menuTemplateRef!=null}_tabindex=-1;closeOnSpacebarTrigger=!0;destroyed=new X;constructor(){this._setupMouseEnter(),this._setType(),this._isStandaloneItem()&&(this._tabindex=0)}ngOnDestroy(){this._cleanupMouseEnter?.(),this.destroyed.next(),this.destroyed.complete()}focus(){this._elementRef.nativeElement.focus()}trigger(i){let{keepOpen:t}=T({},i);!this.disabled&&!this.hasMenu&&(this.triggered.next(),t||this._menuStack.closeAll({focusParentTrigger:!0}))}isMenuOpen(){return!!this._menuTrigger?.isOpen()}getMenu(){return this._menuTrigger?.getMenu()}getMenuTrigger(){return this._menuTrigger}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}_resetTabIndex(){this._isStandaloneItem()||(this._tabindex=-1)}_setTabIndex(i){this.disabled||(!i||!this._menuStack.isEmpty())&&(this._tabindex=0)}_onKeydown(i){switch(i.keyCode){case 32:case 13:if(!hi(i)&&!Oy(this._elementRef,i)){let t=this._elementRef.nativeElement.nodeName;t!=="A"&&t!=="BUTTON"&&i.preventDefault(),this.trigger({keepOpen:i.keyCode===32&&!this.closeOnSpacebarTrigger})}break;case 39:hi(i)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._forwardArrowPressed(i):this._backArrowPressed(i));break;case 37:hi(i)||this._parentMenu&&this._isParentVertical()&&(this._dir?.value!=="rtl"?this._backArrowPressed(i):this._forwardArrowPressed(i));break}}_isStandaloneItem(){return!this._parentMenu}_backArrowPressed(i){let t=this._parentMenu;(this._menuStack.hasInlineMenu()||this._menuStack.length()>1)&&(i.preventDefault(),this._menuStack.close(t,{focusNextOnEmpty:this._menuStack.inlineMenuOrientation()==="horizontal"?Zo.previousItem:Zo.currentItem,focusParentTrigger:!0}))}_forwardArrowPressed(i){!this.hasMenu&&this._menuStack.inlineMenuOrientation()==="horizontal"&&(i.preventDefault(),this._menuStack.closeAll({focusNextOnEmpty:Zo.nextItem,focusParentTrigger:!0}))}_setupMouseEnter(){if(!this._isStandaloneItem()){let i=()=>this._ngZone.run(()=>this._menuStack.closeSubMenuOf(this._parentMenu));this._cleanupMouseEnter=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"mouseenter",()=>{this._inputModalityDetector.mostRecentModality!=="touch"&&!this._menuStack.isEmpty()&&!this.hasMenu&&(this._menuAim?this._menuAim.toggle(i):i())}))}}_isParentVertical(){return this._parentMenu?.orientation==="vertical"}_setType(){let i=this._elementRef.nativeElement;i.nodeName==="BUTTON"&&!i.getAttribute("type")&&i.setAttribute("type","button")}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkMenuItem",""]],hostAttrs:["role","menuitem",1,"cdk-menu-item"],hostVars:2,hostBindings:function(t,o){t&1&&y("blur",function(){return o._resetTabIndex()})("focus",function(){return o._setTabIndex()})("click",function(){return o.trigger()})("keydown",function(s){return o._onKeydown(s)}),t&2&&(mp("tabindex",o._tabindex),Ci("aria-disabled",o.disabled||null))},inputs:{disabled:[2,"cdkMenuItemDisabled","disabled",Tn],typeaheadLabel:[0,"cdkMenuitemTypeaheadLabel","typeaheadLabel"]},outputs:{triggered:"cdkMenuItemTriggered"},exportAs:["cdkMenuItem"]})}return n})(),Tm=class{_renderer;_items;_eventCleanups;_itemsSubscription;entered=new X;exited=new X;activeElement;previousElement;constructor(e,i){this._renderer=e,this._items=i,this._bindEvents(),this.entered.subscribe(t=>this.activeElement=t),this.exited.subscribe(()=>{this.previousElement=this.activeElement,this.activeElement=void 0})}destroy(){this._cleanupEvents(),this._itemsSubscription?.unsubscribe()}_bindEvents(){this._itemsSubscription=this._items.changes.pipe(Wn(this._items)).subscribe(()=>{this._cleanupEvents(),this._eventCleanups=[],this._items.forEach(e=>{let i=e._elementRef.nativeElement;this._eventCleanups.push(this._renderer.listen(i,"mouseenter",()=>{this.entered.next(e)}),this._renderer.listen(i,"mouseout",()=>{this.exited.next(e)}))})})}_cleanupEvents(){this._eventCleanups?.forEach(e=>e()),this._eventCleanups=void 0}},CM=(()=>{class n extends ky{_focusMonitor=u(nd);ngZone=u(Ae);_renderer=u($e);nativeElement=u(Ue).nativeElement;menuStack=u(Xo);menuAim=u(Am,{optional:!0,self:!0});dir=u(Mn,{optional:!0});id=u(jr).getId("cdk-menu-");items;orientation="vertical";isInline=!1;keyManager;destroyed=new X;triggerItem;pointerTracker;_menuStackHasFocus=k(!1);_tabIndexSignal=ae(()=>{let i=this._menuStackHasFocus()?-1:0;return this.isInline?i:null});ngAfterContentInit(){this.isInline||this.menuStack.push(this),this._setKeyManager(),this._handleFocus(),this._subscribeToMenuStackHasFocus(),this._subscribeToMenuOpen(),this._subscribeToMenuStackClosed(),this._setUpPointerTracker()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.nativeElement),this.keyManager?.destroy(),this.destroyed.next(),this.destroyed.complete(),this.pointerTracker?.destroy()}focusFirstItem(i="program"){this.keyManager.setFocusOrigin(i),this.keyManager.setFirstItemActive()}focusLastItem(i="program"){this.keyManager.setFocusOrigin(i),this.keyManager.setLastItemActive()}_getTabIndex(){return this._tabIndexSignal()}closeOpenMenu(i,t){let{focusParentTrigger:o}=T({},t),r=this.keyManager,s=this.triggerItem;i===s?.getMenuTrigger()?.getMenu()&&(s?.getMenuTrigger()?.close(),o&&(s?r.setActiveItem(s):r.setFirstItemActive()))}_setKeyManager(){this.keyManager=new Bd(this.items).withWrap().withTypeAhead().withHomeAndEnd(),this.orientation==="horizontal"?this.keyManager.withHorizontalOrientation(this.dir?.value||"ltr"):this.keyManager.withVerticalOrientation()}_subscribeToMenuOpen(){let i=yo(this.items.changes,this.destroyed);this.items.changes.pipe(Wn(this.items),nh(t=>t.filter(o=>o.hasMenu).map(o=>o.getMenuTrigger().opened.pipe(ph(o),Ge(i)))),oh(),nr(t=>(this.triggerItem=t,t.getMenuTrigger().closed)),Ge(this.destroyed)).subscribe(()=>this.triggerItem=void 0)}_subscribeToMenuStackClosed(){this.menuStack.closed.pipe(Ge(this.destroyed)).subscribe(({item:i,focusParentTrigger:t})=>this.closeOpenMenu(i,{focusParentTrigger:t}))}_subscribeToMenuStackHasFocus(){this.isInline&&this.menuStack.hasFocus.pipe(Ge(this.destroyed)).subscribe(i=>{this._menuStackHasFocus.set(i)})}_setUpPointerTracker(){this.menuAim&&(this.ngZone.runOutsideAngular(()=>{this.pointerTracker=new Tm(this._renderer,this.items)}),this.menuAim.initialize(this,this.pointerTracker))}_handleFocus(){this._focusMonitor.monitor(this.nativeElement,!1).pipe(Ge(this.destroyed)).subscribe(i=>{i!==null&&i!=="mouse"&&this.focusFirstItem(i)})}static \u0275fac=(()=>{let i;return function(o){return(i||(i=W(n)))(o||n)}})();static \u0275dir=pe({type:n,contentQueries:function(t,o,r){if(t&1&&Th(r,vM,5),t&2){let s;_t(s=vt())&&(o.items=s)}},hostAttrs:["role","menu"],hostVars:4,hostBindings:function(t,o){t&1&&y("focusin",function(){return o.menuStack.setHasFocus(!0)})("focusout",function(){return o.menuStack.setHasFocus(!1)}),t&2&&(mp("tabindex",o._getTabIndex())("id",o.id),Ci("aria-orientation",o.orientation)("data-cdk-menu-stack-id",o.menuStack.id))},inputs:{id:"id"},features:[V]})}return n})(),Fy=(()=>{class n extends CM{_parentTrigger=u(km,{optional:!0});closed=new ze;orientation="vertical";isInline=!this._parentTrigger;constructor(){super(),this.destroyed.subscribe(this.closed),this._parentTrigger?.registerChildMenu(this)}ngAfterContentInit(){super.ngAfterContentInit(),this._subscribeToMenuStackEmptied()}ngOnDestroy(){super.ngOnDestroy(),this.closed.complete()}_handleKeyEvent(i){let t=this.keyManager;switch(i.keyCode){case 37:case 39:hi(i)||(i.preventDefault(),t.setFocusOrigin("keyboard"),t.onKeydown(i));break;case 27:hi(i)||(i.preventDefault(),this.menuStack.close(this,{focusNextOnEmpty:Zo.currentItem,focusParentTrigger:!0}));break;case 9:hi(i,"altKey","metaKey","ctrlKey")||this.menuStack.closeAll({focusParentTrigger:!0});break;default:t.onKeydown(i)}}_toggleMenuFocus(i){let t=this.keyManager;switch(i){case Zo.nextItem:t.setFocusOrigin("keyboard"),t.setNextItemActive();break;case Zo.previousItem:t.setFocusOrigin("keyboard"),t.setPreviousItemActive();break;case Zo.currentItem:t.activeItem&&(t.setFocusOrigin("keyboard"),t.setActiveItem(t.activeItem));break}}_subscribeToMenuStackEmptied(){this.menuStack.emptied.pipe(Ge(this.destroyed)).subscribe(i=>this._toggleMenuFocus(i))}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkMenu",""]],hostAttrs:["role","menu",1,"cdk-menu"],hostVars:2,hostBindings:function(t,o){t&1&&y("keydown",function(s){return o._handleKeyEvent(s)}),t&2&&me("cdk-menu-inline",o.isInline)},outputs:{closed:"closed"},exportAs:["cdkMenu"],features:[et([{provide:ky,useExisting:n},{provide:Im,useExisting:n},gM("vertical")]),V]})}return n})();var Ry=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Pe({type:n});static \u0275inj=De({imports:[gd]})}return n})();function SM(n,e){if(n&1&&(a(0,"div",10),p(1),l()),n&2){let i=m().$implicit;c(),Ee("Level ",i.currentLevel+1,"/",i.base.levels.length)}}function bM(n,e){n&1&&(a(0,"div",10),p(1,"Not built"),l())}function xM(n,e){if(n&1){let i=I();a(0,"div",7)(1,"div",8),y("click",function(){let o=w(i).$implicit,r=m(2);return S(r.handleBuildingClicked(o))}),g(2,"mw-ra-icon",9),p(3),x(4,SM,2,2,"div",10)(5,bM,2,0,"div",10),g(6,"hr",11),l()()}if(n&2){let i=e.$implicit,t=m(2);f("mwActionHint","Inspect "+i.base.baseName),c(),se("background-color",t.builtColor),me("not-built",!i.built),c(),f("icon",i.base.icon),c(),D(" ",i.currentBuilding.name," "),c(),M(i.built?4:5)}}function MM(n,e){if(n&1&&(a(0,"div",7),p(1),l()),n&2){let i=e.$implicit;f("mwActionHint","Inspect "+i.base.baseName),c(),D(" ",i.base.baseName," ")}}function DM(n,e){if(n&1&&(a(0,"div",13),P(1,MM,2,2,"div",7,j),l()),n&2){let i=m(2).$implicit;c(),E(i.value)}}function PM(n,e){if(n&1&&(a(0,"button",12),p(1," Build "),l(),K(2,DM,3,0,"ng-template",null,0,ve)),n&2){let i=ce(3),t=m(2);f("cdkMenuTriggerFor",i)("cdkMenuPosition",t.menuPosition)}}function EM(n,e){if(n&1&&(a(0,"div",4)(1,"div"),p(2),l(),a(3,"div",6),P(4,xM,7,8,"div",7,j),l(),x(6,PM,4,2),l()),n&2){let i=e.$implicit,t=m();c(2),D("Tier ",i.key),c(2),E(i.value),c(2),M(t.newTownSystemEnabled?6:-1)}}var Om=(()=>{let e=class e{constructor(){this.players=u($),this.state=u(fe),this.events=u(oe),this.popupService=u(Ei),this.dialogsService=u(Is),this.newTownSystemEnabled=kn(In.NewTownSystem),this.menuPosition=[new zr({originX:"center",originY:"top"},{overlayX:"center",overlayY:"bottom"})],this.buildingsByTiers={},this.town=this.state.createdGame.town,this.builtColor=this.state.createdGame.selectedColor,kd(At.Structures),this.buildingsByTiers=Object.entries(this.town.base.availableBuildings).reduce((t,[o,r])=>(t[r.tier]?t[r.tier].push(this.town.buildings[o]):t[r.tier]=[this.town.buildings[o]],t),{})}leaveTown(){this.events.dispatch(fa({}))}handleBuildingClicked(t){if(!t.built){this.popupService.createBasicPopup({component:Kr,data:{building:t,targetLevel:1},class:"dark"});return}let o=t.currentBuilding.activity;if(o)switch(o.type){case st.Hiring:let r=o;this.popupService.createBasicPopup({component:wm,data:{building:t,town:this.town,hiringActivity:r}});break;case st.ItemsSelling:this.popupService.createBasicPopup({component:Sm,data:{building:t}});break;case st.Garrison:this.players.getCurrentPlayer().garrisons&&this.events.dispatch(fr());break;case st.ResourceTrading:this.popupService.createBasicPopup({component:bm,data:{town:this.town}});break;case st.HallsOfFate:this.dialogsService.open(Ty,{data:{town:this.town,building:t}});break}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-town-view"]],standalone:!1,decls:7,vars:2,consts:[["buildingMenu",""],["mwActionHint","Return to Map","icon","sideswipe",2,"padding","0px 10px","position","fixed","top","50%",3,"click"],[1,"contrast"],[1,"tiers"],[1,"building"],[2,"position","absolute","bottom","0","left","0"],[1,"build"],[3,"mwActionHint"],[1,"header",3,"click"],[2,"font-size","28px",3,"icon"],[2,"font-size","10px"],[2,"width","100%","border-top","0"],["mw-main-button","",3,"cdkMenuTriggerFor","cdkMenuPosition"],["cdkMenu","",1,"content"]],template:function(o,r){o&1&&(a(0,"mw-icon-btn",1),y("click",function(){return r.leaveTown()}),l(),g(1,"mw-action-hint",2),a(2,"div",3),P(3,EM,7,2,"div",4,le),xe(5,"keyvalue"),l(),g(6,"mw-player-info-panel",5)),o&2&&(c(3),E(Me(5,0,r.buildingsByTiers)))},dependencies:[Yt,Vn,Ce,Fr,ee,Br,Fy,Cl,Ri],styles:[".tiers[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%)}.building[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#41454e;color:#fff;text-align:center;margin:5px;border-radius:8px;font-size:14px}.building[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:10px;cursor:pointer;margin:5px;color:#fff;border-radius:20px;display:flex;flex-direction:column}.building[_ngcontent-%COMP%]   .header.not-built[_ngcontent-%COMP%]{background:#555967!important;color:#aeaeae}.build[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}"]});let n=e;return n})();var Qo=class Qo extends Te(){constructor(){super(...arguments),this.dialog=u(Is),this.popupService=u(Ei),this.battleState=u(zt),this.playersService=u($)}displayCdkPopup(e){this.dialog.open(e.component)}displayPopup(e){this.popupService.createPopup(e)}openDialog(){this.dialog.open(Pd,{})}openHeroInfo(){this.popupService.createPopup({component:em,data:{},escape:!0})}openSettings(){this.popupService.createBasicPopup({component:ey,data:{},escape:!0})}openGlossary(){this.popupService.createBasicPopup({component:Ey,data:{},escape:!0,isCloseable:!0})}openMainMenu(){this.popupService.createBasicPopup({component:Bc,data:{}})}openGarrison(){this.popupService.createBasicPopup({component:Cm,data:{}})}showGameOverPopup(){this.popupService.createBasicPopup({component:Ic,data:{}})}displayPlayerRewardPopup(e){this.popupService.createBasicPopup({component:Vc,data:e})}openUnitGroupSplitPopup(e){this.popupService.createBasicPopup({component:jc,data:e})}openUnitSlotsActionPopup(e){this.popupService.createBasicPopup({component:zc,data:e})}displayActionCardsPopup(){this.popupService.createBasicPopup({component:Ka,data:{},class:"transparent",isCloseable:!0})}playerSelectsStructure(e){if(e.struct.guard?.length){let i={struct:e.struct};this.events.dispatch(ps({component:sm,data:i}));return}if(!e.struct.guard?.length){if(e.struct.generator?.onVisited||e.struct.generator?.type===ui.Scripted){let t={struct:e.struct};this.events.dispatch(ps({component:am,data:t}));return}let i={struct:e.struct};this.events.dispatch(ps({component:dm,data:i}))}}fightEndsPopup(e){let i={isWin:e.win,playerLosses:this.getPlayerLosses(this.playersService.getCurrentPlayerId()),enemyLosses:this.getPlayerLosses(this.playersService.getEnemyPlayer().id),struct:e.struct};this.popupService.createPopup({data:i,component:rm})}displayRewardPopup(e){let i=e.struct,t={struct:i},o=i.reward;if(o){let r={[gt.Resources]:lm,[gt.UnitsHire]:nm,[gt.Item]:om,[gt.Scripted]:cm},s=o.type;if(s in r){let d=r[s];this.popupService.createBasicPopup({data:t,component:d})}}}getPlayerLosses(e){return[...this.battleState.playerLosses[e]].map(t=>({type:t[0],count:t[1]}))}};Qo.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Qo)))(t||Qo)}})(),Qo.\u0275prov=A({token:Qo,factory:Qo.\u0275fac});var Bt=Qo;F([Y(xa)],Bt.prototype,"displayCdkPopup",null);F([Y(ps)],Bt.prototype,"displayPopup",null);F([ge(ga)],Bt.prototype,"openDialog",null);F([ge(pr)],Bt.prototype,"openHeroInfo",null);F([ge(Cr)],Bt.prototype,"openSettings",null);F([ge(wr)],Bt.prototype,"openGlossary",null);F([ge(Sr)],Bt.prototype,"openMainMenu",null);F([ge(fr)],Bt.prototype,"openGarrison",null);F([ge(Sa)],Bt.prototype,"showGameOverPopup",null);F([Y(Ta)],Bt.prototype,"displayPlayerRewardPopup",null);F([Y(ya)],Bt.prototype,"openUnitGroupSplitPopup",null);F([Y(_a)],Bt.prototype,"openUnitSlotsActionPopup",null);F([ge(va)],Bt.prototype,"displayActionCardsPopup",null);F([Y(ur)],Bt.prototype,"playerSelectsStructure",null);F([Y(fn)],Bt.prototype,"fightEndsPopup",null);F([Y(ba)],Bt.prototype,"displayRewardPopup",null);function IM(n,e){n&1&&g(0,"mw-ra-icon",7)}function kM(n,e){n&1&&g(0,"mw-ra-icon",8)}function AM(n,e){if(n&1&&(g(0,"mw-ra-icon",20),p(1)),n&2){m();let i=q(1);c(),D(" ",i.groupStats.totalHealth," ")}}function OM(n,e){if(n&1&&g(0,"mw-unit-group-spell",14),n&2){let i=e.$implicit,t=m(),o=q(0),r=q(1);f("hintPos",t.spellsHintsPosition)("spell",i)("hero",t.playerInfo().hero)("owner",o)("onCooldown",r.groupState.spellsOnCooldown||!!i.cooldown)("currentUnit",t.attackingUnitGroup())}}function FM(n,e){if(n&1&&g(0,"mw-unit-group-buff",15),n&2){let i=e.$implicit,t=m(),o=q(0);f("hintPos",t.spellsHintsPosition)("buff",i)("ownerUnit",o)}}function RM(n,e){if(n&1&&(a(0,"mw-value-bar",18),g(1,"mw-ra-icon",21),l()),n&2){let i=m(),t=q(0);f("side",i.side())("showMax",!0)("currentValue",t.tailUnitHp)("maxValue",t.type.baseStats.health)("barHeight",14)}}function BM(n,e){if(n&1&&(a(0,"mw-value-bar",19),g(1,"mw-ra-icon",22),l()),n&2){let i=m(),t=q(1);f("barHeight",13)("showMax",!0)("currentValue",t.groupState.currentMana)("side",i.side())("maxValue",t.groupStats.maxMana)}}function GM(n,e){if(n&1&&(a(0,"mw-value-bar",19),g(1,"mw-ra-icon",22),l()),n&2){let i=m(),o=q(0).ownerHero.getStateSignal()();f("barHeight",13)("showMax",!0)("currentValue",o.currentMana)("side",i.side())("maxValue",o.maxMana)}}var wl=(()=>{let e=class e extends Te(){constructor(){super(...arguments),this.hostElem=ti(),this.mwBattleStateService=u(zt),this.playersService=u($),this.unitsService=u(qc),this.renderer=u($e),this.unitGroup=N.required(),this.playerInfo=N.required(),this.side=N("left"),this.isCurrentUnitGroupActive=ae(()=>this.mwBattleStateService.state.mapGet(t=>t.currentPlayer===this.playerInfo()&&t.currentUnitGroup===this.unitGroup())),this.canCurrentPlayerAttack=ae(()=>this.mwBattleStateService.state.mapGet(t=>t.currentPlayer!==this.playerInfo())),this.effects=ae(()=>this.unitGroup().getStateSignal()().groupState.spells.filter(t=>t.isEffect())),this.spells=ae(()=>this.unitGroup().getStateSignal()().groupState.spells.filter(t=>!t.isEffect())),this.cardReady=mn(),this.cardDestroyed=mn(),this.isCardHovered=!1,this.attackingUnitGroup=ae(()=>this.mwBattleStateService.state.pick(t=>t.currentUnitGroup)),this.isGroupMelee=!1,this.initialCount=0,this.isBoss=!1}get isEnemyCard(){return this.mwBattleStateService.canUnitGroupBeAttackedByCurrentPlayerAICheck(this.unitGroup())}ngOnInit(){this.unitState=this.unitGroup().getStateSignal(),this.spellsHintsPosition="above",this.isGroupMelee=!this.unitsService.isUnitGroupRanged(this.unitGroup()),this.initialCount=this.unitGroup().count;let t=this.unitGroup();this.isBoss=t.type.defaultModifiers?.isBoss,this.cardReady.emit(this),this.unitStats$=t.listenStats(),t.modGroup.getModValue("isSummon")&&this.renderer.addClass(this.hostElem,"summoned")}ngOnDestroy(){this.events.dispatch(Fn({hoverType:ni.Unhover})),this.cardDestroyed.emit()}onCardHover(t){if(this.isCardHovered=t,t){let o=this.unitGroup();if(!o.isAlive){this.events.dispatch(Fn({hoverType:ni.Unhover}));return}this.events.dispatch(Fn({hoverType:this.isEnemyCard?ni.EnemyCard:ni.AllyCard,currentCard:this.mwBattleStateService.state.get().currentUnitGroup,hoveredCard:o}))}else this.events.dispatch(Fn({hoverType:ni.Unhover}))}getUnitGroup(){return this.unitGroup()}};e.\u0275fac=(()=>{let t;return function(r){return(t||(t=W(e)))(r||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-card"]],inputs:{unitGroup:[1,"unitGroup"],playerInfo:[1,"playerInfo"],side:[1,"side"]},outputs:{cardReady:"cardReady",cardDestroyed:"cardDestroyed"},standalone:!1,features:[et([{provide:vl,useExisting:Wi(()=>e)}]),V],decls:35,vars:36,consts:[[3,"containerId"],[1,"card-top",3,"mouseenter","mouseleave","ngClass"],[1,"card-wrapper"],[1,"card"],[2,"padding-bottom","3px","font-weight","500","white-space","nowrap","z-index","1000","position","relative"],[2,"font-size","12px"],["icon","spinning-sword"],["icon","sword"],["icon","crossbow"],["icon","feather-wing"],[3,"mwNumberModifier"],[1,"secondary-stats"],[1,"abilities",3,"ngClass"],[1,"column-data"],[3,"hintPos","spell","hero","owner","onCooldown","currentUnit"],[3,"hintPos","buff","ownerUnit"],[1,"portrait-container"],[3,"unitGroup","toRight","isHero"],["barStyle","normal","color","rgb(201, 45, 45)",1,"health-bar",3,"side","showMax","currentValue","maxValue","barHeight"],["barStyle","normal","color","linear-gradient(0deg, rgb(100 26 95), rgb(92 142 242))",1,"mana-bar",3,"barHeight","showMax","currentValue","side","maxValue"],["icon","health"],["icon","health",1,"bar-icon"],["icon","crystal-ball",1,"bar-icon"]],template:function(o,r){if(o&1){let s=I();Re(0)(1),xe(2,"async"),a(3,"mw-vfx-container",0)(4,"div",1),y("mouseenter",function(){return w(s),S(r.onCardHover(!0))})("mouseleave",function(){return w(s),S(r.onCardHover(!1))}),a(5,"div",2)(6,"div",3)(7,"div",4),p(8),l(),a(9,"div",5)(10,"div"),g(11,"mw-ra-icon",6),p(12),l(),a(13,"div"),x(14,IM,1,0,"mw-ra-icon",7)(15,kM,1,0,"mw-ra-icon",8),p(16),l(),a(17,"div"),g(18,"mw-ra-icon",9),p(19),g(20,"span",10),l(),g(21,"div",11),x(22,AM,2,1),l()(),a(23,"div",12)(24,"div",13),P(25,OM,1,6,"mw-unit-group-spell",14,j),l(),a(27,"div",13),P(28,FM,1,3,"mw-unit-group-buff",15,j),l()()(),a(30,"div",16),g(31,"mw-unit-group-portrait",17),x(32,RM,2,5,"mw-value-bar",18),x(33,BM,2,5,"mw-value-bar",19),x(34,GM,2,5,"mw-value-bar",19),l()()()}if(o&2){let s=Ve(r.unitGroup());c();let d=Ve(Me(2,33,r.unitStats$));c(2),f("containerId",s.id),c(),me("active",r.isCurrentUnitGroupActive())("inactive",!s.turnsLeft&&d.groupState.isAlive)("defeated",!d.groupState.isAlive),f("ngClass",r.side()==="left"?"card-left":"card-right"),c(2),se("background",r.playerInfo().color),me("current-group",r.isCurrentUnitGroupActive())("hovered-enemy",r.isCardHovered&&r.isEnemyCard&&r.canCurrentPlayerAttack()),c(2),Ee(" ",s.type.name," (",s.count,") "),c(4),Ee(" (",s.turnsLeft,"/",s.type.defaultTurnsPerRound,") "),c(2),M(r.isGroupMelee?14:15),c(2),D(" ",d.groupStats.avgTotalDamage," "),c(),me("defence",d.groupStats.defends),c(2),D(" ",d.groupStats.baseSpeed," "),c(),f("mwNumberModifier",d.groupStats.speedBonus),c(2),M(!r.isBoss||s.type.isHero?22:-1),c(),f("ngClass",r.side()),c(2),E(r.spells()),c(3),E(r.effects()),c(3),f("unitGroup",s)("toRight",r.side()==="left")("isHero",s.type.isHero),c(),M(r.isBoss||s.type.isHero?32:-1),c(),M(!s.type.isHero&&d.groupStats.maxMana?33:-1),c(),M(s.type.isHero&&r.playerInfo().hero?34:-1)}},styles:["@keyframes _ngcontent-%COMP%_summonedAnimation{0%{opacity:0;height:0;width:0px}to{opacity:100%;height:100px;width:115px}}.summoned[_nghost-%COMP%]{animation:_ngcontent-%COMP%_summonedAnimation .6s ease-in-out}.secondary-stats[_ngcontent-%COMP%]{position:absolute;z-index:100}.card-right[_ngcontent-%COMP%]   .secondary-stats[_ngcontent-%COMP%]{right:0}.card-top[_ngcontent-%COMP%]{display:flex;position:relative;transition:.5s;left:0;right:0}.portrait-container[_ngcontent-%COMP%]{position:absolute;top:-25px}.card-left[_ngcontent-%COMP%]   .portrait-frame[_ngcontent-%COMP%]{scale:-1 1}.vertical[_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{right:79%}.vertical[_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{left:79%}.horizontal[_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%]{z-index:-1;right:0;top:-94px;left:-10px}.health-bar[_ngcontent-%COMP%], .mana-bar[_ngcontent-%COMP%]{position:relative;overflow:hidden;top:-42px;width:70px;border-radius:7px;border:1px solid #395698}.mana-bar[_ngcontent-%COMP%]{top:-41px}.bar-icon[_ngcontent-%COMP%]{margin:0 4px}.card-left[_ngcontent-%COMP%]   :is(.health-bar[_ngcontent-%COMP%], .mana-bar[_ngcontent-%COMP%]){left:24px}.card-right[_ngcontent-%COMP%]   :is(.health-bar[_ngcontent-%COMP%], .mana-bar[_ngcontent-%COMP%]){right:-23px}.card-left[_ngcontent-%COMP%]{text-align:right}.card-right[_ngcontent-%COMP%]{text-align:left}.card-wrapper[_ngcontent-%COMP%]{position:relative}.abilities[_ngcontent-%COMP%]{position:absolute;font-size:12px;top:0;display:flex}.vertical[_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%]{right:185%;flex-direction:row-reverse}.vertical[_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%]{left:185%}.horizontal[_nghost-%COMP%]   .abilities[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .abilities[_ngcontent-%COMP%]{top:-62%;left:-42px;flex-direction:column}.card[_ngcontent-%COMP%]{display:block;width:115px;height:100px;border-radius:6px;align-items:center;box-sizing:border-box;font-size:13px;padding:4px 15px 0;color:#fff;border:3px solid transparent;-webkit-user-select:none;user-select:none}.card.current-group[_ngcontent-%COMP%]{border:3px solid gold}.hovered-enemy[_ngcontent-%COMP%]{border:3px solid rgba(240,113,113,.906)}.column-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 4px}[_nghost-%COMP%]{position:relative}.card-top[_ngcontent-%COMP%]{transition:.5s;filter:brightness(100%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.active[_ngcontent-%COMP%]{filter:brightness(100%) drop-shadow(2px 4px 6px rgba(0,0,0,.721))}.card-top.inactive[_ngcontent-%COMP%]{filter:brightness(85%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.defeated[_ngcontent-%COMP%]{filter:brightness(55%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.vertical[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{left:32px}.vertical[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{left:32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{right:32px}.horizontal[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.defence[_ngcontent-%COMP%]{font-weight:700;color:gold}"],changeDetection:0});let n=e;return n})();var By=(n,e)=>e.id;function LM(n,e){if(n&1){let i=I();a(0,"mw-unit-group-card",12),y("cardDestroyed",function(){let o=w(i).$implicit,r=m();return S(r.onGroupDies(o))}),l()}if(n&2){let i=e.$implicit,t=m();f("playerInfo",t.mainPlayerInfo)("unitGroup",i)}}function NM(n,e){if(n&1){let i=I();a(0,"mw-unit-group-card",13),y("cardDestroyed",function(){let o=w(i).$implicit,r=m();return S(r.onGroupDies(o))}),l()}if(n&2){let i=e.$implicit,t=m();f("playerInfo",t.enemyPlayerInfo)("unitGroup",i)}}function UM(n,e){if(n&1&&(a(0,"div",14)(1,"div"),p(2),l(),a(3,"div"),p(4),l(),a(5,"div"),p(6),l()()),n&2){let i=e.$implicit;se("background",i.ownerPlayer.color),c(2),H(i.type.name),c(2),H(i.count),c(2),D("turns: ",i.turnsLeft)}}var Zr=class Zr extends Te(){constructor(){super(...arguments),this.mwPlayerState=u(D0),this.players=u($),this.mwBattleState=u(zt),this.mwNeutralPlayer=u(M0),this.cardsMapping=u(bc),this.combatInteractor=u(Ro),this.vfx=u(on),this.cd=An(),this.state=u(fe),this.settings=this.state.settings,this.orientation=So,this.currentUnitGroup$=this.mwBattleState.state.select(e=>e.currentUnitGroup),this.canDefend$=this.currentUnitGroup$.pipe(Xt(e=>!!(e&&!e.getState().groupStats.defends&&!this.players.isEnemyUnitGroup(e)))),this.defendActionMessage$=this.currentUnitGroup$.pipe(Xt(e=>!e||this.players.isEnemyUnitGroup(e)?"":e.getState().groupStats.defends?"Unit group is already defending":`Defend ${e.count} ${e.type.name}`))}ngOnInit(){this.mainPlayerUnitGroups=this.mwPlayerState.getUnitGroups(),this.neutralPlayerGroups=this.mwNeutralPlayer.getUnitGroups(),this.mainPlayerInfo=this.mwPlayerState.getPlayerInfo(),this.enemyPlayerInfo=this.mwNeutralPlayer.getPlayerInfo()}onGroupDies(e){this.cardsMapping.unregister(e)}ngAfterViewInit(){this.cards.forEach(e=>this.cardsMapping.register(e.unitGroup(),e)),this.initInteractions(),this.cd.detectChanges()}initInteractions(){this.combatInteractor.onBattleBegins(),this.events.dispatch(Ca({players:[this.mainPlayerInfo,this.enemyPlayerInfo],unitGroups:[...this.mainPlayerUnitGroups,...this.neutralPlayerGroups]})),this.updateFightQueue(),this.events.eventStream$.pipe(Ge(this.destroyed$)).subscribe(()=>{this.updatePlayersUnitGroupsToShow()})}defend(){this.events.dispatch(da())}displayDamageVfxOverAttackedGroup(e){let i=e.attackingGroup.type.defaultModifiers?.isRanged;e.lifeStolen&&(this.vfx.createDroppingMessageForContainer(e.attackingGroup.id,Kf(e.lifeStolenUnitsRestored,e.lifeStolen),{duration:1600}),this.vfx.createEffectAnimationForUnitGroup(e.attackingGroup,Nf,{duration:700,darkOverlay:!1})),this.vfx.createFloatingMessageForUnitGroup(e.attackedGroup,Di(e.damage,e.loss,i,e.damageBlocked,e.isCritical),{duration:e.isCritical?1200:e.damageBlocked?1100:1e3})}registerSummonedUnit(e){this.updatePlayersUnitGroupsToShow(),this.cd.detectChanges(),this.cardsMapping.register(e.unitGroup,this.cards.find(i=>i.unitGroup()===e.unitGroup))}updatePlayersUnitGroupsToShow(){this.mainPlayerUnitGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.mainPlayerInfo),this.neutralPlayerGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.enemyPlayerInfo),this.updateFightQueue()}updateFightQueue(){this.fightQueue=this.mwBattleState.getFightQueue()}};Zr.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Zr)))(t||Zr)}})(),Zr.\u0275cmp=v({type:Zr,selectors:[["mw-gameboard"]],viewQuery:function(i,t){if(i&1&&Et(wl,5),i&2){let o;_t(o=vt())&&(t.cards=o)}},standalone:!1,features:[V],decls:22,vars:7,consts:[[1,"columns-wrapper",3,"ngClass"],[1,"columns"],[1,"column"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",1,"card",3,"playerInfo","unitGroup"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",1,"card",3,"playerInfo","unitGroup"],[1,"abilities-panel"],["icon","shield",2,"width","60px","text-align","center","color","#ffe5a0","background","#505263",3,"click","disabled","mwActionHint"],[1,"queue-panel"],[1,"queue-card",3,"background"],[1,"hint-panel"],[1,"history-log-panel"],[1,"items-panel"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",1,"card",3,"cardDestroyed","playerInfo","unitGroup"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",1,"card",3,"cardDestroyed","playerInfo","unitGroup"],[1,"queue-card"]],template:function(i,t){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),P(3,LM,1,2,"mw-unit-group-card",3,By),l(),a(5,"div",2),P(6,NM,1,2,"mw-unit-group-card",4,By),l()()(),a(8,"div",5)(9,"mw-icon-btn",6),xe(10,"async"),xe(11,"async"),y("click",function(){return t.defend()}),l(),g(12,"mw-battle-hero-abilities"),l(),a(13,"div",7),P(14,UM,7,5,"div",8,le),l(),g(16,"mw-action-hint",9),a(17,"div",10),g(18,"mw-history-log"),l(),a(19,"div",11),p(20," Items: "),g(21,"mw-items-panel"),l()),i&2&&(f("ngClass",t.settings.orientation===t.orientation.Horizontal?"horizontal":"vertical"),c(3),E(t.mainPlayerUnitGroups),c(3),E(t.neutralPlayerGroups),c(3),f("disabled",Me(10,3,t.canDefend$)===!1)("mwActionHint",Me(11,5,t.defendActionMessage$)),c(5),E(t.fightQueue))},styles:[".columns-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:80%;width:100%;display:flex;align-items:center}.columns-wrapper.horizontal[_ngcontent-%COMP%]{top:90px;height:65%}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%]{flex-direction:column-reverse}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%] > .column[_ngcontent-%COMP%]{flex-direction:row;height:auto;justify-content:space-evenly;width:100%}.columns[_ngcontent-%COMP%]{display:flex;width:680px;height:100%;justify-content:space-between;margin:auto;align-items:center}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;justify-content:center}.card[_ngcontent-%COMP%]{margin:6px}.queue-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:0;left:0}.queue-card[_ngcontent-%COMP%]{height:64px;width:64px;border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;color:#fff;text-align:center;margin:8px}.abilities-panel[_ngcontent-%COMP%]{position:fixed;left:100px;top:35%}.hint-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:81px;left:0;font-size:12px}.history-log-panel[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;width:370px}.items-panel[_ngcontent-%COMP%]{position:absolute;left:16px;bottom:75px}"]});var Jo=Zr;F([Y(cr)],Jo.prototype,"displayDamageVfxOverAttackedGroup",null);F([Y(oa)],Jo.prototype,"registerSummonedUnit",null);function HM(n,e){if(n&1&&(a(0,"span"),p(1),l()),n&2){m();let i=q(0);c(),D(" (+",i.bonusAttack,") ")}}function jM(n,e){if(n&1&&(a(0,"span"),p(1),l()),n&2){m();let i=q(0);c(),D(" (+",i.bonusDefence,") ")}}var Fm=(()=>{let e=class e{constructor(t,o){this.playersService=t,this.state=o,this.resourceNames=$h,this.currentPlayer=this.playersService.getCurrentPlayer(),this.heroStats$=this.currentPlayer.hero.listenHeroStats()}};e.\u0275fac=function(o){return new(o||e)(G($),G(fe))},e.\u0275cmp=v({type:e,selectors:[["mw-player-resources"]],standalone:!1,decls:51,vars:20,consts:[[1,"resource-info-row"],["icon","gold"],["icon","wood"],["icon","gems"],["icon","crystals"],[1,"sub-info"],["icon","feather-wing"]],template:function(o,r){if(o&1&&(Re(0),xe(1,"async"),a(2,"div")(3,"div",0),g(4,"mw-img-icon",1),a(5,"div"),p(6),l(),a(7,"div"),p(8),l()(),a(9,"div",0),g(10,"mw-img-icon",2),a(11,"div"),p(12),l(),a(13,"div"),p(14),l()(),a(15,"div",0),g(16,"mw-img-icon",3),a(17,"div"),p(18),l(),a(19,"div"),p(20),l()(),a(21,"div",0),g(22,"mw-img-icon",4),a(23,"div"),p(24),l(),a(25,"div"),p(26),l()(),a(27,"div",0)(28,"div"),p(29,"Mana:"),l(),a(30,"div"),p(31),l()(),a(32,"div",0)(33,"div"),p(34,"Attack:"),l(),a(35,"div"),p(36),x(37,HM,2,1,"span"),l()(),a(38,"div",0)(39,"div"),p(40,"Defence:"),l(),a(41,"div"),p(42),x(43,jM,2,1,"span"),l()(),a(44,"div",5)(45,"div")(46,"div"),p(47),l(),a(48,"div"),p(49),g(50,"mw-ra-icon",6),l()()()()),o&2){let s=Ve(Me(1,17,r.heroStats$));c(6),D("",r.resourceNames.gold,":"),c(2),H(r.currentPlayer.resources.gold),c(4),D("",r.resourceNames.wood,":"),c(2),H(r.currentPlayer.resources.wood),c(4),D("",r.resourceNames.gems,":"),c(2),H(r.currentPlayer.resources.gems),c(4),D("",r.resourceNames.redCrystals,":"),c(2),H(r.currentPlayer.resources.redCrystals),c(5),Ee("",s.currentMana,"/",s.maxMana),c(5),D(" ",s.baseAttack," "),c(),M(s.bonusAttack?37:-1),c(5),D(" ",s.baseDefence," "),c(),M(s.bonusDefence?43:-1),c(4),Ee("Week: ",r.state.currentGame.week,", Day: ",r.state.currentGame.day),c(2),D(" Action Points: ",r.state.currentGame.actionPoints," ")}},dependencies:[Un,Ce,Xi],styles:[".resource-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:2px;align-items:center}[_nghost-%COMP%]{font-size:12px}.sub-info[_ngcontent-%COMP%]{margin-top:8px;font-size:13px}"]});let n=e;return n})();var zM=n=>[n],Gy=n=>({data:n});function WM(n,e){n&1&&g(0,"mw-ra-icon",21)}function qM(n,e){if(n&1&&g(0,"mw-ra-icon",22),n&2){let i=m().$implicit,t=m();f("icon",i.controlType===t.controlTypes.AI?"guarded-tower":"player")}}function YM(n,e){if(n&1&&(a(0,"div"),g(1,"mw-ra-icon",27),a(2,"span",28),p(3),l()()),n&2){let i=m().$implicit;c(),f("icon",i.selectedFaction.icon),c(2),D(" ",i.selectedFaction.title," ")}}function KM(n,e){n&1&&(a(0,"div"),g(1,"mw-ra-icon",29),a(2,"span",28),p(3,"Random"),l()())}function ZM(n,e){if(n&1){let i=I();a(0,"mw-ra-icon",32),y("click",function(){let o=w(i).$implicit,r=m(2).$implicit,s=m();return S(s.selectFactionForPlayer(r,o))}),l()}if(n&2){let i=e.$implicit;f("icon",i.icon)}}function XM(n,e){if(n&1){let i=I();a(0,"mw-ra-icon",30),y("click",function(){w(i);let o=m().$implicit,r=m();return S(r.selectFactionForPlayer(o))}),l(),K(1,ZM,1,1,"mw-ra-icon",31)}if(n&2){let i=m(2);c(),f("ngForOf",i.playableFactions)}}function QM(n,e){if(n&1&&(a(0,"div"),g(1,"div",33),a(2,"span",28),p(3),l()()),n&2){let i=m().$implicit;c(),se("background-image","url('"+i.selectedHero.image+"')"),c(2),H(i.selectedHero.name)}}function JM(n,e){n&1&&(a(0,"div"),g(1,"mw-ra-icon",29),a(2,"span",28),p(3,"Random"),l()())}function eD(n,e){if(n&1){let i=I();a(0,"div",37),y("mouseenter",function(){let o=w(i).$implicit,r=m(2).$implicit,s=m();return S(s.onHoverFactionHero(r,o))})("mouseleave",function(){let o=w(i).$implicit,r=m(2).$implicit,s=m();return S(s.onUnhoverFactionHero(r,o))})("click",function(){let o=w(i).$implicit,r=m(2).$implicit,s=m();return S(s.onSelectFactionHero(r,o))}),g(1,"div",33),a(2,"span",28),p(3),l()()}if(n&2){let i=e.$implicit;c(),se("background-image","url('"+i.image+"')"),c(2),H(i.name)}}function tD(n,e){if(n&1){let i=I();a(0,"div",34)(1,"div",35),y("click",function(){w(i);let o=m().$implicit,r=m();return S(r.onRandomHeroClick(o))})("mouseenter",function(){w(i);let o=m().$implicit,r=m();return S(r.onHoverRandomHero(o))})("mouseleave",function(){w(i);let o=m().$implicit,r=m();return S(r.onUnhoverRandomHero(o))}),g(2,"mw-ra-icon",29),a(3,"span",28),p(4,"Random"),l()(),K(5,eD,4,3,"div",36),l()}if(n&2){let i=m().$implicit;c(5),f("ngForOf",i.selectedFaction==null?null:i.selectedFaction.getAllHeroes())}}function iD(n,e){if(n&1){let i=I();a(0,"div",39),y("click",function(){let o=w(i).$implicit,r=m(2).$implicit;return S(r.pickedColor=o)}),l()}if(n&2){let i=e.$implicit;se("background",i)}}function nD(n,e){if(n&1&&K(0,iD,1,2,"div",38),n&2){let i=m(2);f("ngForOf",i.colors)}}function oD(n,e){if(n&1){let i=I();a(0,"div",19),y("mouseenter",function(){let o=w(i).$implicit,r=m();return S(r.onPlayerRowHovered(o))})("mouseleave",function(){let o=w(i).$implicit,r=m();return S(r.onPlayerRowUnhovered(o))}),a(1,"div",20),y("click",function(){let o=w(i).$implicit,r=m();return S(r.toggleControlType(o))}),x(2,WM,1,0,"mw-ra-icon",21)(3,qM,1,1,"mw-ra-icon",22),p(4),l(),a(5,"div",10)(6,"mw-menu",23),K(7,YM,4,2,"div",24)(8,KM,4,0,"ng-template",null,2,ve),l(),K(10,XM,2,1,"ng-template",null,3,ve),l(),a(12,"div",11)(13,"mw-menu",25),K(14,QM,4,3,"div",24)(15,JM,4,0,"ng-template",null,1,ve),l(),K(17,tD,6,1,"ng-template",null,4,ve),l(),a(19,"div",12)(20,"mw-menu",23),g(21,"div",26),l(),K(22,nD,1,1,"ng-template",null,5,ve),l()()}if(n&2){let i=e.$implicit,t=ce(9),o=ce(11),r=ce(18),s=ce(23);c(),f("mwActionHint",i.isMainPlayer?"":"Click to change player control type."),c(),M(i.isMainPlayer?2:3),c(2),D(" ",i.name," "),c(2),f("menuBody",o),c(),f("ngIf",i.selectedFaction)("ngIfElse",t),c(6),f("menuBody",r)("pos","below"),c(),f("ngIf",i.selectedHero)("ngIfElse",t),c(6),f("menuBody",s),c(),se("background",i.pickedColor)}}function rD(n,e){if(n&1&&(a(0,"div",40)(1,"div"),p(2,"Hero"),l(),a(3,"div")(4,"div"),p(5),l(),g(6,"mw-ra-icon",41),a(7,"div",42)(8,"div",43)(9,"div"),g(10,"mw-ra-icon",44),p(11),l(),a(12,"div"),g(13,"mw-ra-icon",45),p(14),l(),a(15,"div"),g(16,"mw-ra-icon",46),p(17),l()(),a(18,"div",43)(19,"div",47),g(20,"mw-res-label",48)(21,"mw-res-label",48),l()()(),a(22,"div",49),g(23,"mw-description",50),l()()()),n&2){let i=e.data,t=m(),o=t.getHero(i);c(5),D(" ",o.name," "),c(6),D(" ",o.initialState.stats.baseAttack," "),c(3),D(" ",o.initialState.stats.baseDefence," "),c(3),D(" ",o.initialState.stats.mana," "),c(3),f("iconSize",24)("resType",t.ResourceType.Gold)("amount",o.initialState.resources.gold),c(),f("iconSize",24)("resType",t.ResourceType.Wood)("amount",o.initialState.resources.wood),c(2),f("descriptions",ht(11,zM,o.generalDescription))}}function sD(n,e){if(n&1&&(a(0,"span"),p(1),l()),n&2){let i=m(2);c(),Ee(" ",i.hoveredPlayer.name," plays as random hero of ",i.hoveredPlayer.selectedFaction.title," faction. ")}}function aD(n,e){n&1&&(a(0,"span"),p(1,"Play as random hero of this faction."),l())}function lD(n,e){n&1&&(a(0,"span"),p(1,"Play as random hero of any faction."),l())}function cD(n,e){if(n&1&&(a(0,"div",40)(1,"div")(2,"div"),p(3,"Random Hero"),l(),g(4,"mw-ra-icon",51),a(5,"div",49),x(6,sD,2,2,"span"),x(7,aD,2,0,"span"),x(8,lD,2,0,"span"),l()()()),n&2){let i=m();c(6),M(i.hoveredPlayer&&i.hoveredPlayer.selectedFaction&&!i.hoveredPlayer.selectedHero?6:-1),c(),M(i.hoveredPlayer?-1:7),c(),M(i.hoveredPlayer&&!i.hoveredPlayer.selectedFaction?8:-1)}}function dD(n,e){n&1&&We(0)}function pD(n,e){if(n&1&&K(0,dD,1,0,"ng-container",52),n&2){let i=m(2),t=ce(15);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Gy,i.hoveredPlayer.selectedHero))}}function uD(n,e){n&1&&We(0)}function mD(n,e){if(n&1&&K(0,uD,1,0,"ng-container",53),n&2){m(2);let i=ce(17);f("ngTemplateOutlet",i)}}function hD(n,e){if(n&1&&(p(0),x(1,pD,1,4,"ng-container")(2,mD,1,1,"ng-container")),n&2){let i=m();Ee(" ",i.hoveredPlayer.name," plays ",(i.hoveredPlayer.selectedFaction==null?null:i.hoveredPlayer.selectedFaction.title)||"Random Faction"," as "),c(),M(i.hoveredPlayer.selectedHero?1:2)}}function fD(n,e){n&1&&We(0)}function gD(n,e){if(n&1&&K(0,fD,1,0,"ng-container",52),n&2){let i=m(),t=ce(15);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Gy,i.hoveredHero))}}function yD(n,e){n&1&&We(0)}function _D(n,e){if(n&1&&K(0,yD,1,0,"ng-container",53),n&2){m();let i=ce(17);f("ngTemplateOutlet",i)}}function vD(n,e){if(n&1){let i=I();a(0,"button",17),y("click",function(){w(i);let o=m();return S(o.gameSettingsPopup())}),p(1," Game Settings "),l()}}var CD=[yt],Ly=(()=>{let e=class e{constructor(){this.events=u(oe),this.state=u(fe),this.gameObjectsManager=u(je),this.gameSettingsEnabled=kn(In.NewGameSettings),this.players=k([{id:"player:main",name:"Player 1",isMainPlayer:!0,selectedFaction:rt,controlType:mt.Player,pickedColor:Zn.BLUE,selectedHero:rt.getAllHeroes().find(t=>t.id==="#hero-helvetica")}]),this.playableFactions=ls.getAllFactions().filter(t=>!CD.includes(t)),this.controlTypes=mt,this.ResourceType=Oe,this.colors=[Zn.BLUE,Zn.RED,Zn.GREEN],kd(At.MainScreen)}startGame(){let t=this.players()[0],o=t.selectedFaction||z.randItem(this.playableFactions),r=o.getTownBase();this.state.createdGame={faction:o,selectedColor:t.pickedColor,selectedHero:t.selectedHero||z.randItem(o.heroes),town:this.gameObjectsManager.createNewGameObject(Kc,{townBase:r})},this.state.townsByPlayers.set(t.id,this.state.createdGame.town),console.log(this.state.createdGame),this.events.dispatch(ua())}onPlayerRowHovered(t){this.hoveredPlayer=t}onPlayerRowUnhovered(t){this.hoveredPlayer=void 0}onRandomHeroClick(t){t.selectedHero=void 0,this.hoveredHero=void 0}onHoverRandomHero(t){this.hoveredHero=null}onUnhoverRandomHero(t){this.hoveredHero=void 0}onSelectFactionHero(t,o){t.selectedHero=o,this.hoveredHero=void 0}onHoverFactionHero(t,o){this.hoveredHero=o}onUnhoverFactionHero(t,o){this.hoveredHero=void 0}getHero(t){return t}gameSettingsPopup(){this.events.dispatch(xa({component:Dd,data:{}}))}returnToMainScreen(){this.events.dispatch(Li())}selectFactionForPlayer(t,o){t.selectedFaction=o,o?t.selectedHero=o.getAllHeroes()[0]:t.selectedHero=void 0}toggleControlType(t){t.isMainPlayer||(t.controlType=t.controlType===mt.AI?mt.Player:mt.AI)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-new-game-screen"]],standalone:!1,decls:29,vars:4,consts:[["heroInfo",""],["randomHero",""],["randomFaction",""],["factionsMenu",""],["heroesMenu",""],["colorsMenu",""],[1,"main-container"],[1,"players"],[1,"players-row"],[1,"name"],[1,"faction"],[1,"hero"],[1,"color"],[1,"player","players-row"],[1,"right-panel"],[1,"bottom-container"],[1,"buttons"],["mw-main-button","",3,"click"],["mw-main-button",""],[1,"player","players-row",3,"mouseenter","mouseleave"],[1,"name",3,"click","mwActionHint"],["icon","player-king"],[3,"icon"],["pos","below",3,"menuBody"],[4,"ngIf","ngIfElse"],[3,"menuBody","pos"],[1,"color-item",2,"position","relative","top","-6px"],[1,"item-icon",3,"icon"],[1,"icon-subtext"],["icon","perspective-dice-four",1,"item-icon"],["icon","perspective-dice-four",1,"item-icon",3,"click"],["class","item-icon",3,"icon","click",4,"ngFor","ngForOf"],[1,"item-icon",3,"click","icon"],[1,"item-icon","hero-icon"],[2,"display","flex","max-width","228px","padding","4px","justify-content","center","flex-wrap","wrap"],[1,"hero-option",3,"click","mouseenter","mouseleave"],["class","hero-option",3,"mouseenter","mouseleave","click",4,"ngFor","ngForOf"],[1,"hero-option",3,"mouseenter","mouseleave","click"],["class","color-item",3,"background","click",4,"ngFor","ngForOf"],[1,"color-item",3,"click"],[1,"hero-description"],["icon","aura",1,"hero-icon"],[1,"hero-stats"],[1,"column"],["icon","sword"],["icon","shield"],["icon","crystal-ball"],[2,"margin-top","16px"],[3,"iconSize","resType","amount"],[1,"description"],[3,"descriptions"],["icon","perspective-dice-four",1,"hero-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"]],template:function(o,r){if(o&1){let s=I();a(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),p(4,"Player:"),l(),a(5,"div",10),p(6,"Faction:"),l(),a(7,"div",11),p(8,"Hero:"),l(),a(9,"div",12),p(10,"Color:"),l()(),P(11,oD,24,13,"div",13,j),l(),a(13,"div",14),K(14,rD,24,13,"ng-template",null,0,ve)(16,cD,9,3,"ng-template",null,1,ve),x(18,hD,3,3),x(19,gD,1,4,"ng-container"),x(20,_D,1,1,"ng-container"),l()(),a(21,"div",15)(22,"div",16)(23,"button",17),y("click",function(){return w(s),S(r.startGame())}),p(24," Start game "),l(),x(25,vD,2,0,"button",18),a(26,"button",17),y("click",function(){return w(s),S(r.returnToMainScreen())}),p(27," Return "),l()()(),g(28,"mw-action-hint")}o&2&&(c(11),E(r.players()),c(7),M(r.hoveredPlayer&&r.hoveredHero===void 0?18:-1),c(),M(r.hoveredHero?19:-1),c(),M(r.hoveredHero===null?20:-1),c(5),M(r.gameSettingsEnabled?25:-1))},dependencies:[zl,Sp,Gt,Yt,si,Wt,Vn,Ce,Ja,ee],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100vh}.main-container[_ngcontent-%COMP%]{margin:8px;display:flex;flex-grow:1}.bottom-container[_ngcontent-%COMP%]{display:flex}.players[_ngcontent-%COMP%]{width:100%;height:200px;padding:20px;display:flex;flex-direction:column;gap:2px}.players-row[_ngcontent-%COMP%]{display:flex;padding:7px 15px 3px;align-items:center;font-size:13px}.players-row.player[_ngcontent-%COMP%]:hover{background-color:#27272725}.players-row[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%]{flex:.1 0 80px;flex:0 0 100px;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.players-row[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%] > mw-ra-icon[_ngcontent-%COMP%]{font-size:28px;margin-right:2px}.players-row.player[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%]{padding-bottom:6px}.players-row[_ngcontent-%COMP%] > .faction[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .hero[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .color[_ngcontent-%COMP%]{display:flex;justify-content:center;flex:.1 0 140px}.item-icon[_ngcontent-%COMP%]{width:72px;height:42px;background-color:#545459;color:#fff;display:flex;font-size:30px;align-items:center;justify-content:center;border-radius:3px;cursor:pointer}.item-icon.hero-icon[_ngcontent-%COMP%]{background-size:cover;background-position:center center}.hero-option[_ngcontent-%COMP%]{padding:2px;cursor:pointer}.color-item[_ngcontent-%COMP%]{width:64px;height:36px;cursor:pointer}.color-item[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:2px}mw-res-label[_ngcontent-%COMP%]{display:flex}.icon-subtext[_ngcontent-%COMP%]{font-size:9px;text-align:center;display:block}.buttons[_ngcontent-%COMP%]{padding:20px;display:flex;margin-left:auto}.player[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]{flex:.1 0 300px;padding:10px;font-size:14px;text-align:center}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]{padding-top:16px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-icon[_ngcontent-%COMP%]{font-size:20px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{font-size:13px;flex:1 0 100px;text-align:left;padding-left:53px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;padding:6px 20px;border-top:1px solid gainsboro}mw-action-hint[_ngcontent-%COMP%]{position:fixed;bottom:50px;left:0;right:0}"]});let n=e;return n})();var Gd=class{constructor(){this.hero=k(null),this.heroItems=k([]),this.units=k([]),this.canStart=ae(()=>this.hero()&&this.units().length)}},Ld=(()=>{let e=class e{constructor(){this.registry=Ll,this.unitTypes=this.registry.getRegisteredEntitiesMap().get("#unit"),this.heroTypes=this.registry.getRegisteredEntitiesMap().get("#hero"),this.itemTypes=this.registry.getRegisteredEntitiesMap().get("#item"),this.spellTypes=this.registry.getRegisteredEntitiesMap().get("#spell"),this.currentPlayerSettings=new Gd,this.opponentPlayerSettings=new Gd}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var SD=["menuTrigger"],bD=["optionsRef"],xD=[[["",8,"trigger"]],[["",8,"empty"]]],MD=[".trigger",".empty"];function DD(n,e){n&1&&We(0)}function PD(n,e){if(n&1&&K(0,DD,1,0,"ng-container",5),n&2){let i=e.$implicit;f("ngTemplateOutlet",i.templateRef())}}function ED(n,e){if(n&1&&(a(0,"div",4,2),P(2,PD,1,1,"ng-container",null,j),Xe(4,1),l()),n&2){let i=m();c(2),E(i.options())}}var jn=(()=>{let e=class e{constructor(){this.hostElem=ti(),this.selectedItem=Yn(),this.options=k([]),this.optionChanged=mn(),this.menuTriggerRef=It.required("menuTrigger"),this.optionsRef=It("optionsRef"),this.menuPosition=[new zr({originX:"center",originY:"bottom"},{overlayX:"center",overlayY:"top"})]}onOpen(){this.selectedItem()&&setTimeout(()=>{this.options().find(o=>o.value()===this.selectedItem())?.focusIntoView()},0)}onClick(t){this.menuTriggerRef().opened&&([this.optionsRef()?.nativeElement,this.hostElem].filter(Nl).some(o=>o.contains(t.target))||this.menuTriggerRef().close())}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-dropdown"]],viewQuery:function(o,r){o&1&&(Tt(r.menuTriggerRef,SD,5),Tt(r.optionsRef,bD,5)),o&2&&ei(2)},hostBindings:function(o,r){o&1&&y("mousedown",function(d){return r.onClick(d)},Sh)},inputs:{selectedItem:[1,"selectedItem"]},outputs:{selectedItem:"selectedItemChange",optionChanged:"optionChanged"},ngContentSelectors:MD,decls:5,vars:2,consts:[["menuTrigger","cdkMenuTriggerFor"],["dropdown",""],["optionsRef",""],[1,"trigger",3,"cdkMenuOpened","cdkMenuTriggerFor","cdkMenuPosition"],[1,"options"],[4,"ngTemplateOutlet"]],template:function(o,r){if(o&1){let s=I();lt(xD),a(0,"div",3,0),y("cdkMenuOpened",function(){return w(s),S(r.onOpen())}),Xe(2),l(),K(3,ED,5,0,"ng-template",null,1,ve)}if(o&2){let s=ce(4);f("cdkMenuTriggerFor",s)("cdkMenuPosition",r.menuPosition)}},dependencies:[Cl,ct,Gt],styles:["[_nghost-%COMP%]{color:#fff}.trigger[_ngcontent-%COMP%]{border:1px solid white;padding:5px;border-radius:20px;background:#00000074;font-size:12px;cursor:pointer}.trigger[_ngcontent-%COMP%]:hover{background:#0000009e}.options[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:gray;border-radius:6px;color:#fff;overflow:auto;box-shadow:1px 1px 5px #000;transition:opacity .3s,translate .3s}@starting-style{.options[_ngcontent-%COMP%]{translate:0 -10px;opacity:0}}"]});let n=e;return n})();var TD=["template"],ID=["option"],kD=["*"];function AD(n,e){if(n&1){let i=I();a(0,"div",2,1),y("click",function(){w(i);let o=m();return S(o.selected())}),Xe(2),l()}if(n&2){let i=m();me("selected",i.isSelected())}}var er=(()=>{let e=class e{constructor(){this.dropdownRef=u(jn),this.templateRef=It.required("template"),this.optionRef=It("option"),this.value=N.required(),this.isSelected=ae(()=>this.value()===this.dropdownRef.selectedItem()),this.dropdownRef.options.update(wt.addItem(this)),u(_o).onDestroy(()=>this.dropdownRef.options.update(wt.removeItem(this)))}selected(){this.dropdownRef.selectedItem.set(this.value()),this.dropdownRef.menuTriggerRef().close(),this.dropdownRef.optionChanged.emit(this.value())}focusIntoView(){this.optionRef()?.nativeElement.scrollIntoView({block:"center"})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-dropdown-option"]],viewQuery:function(o,r){o&1&&(Tt(r.templateRef,TD,5),Tt(r.optionRef,ID,5)),o&2&&ei(2)},inputs:{value:[1,"value"]},ngContentSelectors:kD,decls:2,vars:0,consts:[["template",""],["option",""],[1,"option",3,"click"]],template:function(o,r){o&1&&(lt(),K(0,AD,3,2,"ng-template",null,0,ve))},styles:[".option[_ngcontent-%COMP%]{cursor:pointer;padding:4px}.option[_ngcontent-%COMP%]:hover{background:#0000004d}.option.selected[_ngcontent-%COMP%]{background:#fe9e28bd}"]});let n=e;return n})();function OD(n,e){if(n&1&&p(0),n&2){m();let i=q(1);D(" ",i.name," ")}}function FD(n,e){n&1&&p(0," Select a Hero... ")}function RD(n,e){if(n&1&&(a(0,"mw-dropdown-option",2),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.name)}}function BD(n,e){if(n&1&&p(0),n&2){m();let i=q(10);D(" ",i.name," ")}}function GD(n,e){n&1&&p(0," Select a Unit Type... ")}function LD(n,e){if(n&1&&(a(0,"mw-dropdown-option",2),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.name)}}function ND(n,e){if(n&1&&(a(0,"mw-dropdown-option",2),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.name)}}function UD(n,e){if(n&1){let i=I();a(0,"div",5),p(1),a(2,"mw-dropdown",0),ne("selectedItemChange",function(o){let r=w(i).$implicit;return ie(r.unitType,o)||(r.unitType=o),S(o)}),a(3,"div",1),p(4),l(),P(5,ND,2,2,"mw-dropdown-option",2,j),l(),a(7,"input",6),ne("ngModelChange",function(o){let r=w(i).$implicit;return ie(r.count,o)||(r.count=o),S(o)}),l()()}if(n&2){let i=e.$implicit,t=m();c(),D(" ",i.unitType().name," "),c(),te("selectedItem",i.unitType),c(2),D(" ",i.unitType().name," "),c(),E(t.unitTypes),c(2),te("ngModel",i.count)}}var Nd=(()=>{let e=class e{constructor(){this.context=u(Ld),this.settings=N.required(),this.playerName=N(""),this.activeUnitType=k(null),this.heroes=this.context.heroTypes,this.unitTypes=this.context.unitTypes}addUnitType(){let t=this.activeUnitType();t&&this.settings().units.update(wt.addItem({count:k(0),unitType:k(t)}))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-player-settings"]],inputs:{settings:[1,"settings"],playerName:[1,"playerName"]},decls:20,vars:7,consts:[[3,"selectedItemChange","selectedItem"],[1,"trigger"],[3,"value"],["mw-main-button","",3,"click"],[1,"units"],[1,"unit"],["type","number","min","1",3,"ngModelChange","ngModel"]],template:function(o,r){if(o&1){let s=I();p(0),Re(1),a(2,"mw-dropdown",0),ne("selectedItemChange",function(h){return w(s),ie(r.settings().hero,h)||(r.settings().hero=h),S(h)}),a(3,"div",1),x(4,OD,1,1)(5,FD,1,0),l(),P(6,RD,2,2,"mw-dropdown-option",2,j),l(),a(8,"button",3),y("click",function(){return w(s),S(r.addUnitType())}),p(9,` Add Unit Type
`),l(),Re(10),a(11,"mw-dropdown",0),ne("selectedItemChange",function(h){return w(s),ie(r.activeUnitType,h)||(r.activeUnitType=h),S(h)}),a(12,"div",1),x(13,BD,1,1)(14,GD,1,0),l(),P(15,LD,2,2,"mw-dropdown-option",2,j),l(),a(17,"div",4),P(18,UD,8,4,"div",5,j),l()}if(o&2){D("Player: ",r.playerName(),` Hero:
`),c();let s=Ve(r.settings().hero());c(),te("selectedItem",r.settings().hero),c(2),M(s?4:5),c(2),E(r.heroes),c(4);let d=Ve(r.activeUnitType());c(),te("selectedItem",r.activeUnitType),c(2),M(d?13:14),c(2),E(r.unitTypes),c(3),E(r.settings().units())}},dependencies:[jn,er,Ke,ee,Zt,li,qr,Kt,Yr,Vt],encapsulation:2});let n=e;return n})();var Ny=(()=>{let e=class e{constructor(){this.events=u(oe),this.sandboxContext=u(Ld),this.playerSettings=this.sandboxContext.currentPlayerSettings,this.opponentSettings=this.sandboxContext.opponentPlayerSettings,this.canStart=()=>this.playerSettings.canStart()&&this.opponentSettings.canStart()}runScenario(){this.events.dispatch(ma({hero:this.playerSettings.hero(),faction:rt,townBase:rt.townBase}))}goToMainScreen(){this.events.dispatch(Li())}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-sandbox-mode-screen"]],standalone:!1,decls:8,vars:3,consts:[[1,"bar"],["mw-main-button","",3,"click"],["mw-main-button","",3,"click","disabled"],[1,"settings"],["playerName","Your army",3,"settings"],["playerName","Opponent",3,"settings"]],template:function(o,r){o&1&&(a(0,"div",0)(1,"button",1),y("click",function(){return r.goToMainScreen()}),p(2," Main screen "),l(),a(3,"button",2),y("click",function(){return r.runScenario()}),p(4,"Test scenario"),l()(),a(5,"div",3),g(6,"mw-player-settings",4)(7,"mw-player-settings",5),l()),o&2&&(c(3),f("disabled",!r.canStart()),c(3),f("settings",r.playerSettings),c(),f("settings",r.opponentSettings))},dependencies:[ee,Nd],styles:[".bar[_ngcontent-%COMP%]{display:flex}.settings[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]});let n=e;return n})();function Jy(n){let e=n.cloneNode(!0),i=e.querySelectorAll("[id]"),t=n.nodeName.toLowerCase();e.removeAttribute("id");for(let o=0;o<i.length;o++)i[o].removeAttribute("id");return t==="canvas"?Hy(n,e):(t==="input"||t==="select"||t==="textarea")&&Vy(n,e),Uy("canvas",n,e,Hy),Uy("input, textarea, select",n,e,Vy),e}function Uy(n,e,i,t){let o=e.querySelectorAll(n);if(o.length){let r=i.querySelectorAll(n);for(let s=0;s<o.length;s++)t(o[s],r[s])}}var jD=0;function Vy(n,e){e.type!=="file"&&(e.value=n.value),e.type==="radio"&&e.name&&(e.name=`mat-clone-${e.name}-${jD++}`)}function Hy(n,e){let i=e.getContext("2d");if(i)try{i.drawImage(n,0,0)}catch{}}function jm(n){let e=n.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height,x:e.x,y:e.y}}function Gm(n,e,i){let{top:t,bottom:o,left:r,right:s}=n;return i>=t&&i<=o&&e>=r&&e<=s}function $D(n,e){let i=e.left<n.left,t=e.left+e.width>n.right,o=e.top<n.top,r=e.top+e.height>n.bottom;return i||t||o||r}function xl(n,e,i){n.top+=e,n.bottom=n.top+n.height,n.left+=i,n.right=n.left+n.width}function jy(n,e,i,t){let{top:o,right:r,bottom:s,left:d,width:h,height:_}=n,C=h*e,O=_*e;return t>o-O&&t<s+O&&i>d-C&&i<r+C}var Ud=class{_document;positions=new Map;constructor(e){this._document=e}clear(){this.positions.clear()}cache(e){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),e.forEach(i=>{this.positions.set(i,{scrollPosition:{top:i.scrollTop,left:i.scrollLeft},clientRect:jm(i)})})}handleScroll(e){let i=ai(e),t=this.positions.get(i);if(!t)return null;let o=t.scrollPosition,r,s;if(i===this._document){let _=this.getViewportScrollPosition();r=_.top,s=_.left}else r=i.scrollTop,s=i.scrollLeft;let d=o.top-r,h=o.left-s;return this.positions.forEach((_,C)=>{_.clientRect&&i!==C&&i.contains(C)&&xl(_.clientRect,d,h)}),o.top=r,o.left=s,{top:d,left:h}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function e_(n,e){let i=n.rootNodes;if(i.length===1&&i[0].nodeType===e.ELEMENT_NODE)return i[0];let t=e.createElement("div");return i.forEach(o=>t.appendChild(o)),t}function $m(n,e,i){for(let t in e)if(e.hasOwnProperty(t)){let o=e[t];o?n.setProperty(t,o,i?.has(t)?"important":""):n.removeProperty(t)}return n}function Vs(n,e){let i=e?"":"none";$m(n.style,{"touch-action":e?"":"none","-webkit-user-drag":e?"":"none","-webkit-tap-highlight-color":e?"":"transparent","user-select":i,"-ms-user-select":i,"-webkit-user-select":i,"-moz-user-select":i})}function $y(n,e,i){$m(n.style,{position:e?"":"fixed",top:e?"":"0",opacity:e?"":"0",left:e?"":"-999em"},i)}function Vd(n,e){return e&&e!="none"?n+" "+e:n}function zy(n,e){n.style.width=`${e.width}px`,n.style.height=`${e.height}px`,n.style.transform=Ml(e.left,e.top)}function Ml(n,e){return`translate3d(${Math.round(n)}px, ${Math.round(e)}px, 0)`}function Wy(n){let e=n.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(n)*e}function zD(n){let e=getComputedStyle(n),i=Rm(e,"transition-property"),t=i.find(d=>d==="transform"||d==="all");if(!t)return 0;let o=i.indexOf(t),r=Rm(e,"transition-duration"),s=Rm(e,"transition-delay");return Wy(r[o])+Wy(s[o])}function Rm(n,e){return n.getPropertyValue(e).split(",").map(t=>t.trim())}var WD=new Set(["position"]),Lm=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(e,i,t,o,r,s,d,h,_,C){this._document=e,this._rootElement=i,this._direction=t,this._initialDomRect=o,this._previewTemplate=r,this._previewClass=s,this._pickupPositionOnPage=d,this._initialTransform=h,this._zIndex=_,this._renderer=C}attach(e){this._preview=this._createPreview(),e.appendChild(this._preview),qy(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(e){this._preview.style.transform=e}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(e){this._preview.classList.add(e)}getTransitionDuration(){return zD(this._preview)}addEventListener(e,i){return this._renderer.listen(this._preview,e,i)}_createPreview(){let e=this._previewTemplate,i=this._previewClass,t=e?e.template:null,o;if(t&&e){let r=e.matchSize?this._initialDomRect:null,s=e.viewContainer.createEmbeddedView(t,e.context);s.detectChanges(),o=e_(s,this._document),this._previewEmbeddedView=s,e.matchSize?zy(o,r):o.style.transform=Ml(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else o=Jy(this._rootElement),zy(o,this._initialDomRect),this._initialTransform&&(o.style.transform=this._initialTransform);return $m(o.style,{"pointer-events":"none",margin:qy(o)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},WD),Vs(o,!1),o.classList.add("cdk-drag-preview"),o.setAttribute("popover","manual"),o.setAttribute("dir",this._direction),i&&(Array.isArray(i)?i.forEach(r=>o.classList.add(r)):o.classList.add(i)),o}};function qy(n){return"showPopover"in n}var qD={passive:!0},Yy={passive:!1},YD={passive:!1,capture:!0},KD=800,Ky=new Set(["position"]),Nm=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_anchor;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=k(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new X;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=yi.EMPTY;_pointerUpSubscription=yi.EMPTY;_scrollSubscription=yi.EMPTY;_resizeSubscription=yi.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(e){e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(i=>Vs(i,e)))}_disabled=!1;beforeStarted=new X;started=new X;released=new X;ended=new X;entered=new X;exited=new X;dropped=new X;moved=this._moveEvents;data;constrainPosition;constructor(e,i,t,o,r,s,d){this._config=i,this._document=t,this._ngZone=o,this._viewportRuler=r,this._dragDropRegistry=s,this._renderer=d,this.withRootElement(e).withParent(i.parentDragRef||null),this._parentPositions=new Ud(t),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(e){this._handles=e.map(t=>ki(t)),this._handles.forEach(t=>Vs(t,this.disabled)),this._toggleNativeDragInteractions();let i=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&i.add(t)}),this._disabledHandles=i,this}withPreviewTemplate(e){return this._previewTemplate=e,this}withPlaceholderTemplate(e){return this._placeholderTemplate=e,this}withRootElement(e){let i=ki(e);if(i!==this._rootElement){this._removeRootElementListeners();let t=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[t.listen(i,"mousedown",this._pointerDown,Yy),t.listen(i,"touchstart",this._pointerDown,qD),t.listen(i,"dragstart",this._nativeDragStart,Yy)]),this._initialTransform=void 0,this._rootElement=i}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(e){return this._boundaryElement=e?ki(e):null,this._resizeSubscription.unsubscribe(),e&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(e){return this._parentDragRef=e,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&$D(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let e=this._boundaryElement.getBoundingClientRect(),i=this._rootElement.getBoundingClientRect(),t=0,o=0;i.left<e.left?t=e.left-i.left:i.right>e.right&&(t=e.right-i.right),i.top<e.top?o=e.top-i.top:i.bottom>e.bottom&&(o=e.bottom-i.bottom);let r=this._activeTransform.x,s=this._activeTransform.y,d=r+t,h=s+o;this._rootElement.style.transform=Ml(d,h),this._activeTransform={x:d,y:h},this._passiveTransform={x:d,y:h}}}disableHandle(e){!this._disabledHandles.has(e)&&this._handles.indexOf(e)>-1&&(this._disabledHandles.add(e),Vs(e,!0))}enableHandle(e){this._disabledHandles.has(e)&&(this._disabledHandles.delete(e),Vs(e,this.disabled))}withDirection(e){return this._direction=e,this}_withDropContainer(e){this._dropContainer=e}getFreeDragPosition(){let e=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:e.x,y:e.y}}setFreeDragPosition(e){return this._activeTransform={x:0,y:0},this._passiveTransform.x=e.x,this._passiveTransform.y=e.y,this._dropContainer||this._applyRootElementTransform(e.x,e.y),this}withPreviewContainer(e){return this._previewContainer=e,this}_sortFromLastPointerPosition(){let e=this._lastKnownPointerPosition;e&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(e),e)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_pointerDown=e=>{if(this.beforeStarted.next(),this._handles.length){let i=this._getTargetHandle(e);i&&!this._disabledHandles.has(i)&&!this.disabled&&this._initializeDragSequence(i,e)}else this.disabled||this._initializeDragSequence(this._rootElement,e)};_pointerMove=e=>{let i=this._getPointerPositionOnPage(e);if(!this._hasStartedDragging()){let o=Math.abs(i.x-this._pickupPositionOnPage.x),r=Math.abs(i.y-this._pickupPositionOnPage.y);if(o+r>=this._config.dragStartThreshold){let d=Date.now()>=this._dragStartTime+this._getDragStartDelay(e),h=this._dropContainer;if(!d){this._endDragSequence(e);return}(!h||!h.isDragging()&&!h.isReceiving())&&(e.cancelable&&e.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(e)))}return}e.cancelable&&e.preventDefault();let t=this._getConstrainedPointerPosition(i);if(this._hasMoved=!0,this._lastKnownPointerPosition=i,this._updatePointerDirectionDelta(t),this._dropContainer)this._updateActiveDropContainer(t,i);else{let o=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=t.x-o.x+this._passiveTransform.x,r.y=t.y-o.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:t,event:e,distance:this._getDragDistance(t),delta:this._pointerDirectionDelta})})};_pointerUp=e=>{this._endDragSequence(e)};_endDragSequence(e){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:e}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(e),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let i=this._getPointerPositionOnPage(e);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(i),dropPoint:i,event:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(e){Sl(e)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let i=this._getShadowRoot(),t=this._dropContainer;if(i&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(i,"selectstart",ZD,YD)}),t){let o=this._rootElement,r=o.parentNode,s=this._placeholder=this._createPlaceholderElement(),d=this._anchor=this._anchor||this._document.createComment("");r.insertBefore(d,o),this._initialTransform=o.style.transform||"",this._preview=new Lm(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,i)),$y(o,!1,Ky),this._document.body.appendChild(r.replaceChild(s,o)),this.started.next({source:this,event:e}),t.start(),this._initialContainer=t,this._initialIndex=t.getItemIndex(this)}else this.started.next({source:this,event:e}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(t?t.getScrollableParents():[])}_initializeDragSequence(e,i){this._parentDragRef&&i.stopPropagation();let t=this.isDragging(),o=Sl(i),r=!o&&i.button!==0,s=this._rootElement,d=ai(i),h=!o&&this._lastTouchEventTime&&this._lastTouchEventTime+KD>Date.now(),_=o?Qc(i):Xc(i);if(d&&d.draggable&&i.type==="mousedown"&&i.preventDefault(),t||r||h||_)return;if(this._handles.length){let R=s.style;this._rootElementTapHighlight=R.webkitTapHighlightColor||"",R.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(R=>this._updateOnScroll(R)),this._boundaryElement&&(this._boundaryRect=jm(this._boundaryElement));let C=this._previewTemplate;this._pickupPositionInElement=C&&C.template&&!C.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,e,i);let O=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(i);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:O.x,y:O.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,i)}_cleanupDragArtifacts(e){$y(this._rootElement,!0,Ky),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let i=this._dropContainer,t=i.getItemIndex(this),o=this._getPointerPositionOnPage(e),r=this._getDragDistance(o),s=i._isOverContainer(o.x,o.y);this.ended.next({source:this,distance:r,dropPoint:o,event:e}),this.dropped.next({item:this,currentIndex:t,previousIndex:this._initialIndex,container:i,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:r,dropPoint:o,event:e}),i.drop(this,t,this._initialIndex,this._initialContainer,s,r,o,e),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:e,y:i},{x:t,y:o}){let r=this._initialContainer._getSiblingContainerFromPosition(this,e,i);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(e,i)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,e,i,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(t,o),this._dropContainer._sortItem(this,e,i,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(e,i):this._applyPreviewTransform(e-this._pickupPositionInElement.x,i-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let e=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(e.left,e.top);let i=this._preview.getTransitionDuration();return i===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{let o=d=>{(!d||this._preview&&ai(d)===this._preview.element&&d.propertyName==="transform")&&(s(),t(),clearTimeout(r))},r=setTimeout(o,i*1.5),s=this._preview.addEventListener("transitionend",o)}))}_createPlaceholderElement(){let e=this._placeholderTemplate,i=e?e.template:null,t;return i?(this._placeholderRef=e.viewContainer.createEmbeddedView(i,e.context),this._placeholderRef.detectChanges(),t=e_(this._placeholderRef,this._document)):t=Jy(this._rootElement),t.style.pointerEvents="none",t.classList.add("cdk-drag-placeholder"),t}_getPointerPositionInElement(e,i,t){let o=i===this._rootElement?null:i,r=o?o.getBoundingClientRect():e,s=Sl(t)?t.targetTouches[0]:t,d=this._getViewportScrollPosition(),h=s.pageX-r.left-d.left,_=s.pageY-r.top-d.top;return{x:r.left-e.left+h,y:r.top-e.top+_}}_getPointerPositionOnPage(e){let i=this._getViewportScrollPosition(),t=Sl(e)?e.touches[0]||e.changedTouches[0]||{pageX:0,pageY:0}:e,o=t.pageX-i.left,r=t.pageY-i.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let d=this._ownerSVGElement.createSVGPoint();return d.x=o,d.y=r,d.matrixTransform(s.inverse())}}return{x:o,y:r}}_getConstrainedPointerPosition(e){let i=this._dropContainer?this._dropContainer.lockAxis:null,{x:t,y:o}=this.constrainPosition?this.constrainPosition(e,this,this._initialDomRect,this._pickupPositionInElement):e;if(this.lockAxis==="x"||i==="x"?o=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||i==="y")&&(t=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,d=this._boundaryRect,{width:h,height:_}=this._getPreviewRect(),C=d.top+s,O=d.bottom-(_-s),R=d.left+r,Q=d.right-(h-r);t=Zy(t,R,Q),o=Zy(o,C,O)}return{x:t,y:o}}_updatePointerDirectionDelta(e){let{x:i,y:t}=e,o=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,s=Math.abs(i-r.x),d=Math.abs(t-r.y);return s>this._config.pointerDirectionChangeThreshold&&(o.x=i>r.x?1:-1,r.x=i),d>this._config.pointerDirectionChangeThreshold&&(o.y=t>r.y?1:-1,r.y=t),o}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let e=this._handles.length>0||!this.isDragging();e!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=e,Vs(this._rootElement,e))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(e=>e()),this._rootElementCleanups=void 0}_applyRootElementTransform(e,i){let t=1/this.scale,o=Ml(e*t,i*t),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=Vd(o,this._initialTransform)}_applyPreviewTransform(e,i){let t=this._previewTemplate?.template?void 0:this._initialTransform,o=Ml(e,i);this._preview.setTransform(Vd(o,t))}_getDragDistance(e){let i=this._pickupPositionOnPage;return i?{x:e.x-i.x,y:e.y-i.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:e,y:i}=this._passiveTransform;if(e===0&&i===0||this.isDragging()||!this._boundaryElement)return;let t=this._rootElement.getBoundingClientRect(),o=this._boundaryElement.getBoundingClientRect();if(o.width===0&&o.height===0||t.width===0&&t.height===0)return;let r=o.left-t.left,s=t.right-o.right,d=o.top-t.top,h=t.bottom-o.bottom;o.width>t.width?(r>0&&(e+=r),s>0&&(e-=s)):e=0,o.height>t.height?(d>0&&(i+=d),h>0&&(i-=h)):i=0,(e!==this._passiveTransform.x||i!==this._passiveTransform.y)&&this.setFreeDragPosition({y:i,x:e})}_getDragStartDelay(e){let i=this.dragStartDelay;return typeof i=="number"?i:Sl(e)?i.touch:i?i.mouse:0}_updateOnScroll(e){let i=this._parentPositions.handleScroll(e);if(i){let t=ai(e);this._boundaryRect&&t!==this._boundaryElement&&t.contains(this._boundaryElement)&&xl(this._boundaryRect,i.top,i.left),this._pickupPositionOnPage.x+=i.left,this._pickupPositionOnPage.y+=i.top,this._dropContainer||(this._activeTransform.x-=i.left,this._activeTransform.y-=i.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Ms(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(e,i){let t=this._previewContainer||"global";if(t==="parent")return e;if(t==="global"){let o=this._document;return i||o.fullscreenElement||o.webkitFullscreenElement||o.mozFullScreenElement||o.msFullscreenElement||o.body}return ki(t)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=e=>{if(this._handles.length){let i=this._getTargetHandle(e);i&&!this._disabledHandles.has(i)&&!this.disabled&&e.preventDefault()}else this.disabled||e.preventDefault()};_getTargetHandle(e){return this._handles.find(i=>e.target&&(e.target===i||i.contains(e.target)))}};function Zy(n,e,i){return Math.max(e,Math.min(i,n))}function Sl(n){return n.type[0]==="t"}function ZD(n){n.preventDefault()}function t_(n,e,i){let t=Xy(e,n.length-1),o=Xy(i,n.length-1);if(t===o)return;let r=n[t],s=o<t?-1:1;for(let d=t;d!==o;d+=s)n[d]=n[d+s];n[o]=r}function Xy(n,e){return Math.max(0,Math.min(e,n))}var Hd=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(e){this._dragDropRegistry=e}_previousSwap={drag:null,delta:0,overlaps:!1};start(e){this.withItems(e)}sort(e,i,t,o){let r=this._itemPositions,s=this._getItemIndexFromPointerPosition(e,i,t,o);if(s===-1&&r.length>0)return null;let d=this.orientation==="horizontal",h=r.findIndex(nt=>nt.drag===e),_=r[s],C=r[h].clientRect,O=_.clientRect,R=h>s?1:-1,Q=this._getItemOffsetPx(C,O,R),de=this._getSiblingOffsetPx(h,r,R),Ie=r.slice();return t_(r,h,s),r.forEach((nt,ci)=>{if(Ie[ci]===nt)return;let El=nt.drag===e,Hs=El?Q:de,Tl=El?e.getPlaceholderElement():nt.drag.getRootElement();nt.offset+=Hs;let go=Math.round(nt.offset*(1/nt.drag.scale));d?(Tl.style.transform=Vd(`translate3d(${go}px, 0, 0)`,nt.initialTransform),xl(nt.clientRect,0,Hs)):(Tl.style.transform=Vd(`translate3d(0, ${go}px, 0)`,nt.initialTransform),xl(nt.clientRect,Hs,0))}),this._previousSwap.overlaps=Gm(O,i,t),this._previousSwap.drag=_.drag,this._previousSwap.delta=d?o.x:o.y,{previousIndex:h,currentIndex:s}}enter(e,i,t,o){let r=o==null||o<0?this._getItemIndexFromPointerPosition(e,i,t):o,s=this._activeDraggables,d=s.indexOf(e),h=e.getPlaceholderElement(),_=s[r];if(_===e&&(_=s[r+1]),!_&&(r==null||r===-1||r<s.length-1)&&this._shouldEnterAsFirstChild(i,t)&&(_=s[0]),d>-1&&s.splice(d,1),_&&!this._dragDropRegistry.isDragging(_)){let C=_.getRootElement();C.parentElement.insertBefore(h,C),s.splice(r,0,e)}else this._element.appendChild(h),s.push(e);h.style.transform="",this._cacheItemPositions()}withItems(e){this._activeDraggables=e.slice(),this._cacheItemPositions()}withSortPredicate(e){this._sortPredicate=e}reset(){this._activeDraggables?.forEach(e=>{let i=e.getRootElement();if(i){let t=this._itemPositions.find(o=>o.drag===e)?.initialTransform;i.style.transform=t||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(e){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(t=>t.drag===e)}updateOnScroll(e,i){this._itemPositions.forEach(({clientRect:t})=>{xl(t,e,i)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(e){this._element=e}_cacheItemPositions(){let e=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(i=>{let t=i.getVisibleElement();return{drag:i,offset:0,initialTransform:t.style.transform||"",clientRect:jm(t)}}).sort((i,t)=>e?i.clientRect.left-t.clientRect.left:i.clientRect.top-t.clientRect.top)}_getItemOffsetPx(e,i,t){let o=this.orientation==="horizontal",r=o?i.left-e.left:i.top-e.top;return t===-1&&(r+=o?i.width-e.width:i.height-e.height),r}_getSiblingOffsetPx(e,i,t){let o=this.orientation==="horizontal",r=i[e].clientRect,s=i[e+t*-1],d=r[o?"width":"height"]*t;if(s){let h=o?"left":"top",_=o?"right":"bottom";t===-1?d-=s.clientRect[h]-r[_]:d+=r[h]-s.clientRect[_]}return d}_shouldEnterAsFirstChild(e,i){if(!this._activeDraggables.length)return!1;let t=this._itemPositions,o=this.orientation==="horizontal";if(t[0].drag!==this._activeDraggables[0]){let s=t[t.length-1].clientRect;return o?e>=s.right:i>=s.bottom}else{let s=t[0].clientRect;return o?e<=s.left:i<=s.top}}_getItemIndexFromPointerPosition(e,i,t,o){let r=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:d,clientRect:h})=>{if(d===e)return!1;if(o){let _=r?o.x:o.y;if(d===this._previousSwap.drag&&this._previousSwap.overlaps&&_===this._previousSwap.delta)return!1}return r?i>=Math.floor(h.left)&&i<Math.floor(h.right):t>=Math.floor(h.top)&&t<Math.floor(h.bottom)});return s===-1||!this._sortPredicate(s,e)?-1:s}},Um=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(e,i){this._document=e,this._dragDropRegistry=i}start(e){let i=this._element.childNodes;this._relatedNodes=[];for(let t=0;t<i.length;t++){let o=i[t];this._relatedNodes.push([o,o.nextSibling])}this.withItems(e)}sort(e,i,t,o){let r=this._getItemIndexFromPointerPosition(e,i,t),s=this._previousSwap;if(r===-1||this._activeItems[r]===e)return null;let d=this._activeItems[r];if(s.drag===d&&s.overlaps&&s.deltaX===o.x&&s.deltaY===o.y)return null;let h=this.getItemIndex(e),_=e.getPlaceholderElement(),C=d.getRootElement();r>h?C.after(_):C.before(_),t_(this._activeItems,h,r);let O=this._getRootNode().elementFromPoint(i,t);return s.deltaX=o.x,s.deltaY=o.y,s.drag=d,s.overlaps=C===O||C.contains(O),{previousIndex:h,currentIndex:r}}enter(e,i,t,o){let r=o==null||o<0?this._getItemIndexFromPointerPosition(e,i,t):o;r===-1&&(r=this._getClosestItemIndexToPointer(e,i,t));let s=this._activeItems[r],d=this._activeItems.indexOf(e);d>-1&&this._activeItems.splice(d,1),s&&!this._dragDropRegistry.isDragging(s)?(this._activeItems.splice(r,0,e),s.getRootElement().before(e.getPlaceholderElement())):(this._activeItems.push(e),this._element.appendChild(e.getPlaceholderElement()))}withItems(e){this._activeItems=e.slice()}withSortPredicate(e){this._sortPredicate=e}reset(){let e=this._element,i=this._previousSwap;for(let t=this._relatedNodes.length-1;t>-1;t--){let[o,r]=this._relatedNodes[t];o.parentNode===e&&o.nextSibling!==r&&(r===null?e.appendChild(o):r.parentNode===e&&e.insertBefore(o,r))}this._relatedNodes=[],this._activeItems=[],i.drag=null,i.deltaX=i.deltaY=0,i.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(e){return this._activeItems.indexOf(e)}updateOnScroll(){this._activeItems.forEach(e=>{this._dragDropRegistry.isDragging(e)&&e._sortFromLastPointerPosition()})}withElementContainer(e){e!==this._element&&(this._element=e,this._rootNode=void 0)}_getItemIndexFromPointerPosition(e,i,t){let o=this._getRootNode().elementFromPoint(Math.floor(i),Math.floor(t)),r=o?this._activeItems.findIndex(s=>{let d=s.getRootElement();return o===d||d.contains(o)}):-1;return r===-1||!this._sortPredicate(r,e)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=Ms(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(e,i,t){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let o=1/0,r=-1;for(let s=0;s<this._activeItems.length;s++){let d=this._activeItems[s];if(d!==e){let{x:h,y:_}=d.getRootElement().getBoundingClientRect(),C=Math.hypot(i-h,t-_);C<o&&(o=C,r=s)}}return r}},Qy=.05,i_=.05,dn=function(n){return n[n.NONE=0]="NONE",n[n.UP=1]="UP",n[n.DOWN=2]="DOWN",n}(dn||{}),fi=function(n){return n[n.NONE=0]="NONE",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n}(fi||{}),Vm=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis;autoScrollDisabled=!1;autoScrollStep=2;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new X;entered=new X;exited=new X;dropped=new X;sorted=new X;receivingStarted=new X;receivingStopped=new X;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=yi.EMPTY;_verticalScrollDirection=dn.NONE;_horizontalScrollDirection=fi.NONE;_scrollNode;_stopScrollTimers=new X;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(e,i,t,o,r){this._dragDropRegistry=i,this._ngZone=o,this._viewportRuler=r;let s=this.element=ki(e);this._document=t,this.withOrientation("vertical").withElementContainer(s),i.registerDropContainer(this),this._parentPositions=new Ud(t)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(e,i,t,o){this._draggingStarted(),o==null&&this.sortingDisabled&&(o=this._draggables.indexOf(e)),this._sortStrategy.enter(e,i,t,o),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:e,container:this,currentIndex:this.getItemIndex(e)})}exit(e){this._reset(),this.exited.next({item:e,container:this})}drop(e,i,t,o,r,s,d,h={}){this._reset(),this.dropped.next({item:e,currentIndex:i,previousIndex:t,container:this,previousContainer:o,isPointerOverContainer:r,distance:s,dropPoint:d,event:h})}withItems(e){let i=this._draggables;return this._draggables=e,e.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(i.filter(o=>o.isDragging()).every(o=>e.indexOf(o)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(e){return this._direction=e,this._sortStrategy instanceof Hd&&(this._sortStrategy.direction=e),this}connectedTo(e){return this._siblings=e.slice(),this}withOrientation(e){if(e==="mixed")this._sortStrategy=new Um(this._document,this._dragDropRegistry);else{let i=new Hd(this._dragDropRegistry);i.direction=this._direction,i.orientation=e,this._sortStrategy=i}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((i,t)=>this.sortPredicate(i,t,this)),this}withScrollableParents(e){let i=this._container;return this._scrollableElements=e.indexOf(i)===-1?[i,...e]:e.slice(),this}withElementContainer(e){if(e===this._container)return this;let i=ki(this.element),t=this._scrollableElements.indexOf(this._container),o=this._scrollableElements.indexOf(e);return t>-1&&this._scrollableElements.splice(t,1),o>-1&&this._scrollableElements.splice(o,1),this._sortStrategy&&this._sortStrategy.withElementContainer(e),this._cachedShadowRoot=null,this._scrollableElements.unshift(e),this._container=e,this}getScrollableParents(){return this._scrollableElements}getItemIndex(e){return this._isDragging?this._sortStrategy.getItemIndex(e):this._draggables.indexOf(e)}isReceiving(){return this._activeSiblings.size>0}_sortItem(e,i,t,o){if(this.sortingDisabled||!this._domRect||!jy(this._domRect,Qy,i,t))return;let r=this._sortStrategy.sort(e,i,t,o);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:e})}_startScrollingIfNecessary(e,i){if(this.autoScrollDisabled)return;let t,o=dn.NONE,r=fi.NONE;if(this._parentPositions.positions.forEach((s,d)=>{d===this._document||!s.clientRect||t||jy(s.clientRect,Qy,e,i)&&([o,r]=XD(d,s.clientRect,this._direction,e,i),(o||r)&&(t=d))}),!o&&!r){let{width:s,height:d}=this._viewportRuler.getViewportSize(),h={width:s,height:d,top:0,right:s,bottom:d,left:0};o=n_(h,i),r=o_(h,e),t=window}t&&(o!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||t!==this._scrollNode)&&(this._verticalScrollDirection=o,this._horizontalScrollDirection=r,this._scrollNode=t,(o||r)&&t?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let e=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=e.msScrollSnapType||e.scrollSnapType||"",e.scrollSnapType=e.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let e=this._container.style;e.scrollSnapType=e.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(i=>i._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),ah(0,op).pipe(Ge(this._stopScrollTimers)).subscribe(()=>{let e=this._scrollNode,i=this.autoScrollStep;this._verticalScrollDirection===dn.UP?e.scrollBy(0,-i):this._verticalScrollDirection===dn.DOWN&&e.scrollBy(0,i),this._horizontalScrollDirection===fi.LEFT?e.scrollBy(-i,0):this._horizontalScrollDirection===fi.RIGHT&&e.scrollBy(i,0)})};_isOverContainer(e,i){return this._domRect!=null&&Gm(this._domRect,e,i)}_getSiblingContainerFromPosition(e,i,t){return this._siblings.find(o=>o._canReceive(e,i,t))}_canReceive(e,i,t){if(!this._domRect||!Gm(this._domRect,i,t)||!this.enterPredicate(e,this))return!1;let o=this._getShadowRoot().elementFromPoint(i,t);return o?o===this._container||this._container.contains(o):!1}_startReceiving(e,i){let t=this._activeSiblings;!t.has(e)&&i.every(o=>this.enterPredicate(o,this)||this._draggables.indexOf(o)>-1)&&(t.add(e),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:e,receiver:this,items:i}))}_stopReceiving(e){this._activeSiblings.delete(e),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:e,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(e=>{if(this.isDragging()){let i=this._parentPositions.handleScroll(e);i&&this._sortStrategy.updateOnScroll(i.top,i.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let e=Ms(this._container);this._cachedShadowRoot=e||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let e=this._sortStrategy.getActiveItemsSnapshot().filter(i=>i.isDragging());this._siblings.forEach(i=>i._startReceiving(this,e))}};function n_(n,e){let{top:i,bottom:t,height:o}=n,r=o*i_;return e>=i-r&&e<=i+r?dn.UP:e>=t-r&&e<=t+r?dn.DOWN:dn.NONE}function o_(n,e){let{left:i,right:t,width:o}=n,r=o*i_;return e>=i-r&&e<=i+r?fi.LEFT:e>=t-r&&e<=t+r?fi.RIGHT:fi.NONE}function XD(n,e,i,t,o){let r=n_(e,o),s=o_(e,t),d=dn.NONE,h=fi.NONE;if(r){let _=n.scrollTop;r===dn.UP?_>0&&(d=dn.UP):n.scrollHeight-_>n.clientHeight&&(d=dn.DOWN)}if(s){let _=n.scrollLeft;i==="rtl"?s===fi.RIGHT?_<0&&(h=fi.RIGHT):n.scrollWidth+_>n.clientWidth&&(h=fi.LEFT):s===fi.LEFT?_>0&&(h=fi.LEFT):n.scrollWidth-_>n.clientWidth&&(h=fi.RIGHT)}return[d,h]}var bl={capture:!0},Bm={passive:!1,capture:!0},QD=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(t,o){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return n})(),zm=(()=>{class n{_ngZone=u(Ae);_document=u(ke);_styleLoader=u(Ur);_renderer=u(pi).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new X;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=k([]);_globalListeners;_draggingPredicate=i=>i.isDragging();_domNodesToDirectives=null;pointerMove=new X;pointerUp=new X;constructor(){}registerDropContainer(i){this._dropInstances.has(i)||this._dropInstances.add(i)}registerDragItem(i){this._dragInstances.add(i),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,Bm)})}removeDropContainer(i){this._dropInstances.delete(i)}removeDragItem(i){this._dragInstances.delete(i),this.stopDragging(i),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(i,t){if(!(this._activeDragInstances().indexOf(i)>-1)&&(this._styleLoader.load(QD),this._activeDragInstances.update(o=>[...o,i]),this._activeDragInstances().length===1)){let o=t.type.startsWith("touch"),r=d=>this.pointerUp.next(d),s=[["scroll",d=>this._scroll.next(d),bl],["selectstart",this._preventDefaultWhileDragging,Bm]];o?s.push(["touchend",r,bl],["touchcancel",r,bl]):s.push(["mouseup",r,bl]),o||s.push(["mousemove",d=>this.pointerMove.next(d),Bm]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=s.map(([d,h,_])=>this._renderer.listen(this._document,d,h,_))})}}stopDragging(i){this._activeDragInstances.update(t=>{let o=t.indexOf(i);return o>-1?(t.splice(o,1),[...t]):t}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(i){return this._activeDragInstances().indexOf(i)>-1}scrolled(i){let t=[this._scroll];return i&&i!==this._document&&t.push(new tr(o=>this._ngZone.runOutsideAngular(()=>{let r=this._renderer.listen(i,"scroll",s=>{this._activeDragInstances().length&&o.next(s)},bl);return()=>{r()}}))),yo(...t)}registerDirectiveNode(i,t){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(i,t)}removeDirectiveNode(i){this._domNodesToDirectives?.delete(i)}getDragDirectiveForNode(i){return this._domNodesToDirectives?.get(i)||null}ngOnDestroy(){this._dragInstances.forEach(i=>this.removeDragItem(i)),this._dropInstances.forEach(i=>this.removeDropContainer(i)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=i=>{this._activeDragInstances().length>0&&i.preventDefault()};_persistentTouchmoveListener=i=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&i.preventDefault(),this.pointerMove.next(i))};_clearGlobalListeners(){this._globalListeners?.forEach(i=>i()),this._globalListeners=void 0}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),JD={dragStartThreshold:5,pointerDirectionChangeThreshold:5},eP=(()=>{class n{_document=u(ke);_ngZone=u(Ae);_viewportRuler=u(Hr);_dragDropRegistry=u(zm);_renderer=u(pi).createRenderer(null,null);constructor(){}createDrag(i,t=JD){return new Nm(i,t,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(i){return new Vm(i,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Hm=new Se("CDK_DRAG_PARENT");var r_=new Se("CdkDragHandle"),s_=(()=>{class n{element=u(Ue);_parentDrag=u(Hm,{optional:!0,skipSelf:!0});_dragDropRegistry=u(zm);_stateChanges=new X;get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._stateChanges.next(this)}_disabled=!1;constructor(){this._parentDrag?._addHandle(this)}ngAfterViewInit(){if(!this._parentDrag){let i=this.element.nativeElement.parentElement;for(;i;){let t=this._dragDropRegistry.getDragDirectiveForNode(i);if(t){this._parentDrag=t,t._addHandle(this);break}i=i.parentElement}}}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",Tn]},features:[et([{provide:r_,useExisting:n}])]})}return n})(),tP=new Se("CDK_DRAG_CONFIG"),iP=new Se("CdkDropList"),a_=(()=>{class n{element=u(Ue);dropContainer=u(iP,{optional:!0,skipSelf:!0});_ngZone=u(Ae);_viewContainerRef=u(Ht);_dir=u(Mn,{optional:!0});_changeDetectorRef=u(hn);_selfHandle=u(r_,{optional:!0,self:!0});_parentDrag=u(Hm,{optional:!0,skipSelf:!0});_dragDropRegistry=u(zm);_destroyed=new X;_handles=new un([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(i){this._disabled=i,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new ze;released=new ze;ended=new ze;entered=new ze;exited=new ze;dropped=new ze;moved=new tr(i=>{let t=this._dragRef.moved.pipe(Xt(o=>({source:this,pointerPosition:o.pointerPosition,event:o.event,delta:o.delta,distance:o.distance}))).subscribe(i);return()=>{t.unsubscribe()}});_injector=u(Ne);constructor(){let i=this.dropContainer,t=u(tP,{optional:!0}),o=u(eP);this._dragRef=o.createDrag(this.element,{dragStartThreshold:t&&t.dragStartThreshold!=null?t.dragStartThreshold:5,pointerDirectionChangeThreshold:t&&t.pointerDirectionChangeThreshold!=null?t.pointerDirectionChangeThreshold:5,zIndex:t?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),t&&this._assignDefaults(t),i&&(this._dragRef._withDropContainer(i._dropListRef),i.addItem(this),i._dropListRef.beforeStarted.pipe(Ge(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(i){this._dragRef.setFreeDragPosition(i)}ngAfterViewInit(){Pn(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(i){let t=i.rootElementSelector,o=i.freeDragPosition;t&&!t.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,o&&!o.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(i){let t=this._handles.getValue();t.push(i),this._handles.next(t)}_removeHandle(i){let t=this._handles.getValue(),o=t.indexOf(i);o>-1&&(t.splice(o,1),this._handles.next(t))}_setPreviewTemplate(i){this._previewTemplate=i}_resetPreviewTemplate(i){i===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(i){this._placeholderTemplate=i}_resetPlaceholderTemplate(i){i===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let i=this.element.nativeElement,t=i;this.rootElementSelector&&(t=i.closest!==void 0?i.closest(this.rootElementSelector):i.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(t||i)}_getBoundaryElement(){let i=this.boundaryElement;return i?typeof i=="string"?this.element.nativeElement.closest(i):ki(i):null}_syncInputs(i){i.beforeStarted.subscribe(()=>{if(!i.isDragging()){let t=this._dir,o=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;i.disabled=this.disabled,i.lockAxis=this.lockAxis,i.scale=this.scale,i.dragStartDelay=typeof o=="object"&&o?o:Nu(o),i.constrainPosition=this.constrainPosition,i.previewClass=this.previewClass,i.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),t&&i.withDirection(t.value)}}),i.beforeStarted.pipe(Co(1)).subscribe(()=>{if(this._parentDrag){i.withParent(this._parentDrag._dragRef);return}let t=this.element.nativeElement.parentElement;for(;t;){let o=this._dragDropRegistry.getDragDirectiveForNode(t);if(o){i.withParent(o._dragRef);break}t=t.parentElement}})}_handleEvents(i){i.started.subscribe(t=>{this.started.emit({source:this,event:t.event}),this._changeDetectorRef.markForCheck()}),i.released.subscribe(t=>{this.released.emit({source:this,event:t.event})}),i.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),i.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),i.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),i.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event})})}_assignDefaults(i){let{lockAxis:t,dragStartDelay:o,constrainPosition:r,previewClass:s,boundaryElement:d,draggingDisabled:h,rootElementSelector:_,previewContainer:C}=i;this.disabled=h??!1,this.dragStartDelay=o||0,t&&(this.lockAxis=t),r&&(this.constrainPosition=r),s&&(this.previewClass=s),d&&(this.boundaryElement=d),_&&(this.rootElementSelector=_),C&&(this.previewContainer=C)}_setupHandlesListener(){this._handles.pipe(ns(i=>{let t=i.map(o=>o.element);this._selfHandle&&this.rootElementSelector&&t.push(this.element),this._dragRef.withHandles(t)}),nr(i=>yo(...i.map(t=>t._stateChanges.pipe(Wn(t))))),Ge(this._destroyed)).subscribe(i=>{let t=this._dragRef,o=i.element.nativeElement;i.disabled?t.disableHandle(o):t.enableHandle(o)})}static \u0275fac=function(t){return new(t||n)};static \u0275dir=pe({type:n,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(t,o){t&2&&me("cdk-drag-disabled",o.disabled)("cdk-drag-dragging",o._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Tn],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Lh]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[et([{provide:Hm,useExisting:n}]),bt]})}return n})();var Dl=(()=>{let e=class e{constructor(){this.panels=[]}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac});let n=e;return n})();var nP=["*"],oP=(n,e)=>e.title();function rP(n,e){n&1&&We(0)}function sP(n,e){if(n&1){let i=I();a(0,"div",1),y("mousedown",function(){let o=w(i).$implicit,r=m();return S(r.focused(o))}),a(1,"div",2),p(2),l(),a(3,"div",3),K(4,rP,1,0,"ng-container",4),l()()}if(n&2){let i=e.$implicit;se("width",i.width(),"px")("height",i.height(),"px"),f("cdkDragFreeDragPosition",i.position()),c(2),D(" ",i.title()," "),c(2),f("ngTemplateOutlet",i.templateRef())}}var l_=(()=>{let e=class e{constructor(){this.panels=u(Dl)}focused(t){z.removeItem(this.panels.panels,t),this.panels.panels.push(t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-panel-container"]],features:[et([Dl])],ngContentSelectors:nP,decls:3,vars:0,consts:[["cdkDrag","",1,"panel",3,"width","height","cdkDragFreeDragPosition"],["cdkDrag","",1,"panel",3,"mousedown","cdkDragFreeDragPosition"],["cdkDragHandle","",1,"header"],[1,"content"],[4,"ngTemplateOutlet"]],template:function(o,r){o&1&&(lt(),P(0,sP,5,7,"div",0,oP),Xe(2)),o&2&&E(r.panels.panels)},dependencies:[a_,s_,ct,Gt],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.panel[_ngcontent-%COMP%]{background:gray;border:1px solid black;color:#fff;position:absolute;display:inline-block;overflow:auto;width:300px;height:400px;resize:both;z-index:1000}.panel[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:4px}.panel[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{background:#00000050;padding:3px;font-size:12px}.panel[_ngcontent-%COMP%]   .resize-handler[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;height:4px;width:4px;background:#474747}"]});let n=e;return n})();var aP=["content"],lP=["*"];function cP(n,e){n&1&&Xe(0)}var c_=(()=>{let e=class e{constructor(){this.title=N("panel_title"),this.width=Yn(100),this.height=Yn(100),this.xPosition=Yn(0),this.yPosition=Yn(0),this.position=ae(()=>({x:this.xPosition(),y:this.yPosition()})),this.templateRef=It.required("content"),this.panels=u(Dl),this.panels.panels.push(this)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-panel"]],viewQuery:function(o,r){o&1&&Tt(r.templateRef,aP,5),o&2&&ei()},inputs:{title:[1,"title"],width:[1,"width"],height:[1,"height"],xPosition:[1,"xPosition"],yPosition:[1,"yPosition"]},outputs:{width:"widthChange",height:"heightChange",xPosition:"xPositionChange",yPosition:"yPositionChange"},ngContentSelectors:lP,decls:2,vars:0,consts:[["content",""]],template:function(o,r){o&1&&(lt(),K(0,cP,1,0,"ng-template",null,0,ve))},styles:["[_nghost-%COMP%]{display:inline-block}"]});let n=e;return n})();function dP(n,e){if(n&1){let i=I();a(0,"input",2),ne("ngModelChange",function(o){w(i),m();let r=q(0);return ie(r.value,o)||(r.value=o),S(o)}),l()}if(n&2){m();let i=q(0);f("type",i.type),te("ngModel",i.value)}}function pP(n,e){if(n&1){let i=I();a(0,"input",3),ne("ngModelChange",function(o){w(i),m();let r=q(0);return ie(r.value,o)||(r.value=o),S(o)}),l()}if(n&2){m();let i=q(0);f("type",i.type),te("ngModel",i.value),f("min",i.min)}}function uP(n,e){if(n&1){let i=I();a(0,"input",2),ne("ngModelChange",function(o){w(i),m();let r=q(0);return ie(r.value,o)||(r.value=o),S(o)}),l()}if(n&2){m();let i=q(0);f("type",i.type),te("ngModel",i.value)}}function mP(n,e){if(n&1){let i=I();a(0,"input",2),ne("ngModelChange",function(o){w(i),m();let r=q(0);return ie(r.value,o)||(r.value=o),S(o)}),l()}if(n&2){m();let i=q(0);f("type",i.type),te("ngModel",i.value)}}function pn(n){return{type:"number",value:k(n)}}function d_(n){return{type:"checkbox",value:k(n)}}function p_(n){return{type:"text",value:k(n)}}function u_(n){return{type:"color",value:k(n)}}var jd=(()=>{let e=class e{constructor(){this.typedSignal=N.required()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-editor-typed-signal-input"]],inputs:{typedSignal:[1,"typedSignal"]},decls:5,vars:2,consts:[[3,"type","ngModel"],[3,"type","ngModel","min"],[3,"ngModelChange","type","ngModel"],[3,"ngModelChange","type","ngModel","min"]],template:function(o,r){if(o&1&&(Re(0),x(1,dP,1,2,"input",0)(2,pP,1,3,"input",1)(3,uP,1,2,"input",0)(4,mP,1,2,"input",0)),o&2){let s,d=Ve(r.typedSignal());c(),M((s=d.type)==="checkbox"?1:s==="number"?2:s==="text"?3:s==="color"?4:-1)}},dependencies:[Zt,li,Kt,Vt,ct],styles:["input[_ngcontent-%COMP%]{width:100px}"]});let n=e;return n})();var m_=(()=>{let e=class e{constructor(){this.addedModifiers=[],this.modifiers={heroBonusAttack:pn(0),heroBonusDefence:pn(0),unitGroupSpeedBonus:pn(0),heroMaxMana:pn(0),resistAll:pn(0),amplifiedTakenMagicDamagePercent:pn(0),cannotBeSlowed:d_(!1),criticalDamageChance:pn(0),criticalDamageMul:pn(0)},this.visibleModifiers=k([]),this.modifiersForm=ae(()=>this.visibleModifiers().map(t=>({modName:t.modifier,label:t.label,value:this.modifiers[t.modifier]}))),this.availableModifiers=ae(()=>e.MODIFIERS_LIST.filter(t=>!this.visibleModifiers().includes(t)))}addModifierOption(t){this.visibleModifiers.update(wt.addItem(t))}removeModifierOption(t){this.visibleModifiers.update(wt.removeItem(t))}removeModifierOptionByModName(t){this.visibleModifiers.update(o=>o.filter(r=>r.modifier!==t))}};e.MODIFIERS_LIST=[{label:"Attack",modifier:"heroBonusAttack"},{label:"Defence",modifier:"heroBonusDefence"},{label:"Speed",modifier:"unitGroupSpeedBonus"},{label:"Max Mana",modifier:"heroMaxMana"},{label:"Resist All",modifier:"resistAll"},{label:"Amplified Taken Magic Damage Percent",modifier:"amplifiedTakenMagicDamagePercent"},{label:"Cannot Be Slowed",modifier:"cannotBeSlowed"}];let n=e;return n})();var $d=class{constructor({gold:e=0,gems:i=0,redCrystals:t=0,wood:o=0}={}){this.gold=k(100),this.wood=k(0),this.gems=k(0),this.crystals=k(0),this.gold.set(e),this.wood.set(o),this.gems.set(i),this.crystals.set(t)}};var zd=function(n){return n[n.TargetedSpell=0]="TargetedSpell",n[n.Trigger=1]="Trigger",n[n.InstantSpell=2]="InstantSpell",n}(zd||{}),Wm=(()=>{let e=class e{constructor(t){this.id=`custom_script_${e.counter}`,this.name=k(`New_Script_${e.counter}`),this.type=k(qd[0]),this.code=k(""),e.counter++,t&&(this.id=t)}static fromSaved(t){let o=new e(t.id);return o.code.set(t.code),o.name.set(t.name),o.type.set(qd.find(r=>r.value===t.type)),o}};e.counter=0;let n=e;return n})(),Wd=(()=>{let e=class e{constructor(t){this.id=`custom_unit_${e.counter}`,this.name=k(`New_Unit_Type_${e.counter}`),this.level=k(1),this.health=k(10),this.damage=k(5),Pl.counter++,t&&(this.id=t)}};e.counter=0;let n=e;return n})(),h_=(()=>{let e=class e{constructor(t){this.id=`custom_item_${Wd.counter}`,this.name=k(`New_Item_Type_${Wd.counter}`),this.icon=k("book"),this.modifiers=new m_,this.resources=new $d({gold:100}),e.counter++,t&&(this.id=t)}};e.counter=0;let n=e;return n})(),Pl=(()=>{let e=class e{constructor(t){this.id=`custom_hero_${e.counter}`,this.assetUrl=k("assets/heroes/hero-melee.png"),this.name=k(`New_Hero_Type_${e.counter}`),this.spells=k([]),this.items=k([]),this.army=k([]),this.maxMana=k(10),this.defence=k(1),this.attack=k(1),this.initialGold=k(1e3),this.initialWood=k(1),this.initialGems=k(0),this.initialCrystals=k(0),e.counter++,t&&(this.id=t)}static fromSaved(t,o){let r=new e(t.id);return r.name.set(t.name),r.attack.set(t.attack),r.defence.set(t.defence),r.assetUrl.set(t.assetUrl),r.spells.set(t.spellIds.map(s=>o.spells.find(d=>d.id===s))),r.initialGold.set(t.gold),r.initialWood.set(t.wood),r.initialGems.set(t.gems),r.initialCrystals.set(t.crystals),r}};e.counter=0;let n=e;return n})(),Kd=(()=>{let e=class e{constructor(t){this.id=`custom_spell_${e.counter}`,this.name=k(`New_Spell_Type_${e.counter}`),this.activationType=k(Yd[0]),this.icon=k("book"),this.connectedScript=k(null),e.counter++,t&&(this.id=t)}static fromSaved(t,o){let r=new e(t.id);return r.name.set(t.name),r.icon.set(t.icon),r.connectedScript.set(o.find(s=>s.id===t.linkedScriptId)??null),r.activationType.set(Yd.find(s=>s.value===t.activationType)),r}};e.counter=0;let n=e;return n})(),zi=function(n){return n.UnitTypes="Units",n.Items="Items",n.Spells="Spells",n.Heroes="Heroes",n.Locations="Locations",n.Factions="Factions",n.Towns="Towns",n}(zi||{}),qd=[{label:"Targeted Spell Script",value:zd.TargetedSpell},{label:"Instant Spell Script",value:zd.InstantSpell},{label:"Trigger Spell",value:zd.Trigger}],Yd=[{label:"Targetable",value:L.Target},{label:"Instant",value:L.Instant},{label:"Passive",value:L.Passive},{label:"Buff",value:L.Buff},{label:"Debuff",value:L.Debuff}];function hP(n,e){if(n&1){let i=I();a(0,"div",3),y("click",function(){w(i);let o=m();return S(o.toggleCollapsed())}),p(1),l()}if(n&2){let i=m();c(),D(" ",i.sectionName()," ")}}function fP(n,e){if(n&1&&(a(0,"div",2)(1,"div",4),p(2),l(),a(3,"div",5),g(4,"mw-editor-typed-signal-input",6),l()()),n&2){let i=e.$implicit;c(2),H(i.name),c(2),f("typedSignal",i.typedSignal)}}function gP(n,e){return{name:n,typedSignal:e}}var Zd=class{get properties(){return this.props()}get propsMap(){return this.props().reduce((e,i)=>(e[i.name]=i.typedSignal,e),{})}constructor(e){this.props=k([]),this.props.set(Object.entries(e).map(([i,t])=>gP(i,t)))}},f_=(()=>{let e=class e{constructor(){this.properties=N.required(),this.sectionName=N(""),this.collapsible=N(!1),this.collapsed=k(!1)}toggleCollapsed(){this.collapsible()&&this.collapsed.update(t=>!t)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-editor-property"]],inputs:{properties:[1,"properties"],sectionName:[1,"sectionName"],collapsible:[1,"collapsible"]},decls:5,vars:3,consts:[[1,"header"],[1,"properties"],[1,"property"],[1,"header",3,"click"],[1,"name"],[1,"value"],[3,"typedSignal"]],template:function(o,r){o&1&&(x(0,hP,2,1,"div",0),a(1,"div",1),P(2,fP,5,2,"div",2,j),l(),g(4,"hr")),o&2&&(M(r.sectionName()?0:-1),c(),me("hidden",r.collapsed()),c(),E(r.properties().properties))},dependencies:[jd],styles:[".header[_ngcontent-%COMP%]{cursor:pointer}.properties[_ngcontent-%COMP%]{display:flex;flex-direction:column}.properties[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.hidden[_ngcontent-%COMP%]{display:none}"]});let n=e;return n})();var g_=(()=>{let e=class e{constructor(){this.locations=k([]),this.properties=new Zd({Width:pn(100),Height:pn(100),Name:p_(`Game_Area_${e.counter}`),Color:u_("red")}),e.counter++}};e.counter=0;let n=e;return n})();var Xr=(()=>{let e=class e{constructor(){this.entitiesRegistries=Ll,this.unitTypes=this.entitiesRegistries.getRegisteredEntitiesMap().get("#unit"),this.itemTypes=this.entitiesRegistries.getRegisteredEntitiesMap().get("#item"),this.spellTypes=this.entitiesRegistries.getRegisteredEntitiesMap().get("#spell"),this.vfxTypes=this.entitiesRegistries.getRegisteredEntitiesMap().get("#vfx"),this.customDefinitions={units:k([]),spells:k([]),heroes:k([]),items:k([])},this.scriptsEditor={scripts:k([]),selectedScript:k(null)},this.entitiesInspector={selectedUnitType:k(null),selectedItemType:k(null),selectedSpellType:k(null),selectedVFX:k(null),selectedCustomSpellType:k(null)},this.selectedScenario=k(null),this.currentScenarioName=k(""),this.entitiesManager={selectedUnitDefinition:k(null),selectedHeroDefinition:k(null),selectedSpellDefinition:k(null),selectedItemDefinition:k(null)},this.areaEditor={areas:k([new g_]),currentArea:k(null)}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=A({token:e,factory:e.\u0275fac});let n=e;return n})();var y_=(()=>{let e=class e{constructor(){this.resources=N.required()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-scenario-resources-editor"]],inputs:{resources:[1,"resources"]},decls:17,vars:4,consts:[[1,"property"],["icon","gold"],["type","number","step","1","min","0",3,"ngModelChange","ngModel"],["icon","wood"],["icon","gems"],["icon","crystals"]],template:function(o,r){o&1&&(p(0,"Resources: "),a(1,"div",0),g(2,"mw-img-icon",1),p(3," Gold: "),a(4,"input",2),ne("ngModelChange",function(d){return ie(r.resources().gold,d)||(r.resources().gold=d),d}),l()(),a(5,"div",0),g(6,"mw-img-icon",3),p(7," Wood: "),a(8,"input",2),ne("ngModelChange",function(d){return ie(r.resources().wood,d)||(r.resources().wood=d),d}),l()(),a(9,"div",0),g(10,"mw-img-icon",4),p(11," Gems: "),a(12,"input",2),ne("ngModelChange",function(d){return ie(r.resources().gems,d)||(r.resources().gems=d),d}),l()(),a(13,"div",0),g(14,"mw-img-icon",5),p(15," Crystals: "),a(16,"input",2),ne("ngModelChange",function(d){return ie(r.resources().crystals,d)||(r.resources().crystals=d),d}),l()()),o&2&&(c(4),te("ngModel",r.resources().gold),c(4),te("ngModel",r.resources().wood),c(4),te("ngModel",r.resources().gems),c(4),te("ngModel",r.resources().crystals))},dependencies:[Zt,li,qr,Kt,Yr,Vt,Ke,Un],styles:[".property[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}"]});let n=e;return n})();function yP(n,e){if(n&1&&(a(0,"mw-dropdown-option",3),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.label)}}function _P(n,e){if(n&1){let i=I();a(0,"div",4),p(1),a(2,"button",5),y("click",function(){let o=w(i).$implicit,r=m();return S(r.modifiers().removeModifierOptionByModName(o.modName))}),p(3,"Remove"),l(),g(4,"mw-editor-typed-signal-input",6),l()}if(n&2){let i=e.$implicit;c(),D(" ",i.label," "),c(3),f("typedSignal",i.value)}}var __=(()=>{let e=class e{constructor(){this.modifiers=N.required()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-scenario-modifiers-editor"]],inputs:{modifiers:[1,"modifiers"]},decls:9,vars:1,consts:[[1,"properties"],[3,"selectedItemChange"],[1,"trigger"],[3,"value"],[1,"property"],[3,"click"],[3,"typedSignal"]],template:function(o,r){o&1&&(p(0,`Modifiers:
`),a(1,"div",0)(2,"mw-dropdown",1),y("selectedItemChange",function(d){return r.modifiers().addModifierOption(d)}),a(3,"div",2),p(4),l(),P(5,yP,2,2,"mw-dropdown-option",3,j),l(),P(7,_P,5,2,"div",4,j),l()),o&2&&(c(4),D(" Select modifier... ",r.modifiers().availableModifiers().length," "),c(),E(r.modifiers().availableModifiers()),c(2),E(r.modifiers().modifiersForm()))},dependencies:[jn,er,Zt,jd],styles:[".properties[_ngcontent-%COMP%]{display:flex;flex-direction:column}.properties[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.properties[_ngcontent-%COMP%]   .property[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100px;min-width:50px}"]});let n=e;return n})();function vP(n,e){if(n&1){let i=I();a(0,"button",2),y("click",function(){let o=w(i).$implicit,r=m();return S(r.activeTab.set(o))}),p(1),l()}if(n&2){let i=e.$implicit,t=m();me("active",t.activeTab()===i),c(),D(" ",i," ")}}function CP(n,e){n&1&&p(0," No Custom Unit Types Defined... ")}function wP(n,e){if(n&1&&p(0),n&2){m();let i=q(2);D(" ",i?i.name():"No Unit Type Selected..."," ")}}function SP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.name()," ")}}function bP(n,e){n&1&&(a(0,"div",7),p(1,"No Unit Types Defined..."),l())}function xP(n,e){if(n&1){let i=I();a(0,"div",9)(1,"div",10),p(2," Name: "),a(3,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.name,o)||(r.name=o),S(o)}),l()(),a(4,"div",10),p(5," Level: "),a(6,"input",12),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.level,o)||(r.level=o),S(o)}),l()(),a(7,"div",10),p(8," Health: "),a(9,"input",13),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.health,o)||(r.health=o),S(o)}),l()(),a(10,"div",10),p(11," Damage: "),a(12,"input",12),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.damage,o)||(r.damage=o),S(o)}),l()()()}if(n&2){m();let i=q(2);c(3),te("ngModel",i.name),c(3),te("ngModel",i.level),c(3),te("ngModel",i.health),c(3),te("ngModel",i.damage)}}function MP(n,e){if(n&1){let i=I();a(0,"div",3),p(1,"Create New Unit Type:"),l(),Re(2),a(3,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedUnitDefinition,o)||(r.selectedUnitDefinition=o),S(o)}),a(4,"div",5),x(5,CP,1,0)(6,wP,1,1),l(),P(7,SP,2,2,"mw-dropdown-option",6,j,!1,bP,2,0,"div",7),l(),a(10,"button",8),y("click",function(){w(i);let o=m();return S(o.addCustomUnitGroup())}),p(11," Add Unit Group "),l(),x(12,xP,13,4,"div",9)}if(n&2){let i=m();c(2);let t=Ve(i.selectedUnitDefinition());c(),te("selectedItem",i.selectedUnitDefinition),c(2),M(i.customUnitDefinitions().length?6:5),c(2),E(i.customUnitDefinitions()),c(5),M(t?12:-1)}}function DP(n,e){n&1&&p(0," No Custom Spell Types Defined... ")}function PP(n,e){if(n&1&&p(0),n&2){m();let i=q(2);D(" ",i?i.name():"No Spell Type Selected..."," ")}}function EP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.name()," ")}}function TP(n,e){n&1&&(a(0,"div",7),p(1,"No Custom Spells Defined..."),l())}function IP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.label)}}function kP(n,e){n&1&&p(0," No scripts created... ")}function AP(n,e){if(n&1&&p(0),n&2){m(2);let i=q(16);D(" ",i.name()," ")}}function OP(n,e){n&1&&p(0," Select a script... ")}function FP(n,e){if(n&1&&x(0,AP,1,1)(1,OP,1,0),n&2){m();let i=q(16);M(i?0:1)}}function RP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.name()," ")}}function BP(n,e){n&1&&(a(0,"div",7),p(1,"No custom scripts created..."),l())}function GP(n,e){if(n&1){let i=I();a(0,"div",9)(1,"div",10),p(2," Name: "),a(3,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.name,o)||(r.name=o),S(o)}),l()(),a(4,"div",10),p(5," Icon: "),a(6,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.icon,o)||(r.icon=o),S(o)}),l()(),a(7,"div",10),p(8," Activation Type: "),a(9,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i),m();let r=q(2);return ie(r.activationType,o)||(r.activationType=o),S(o)}),a(10,"div",5),p(11),l(),P(12,IP,2,2,"mw-dropdown-option",6,j),l()(),a(14,"div",10),p(15," Connected Script: "),Re(16),a(17,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i),m();let r=q(2);return ie(r.connectedScript,o)||(r.connectedScript=o),S(o)}),a(18,"div",5),x(19,kP,1,0)(20,FP,2,1),l(),P(21,RP,2,2,"mw-dropdown-option",6,j,!1,BP,2,0,"div",7),l()()()}if(n&2){m();let i=q(2),t=m();c(3),te("ngModel",i.name),c(3),te("ngModel",i.icon),c(3),te("selectedItem",i.activationType),c(2),D(" ",i.activationType().label," "),c(),E(t.ActivationTypes),c(4),Ve(i.connectedScript()),c(),te("selectedItem",i.connectedScript),c(2),M(t.scripts().length?20:19),c(2),E(t.scripts())}}function LP(n,e){if(n&1){let i=I();a(0,"div",3),p(1,"Spells:"),l(),Re(2),a(3,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedSpellDefinition,o)||(r.selectedSpellDefinition=o),S(o)}),a(4,"div",5),x(5,DP,1,0)(6,PP,1,1),l(),P(7,EP,2,2,"mw-dropdown-option",6,j,!1,TP,2,0,"div",7),l(),a(10,"button",8),y("click",function(){w(i);let o=m();return S(o.addCustomSpellType())}),p(11," Add Spell "),l(),x(12,GP,24,8,"div",9)}if(n&2){let i=m();c(2);let t=Ve(i.selectedSpellDefinition());c(),te("selectedItem",i.selectedSpellDefinition),c(2),M(i.customSpellsDefinitions().length?6:5),c(2),E(i.customSpellsDefinitions()),c(5),M(t?12:-1)}}function NP(n,e){n&1&&p(0," No custom heroes defined... ")}function UP(n,e){n&1&&p(0," Click to select custom hero... ")}function VP(n,e){if(n&1&&p(0),n&2){m(2);let i=q(2);D(" ",i.name()," ")}}function HP(n,e){if(n&1&&x(0,UP,1,0)(1,VP,1,1),n&2){m();let i=q(2);M(i?1:0)}}function jP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D("Hero - ",i.name())}}function $P(n,e){n&1&&(a(0,"div",7),p(1,"Define new hero type..."),l())}function zP(n,e){if(n&1){let i=I();a(0,"div",22),p(1),a(2,"button",24),y("click",function(){let o=w(i).$implicit,r=m(3);return S(r.removeSpellFromHero(o))}),p(3,"remove"),l()()}if(n&2){let i=e.$implicit;c(),D(" Spell - ",i.name()," ")}}function WP(n,e){if(n&1){let i=I();g(0,"img",14),a(1,"div",9)(2,"div",10),p(3," Name: "),a(4,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.name,o)||(r.name=o),S(o)}),l()(),a(5,"div",10),p(6," Asset: "),a(7,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.assetUrl,o)||(r.assetUrl=o),S(o)}),l()(),a(8,"div",10),p(9," Mana: "),a(10,"input",15),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.maxMana,o)||(r.maxMana=o),S(o)}),l()(),a(11,"div",10),p(12," Attack: "),a(13,"input",15),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.attack,o)||(r.attack=o),S(o)}),l()(),a(14,"div",10),p(15," Defence: "),a(16,"input",15),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.defence,o)||(r.defence=o),S(o)}),l()(),a(17,"div",10),g(18,"mw-img-icon",16),p(19," Gold: "),a(20,"input",17),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.initialGold,o)||(r.initialGold=o),S(o)}),l()(),a(21,"div",10),g(22,"mw-img-icon",18),p(23," Wood: "),a(24,"input",17),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.initialWood,o)||(r.initialWood=o),S(o)}),l()(),a(25,"div",10),g(26,"mw-img-icon",19),p(27," Gems: "),a(28,"input",17),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.initialGems,o)||(r.initialGems=o),S(o)}),l()(),a(29,"div",10),g(30,"mw-img-icon",20),p(31," Crystals: "),a(32,"input",17),ne("ngModelChange",function(o){w(i),m();let r=q(2);return ie(r.initialCrystals,o)||(r.initialCrystals=o),S(o)}),l()(),a(33,"div",10),p(34,"Spells:"),l(),a(35,"div",21),P(36,zP,4,1,"div",22,j),l(),a(38,"button",23),y("click",function(){w(i);let o=m(2);return S(o.addSpellFromInspector())}),p(39," Take spell from Inspector "),l()()}if(n&2){m();let i=q(2),t=m();f("src",Rl(i.assetUrl()),wo),c(4),te("ngModel",i.name),c(3),te("ngModel",i.assetUrl),c(3),te("ngModel",i.maxMana),c(3),te("ngModel",i.attack),c(3),te("ngModel",i.defence),c(4),te("ngModel",i.initialGold),c(4),te("ngModel",i.initialWood),c(4),te("ngModel",i.initialGems),c(4),te("ngModel",i.initialCrystals),c(4),E(i.spells()),c(2),f("disabled",!t.spellSelectedInInspector())}}function qP(n,e){if(n&1){let i=I();a(0,"div",3),p(1,"Heroes:"),l(),Re(2),a(3,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedHeroDefinition,o)||(r.selectedHeroDefinition=o),S(o)}),a(4,"div",5),x(5,NP,1,0)(6,HP,2,1),l(),P(7,jP,2,2,"mw-dropdown-option",6,j,!1,$P,2,0,"div",7),l(),a(10,"button",8),y("click",function(){w(i);let o=m();return S(o.addNewHero())}),p(11," Add new Hero "),l(),x(12,WP,40,12)}if(n&2){let i=m();c(2);let t=Ve(i.selectedHeroDefinition());c(),te("selectedItem",i.selectedHeroDefinition),c(2),M(i.customHeroDefinitions().length?6:5),c(2),E(i.customHeroDefinitions()),c(5),M(t?12:-1)}}function YP(n,e){n&1&&p(0," No Custom Items Defined... ")}function KP(n,e){if(n&1&&p(0),n&2){let i,t=m(3);D(" ",(i=t.selectedItemDefinition())==null?null:i.name()," ")}}function ZP(n,e){n&1&&p(0," Select custom item... ")}function XP(n,e){if(n&1&&x(0,KP,1,1)(1,ZP,1,0),n&2){let i=m(2);M(i.selectedItemDefinition()?0:1)}}function QP(n,e){if(n&1&&(a(0,"mw-dropdown-option",6),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.name())}}function JP(n,e){n&1&&(a(0,"div",7),p(1,"No Custom Item Definitions"),l())}function eE(n,e){if(n&1){let i=I();a(0,"div",25)(1,"div",10),p(2," Name: "),a(3,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(11);return ie(r.name,o)||(r.name=o),S(o)}),l()(),a(4,"div",10),p(5," Icon: "),a(6,"input",11),ne("ngModelChange",function(o){w(i),m();let r=q(11);return ie(r.icon,o)||(r.icon=o),S(o)}),l()(),g(7,"mw-scenario-resources-editor",26)(8,"mw-scenario-modifiers-editor",27),l()}if(n&2){m();let i=q(11);c(3),te("ngModel",i.name),c(3),te("ngModel",i.icon),c(),f("resources",i.resources),c(),f("modifiers",i.modifiers)}}function tE(n,e){if(n&1){let i=I();a(0,"div",3),p(1,"Items:"),l(),a(2,"mw-dropdown",4),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedItemDefinition,o)||(r.selectedItemDefinition=o),S(o)}),a(3,"div",5),x(4,YP,1,0)(5,XP,2,1),l(),P(6,QP,2,2,"mw-dropdown-option",6,j,!1,JP,2,0,"div",7),l(),a(9,"button",8),y("click",function(){w(i);let o=m();return S(o.addItemType())}),p(10," Add Custom Item "),l(),Re(11),x(12,eE,9,4,"div",25)}if(n&2){let i=m();c(2),te("selectedItem",i.selectedItemDefinition),c(2),M(i.customItemDefinitions().length?5:4),c(2),E(i.customItemDefinitions()),c(5);let t=Ve(i.selectedItemDefinition());c(),M(t?12:-1)}}var v_=(()=>{let e=class e{constructor(){this.scenarioEditorContext=u(Xr),this.scripts=this.scenarioEditorContext.scriptsEditor.scripts,this.spellSelectedInInspector=this.scenarioEditorContext.entitiesInspector.selectedCustomSpellType,this.customUnitDefinitions=this.scenarioEditorContext.customDefinitions.units,this.customSpellsDefinitions=this.scenarioEditorContext.customDefinitions.spells,this.customHeroDefinitions=this.scenarioEditorContext.customDefinitions.heroes,this.customItemDefinitions=this.scenarioEditorContext.customDefinitions.items,this.selectedUnitDefinition=this.scenarioEditorContext.entitiesManager.selectedUnitDefinition,this.selectedHeroDefinition=this.scenarioEditorContext.entitiesManager.selectedHeroDefinition,this.selectedSpellDefinition=this.scenarioEditorContext.entitiesManager.selectedSpellDefinition,this.selectedItemDefinition=this.scenarioEditorContext.entitiesManager.selectedItemDefinition,this.EntityTab=zi,this.EntityTabs=[zi.UnitTypes,zi.Spells,zi.Items,zi.Heroes,zi.Locations,zi.Factions,zi.Towns],this.ActivationTypes=Yd,this.activeTab=k(zi.UnitTypes)}addCustomUnitGroup(){let t=new Wd;this.customUnitDefinitions.update(wt.addItem(t)),this.selectedUnitDefinition.set(t)}addCustomSpellType(){let t=new Kd;this.customSpellsDefinitions.update(wt.addItem(t)),this.selectedSpellDefinition.set(t)}addNewHero(){let t=new Pl;this.customHeroDefinitions.update(wt.addItem(t)),this.selectedHeroDefinition.set(t)}addSpellFromInspector(){let t=this.spellSelectedInInspector();t&&this.selectedHeroDefinition()?.spells.update(wt.addItem(t))}addItemType(){let t=new h_;this.customItemDefinitions.update(wt.addItem(t)),this.selectedItemDefinition.set(t)}removeSpellFromHero(t){this.selectedHeroDefinition()?.spells.update(wt.removeItem(t))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-scenario-entities-manager"]],decls:7,vars:1,consts:[[1,"header-tabs"],[1,"tab",3,"active"],[1,"tab",3,"click"],[1,"header"],[3,"selectedItemChange","selectedItem"],[1,"trigger"],[3,"value"],[1,"empty"],["mw-main-button","",3,"click"],[1,"properties"],[1,"property"],["type","text",3,"ngModelChange","ngModel"],["type","number","min","1",3,"ngModelChange","ngModel"],["type","number","min","1","step","1",3,"ngModelChange","ngModel"],["alt","No Image Found by given asset url",1,"portrait",3,"src"],["type","number","step","1","min","1",3,"ngModelChange","ngModel"],["icon","gold"],["type","number","step","1","min","0",3,"ngModelChange","ngModel"],["icon","wood"],["icon","gems"],["icon","crystals"],[1,"list"],[1,"item"],[3,"click","disabled"],[3,"click"],[1,"section"],[3,"resources"],[3,"modifiers"]],template:function(o,r){if(o&1&&(a(0,"div",0),P(1,vP,2,3,"button",1,j),l(),x(3,MP,13,5)(4,LP,13,5)(5,qP,13,5)(6,tE,13,5)),o&2){let s;c(),E(r.EntityTabs),c(2),M((s=r.activeTab())===r.EntityTab.UnitTypes?3:s===r.EntityTab.Spells?4:s===r.EntityTab.Heroes?5:s===r.EntityTab.Items?6:-1)}},dependencies:[jn,er,Zt,li,qr,Kt,Yr,Vt,Ke,Un,ee,y_,__],styles:[".header-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;color:#fff}.header-tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{padding:3px;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.header-tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:hover{background:#00000052}.header-tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{background:orange}.empty[_ngcontent-%COMP%]{font-size:10px;padding:10px}.property[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1px}.list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;background:#0000004b;padding:0 5px;font-size:11px;border-radius:10px}.portrait[_ngcontent-%COMP%]{height:120px;width:auto}"]});let n=e;return n})();function iE(n,e){if(n&1&&g(0,"div",1),n&2){m();let i=q(0);se("width",i.properties.propsMap.Width.value(),"px")("height",i.properties.propsMap.Height.value(),"px")("background",i.properties.propsMap.Color.value())}}var C_=(()=>{let e=class e{constructor(){this.context=u(Xr),this.rootArea=this.context.areaEditor.currentArea}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-scenario-area-editor"]],decls:2,vars:2,consts:[[1,"area",3,"width","height","background"],[1,"area"]],template:function(o,r){if(o&1&&(Re(0),x(1,iE,1,6,"div",0)),o&2){let s=Ve(r.rootArea());c(),M(s?1:-1)}},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.area[_ngcontent-%COMP%]{opacity:.5}"]});let n=e;return n})();var nE=["vfxRef"],oE=()=>[import("./chunk-ZTTH32ZY.js").then(n=>n.ScriptEditorComponent)];function rE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),H(i.properties.propsMap.Name.value())}}function sE(n,e){if(n&1&&g(0,"mw-editor-property",15),n&2){m();let i=q(12);f("collapsible",!0)("properties",i.properties)}}function aE(n,e){if(n&1&&p(0),n&2){let i,t=m(2);Ee(" ",(i=t.selectedUnitType())==null||i.faction==null?null:i.faction.title," - ",(i=t.selectedUnitType())==null?null:i.name," ")}}function lE(n,e){n&1&&p(0," Select Unit Type... ")}function cE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),Ee(" ",i.faction.title," - ",i.name," ")}}function dE(n,e){if(n&1&&(g(0,"mw-ra-icon",23),p(1)),n&2){m();let i=q(29);f("icon",i.icon.icon),c(),D(" Item - ",i.name," ")}}function pE(n,e){n&1&&p(0," Select Item Type... ")}function uE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),g(1,"mw-ra-icon",23),p(2),l()),n&2){let i=e.$implicit;f("value",i),c(),f("icon",i.icon.icon),c(),D(" Item - ",i.name," ")}}function mE(n,e){if(n&1&&(g(0,"mw-ra-icon",23),p(1)),n&2){m();let i=q(40);f("icon",i.icon.icon),c(),Ee(" Spell - ",i.activationType," - ",i.name," ")}}function hE(n,e){n&1&&p(0," Select Spell Type... ")}function fE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),g(1,"mw-ra-icon",23),p(2),l()),n&2){let i=e.$implicit;f("value",i),c(),f("icon",i.icon.icon),c(),Ee(" Spell - ",i.activationType," - ",i.name," ")}}function gE(n,e){if(n&1&&(g(0,"mw-ra-icon",23),p(1)),n&2){m();let i=q(51);f("icon",i.icon()),c(),Ee(" Spell - ",i.activationType().label," - ",i.name()," ")}}function yE(n,e){n&1&&p(0," Select Spell Type... ")}function _E(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),g(1,"mw-ra-icon",23),p(2),l()),n&2){let i=e.$implicit;f("value",i),c(),f("icon",i.icon()),c(),Ee(" Spell - ",i.activationType().label," - ",i.name()," ")}}function vE(n,e){if(n&1&&p(0),n&2){m();let i=q(62);D(" Vfx ",i.id," ")}}function CE(n,e){n&1&&p(0," Select Vfx... ")}function wE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.id," ")}}function SE(n,e){n&1&&g(0,"mw-vfx-element",null,5)}function bE(n,e){n&1&&p(0," No scripts created... ")}function xE(n,e){if(n&1&&p(0),n&2){m(2);let i=q(85);D(" ",i==null?null:i.name()," ")}}function ME(n,e){n&1&&p(0," Select a script... ")}function DE(n,e){if(n&1&&x(0,xE,1,1)(1,ME,1,0),n&2){m();let i=q(85);M(i?0:1)}}function PE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.name()," ")}}function EE(n,e){n&1&&(a(0,"div",22),p(1,"No Custom Scripts Defined..."),l())}function TE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.label," ")}}function IE(n,e){if(n&1){let i=I();a(0,"mw-script-editor",26),ne("codeChange",function(o){w(i),m(2);let r=q(85);return ie(r.code,o)||(r.code=o),S(o)}),l()}if(n&2){m(2);let i=q(85);te("code",i.code)}}function kE(n,e){if(n&1){let i=I();a(0,"div",24),p(1," Script Name: "),a(2,"input",25),ne("ngModelChange",function(o){w(i),m();let r=q(85);return ie(r.name,o)||(r.name=o),S(o)}),l()(),a(3,"div",24),p(4," Script Type: "),a(5,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i),m();let r=q(85);return ie(r.type,o)||(r.type=o),S(o)}),a(6,"div",13),p(7),l(),P(8,TE,2,2,"mw-dropdown-option",14,j),l()(),K(10,IE,1,1),Ph(11,10,oE),Eh()}if(n&2){m();let i=q(85),t=m();c(2),te("ngModel",i.name),c(3),te("selectedItem",i.type),c(2),D(" ",i.type().label," "),c(),E(t.ScriptTypes)}}function AE(n,e){if(n&1){let i=I();a(0,"mw-panel-container"),g(1,"mw-scenario-area-editor"),a(2,"mw-panel",9)(3,"div",10),g(4,"mw-scenario-entities-manager"),l()(),a(5,"mw-panel",11)(6,"div",10)(7,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.currentArea,o)||(r.currentArea=o),S(o)}),a(8,"div",13),p(9,"Select Area"),l(),P(10,rE,2,2,"mw-dropdown-option",14,j),l(),Re(12),x(13,sE,1,2,"mw-editor-property",15),l()(),a(14,"mw-panel",16)(15,"div",10)(16,"div",17)(17,"div",18),p(18,"Units"),l(),a(19,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedUnitType,o)||(r.selectedUnitType=o),S(o)}),a(20,"div",13),x(21,aE,1,2)(22,lE,1,0),l(),P(23,cE,2,3,"mw-dropdown-option",14,j),l(),p(25),l(),a(26,"div",17)(27,"div",18),p(28,"Items"),l(),Re(29),a(30,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedItemType,o)||(r.selectedItemType=o),S(o)}),a(31,"div",13),x(32,dE,2,2)(33,pE,1,0),l(),P(34,uE,3,3,"mw-dropdown-option",14,j),l(),p(36),l(),a(37,"div",17)(38,"div",18),p(39,"Spells"),l(),Re(40),a(41,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedSpellType,o)||(r.selectedSpellType=o),S(o)}),a(42,"div",13),x(43,mE,2,3)(44,hE,1,0),l(),P(45,fE,3,4,"mw-dropdown-option",14,j),l(),p(47),l(),a(48,"div",17)(49,"div",18),p(50,"Custom Spells"),l(),Re(51),a(52,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedCustomSpellType,o)||(r.selectedCustomSpellType=o),S(o)}),a(53,"div",13),x(54,gE,2,3)(55,yE,1,0),l(),P(56,_E,3,4,"mw-dropdown-option",14,j),l(),p(58),l(),a(59,"div",17)(60,"div",18),p(61,"VFX"),l(),Re(62),a(63,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedVFX,o)||(r.selectedVFX=o),S(o)}),a(64,"div",13),x(65,vE,1,1)(66,CE,1,0),l(),P(67,wE,2,2,"mw-dropdown-option",14,j),l(),p(69),l()()(),a(70,"mw-panel",19),p(71," VFX Preview "),a(72,"div",20),x(73,SE,2,0,"mw-vfx-element"),l()(),a(74,"mw-panel",21)(75,"div",10)(76,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.selectedScript,o)||(r.selectedScript=o),S(o)}),a(77,"div",13),x(78,bE,1,0)(79,DE,2,1),l(),P(80,PE,2,2,"mw-dropdown-option",14,j,!1,EE,2,0,"div",22),l(),a(83,"button",7),y("click",function(){w(i);let o=m();return S(o.addNewScript())}),p(84," Add Script "),l(),Re(85),x(86,kE,13,3),l()()()}if(n&2){let i,t,o=m();c(2),f("width",300)("height",400),c(5),te("selectedItem",o.currentArea),c(3),E(o.areas()),c(2);let r=Ve(o.currentArea());c(),M(r?13:-1),c(),f("height",300)("width",250)("xPosition",320),c(5),te("selectedItem",o.selectedUnitType),c(2),M(o.selectedUnitType()?21:22),c(2),E(o.unitTypes),c(2),D(" ",(i=o.selectedUnitType())==null?null:i.id," "),c(4);let s=Ve(o.selectedItemType());c(),te("selectedItem",o.selectedItemType),c(2),M(s?32:33),c(2),E(o.itemTypes),c(2),D(" ",(t=o.selectedItemType())==null?null:t.id," "),c(4);let d=Ve(o.selectedSpellType());c(),te("selectedItem",o.selectedSpellType),c(2),M(d?43:44),c(2),E(o.spellTypes),c(2),D(" ",d==null?null:d.id," "),c(4);let h=Ve(o.selectedCustomSpellType());c(),te("selectedItem",o.selectedCustomSpellType),c(2),M(h?54:55),c(2),E(o.customSpellsDefinitions()),c(2),D(" ",h==null?null:h.id," "),c(4);let _=Ve(o.selectedVFX());c(),te("selectedItem",o.selectedVFX),c(2),M(_?65:66),c(2),E(o.vfxTypes),c(2),D(" ",_==null?null:_.id," "),c(),f("height",220)("width",220)("xPosition",320)("yPosition",320),c(3),M(_?73:-1),c(),f("height",300)("width",660)("xPosition",800),c(2),te("selectedItem",o.selectedScript),c(2),M(o.scripts().length?79:78),c(2),E(o.scripts()),c(5);let C=Ve(o.selectedScript());c(),M(C?86:-1)}}function OE(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",27),p(2,"New scenario"),l(),a(3,"div",28),p(4," Scenario Name: "),a(5,"input",25),ne("ngModelChange",function(o){w(i);let r=m();return ie(r.newScenarioName,o)||(r.newScenarioName=o),S(o)}),l()(),a(6,"div",29)(7,"button",8),y("click",function(){w(i);let o=m(),r=ce(15);return o.addNewScenario(),r.close(),S(o.newScenarioName.set(""))}),p(8," Create "),l(),a(9,"button",7),y("click",function(){w(i);let o=m();return ce(15).close(),S(o.newScenarioName.set(""))}),p(10," Dismiss "),l()()()}if(n&2){let i=m();c(5),te("ngModel",i.newScenarioName),c(2),f("disabled",!i.newScenarioName())}}function FE(n,e){if(n&1&&p(0),n&2){m();let i=q(5);D(" ",i.name," ")}}function RE(n,e){n&1&&p(0," No scenarios created... ")}function BE(n,e){n&1&&p(0," No scenario selected... ")}function GE(n,e){if(n&1&&x(0,RE,1,0)(1,BE,1,0),n&2){let i=m(2);M(i.scenarios().length?1:0)}}function LE(n,e){if(n&1&&(a(0,"mw-dropdown-option",14),p(1),l()),n&2){let i=e.$implicit;f("value",i),c(),D(" ",i.name," ")}}function NE(n,e){n&1&&(a(0,"div",22),p(1,"No Scenarios Created..."),l())}function UE(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",27),p(2,"Select Scenario"),l(),a(3,"div",28),p(4," Your unsaved changes in current scenario might get lost. "),Re(5),a(6,"mw-dropdown",12),ne("selectedItemChange",function(o){w(i);let r=m();return ie(r.unconfirmedSelectedScenario,o)||(r.unconfirmedSelectedScenario=o),S(o)}),a(7,"div",13),x(8,FE,1,1)(9,GE,2,1),l(),P(10,LE,2,2,"mw-dropdown-option",14,j,!1,NE,2,0,"div",22),l()(),a(13,"div",29)(14,"button",8),y("click",function(){w(i);let o=m();return ce(18).close(),S(o.onScenarioChanged(o.unconfirmedSelectedScenario()))}),p(15," Open "),l(),a(16,"button",7),y("click",function(){w(i);let o=m();return ce(18).close(),S(o.unconfirmedSelectedScenario.set(null))}),p(17," Dismiss "),l()()()}if(n&2){let i=m();c(5);let t=Ve(i.unconfirmedSelectedScenario());c(),te("selectedItem",i.unconfirmedSelectedScenario),c(2),M(t?8:9),c(2),E(i.scenarios()),c(4),f("disabled",!i.unconfirmedSelectedScenario())}}function VE(n,e){if(n&1){let i=I();p(0," Selected Scenario Name: "),a(1,"input",25),ne("ngModelChange",function(o){w(i);let r=m(2);return ie(r.currentScenarioName,o)||(r.currentScenarioName=o),S(o)}),l()}if(n&2){let i=m(2);c(),te("ngModel",i.currentScenarioName)}}function HE(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",27),p(2,"Edit scenario"),l(),a(3,"div",28),x(4,VE,2,1),l(),a(5,"div",29)(6,"button",8),y("click",function(){w(i);let o=m();return ce(21).close(),S(o.saveScenario())}),p(7," Apply "),l(),a(8,"button",7),y("click",function(){w(i),m();let o=ce(21);return S(o.close())}),p(9," Dismiss "),l()()()}if(n&2){let i=m();c(4),M(i.selectedScenario()?4:-1),c(2),f("disabled",!i.currentScenarioName())}}function jE(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",27),p(2,"Go to main screen"),l(),a(3,"div",28),p(4,"Are you sure you want to leave? Unsaved progress will be lost."),l(),a(5,"div",29)(6,"button",7),y("click",function(){w(i);let o=m();return ce(24).close(),S(o.goToMainScreen())}),p(7," Go to main screen "),l(),a(8,"button",7),y("click",function(){w(i),m();let o=ce(24);return S(o.close())}),p(9," Cancel "),l()()()}}function $E(n,e){if(n&1){let i=I();a(0,"mw-popup-base-content")(1,"div",27),p(2,"Saving scenario"),l(),a(3,"div",28),p(4,"Are you sure you want to save changes in this scenario?"),l(),a(5,"div",29)(6,"button",7),y("click",function(){w(i);let o=m();return ce(27).close(),S(o.saveScenario())}),p(7," Confirm "),l(),a(8,"button",7),y("click",function(){w(i),m();let o=ce(27);return S(o.close())}),p(9," Cancel "),l()()()}}var Xd=(()=>{let e=class e{constructor(){this.events=u(oe),this.scenarioEditorContext=u(Xr),this.scenarios=k([]),this.activeTab=k(zi.UnitTypes),this.vfxElemRef=It("vfxRef"),this.unitTypes=this.scenarioEditorContext.unitTypes,this.itemTypes=this.scenarioEditorContext.itemTypes,this.spellTypes=this.scenarioEditorContext.spellTypes,this.vfxTypes=this.scenarioEditorContext.vfxTypes,this.scripts=this.scenarioEditorContext.scriptsEditor.scripts,this.currentArea=this.scenarioEditorContext.areaEditor.currentArea,this.areas=this.scenarioEditorContext.areaEditor.areas,this.selectedUnitType=this.scenarioEditorContext.entitiesInspector.selectedUnitType,this.selectedItemType=this.scenarioEditorContext.entitiesInspector.selectedItemType,this.selectedSpellType=this.scenarioEditorContext.entitiesInspector.selectedSpellType,this.selectedVFX=this.scenarioEditorContext.entitiesInspector.selectedVFX,this.selectedCustomSpellType=this.scenarioEditorContext.entitiesInspector.selectedCustomSpellType,this.selectedScenario=this.scenarioEditorContext.selectedScenario,this.unconfirmedSelectedScenario=k(null),this.ScriptTypes=qd,this.currentScenarioName=this.scenarioEditorContext.currentScenarioName,this.newScenarioName=k(""),this.selectedScript=this.scenarioEditorContext.scriptsEditor.selectedScript,this.customUnitDefinitions=this.scenarioEditorContext.customDefinitions.units,this.customSpellsDefinitions=this.scenarioEditorContext.customDefinitions.spells,this.customHeroDefinitions=this.scenarioEditorContext.customDefinitions.heroes;let t=JSON.parse(localStorage.getItem("scenarios"));this.scenarios.set(t??[]),ss(()=>{let o=this.vfxElemRef(),r=this.selectedVFX();!o||!r||(o.clearAnimation(),o.playAnimation(r,{iterations:1/0}))})}addNewScenario(){let t={customEntities:[],customScripts:[],customSpells:[],customHeroes:[],id:crypto.randomUUID(),locations:[],name:this.newScenarioName()};this.scenarios.update(wt.addItem(t)),console.log(t),this.onScenarioChanged(t)}onScenarioChanged(t){if(console.log(t),!t)return;this.selectedScenario.set(t),this.selectedCustomSpellType.set(null),this.scenarioEditorContext.entitiesManager.selectedHeroDefinition.set(null),this.scenarioEditorContext.entitiesManager.selectedSpellDefinition.set(null),this.scenarioEditorContext.entitiesManager.selectedUnitDefinition.set(null),this.selectedScript.set(null);let o=t.customScripts.map(r=>Wm.fromSaved(r));this.scripts.set(o),this.customSpellsDefinitions.set(t.customSpells.map(r=>Kd.fromSaved(r,o))),this.customHeroDefinitions.set((t.customHeroes??[]).map(r=>Pl.fromSaved(r,{spells:this.customSpellsDefinitions()}))),this.currentScenarioName.set(t.name)}addNewScript(){let t=new Wm;this.scripts.update(wt.addItem(t)),this.selectedScript.set(t)}goToMainScreen(){this.events.dispatch(Li())}saveScenario(){let t=this.scenarios(),o=this.selectedScenario();if(!o)return;let r={id:o.id,name:this.currentScenarioName(),customEntities:[],customScripts:this.scripts().map(h=>({code:h.code(),id:h.id,name:h.name(),type:h.type().value})),customHeroes:this.customHeroDefinitions().map(h=>({id:h.id,name:h.name(),assetUrl:h.assetUrl(),maxMana:h.maxMana(),attack:h.attack(),defence:h.defence(),gold:h.initialGold(),wood:h.initialWood(),gems:h.initialGems(),crystals:h.initialCrystals(),spellIds:h.spells().map(_=>_.id),itemIds:[]})),customSpells:this.customSpellsDefinitions().map(h=>({id:h.id,name:h.name(),icon:h.icon(),activationType:h.activationType().value,linkedScriptId:h.connectedScript()?.id})),locations:[]};z.removeItem(t,r)||t.push(r),z.removeItemWith(this.scenarios(),h=>h.id===r.id)||this.scenarios.update(wt.addItem(r)),localStorage.setItem("scenarios",JSON.stringify(t))}testScenario(){let t=this.customSpellsDefinitions().map((r,s)=>{let d=new Function("events","actions","spellInstance","target","vfx",r.connectedScript()?.code()||"");return Z({id:`#spell-${r.id}`,activationType:r.activationType().value,name:r.name(),icon:{icon:r.icon()},getDescription(){return{descriptions:["Custom Ability",r.name()]}},config:{init({events:h,actions:_,spellInstance:C,vfx:O}){h.on({PlayerTargetsSpell({target:R}){d(h,_,C,R,O)}})}}})}),o=this.customHeroDefinitions().map((r,s)=>{let d=r.spells().map(h=>`#spell-${h.id}`);return rt.createHero({id:`#hero-${r.id}`,name:r.name(),items:[],abilities:d,army:[{minUnitGroups:1,maxUnitGroups:1,units:[["#unit-h00",40,40,1]]}],generalDescription:U(""),image:r.assetUrl(),stats:{baseAttack:r.attack(),baseDefence:r.defence(),mana:r.maxMana()},resources:{gems:r.initialGems(),gold:r.initialGold(),redCrystals:r.initialCrystals(),wood:r.initialWood()}})});this.events.dispatch(vr())}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-scenario-editor-screen"]],viewQuery:function(o,r){o&1&&Tt(r.vfxElemRef,nE,5),o&2&&ei()},features:[et([Xr])],decls:29,vars:4,consts:[["newScenarioDialog",""],["selectScenarioDialog",""],["editScenarioDialog",""],["leaveToMainScreenDialog",""],["saveDialog",""],["vfxRef",""],[1,"bar"],["mw-main-button","",3,"click"],["mw-main-button","",3,"click","disabled"],["title","Entities Manager",3,"width","height"],[1,"panel"],["title","Area Editor"],[3,"selectedItemChange","selectedItem"],[1,"trigger"],[3,"value"],["sectionName","Area Properties",3,"collapsible","properties"],["title","Entities Inspector",3,"height","width","xPosition"],[1,"section"],[1,"header"],["title","VFX Editor",3,"height","width","xPosition","yPosition"],[1,"centered"],["title","Scripts Editor",3,"height","width","xPosition"],[1,"empty"],[3,"icon"],[1,"property"],["type","text",3,"ngModelChange","ngModel"],[3,"codeChange","code"],["popupHeader",""],["popupContent",""],["popupButtons",""]],template:function(o,r){if(o&1){let s=I();a(0,"div",6)(1,"button",7),y("click",function(){w(s);let h=ce(15);return S(h.open())}),p(2," New Scenario "),l(),a(3,"button",7),y("click",function(){w(s);let h=ce(18);return S(h.open())}),p(4," Open Scenario "),l(),a(5,"button",8),y("click",function(){w(s);let h=ce(27);return S(h.open())}),p(6," Save Scenario "),l(),a(7,"button",8),y("click",function(){w(s);let h=ce(21);return S(h.open())}),p(8," Edit Scenario "),l(),a(9,"button",8),y("click",function(){return w(s),S(r.testScenario())}),p(10," Test Scenario "),l(),a(11,"button",7),y("click",function(){w(s);let h=ce(24);return S(h.open())}),p(12," Back to main screen "),l()(),x(13,AE,87,40,"mw-panel-container"),a(14,"mw-local-dialog",null,0),K(16,OE,11,2,"ng-template"),l(),a(17,"mw-local-dialog",null,1),K(19,UE,18,5,"ng-template"),l(),a(20,"mw-local-dialog",null,2),K(22,HE,10,2,"ng-template"),l(),a(23,"mw-local-dialog",null,3),K(25,jE,10,0,"ng-template"),l(),a(26,"mw-local-dialog",null,4),K(28,$E,10,0,"ng-template"),l()}o&2&&(c(5),f("disabled",!r.selectedScenario()),c(2),f("disabled",!r.selectedScenario()),c(2),f("disabled",!r.selectedScenario()),c(4),M(r.selectedScenario()?13:-1))},dependencies:[Ke,Hn,Ce,ee,we,Zt,li,Kt,Vt,l_,c_,jn,er,v_,Od,C_,f_],styles:["[_nghost-%COMP%]{position:fixed;inset:0;display:block}.header-tabs[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;color:#fff}.header-tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{padding:3px;font-size:12px;cursor:pointer;-webkit-user-select:none;user-select:none}.header-tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]:hover{background:#00000052}.header-tabs[_ngcontent-%COMP%]   .tab.active[_ngcontent-%COMP%]{background:orange}.empty[_ngcontent-%COMP%]{font-size:10px;padding:10px}.property[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.centered[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;margin-top:60px}mw-popup-base-content[_ngcontent-%COMP%]{background:#fff}.bar[_ngcontent-%COMP%]{display:flex}"]});let n=e;return n})();function WE(n,e){if(n&1){let i=I();a(0,"button",0),y("click",function(){w(i);let o=m();return S(o.tryConnect())}),p(1," Connect "),l()}}var Qd=(()=>{let e=class e{constructor(){this.events=u(oe),this.serverIPAddress=k("")}toMainScreen(){this.events.dispatch(Li())}tryConnect(){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-multiplayer-screen"]],decls:5,vars:2,consts:[["mw-main-button","",3,"click"],["type","text",3,"ngModelChange","ngModel"],["mw-main-button",""]],template:function(o,r){o&1&&(a(0,"button",0),y("click",function(){return r.toMainScreen()}),p(1,` Back to main screen
`),l(),p(2," Multiplayer: "),a(3,"input",1),ne("ngModelChange",function(d){return ie(r.serverIPAddress,d)||(r.serverIPAddress=d),d}),l(),x(4,WE,2,0,"button",2)),o&2&&(c(3),te("ngModel",r.serverIPAddress),c(),M(r.serverIPAddress()?4:-1))},dependencies:[Ke,ee,Zt,li,Kt,Vt],encapsulation:2});let n=e;return n})();function YE(n,e){if(n&1){let i=I();g(0,"mw-player-resources",0),a(1,"div",1)(2,"mw-round-icon-btn",2),y("click",function(){w(i);let o=m();return S(o.openMainMenu())}),l()()}}function KE(n,e){n&1&&g(0,"mw-main-screen")}function ZE(n,e){n&1&&g(0,"mw-new-game-screen")}function XE(n,e){n&1&&g(0,"mw-gameboard")}function QE(n,e){n&1&&g(0,"mw-structures-view")}function JE(n,e){n&1&&g(0,"mw-town-view")}function eT(n,e){n&1&&g(0,"mw-sandbox-mode-screen")}function tT(n,e){n&1&&g(0,"mw-scenario-editor-screen")}function iT(n,e){n&1&&g(0,"mw-multiplayer-screen")}var Qr=class Qr extends Te(){constructor(){super(...arguments),this.cdr=An(),this.resourceViews=[At.Battleground,At.Structures,At.Town],this.currentView=At.MainScreen,this.viewTypes=At}openMainMenu(){this.events.dispatch(Sr())}navigateToView({view:e}){this.currentView=e}initScreen(){this.events.dispatch(Ni({view:At.MainScreen}))}openMultiplayer(){this.events.dispatch(Ni({view:At.Multiplayer}))}openMewGameScreen(){this.events.dispatch(Ni({view:At.NewGame}))}openMapStructuresScreen(){this.events.dispatch(Ni({view:At.Structures}))}playerAcceptsFight(){this.events.dispatch(Ni({view:At.Battleground})),this.cdr.detectChanges()}openSandboxMode(){this.events.dispatch(Ni({view:At.SandboxMode})),this.cdr.detectChanges()}openScenarioMode(){this.events.dispatch(Ni({view:At.ScenarioMode})),this.cdr.detectChanges()}structIsCompleted(e){e.struct.isInactive=!0,this.events.dispatch(Ni({view:At.Structures})),this.events.dispatch(ba({struct:e.struct}))}displayTown(){this.currentView=At.Town}};Qr.\u0275fac=(()=>{let e;return function(t){return(e||(e=W(Qr)))(t||Qr)}})(),Qr.\u0275cmp=v({type:Qr,selectors:[["mw-view-control"]],standalone:!1,features:[V],decls:10,vars:2,consts:[[1,"resources-panel"],[1,"menu-panel"],["mwActionHint","Main Menu","icon","repair",3,"click"]],template:function(i,t){if(i&1&&(x(0,YE,3,0),x(1,KE,1,0,"mw-main-screen")(2,ZE,1,0,"mw-new-game-screen")(3,XE,1,0,"mw-gameboard")(4,QE,1,0,"mw-structures-view")(5,JE,1,0,"mw-town-view")(6,eT,1,0,"mw-sandbox-mode-screen")(7,tT,1,0,"mw-scenario-editor-screen")(8,iT,1,0,"mw-multiplayer-screen"),g(9,"mw-event-feed")),i&2){let o;M(t.resourceViews.includes(t.currentView)?0:-1),c(),M((o=t.currentView)===t.viewTypes.MainScreen?1:o===t.viewTypes.NewGame?2:o===t.viewTypes.Battleground?3:o===t.viewTypes.Structures?4:o===t.viewTypes.Town?5:o===t.viewTypes.SandboxMode?6:o===t.viewTypes.ScenarioMode?7:o===t.viewTypes.Multiplayer?8:-1)}},dependencies:[Yt,Qa,Hc,Jo,Fm,J0,Ly,im,Om,Ny,Xd,Qd],styles:[".resources-panel[_ngcontent-%COMP%]{position:fixed;left:0;top:0;display:flex;flex-direction:column;width:148px;padding:8px;z-index:1}mw-event-feed[_ngcontent-%COMP%]{position:fixed;right:50%;bottom:12%;max-width:400px;z-index:10000}.menu-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;padding:7px}"]});var gi=Qr;F([Y(Ni)],gi.prototype,"navigateToView",null);F([ge(Li)],gi.prototype,"initScreen",null);F([ge(Ea)],gi.prototype,"openMultiplayer",null);F([ge(vr)],gi.prototype,"openMewGameScreen",null);F([ge(br)],gi.prototype,"openMapStructuresScreen",null);F([ge(hr)],gi.prototype,"playerAcceptsFight",null);F([ge(Da)],gi.prototype,"openSandboxMode",null);F([ge(Pa)],gi.prototype,"openScenarioMode",null);F([Y(to)],gi.prototype,"structIsCompleted",null);F([ge(ha)],gi.prototype,"displayTown",null);var oT=["hintsContainer"];function rT(n,e){if(n&1&&g(0,"mw-action-card",2),n&2){let i=e.$implicit;f("actionCard",i)}}var w_=[qt,ln,uo,Nr,Ss,po,$i,Nt,xn,Bt,P0],S_=(()=>{let e=class e{constructor(t,o){this.hintsService=t,this.events=o,this.actionCards=[If,kf,Af,Tf,Pf,Va,Df,so,Ef],this.injectGlobalServices()}ngOnInit(){this.hintsService.containerRef=this.hintsContainer}ngAfterViewInit(){this.events.dispatch(pa())}injectGlobalServices(){w_.forEach(t=>u(t))}};e.\u0275fac=function(o){return new(o||e)(G(ys),G(oe))},e.\u0275cmp=v({type:e,selectors:[["app-root"]],viewQuery:function(o,r){if(o&1&&Et(oT,7),o&2){let s;_t(s=vt())&&(r.hintsContainer=s.first)}},standalone:!1,features:[et(w_)],decls:10,vars:0,consts:[["hintsContainer",""],[1,"test",2,"display","none"],[3,"actionCard"]],template:function(o,r){o&1&&(g(0,"mw-view-control")(1,"mw-popup-container")(2,"mw-hints-container",null,0)(4,"mw-vfx-layer")(5,"mw-custom-cursor")(6,"mw-shared-templates"),a(7,"div",1),P(8,rT,1,1,"mw-action-card",2,le),l()),o&2&&(c(8),E(r.actionCards))},dependencies:[gi,Ar,nl,al,Za,kc,Dc],styles:[".test[_ngcontent-%COMP%]{position:absolute;left:100px;top:100px;display:flex;gap:12px;max-width:1000px;flex-wrap:wrap}"]});let n=e;return n})();function sT(n,e){n&1&&g(0,"mw-ra-icon",2)}function aT(n,e){if(n&1){let i=I();a(0,"mw-spell-button",4),y("clicked",function(){let o=w(i).$implicit,r=m();return S(r.onAbilityClick(o))}),l()}if(n&2){let i=e.$implicit,t=m();f("spell",i)("player",t.currentPlayer)("hero",t.currentPlayer.hero)("disabled",t.currentPlayer.hero.stats.currentMana<i.currentManaCost||t.curPlayerState.state.get().areSpellsOnCooldown||!!i.cooldown)("isActive",t.curPlayerState.state.get().currentSpell===i)}}var qm=(()=>{let e=class e{constructor(t,o){this.players=t,this.curPlayerState=o,this.currentPlayer=this.players.getCurrentPlayer()}onAbilityClick(t){t.currentManaCost>this.currentPlayer.hero.stats.currentMana||this.curPlayerState.state.get().areSpellsOnCooldown||t.cooldown||this.curPlayerState.state.get().playerCurrentState!==Je.WaitsForTurn&&this.curPlayerState.onSpellClick(t)}};e.\u0275fac=function(o){return new(o||e)(G($),G(Dt))},e.\u0275cmp=v({type:e,selectors:[["mw-battle-hero-abilities"]],standalone:!1,decls:7,vars:2,consts:[[1,"abilities-list"],[1,"cd-icon"],["icon","hourglass"],[3,"spell","player","hero","disabled","isActive"],[3,"clicked","spell","player","hero","disabled","isActive"]],template:function(o,r){o&1&&(a(0,"div"),p(1),l(),a(2,"div",0)(3,"div",1),x(4,sT,1,0,"mw-ra-icon",2),l(),P(5,aT,1,5,"mw-spell-button",3,le),l()),o&2&&(c(),D(" ",r.curPlayerState.state.get().playerCurrentState,`
`),c(3),M(r.curPlayerState.state.get().areSpellsOnCooldown?4:-1),c(),E(r.currentPlayer.hero.spells))},styles:[".abilities-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative;width:56px}.cd-icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:-27px;margin-top:-25%;font-size:24px}"]});let n=e;return n})();var lT=["historyLog"],Jd=n=>({log:n});function cT(n,e){n&1&&We(0)}function dT(n,e){if(n&1&&K(0,cT,1,0,"ng-container",8),n&2){let i=m().$implicit;m();let t=ce(7);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Jd,i))}}function pT(n,e){n&1&&We(0)}function uT(n,e){if(n&1&&K(0,pT,1,0,"ng-container",8),n&2){let i=m().$implicit;m();let t=ce(13);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Jd,i))}}function mT(n,e){n&1&&We(0)}function hT(n,e){if(n&1&&K(0,mT,1,0,"ng-container",8),n&2){let i=m().$implicit;m();let t=ce(11);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Jd,i))}}function fT(n,e){n&1&&We(0)}function gT(n,e){if(n&1&&K(0,fT,1,0,"ng-container",8),n&2){let i=m().$implicit;m();let t=ce(9);f("ngTemplateOutlet",t)("ngTemplateOutletContext",ht(2,Jd,i))}}function yT(n,e){if(n&1&&(a(0,"div",7),x(1,dT,1,4,"ng-container")(2,uT,1,4,"ng-container")(3,hT,1,4,"ng-container")(4,gT,1,4,"ng-container"),l()),n&2){let i,t=e.$implicit,o=m();c(),M((i=t.type)===o.types.SimpleMsg?1:i===o.types.RoundInfoMsg?2:i===o.types.DealtDamageMsg?3:i===o.types.Html?4:-1)}}function _T(n,e){if(n&1&&p(0),n&2){let i=e.log;D(" ",i.message,`
`)}}function vT(n,e){if(n&1&&(g(0,"div",9),xe(1,"safeHtml")),n&2){let i=e.log;f("innerHTML",Me(1,1,i.message),qi)}}function CT(n,e){if(n&1&&(a(0,"div"),p(1),l()),n&2){let i=m().log;c(),D(" ",i.damageBlocked," damage was blocked ")}}function wT(n,e){if(n&1&&(a(0,"div")(1,"span"),p(2),l(),p(3),l()),n&2){let i=m().log;c(),se("color",i.attackingPlayer.color),c(),Ee("",i.attackersNumber," ",i.attacker.name),c(),Ee(" steal ",i.stolenLife," life, reviving ",i.stolenLifeUnitsRestored," units. ")}}function ST(n,e){if(n&1&&(a(0,"div")(1,"span"),p(2),l(),p(3),a(4,"span"),p(5),l(),p(6),x(7,CT,2,1,"div"),x(8,wT,4,6,"div"),l()),n&2){let i=e.log;c(),se("color",i.attackingPlayer.color),c(),Ee("",i.attackersNumber," ",i.attacker.name),c(),Ee(" deal ",i.damage," ",i.isCritical?"critical":""," damage to "),c(),se("color",i.attackedPlayer.color),c(),Ee("",i.attackedNumber," ",i.attacked.name),c(),D(" , killing ",i.losses," units "),c(),M(i.damageBlocked?7:-1),c(),M(i.stolenLife?8:-1)}}function bT(n,e){if(n&1&&(a(0,"div",10),p(1),l()),n&2){let i=e.log;c(),D(" ",i.message," ")}}var b_=(()=>{let e=class e{constructor(t){this.battleLogService=t,this.historyLogElem=It.required("historyLog"),this.types=ar,this.battleLogService.historyEvent$.pipe(Gc()).subscribe(()=>{let o=this.historyLogElem().nativeElement;setTimeout(()=>{o.scrollTo({top:o.scrollHeight,behavior:"smooth"})},0)})}};e.\u0275fac=function(o){return new(o||e)(G(Gn))},e.\u0275cmp=v({type:e,selectors:[["mw-history-log"]],viewQuery:function(o,r){o&1&&Tt(r.historyLogElem,lT,5),o&2&&ei()},standalone:!1,decls:14,vars:0,consts:[["historyLog",""],["simple",""],["htmlLog",""],["dealtDamageLog",""],["roundInfoMsg",""],[1,"history-panel"],[1,"history-log"],[1,"entry"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"],[2,"padding","8px","text-align","center"]],template:function(o,r){o&1&&(a(0,"div",5),p(1," Battle Log: "),a(2,"div",6,0),P(4,yT,5,1,"div",7,j),l()(),K(6,_T,1,1,"ng-template",null,1,ve)(8,vT,2,3,"ng-template",null,2,ve)(10,ST,9,13,"ng-template",null,3,ve)(12,bT,2,1,"ng-template",null,4,ve)),o&2&&(c(4),E(r.battleLogService.history))},dependencies:[Gt,en],styles:[".history-log[_ngcontent-%COMP%]{height:200px;overflow-y:scroll;font-size:13px}.history-panel[_ngcontent-%COMP%]{background-color:#fff}.entry[_ngcontent-%COMP%]{margin-bottom:8px}"]});let n=e;return n})();function xT(n,e){if(n&1&&g(0,"mw-item-icon",1),n&2){let i=e.$implicit;f("item",i)("hintPos","after")}}var Ym=(()=>{let e=class e{constructor(t){this.players=t}ngOnInit(){this.currentPlayer=this.players.getCurrentPlayer(),this.equippedItems=this.currentPlayer.hero.inventory.getEquippedItems()}};e.\u0275fac=function(o){return new(o||e)(G($))},e.\u0275cmp=v({type:e,selectors:[["mw-items-panel"]],standalone:!1,decls:3,vars:0,consts:[[1,"items-container"],[3,"item","hintPos"]],template:function(o,r){o&1&&(a(0,"div",0),P(1,xT,1,2,"mw-item-icon",1,le),l()),o&2&&(c(),E(r.equippedItems))},styles:[".items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:12px}"]});let n=e;return n})();var x_=(n,e)=>({color:n,background:e});function MT(n,e){if(n&1&&(a(0,"div",3),g(1,"mw-ra-icon",4),a(2,"div",5)(3,"div"),p(4),l(),a(5,"div"),p(6),l()()(),a(7,"div",6),g(8,"mw-spell-description",7),l()),n&2){let i=m();c(),f("icon",i.icon().icon)("ngStyle",Oi(8,x_,i.icon().iconClr,i.icon().bgClr)),c(3),H(i.baseType().name),c(2),D("Level ",i.buff().currentLevel),c(2),f("ownerUnit",i.ownerUnit())("hero",i.ownerUnit().ownerPlayer.hero)("player",i.ownerUnit().ownerPlayer)("spell",i.buff())}}var Km=(()=>{let e=class e{constructor(){this.buff=N.required(),this.ownerUnit=N.required(),this.hintPos=N("above"),this.baseType=ae(()=>this.buff().baseType),this.icon=ae(()=>this.baseType().icon)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-buff"]],inputs:{buff:[1,"buff"],ownerUnit:[1,"ownerUnit"],hintPos:[1,"hintPos"]},standalone:!1,decls:4,vars:7,consts:[["buffHint",""],[3,"hintBody","hintPos"],[1,"buff-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"ownerUnit","hero","player","spell"]],template:function(o,r){if(o&1&&(a(0,"mw-hover-hint",1),g(1,"mw-ra-icon",2),l(),K(2,MT,9,11,"ng-template",null,0,ve)),o&2){let s=ce(3);f("hintBody",s)("hintPos",r.hintPos()),c(),f("icon",r.icon().icon)("ngStyle",Oi(4,x_,r.icon().iconClr,r.icon().bgClr))}},styles:[".buff-icon[_ngcontent-%COMP%]{display:block;font-size:24px;border-radius:50%;margin:4px;text-align:center;font-size:18px;width:20px;height:20px}.hint-icon[_ngcontent-%COMP%]{width:38px;font-size:30px;text-align:center;padding-top:5px}"],changeDetection:0});let n=e;return n})();var Zm=(()=>{let e=class e{constructor(){this.curPlayerState=u(Dt),this.spell=N.required(),this.owner=N.required(),this.hero=N(),this.currentUnit=N(),this.onCooldown=N(),this.hintPos=N("above"),this.baseType=ae(()=>this.spell().baseType),this.icon=ae(()=>this.baseType().icon),this.isPassive=ae(()=>this.baseType().activationType===L.Passive),this.disabled=ae(()=>this.currentUnit()!==this.owner()&&!this.isPassive())}onSpellClick(t){t.stopPropagation();let o=(this.hero()?.getState().currentMana||0)+(this.currentUnit()?.getMana()||0);this.onCooldown()||this.disabled()||!this.owner().isAlive||this.isPassive()||o<this.spell().currentManaCost||this.curPlayerState.state.get().playerCurrentState!==Je.WaitsForTurn&&this.curPlayerState.onSpellClick(this.spell(),this.owner())}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-spell"]],inputs:{spell:[1,"spell"],owner:[1,"owner"],hero:[1,"hero"],currentUnit:[1,"currentUnit"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},standalone:!1,decls:1,vars:6,consts:[[3,"click","disabled","owner","hintPos","hero","onCooldown","spell"]],template:function(o,r){o&1&&(a(0,"mw-unit-group-spell-icon",0),y("click",function(d){return r.onSpellClick(d)}),l()),o&2&&f("disabled",r.disabled())("owner",r.owner())("hintPos",r.hintPos())("hero",r.hero())("onCooldown",r.onCooldown())("spell",r.spell())},encapsulation:2,changeDetection:0});let n=e;return n})();var ep=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[Ke,ct]});let n=e;return n})();ot(qm,[Ce,ml],[]);ot(Jo,[Id,Td,Yt,Nn,Vn,Fr,Zi,qm,b_,Ym,wl],[Xi]);ot(Ym,[tn],[]);ot(ml,[Gr,Or,Ce,Qn],[]);ot(wl,[Dn,rl,ll,Ce,sl,Zi,Km,Zm],[Xi]);ot(Km,[Gr,Or,Ce,Qn],[]);ot(Zm,[vs],[]);var M_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke]});let n=e;return n})();var D_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke]});let n=e;return n})();var P_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke]});let n=e;return n})();var E_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke,Nd]});let n=e;return n})();var T_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke,Ry,Zt]});let n=e;return n})();var I_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e}),e.\u0275inj=De({imports:[ct,Ke,ep,M_,P_,D_,T_,E_,Xd,Qd]});let n=e;return n})();var tp=class extends ir{constructor(){super(...arguments),this.feed=u(co)}handleError(e){console.error(e),!e.message.startsWith("NG")&&this.feed.pushSystemError(e)}};var k_=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=Pe({type:e,bootstrap:[S_]}),e.\u0275inj=De({providers:[{provide:ir,useClass:tp}],imports:[ep,I_,Ke,Fp]});let n=e;return n})();var A_={production:!0};A_.production&&void 0;Op().bootstrapModule(k_).catch(n=>console.error(n));
