import{D as h,Da as F,L as P,a as m,b as E,da as j,fc as N,i as H}from"./chunk-KSOMLFX6.js";var X=function(e){return e.GREEN="rgb(124 131 116)",e.RED="rgb(255, 138, 138)",e.BLUE="rgb(105 123 226)",e.GRAY="rgb(182, 182, 182)",e}(X||{}),Y=function(e){return e.DefaultItemIconBg="rgb(43, 16, 76)",e.DefaultItemIconClr="rgb(195, 214, 231)",e.DefautlDebuffBg="rgb(135, 20, 175)",e.DefautlDebuffClr="rgb(255,255,255)",e.DefautlBuffBg="rgb(93 155 93)",e.DefautlBuffClr="rgb(255, 255, 255)",e}(Y||{});function B(e){return(t,r="png")=>`assets/${e}${t}.${r}`}var g=B("units/"),l=B("heroes/"),y=B("resources/"),a={UnitMelee:g("common-melee"),UnitRanged:g("common-ranged"),FireBird:g("fire-bird"),Archer:g("archer"),Pikemen:g("pikemen"),HeroMelee:l("hero-melee"),HeroMage:l("hero-mage"),HeroKnight:l("hero-knight"),HeroTaltir:l("hero-taltir"),HeroHelvetica:l("hero-helvetica"),HeroBlackbird:l("hero-blackbird"),Gold:y("gold"),Wood:y("wood"),Gems:y("gems"),Crystals:y("crystals")},_={gold:a.Gold,wood:a.Wood,gems:a.Gems,crystals:a.Crystals};var n=function(e){return e.Gold="gold",e.Wood="wood",e.RedCrystals="redCrystals",e.Gems="gems",e}(n||{}),ee={[n.Gold]:{imgIcon:"gold",name:"Gold"},[n.Wood]:{name:"Wood",imgIcon:"wood"},[n.RedCrystals]:{name:"Crystals",imgIcon:"crystals"},[n.Gems]:{name:"Gems",imgIcon:"gems"}};var ye={[n.Gold]:1,[n.Wood]:50,[n.Gems]:110,[n.RedCrystals]:500};function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var b=e=>Object.entries(e),O=e=>Object.keys(e);function be(e){return e!=null}function we(e){return e===1/0?"\u221E":e}function A(e){return e!=null}var U={[n.Gems]:"Gems",[n.Gold]:"Gold",[n.RedCrystals]:"Red Crystals",[n.Wood]:"Wood"};function Ve(e){return Object.entries(e).map(([t,r])=>({resName:U[t],type:t,count:r}))}function Ge(e,t){let r=m({},e);for(let o in r)R(r,o)&&(r[o]=r[o]+Math.ceil(r[o]*t));return r}function te(e){return Object.entries(e).map(([t,r])=>`+${r} ${U[t]}`)}function Be(e){return te(e).join(`
`)}function $e(e,t){return Object.entries(t).forEach(([r,o])=>e[r]+=o),e}var De=(e,t,r=1/0)=>b(t).filter(([,o])=>A(o)&&o!==0).reduce((o,[s,i])=>{let x=Math.floor((e[s]??0)/(i??0));return x<o?x:o},r);var c=function(e){return e[e.FreeHtml=0]="FreeHtml",e[e.Resource=1]="Resource",e[e.Resources=2]="Resources",e}(c||{});function Te(e){return`${Math.floor(e*100)}%`}function We(e){return{type:c.FreeHtml,htmlContent:e}}function re(e){return{type:c.FreeHtml,htmlContent:`<div class="spell-descr">${e}</div>`}}function ke(e){return{descriptions:[re(e)]}}var oe=function(e){return e.SimpleMsg="simple-msg",e.RoundInfoMsg="round-info-msg",e.DealtDamageMsg="dealt-damage-msg",e.Html="html",e}(oe||{});var se=function(e){return e.OnHoverEnemyCard="on-hover-enemy-card",e.OnTargetSpell="on-target-spell",e.CustomHtml="custom-html",e}(se||{});var ne=e=>`${e>=0?"+":"-"}${e}`;function w(e){return t=>`${t>=0?"+":""}${t} ${e}`}function u(e){return t=>`${ne(t)}% ${e}`}var T={specialtyNecromancy:"Necromancy",specialtySpiritism:"Spiritism",specialtyMysticism:"Mysticism",specialtyMagic:"Magic",specialtyMagicRecovery:"Restoration",specialtyColdMastery:"Cold Mastery",specialtyFireMastery:"Fire Mastery",specialtyLightningMastery:"Lightning Mastery",specialtyPoisonMastery:"Poison Mastery",specialtyCombatTactics:"Combat Tactics",specialtyArchery:"Archery",specialtyOffence:"Offensive Tactics"},W={heroBonusAttack:w("Attack Rating"),heroBonusDefence:w("Defence"),heroMaxMana:w("Max Mana"),lifesteal:u("Lifesteal"),resistAll:u("All Resists"),resistFire:u("Fire Resist"),resistCold:u("Cold Resist"),resistLightning:u("Lightning Resist"),resistPoison:u("Poison Resist"),cannotBeSlowed:()=>"Cannot be slowed",heroManacostPenalty:w("to Spells Manacost")};function k(e,t){return e in T?`+${t} to ${T[e]}`:e in W?W[e](t):""}var d=class e{constructor(t){this.modsObjectRef=t}static fromObjectRef(t){return new e(t)}setValue(t,r){this.modsObjectRef[t]=r}addValue(t,r){if(typeof r=="number"){this.addNumericModValue(t,r);return}if(typeof r=="boolean"){this.setValue(t,r);return}this.setValue(t,r)}clearValue(t){delete this.modsObjectRef[t]}addNumericModValue(t,r){let o=this.modsObjectRef[t];this.modsObjectRef[t]=typeof o>"u"?r:Number((o+r).toFixed(2))}};function Ye(){return h(j).nativeElement}function _e(){return h(F)}function et(e){let t=h(P);return t.onDestroy(e),t}function tt(){return h(N)}var $={selectItems(e,t,r=0){return e.slice(r,r+t)},randIndex(e){return Math.round((e.length-1)*Math.random())},randItem(e){return e[this.randIndex(e)]},randIntInRange(e,t){let r=t-e+1;return Math.floor(e+r*Math.random())},randIntTo(e){return Math.floor((e+1)*Math.random())},removeItem(e,t){let r=e.indexOf(t);return r===-1?!1:(e.splice(r,1),!0)},removeItemWith(e,t){let r=e.findIndex(t);return r===-1?!1:(e.splice(r,1),!0)},removeItemCopy(e,t){let r=[...e],o=r.indexOf(t);return o===-1||r.splice(o,1),r},randBoolean(){return Math.random()>.5},chanceRoll(e){return Math.random()<e},maxPercent(e,t=1){return e>t?t:e},increaseByPercent(e,t){return e+e*t},nonNegative(e){return e<0?0:e},limitedNumber(e,t,r=0){return e>t?t:e<r?r:e},getRandomItems(e,t){let r=[...e],o=[];for(;t&&r.length;){let[s]=r.splice($.randIndex(r),1);o.push(s),t--}return o}};function ot(e){return e[e.length-1]}var K=class e{constructor(){this.modsRefs=[],this.cachedModValues={},this.childGroups=new Set,this.parentGroups=new Set,this.namedParentGroupsMap=new Map,this.modValuesChange$=new H({}),this.valueUpdater=d.fromObjectRef(this.cachedModValues)}static empty(){return new e}static withRefs(t){let r=new e;return t.forEach(o=>r.addModsRef(o)),r}getCalcNumModValue(t){let r=this.modsRefs.filter(o=>o.hasMod(t));return r.length?r.reduce((o,s)=>o+s.getModValue(t),0):null}getCalcNumModValueOrZero(t){return this.getCalcNumModValue(t)??0}getCalcBoolNumModValue(t){let r=this.modsRefs.filter(o=>o.hasMod(t));return r.length?r.some(o=>o.getModValue(t)):null}addModsRef(t){return this.modsRefs.push(t),this.processModsRef(t),this.childGroups.forEach(r=>r.addModsRef(t)),this.emitModValueChange(),t}removeModsRef(t){$.removeItem(this.modsRefs,t),this.processModsRef(t,!0),this.childGroups.forEach(r=>r.removeModsRef(t)),this.emitModValueChange()}getMods(){return this.cachedModValues}clearOwnModRefs(){[...this.getAllRefs()].forEach(t=>this.removeModsRef(t)),this.emitModValueChange()}getAllRefs(){return this.modsRefs}removeRefByModInstance(t){let r=this.modsRefs.find(o=>o.getMods()===t);r&&this.removeModsRef(r)}getModValue(t){return this.cachedModValues[t]||null}getAllModValues(t){return this.modsRefs.filter(r=>r.hasMod(t)).map(r=>r.getModValue(t))}attachNamedParentGroup(t,r){this.namedParentGroupsMap.has(t)&&(console.warn(`ModGroup: reattaching '${t}' parent mod group, child group:`,this),this.detachNamedParentGroup(t)),this.attachParentGroup(r),this.namedParentGroupsMap.set(t,r)}detachNamedParentGroup(t){let r=this.namedParentGroupsMap.get(t);r&&(this.detachParentGroup(r),this.namedParentGroupsMap.delete(t))}getNamedGroup(t){return this.namedParentGroupsMap.get(t)}onValueChanges(){return this.modValuesChange$}attachParentGroup(t){t.childGroups.add(this),this.parentGroups.add(t),t.getAllRefs().forEach(r=>this.addModsRef(r)),this.emitModValueChange()}detachParentGroup(t){this.parentGroups.delete(t),t.childGroups.delete(this),t.getAllRefs().forEach(r=>this.removeModsRef(r)),this.emitModValueChange()}processModsRef(t,r){b(t.getMods()).forEach(([o,s])=>{if(typeof s=="number"){this.valueUpdater.addValue(o,r?-s:s);return}typeof s=="boolean"&&(r?this.cachedModValues[o]=this.getCalcBoolNumModValue(o)||void 0:!this.cachedModValues[o]&&s&&(this.cachedModValues[o]=!0))})}emitModValueChange(){this.modValuesChange$.next(this.cachedModValues)}};var z=class e{constructor(t){this.mods=t,this.valuesUpdater=d.fromObjectRef(this.mods)}static fromMods(t){return new e(t||{})}getModValue(t){return this.mods[t]||null}setModValue(t,r){this.valuesUpdater.setValue(t,r)}addModValue(t,r){this.valuesUpdater.addValue(t,r)}hasMod(t){return R(this.mods,t)}clearMod(t){this.valuesUpdater.clearValue(t)}getMods(){return this.mods}};var ie="specialty";function yt(e){let t={};for(let r of O(e))r.startsWith(ie)&&(t[r]=e[r]);return t}function ae(e){return`<div class="item-mod">${e}</div>`}function Dt(e){let t=e.staticMods,r=Object.entries(t).map(([o,s])=>ae(k(o,s))).filter(Boolean).join("");return{type:c.FreeHtml,htmlContent:`
      <div class="item-mods">
        ${r}
      </div>
    `}}var ce=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}(ce||{});var M=function(e){return e[e.SandboxMode=0]="SandboxMode",e[e.ScenarioEditor=1]="ScenarioEditor",e[e.NewGameSettings=2]="NewGameSettings",e[e.NewTownSystem=3]="NewTownSystem",e[e.MultiplayerServer=4]="MultiplayerServer",e[e.TECHBanditCampVariety=5]="TECHBanditCampVariety",e}(M||{});var C={logEvents:!1,logGameObjects:!0,logObjectsOnRightClick:!0,showLocationsIds:!1,enableHeroUnits:!0,allowNeutralAIControlByDefault:!1,features:[M.TECHBanditCampVariety,M.NewGameSettings,M.ScenarioEditor]};function Qt(e){return C.features.includes(e)}var v=class v{static getRegisteredEntitiesMap(){return this.entitiesByPrefixMap}static resolve(t){let r=this.allEntitiesMap.get(t);if(!r)throw new Error(`Couldn't resolve entity ${t}`);return r}static resolveMany(t){return t.map(r=>this.resolve(r))}static register(t){if(this.allEntitiesMap.has(t.id)){console.error(`Entity ${t.id} is already registered, registering:`,t);return}let r=le(t.id),o=this.entitiesByPrefixMap.get(r);o?o.push(t):this.entitiesByPrefixMap.set(r,[t]),this.allEntitiesMap.set(t.id,t)}};v.allEntitiesMap=new Map,v.entitiesByPrefixMap=new Map;var p=v;window.entities=p;function le(e){return e.split("-")[0]}function f(e){p.register(e)}function tr(e){return p.resolve(e)}function rr(e){return p.resolveMany(e)}var I={factionsMap:new Map,getAllFactions(){return[...this.factionsMap.values()]},createFaction({id:e,icon:t,title:r}){if(this.factionsMap.has(e))throw new Error(`Faction ${e} was already created.`);let o={id:e,unitTypes:{},heroes:[],title:r,icon:t,townBase:null,setTownBase(s){this.townBase=s,f(s)},getTownBase(){return this.townBase},defineUnitType(s){let i=E(m({defaultTurnsPerRound:1},s),{mainPortraitUrl:s.mainPortraitUrl??a.UnitMelee,faction:this});return f(i),i},findBaseUnitType(s){return Object.values(this.unitTypes).find(i=>i.upgradeDetails?.target===s.id)},createHero(s){let{id:i,abilities:x,army:q,items:J,name:D,resources:L,stats:V,generalDescription:Z,defaultModifiers:Q,image:S}=s,G={id:i,name:D,generalDescription:Z,initialState:{abilities:x,army:q,items:J,resources:L,stats:V,defaultModifiers:Q},image:S??a.HeroMage};return f(G),C.enableHeroUnits&&f({id:`#unit-!hero-${i}`,faction:this,baseRequirements:{},baseStats:{attackRating:V.baseAttack,damageInfo:{minDamage:20,maxDamage:30},defence:V.baseDefence,health:300,speed:15},level:1,isHero:!0,name:D,neutralReward:{experience:10,gold:1},defaultModifiers:{},defaultSpells:[],defaultTurnsPerRound:1,getDescription:()=>({descriptions:[]}),upgraded:!1,mainPortraitUrl:S??a.HeroMage}),this.heroes.push(G),G},getAllHeroes(){return this.heroes}};return f(o),this.factionsMap.set(e,o),o},getFaction(e){return this.factionsMap.get(e)}};var ue=I.createFaction({id:"#faction-castle",title:"Castle",icon:"castle-emblem"});window.mw={humansFaction:ue};var Mr=I.createFaction({id:"#faction-fort",title:"Fort",icon:"spikeball"});export{p as a,f as b,tr as c,rr as d,M as e,C as f,Qt as g,oe as h,se as i,c as j,X as k,Y as l,a as m,_ as n,n as o,ee as p,ye as q,b as r,be as s,we as t,A as u,U as v,Ve as w,Ge as x,Be as y,$e as z,De as A,Te as B,We as C,re as D,ke as E,T as F,Ye as G,_e as H,et as I,tt as J,$ as K,ot as L,K as M,z as N,yt as O,Dt as P,ce as Q,I as R,Mr as S,ue as T};
