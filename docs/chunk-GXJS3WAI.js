import{Ka as S,N as h,_ as H,a as m,b as D,cc as j,ea as P,i as F}from"./chunk-GAC7YG4Y.js";var Q=function(e){return e.GREEN="rgb(124 131 116)",e.RED="rgb(255, 138, 138)",e.BLUE="rgb(105 123 226)",e.GRAY="rgb(182, 182, 182)",e}(Q||{}),X=function(e){return e.DefaultItemIconBg="rgb(43, 16, 76)",e.DefaultItemIconClr="rgb(195, 214, 231)",e.DefautlDebuffBg="rgb(135, 20, 175)",e.DefautlDebuffClr="rgb(255,255,255)",e.DefautlBuffBg="rgb(93 155 93)",e.DefautlBuffClr="rgb(255, 255, 255)",e}(X||{});function G(e){return(t,r="png")=>`assets/${e}${t}.${r}`}var g=G("units/"),l=G("heroes/"),y=G("resources/"),a={UnitMelee:g("common-melee"),UnitRanged:g("common-ranged"),FireBird:g("fire-bird"),Archer:g("archer"),Pikemen:g("pikemen"),HeroMelee:l("hero-melee"),HeroMage:l("hero-mage"),HeroKnight:l("hero-knight"),HeroTaltir:l("hero-taltir"),HeroHelvetica:l("hero-helvetica"),HeroBlackbird:l("hero-blackbird"),Gold:y("gold"),Wood:y("wood"),Gems:y("gems"),Crystals:y("crystals")},Y={gold:a.Gold,wood:a.Wood,gems:a.Gems,crystals:a.Crystals};var n=function(e){return e.Gold="gold",e.Wood="wood",e.RedCrystals="redCrystals",e.Gems="gems",e}(n||{}),_={[n.Gold]:{imgIcon:"gold",name:"Gold"},[n.Wood]:{name:"Wood",imgIcon:"wood"},[n.RedCrystals]:{name:"Crystals",imgIcon:"crystals"},[n.Gems]:{name:"Gems",imgIcon:"gems"}};var xe={[n.Gold]:1,[n.Wood]:50,[n.Gems]:110,[n.RedCrystals]:500};function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var b=e=>Object.entries(e),N=e=>Object.keys(e);function Re(e){return e!=null}function be(e){return e===1/0?"\u221E":e}function O(e){return e!=null}var A={[n.Gems]:"Gems",[n.Gold]:"Gold",[n.RedCrystals]:"Red Crystals",[n.Wood]:"Wood"};function Ie(e){return Object.entries(e).map(([t,r])=>({resName:A[t],type:t,count:r}))}function Ve(e,t){let r=m({},e);for(let o in r)R(r,o)&&(r[o]=r[o]+Math.ceil(r[o]*t));return r}function ee(e){return Object.entries(e).map(([t,r])=>`+${r} ${A[t]}`)}function Ge(e){return ee(e).join(`
`)}function Be(e,t){return Object.entries(t).forEach(([r,o])=>e[r]+=o),e}var $e=(e,t,r=1/0)=>b(t).filter(([,o])=>O(o)&&o!==0).reduce((o,[s,i])=>{let x=Math.floor((e[s]??0)/(i??0));return x<o?x:o},r);var c=function(e){return e[e.FreeHtml=0]="FreeHtml",e[e.Resource=1]="Resource",e[e.Resources=2]="Resources",e}(c||{});function Ue(e){return`${Math.floor(e*100)}%`}function Te(e){return{type:c.FreeHtml,htmlContent:e}}function te(e){return{type:c.FreeHtml,htmlContent:`<div class="spell-descr">${e}</div>`}}function We(e){return{descriptions:[te(e)]}}var re=function(e){return e.SimpleMsg="simple-msg",e.RoundInfoMsg="round-info-msg",e.DealtDamageMsg="dealt-damage-msg",e.Html="html",e}(re||{});var oe=function(e){return e.OnHoverEnemyCard="on-hover-enemy-card",e.OnTargetSpell="on-target-spell",e.CustomHtml="custom-html",e}(oe||{});var se=e=>`${e>=0?"+":"-"}${e}`;function w(e){return t=>`${t>=0?"+":""}${t} ${e}`}function u(e){return t=>`${se(t)}% ${e}`}var U={specialtyNecromancy:"Necromancy",specialtySpiritism:"Spiritism",specialtyMysticism:"Mysticism",specialtyMagic:"Magic",specialtyMagicRecovery:"Restoration",specialtyColdMastery:"Cold Mastery",specialtyFireMastery:"Fire Mastery",specialtyLightningMastery:"Lightning Mastery",specialtyPoisonMastery:"Poison Mastery",specialtyCombatTactics:"Combat Tactics",specialtyArchery:"Archery",specialtyOffence:"Offensive Tactics"},T={heroBonusAttack:w("Attack Rating"),heroBonusDefence:w("Defence"),heroMaxMana:w("Max Mana"),lifesteal:u("Lifesteal"),resistAll:u("All Resists"),resistFire:u("Fire Resist"),resistCold:u("Cold Resist"),resistLightning:u("Lightning Resist"),resistPoison:u("Poison Resist"),cannotBeSlowed:()=>"Cannot be slowed",heroManacostPenalty:w("to Spells Manacost")};function W(e,t){return e in U?`+${t} to ${U[e]}`:e in T?T[e](t):""}var d=class e{constructor(t){this.modsObjectRef=t}static fromObjectRef(t){return new e(t)}setValue(t,r){this.modsObjectRef[t]=r}addValue(t,r){if(typeof r=="number"){this.addNumericModValue(t,r);return}if(typeof r=="boolean"){this.setValue(t,r);return}this.setValue(t,r)}clearValue(t){delete this.modsObjectRef[t]}addNumericModValue(t,r){let o=this.modsObjectRef[t];this.modsObjectRef[t]=typeof o>"u"?r:Number((o+r).toFixed(2))}};function Xe(){return h(P).nativeElement}function Ye(){return h(S)}function _e(e){let t=h(H);return t.onDestroy(e),t}function et(){return h(j)}var B={selectItems(e,t,r=0){return e.slice(r,r+t)},randIndex(e){return Math.round((e.length-1)*Math.random())},randItem(e){return e[this.randIndex(e)]},randIntInRange(e,t){let r=t-e+1;return Math.floor(e+r*Math.random())},randIntTo(e){return Math.floor((e+1)*Math.random())},removeItem(e,t){let r=e.indexOf(t);return r===-1?!1:(e.splice(r,1),!0)},removeItemWith(e,t){let r=e.findIndex(t);return r===-1?!1:(e.splice(r,1),!0)},removeItemCopy(e,t){let r=[...e],o=r.indexOf(t);return o===-1||r.splice(o,1),r},randBoolean(){return Math.random()>.5},chanceRoll(e){return Math.random()<e},maxPercent(e,t=1){return e>t?t:e},increaseByPercent(e,t){return e+e*t},nonNegative(e){return e<0?0:e},limitedNumber(e,t,r=0){return e>t?t:e<r?r:e},getRandomItems(e,t){let r=[...e],o=[];for(;t&&r.length;){let[s]=r.splice(B.randIndex(r),1);o.push(s),t--}return o}};function rt(e){return e[e.length-1]}var k=class e{constructor(){this.modsRefs=[],this.cachedModValues={},this.childGroups=new Set,this.parentGroups=new Set,this.namedParentGroupsMap=new Map,this.modValuesChange$=new F({}),this.valueUpdater=d.fromObjectRef(this.cachedModValues)}static empty(){return new e}static withRefs(t){let r=new e;return t.forEach(o=>r.addModsRef(o)),r}getCalcNumModValue(t){let r=this.modsRefs.filter(o=>o.hasMod(t));return r.length?r.reduce((o,s)=>o+s.getModValue(t),0):null}getCalcNumModValueOrZero(t){return this.getCalcNumModValue(t)??0}getCalcBoolNumModValue(t){let r=this.modsRefs.filter(o=>o.hasMod(t));return r.length?r.some(o=>o.getModValue(t)):null}addModsRef(t){return this.modsRefs.push(t),this.processModsRef(t),this.childGroups.forEach(r=>r.addModsRef(t)),this.emitModValueChange(),t}removeModsRef(t){B.removeItem(this.modsRefs,t),this.processModsRef(t,!0),this.childGroups.forEach(r=>r.removeModsRef(t)),this.emitModValueChange()}getMods(){return this.cachedModValues}clearOwnModRefs(){[...this.getAllRefs()].forEach(t=>this.removeModsRef(t)),this.emitModValueChange()}getAllRefs(){return this.modsRefs}removeRefByModInstance(t){let r=this.modsRefs.find(o=>o.getMods()===t);r&&this.removeModsRef(r)}getModValue(t){return this.cachedModValues[t]||null}getAllModValues(t){return this.modsRefs.filter(r=>r.hasMod(t)).map(r=>r.getModValue(t))}attachNamedParentGroup(t,r){this.namedParentGroupsMap.has(t)&&(console.warn(`ModGroup: reattaching '${t}' parent mod group, child group:`,this),this.detachNamedParentGroup(t)),this.attachParentGroup(r),this.namedParentGroupsMap.set(t,r)}detachNamedParentGroup(t){let r=this.namedParentGroupsMap.get(t);r&&(this.detachParentGroup(r),this.namedParentGroupsMap.delete(t))}getNamedGroup(t){return this.namedParentGroupsMap.get(t)}onValueChanges(){return this.modValuesChange$}attachParentGroup(t){t.childGroups.add(this),this.parentGroups.add(t),t.getAllRefs().forEach(r=>this.addModsRef(r)),this.emitModValueChange()}detachParentGroup(t){this.parentGroups.delete(t),t.childGroups.delete(this),t.getAllRefs().forEach(r=>this.removeModsRef(r)),this.emitModValueChange()}processModsRef(t,r){b(t.getMods()).forEach(([o,s])=>{if(typeof s=="number"){this.valueUpdater.addValue(o,r?-s:s);return}typeof s=="boolean"&&(r?this.cachedModValues[o]=this.getCalcBoolNumModValue(o)||void 0:!this.cachedModValues[o]&&s&&(this.cachedModValues[o]=!0))})}emitModValueChange(){this.modValuesChange$.next(this.cachedModValues)}};var K=class e{constructor(t){this.mods=t,this.valuesUpdater=d.fromObjectRef(this.mods)}static fromMods(t){return new e(t||{})}getModValue(t){return this.mods[t]||null}setModValue(t,r){this.valuesUpdater.setValue(t,r)}addModValue(t,r){this.valuesUpdater.addValue(t,r)}hasMod(t){return R(this.mods,t)}clearMod(t){this.valuesUpdater.clearValue(t)}getMods(){return this.mods}};var ne="specialty";function xt(e){let t={};for(let r of N(e))r.startsWith(ne)&&(t[r]=e[r]);return t}function ie(e){return`<div class="item-mod">${e}</div>`}function $t(e){let t=e.staticMods,r=Object.entries(t).map(([o,s])=>ie(W(o,s))).filter(Boolean).join("");return{type:c.FreeHtml,htmlContent:`
      <div class="item-mods">
        ${r}
      </div>
    `}}var ae=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}(ae||{});var M=function(e){return e[e.SandboxMode=0]="SandboxMode",e[e.ScenarioEditor=1]="ScenarioEditor",e[e.NewGameSettings=2]="NewGameSettings",e[e.NewTownSystem=3]="NewTownSystem",e[e.TECHBanditCampVariety=4]="TECHBanditCampVariety",e}(M||{});var C={logEvents:!1,logGameObjects:!0,logObjectsOnRightClick:!0,showLocationsIds:!1,enableHeroUnits:!0,allowNeutralAIControlByDefault:!1,features:[M.TECHBanditCampVariety,M.NewGameSettings,M.ScenarioEditor]};function Zt(e){return C.features.includes(e)}var p=class{static{this.allEntitiesMap=new Map}static{this.entitiesByPrefixMap=new Map}static getRegisteredEntitiesMap(){return this.entitiesByPrefixMap}static resolve(t){let r=this.allEntitiesMap.get(t);if(!r)throw new Error(`Couldn't resolve entity ${t}`);return r}static resolveMany(t){return t.map(r=>this.resolve(r))}static register(t){if(this.allEntitiesMap.has(t.id)){console.error(`Entity ${t.id} is already registered, registering:`,t);return}let r=ce(t.id),o=this.entitiesByPrefixMap.get(r);o?o.push(t):this.entitiesByPrefixMap.set(r,[t]),this.allEntitiesMap.set(t.id,t)}};window.entities=p;function ce(e){return e.split("-")[0]}function f(e){p.register(e)}function er(e){return p.resolve(e)}function tr(e){return p.resolveMany(e)}var v={factionsMap:new Map,getAllFactions(){return[...this.factionsMap.values()]},createFaction({id:e,icon:t,title:r}){if(this.factionsMap.has(e))throw new Error(`Faction ${e} was already created.`);let o={id:e,unitTypes:{},heroes:[],title:r,icon:t,townBase:null,setTownBase(s){this.townBase=s,f(s)},getTownBase(){return this.townBase},defineUnitType(s){let i=D(m({defaultTurnsPerRound:1},s),{mainPortraitUrl:s.mainPortraitUrl??a.UnitMelee,faction:this});return f(i),i},findBaseUnitType(s){return Object.values(this.unitTypes).find(i=>i.upgradeDetails?.target===s.id)},createHero(s){let{id:i,abilities:x,army:z,items:q,name:$,resources:J,stats:I,generalDescription:L,defaultModifiers:Z,image:E}=s,V={id:i,name:$,generalDescription:L,initialState:{abilities:x,army:z,items:q,resources:J,stats:I,defaultModifiers:Z},image:E??a.HeroMage};return f(V),C.enableHeroUnits&&f({id:`#unit-!hero-${i}`,faction:this,baseRequirements:{},baseStats:{attackRating:I.baseAttack,damageInfo:{minDamage:20,maxDamage:30},defence:I.baseDefence,health:300,speed:15},level:1,isHero:!0,name:$,neutralReward:{experience:10,gold:1},defaultModifiers:{},defaultSpells:[],defaultTurnsPerRound:1,getDescription:()=>({descriptions:[]}),upgraded:!1,mainPortraitUrl:E??a.HeroMage}),this.heroes.push(V),V},getAllHeroes(){return this.heroes}};return f(o),this.factionsMap.set(e,o),o},getFaction(e){return this.factionsMap.get(e)}};var le=v.createFaction({id:"#faction-castle",title:"Castle",icon:"castle-emblem"});window.mw={humansFaction:le};var gr=v.createFaction({id:"#faction-fort",title:"Fort",icon:"spikeball"});export{p as a,f as b,er as c,tr as d,M as e,C as f,Zt as g,re as h,oe as i,c as j,Q as k,X as l,a as m,Y as n,n as o,_ as p,xe as q,b as r,Re as s,be as t,O as u,A as v,Ie as w,Ve as x,Ge as y,Be as z,$e as A,Ue as B,Te as C,te as D,We as E,U as F,Xe as G,Ye as H,_e as I,et as J,B as K,rt as L,k as M,K as N,xt as O,$t as P,ae as Q,v as R,gr as S,le as T};
